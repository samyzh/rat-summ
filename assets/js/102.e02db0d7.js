(window.webpackJsonp=window.webpackJsonp||[]).push([[102],{1839:function(s,a,t){"use strict";t.r(a);var n=t(14),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"版本发布"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#版本发布"}},[s._v("#")]),s._v(" 版本发布")]),s._v(" "),n("h3",{attrs:{id:"作用域scope管理发布包"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#作用域scope管理发布包"}},[s._v("#")]),s._v(" 作用域scope管理发布包")]),s._v(" "),n("p",[s._v("经常有看到"),n("code",[s._v("@xxx/yyy")]),s._v("类型的开源npm包，"),n("strong",[s._v("原因是包名称难免会有重名")]),s._v("，如果已经有人在 "),n("code",[s._v("npm")]),s._v(" 上注册该包名，再次 "),n("code",[s._v("npm publish")]),s._v(" 同名包时会告知发布失败，这时可以通过 "),n("code",[s._v("scope")]),s._v(" 作用域来解决")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("定义作用域包")]),s._v(" "),n("p",[s._v("修改package.json中包名称：")]),s._v(" "),n("div",{staticClass:"language-json line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-json"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"name"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"@username/project-name"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("blockquote",[n("p",[s._v("需要注意的是，"),n("strong",[s._v("如果是发布到官方registry，scope一定要是自己注册的用户名，而如果是发布到自己的npm私服，scope可以不是用户名")])])])]),s._v(" "),n("li",[n("p",[s._v("发布作用域包")]),s._v(" "),n("p",[s._v("作用域模块默认发布是私有的")]),s._v(" "),n("p",[s._v("发布到官方registry时，直接"),n("code",[s._v("npm publish")]),s._v("会报错，"),n("code",[s._v("原因是只有付费用户才能发布私有 scope 包，免费用户只能发布公用包")]),s._v("，"),n("strong",[s._v("因此需要添加 "),n("code",[s._v("access=public")]),s._v(" 参数；发布到自己的npm私服时，不加"),n("code",[s._v("access=public")]),s._v("参数也可以发布")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" publish --access"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("public\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("使用作用域包")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" @username/project-name\nvar projectName "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" require"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'@username/project-name'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])])])]),s._v(" "),n("h3",{attrs:{id:"发布"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#发布"}},[s._v("#")]),s._v(" 发布")]),s._v(" "),n("h4",{attrs:{id:"常用发布步骤"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#常用发布步骤"}},[s._v("#")]),s._v(" 常用发布步骤")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(". Login\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" adduser --registry http://172.21.64.25:7373\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(". Publish\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" publish --registry http://172.21.64.25:7373\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(". Refresh this page.\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" adduser\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#npm config set registry http://localhost:8081/repository/group-npm/")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#或者设置npm; .npmrc ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" login\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" publish\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h4",{attrs:{id:"发布到github上的步骤"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#发布到github上的步骤"}},[s._v("#")]),s._v(" 发布到github上的步骤")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("// Step "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(": Use "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("publishConfig"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v(" option "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" your package.json\n"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"publishConfig"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"registry"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://npm.pkg.github.com/"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n// Step "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(": Authenticate\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" login --registry"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https://npm.pkg.github.com/\n\n// Step "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(": Publish\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" publish\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("div",{staticClass:"language-json line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-json"}},[n("code",[n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"name"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"@samy/rat-widget"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"repository"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://github.com/samy/rat-widget"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"publishConfig"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"registry"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://npm.pkg.github.com/samy"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h4",{attrs:{id:"发布与撤销包"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#发布与撤销包"}},[s._v("#")]),s._v(" 发布与撤销包")]),s._v(" "),n("p",[s._v("在项目根目录下运行"),n("code",[s._v("$ npm publish")]),s._v("发布新包。")]),s._v(" "),n("p",[s._v("运行"),n("code",[s._v("$ npm unpublish 包名 --force")]),s._v("撤销发布包。")]),s._v(" "),n("div",{staticClass:"language-json line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-json"}},[n("code",[s._v("  "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"scripts"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"c"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"babel src -d lib"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"w"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"npm run c -- -watch"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"start"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"npm run w"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"b"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"npm publish"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"bc"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"npm --force unpublish rat-cli"')]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("h2",{attrs:{id:"私服搭建"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#私服搭建"}},[s._v("#")]),s._v(" 私服搭建")]),s._v(" "),n("h3",{attrs:{id:"需求与背景"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#需求与背景"}},[s._v("#")]),s._v(" 需求与背景")]),s._v(" "),n("h4",{attrs:{id:"需求"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#需求"}},[s._v("#")]),s._v(" 需求")]),s._v(" "),n("ul",[n("li",[s._v("公司开发环境与外网隔绝，需要搭建内网私有npm库，确保私密性")]),s._v(" "),n("li",[s._v("确保npm服务快速、稳定，减少开发人员和"),n("em",[s._v("CI")]),s._v("服务器的重复下载量并提高下载速度")]),s._v(" "),n("li",[s._v("控制npm模块质量和安全，对于下载、发布npm包有对应的权限管理")])]),s._v(" "),n("h4",{attrs:{id:"当下流行的解决方案"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#当下流行的解决方案"}},[s._v("#")]),s._v(" "),n("strong",[s._v("当下流行的解决方案")])]),s._v(" "),n("ul",[n("li",[n("h5",{attrs:{id:"使用-nexus-搭建-npm-私服"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用-nexus-搭建-npm-私服"}},[s._v("#")]),s._v(" 使用 Nexus 搭建 npm 私服")]),s._v(" "),n("p",[s._v("Nexus仓库管理平台支持范围广泛，可用于maven、npm等仓库。")])]),s._v(" "),n("li",[n("h5",{attrs:{id:"使用-verdaccio搭建-npm-私服【推荐】"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用-verdaccio搭建-npm-私服【推荐】"}},[s._v("#")]),s._v(" 使用 verdaccio搭建 npm 私服【推荐】")]),s._v(" "),n("p",[s._v("verdaccio是一个零配置的私有的带缓存功能的npm包管理工具。")]),s._v(" "),n("p",[s._v("sinopia 在15年的时候就停止更新了，继而由 "),n("a",{attrs:{href:"https://github.com/verdaccio/verdaccio",target:"_blank",rel:"noopener noreferrer"}},[s._v("verdaccio"),n("OutboundLink")],1),s._v(" 提供更新升级，两者用法基本上都是一致的。对于企业级的应用来说，技术选型时请慎重选择sinopia，建议选择verdaccio。")])]),s._v(" "),n("li",[n("h5",{attrs:{id:"使用cnpm-cnpmjs-org搭建"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用cnpm-cnpmjs-org搭建"}},[s._v("#")]),s._v(" 使用cnpm+cnpmjs.org搭建")]),s._v(" "),n("p",[n("code",[s._v("sinopia")]),s._v(" 的优点是配置简单，对环境依赖少（仅 node 就够了），并且支持 "),n("code",[s._v("windows")]),s._v(" 系统下运行。，"),n("code",[s._v("sinopia")]),s._v(" 比较适合个人搭建在本地作为 npm 缓存，这样，安装过的包会直接从缓存中获取，加快安装速度。")]),s._v(" "),n("p",[s._v("对于企业级的应用来说，就需要另外一个解决方案了："),n("a",{attrs:{href:"https://github.com/cnpm/cnpm",target:"_blank",rel:"noopener noreferrer"}},[s._v("cnpm"),n("OutboundLink")],1),s._v(" + "),n("a",{attrs:{href:"https://github.com/cnpm/cnpmjs.org",target:"_blank",rel:"noopener noreferrer"}},[s._v("cnpmjs.org"),n("OutboundLink")],1)])])]),s._v(" "),n("h4",{attrs:{id:"两种解决方案的对比"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#两种解决方案的对比"}},[s._v("#")]),s._v(" 两种解决方案的对比")]),s._v(" "),n("blockquote",[n("h5",{attrs:{id:"nexus-verdaccio比较"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nexus-verdaccio比较"}},[s._v("#")]),s._v(" Nexus&verdaccio比较")])]),s._v(" "),n("ul",[n("li",[s._v("都缓存了从proxy仓库下载过的包，没有同步整个proxy仓库的包。")]),s._v(" "),n("li",[s._v("存储方式："),n("strong",[s._v("nexus使用blob store，sinopia直接保存包文件到storage目录。")])]),s._v(" "),n("li",[s._v("nexus管理界面可以清缓存；verdaccio貌似没有命令和工具，但是可以删除通过删除storage目录下包目录的方式清除缓存。")]),s._v(" "),n("li",[s._v("使用nexus时，"),n("code",[s._v("发布包")]),s._v("和"),n("code",[s._v("安装、卸载包")]),s._v("需要设置不同的registry，而Sinopia一直用同一个就可以。")]),s._v(" "),n("li",[n("strong",[s._v("nexus管理页面上展示了更多的包信息，相比而言sinopia也就是nodejs风格的包主页上信息较少。")])]),s._v(" "),n("li",[s._v("verdaccio更适合前端工程，优点是配置简单，对环境依赖少（仅node就够了），并且支持在windows系统下运行；nexus支持仓库种类最多，是用户群体最大的一个仓库平台，maven、docker、npm、gradle均支持，java需要maven仓库、android需要gradle仓库、运维需要docker仓库，前端需要npm仓库，如果公司已有nexus平台管理这些仓库，接入新的仓库会较方便。")]),s._v(" "),n("li",[s._v("verdaccio的权限管理比较弱，对用户权限，发布权限，下载权限控制不是很得心应手")])]),s._v(" "),n("p",[s._v("以上的情况并没有考虑在遇到一些黑客攻击的情况下，所以"),n("strong",[s._v("为了尽量保证代码的安全，可以在前端加一层 Nginx 然后配置 SSH 公钥来作为双层验证。")])]),s._v(" "),n("ul",[n("li",[s._v("以上nginx相关配置，可以参考下面的cnpm中nginx配置设置；")]),s._v(" "),n("li",[s._v("防火墙端口开放，可以参考下面verdaccio中iptables的设置；")])]),s._v(" "),n("h3",{attrs:{id:"搭建过程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#搭建过程"}},[s._v("#")]),s._v(" 搭建过程")]),s._v(" "),n("h4",{attrs:{id:"使用nexus"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用nexus"}},[s._v("#")]),s._v(" 使用Nexus")]),s._v(" "),n("h5",{attrs:{id:"docker安装方式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#docker安装方式"}},[s._v("#")]),s._v(" docker安装方式")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("docker pull sonatype/nexus3\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker volume create --name nexus-data")]),s._v("\ndocker run  --restart"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("always -d -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8081")]),s._v(":8081 --name nexus -v /data/nexus:/nexus-data sonatype/nexus3\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h5",{attrs:{id:"源码安装方式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#源码安装方式"}},[s._v("#")]),s._v(" 源码安装方式")]),s._v(" "),n("ul",[n("li",[n("h5",{attrs:{id:"下载解压"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#下载解压"}},[s._v("#")]),s._v(" 下载解压")]),s._v(" "),n("p",[s._v("官方下载链接]("),n("a",{attrs:{href:"https://help.sonatype.com/repomanager3/download",target:"_blank",rel:"noopener noreferrer"}},[s._v("help.sonatype.com/repomanager…"),n("OutboundLink")],1),s._v(")，执行：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://download.sonatype.com/nexus/3/latest-unix.tar.gz "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#下载")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" latest-unix.tar.gz /opt/nexus3.tar.gz "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#移动到 /opt 目录")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -xzvf nexus3.tar.gz "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#解压")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("blockquote",[n("p",[s._v("注意运行Nexus需要Java 8 运行时环境(JRE)，请自行安装。")])])]),s._v(" "),n("li",[n("h5",{attrs:{id:"创建运行用户"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建运行用户"}},[s._v("#")]),s._v(" 创建运行用户")]),s._v(" "),n("p",[s._v("单独创建一个 nexus 用户用来运行")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建用户、指定用户目录、授权")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("useradd")]),s._v(" -d /home/nexus -m nexus\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" -R nexus:nexus /home/nexus\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" -R nexus:nexus /opt/nexus-3.15.2-01\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" -R nexus:nexus /opt/sonatype-work/\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("修改运行用户配置项：修改 /opt/nexus-3.15.2-01/bin 目录下的配置文件nexus.rc为 "),n("code",[s._v('run_as_user="nexus"')])])]),s._v(" "),n("li",[n("h5",{attrs:{id:"运行"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#运行"}},[s._v("#")]),s._v(" 运行")]),s._v(" "),n("p",[n("strong",[s._v("修改端口指8073并开放iptables防火墙")]),s._v("，对"),n("code",[s._v("/opt/sonatype-work/nexus3/etc/nexus.properties")]),s._v("文件进行修改:")]),s._v(" "),n("div",{staticClass:"language-properties line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-properties"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Jetty section                                                     ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("application-port")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("8073")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("application-host")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("0.0.0.0                                                                 # nexus-args=${jetty.etc}/jetty.xml,${jetty.etc}/jetty-http.xml,${jetty.etc}/jetty-requestlog.xml                                               ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nexus-context-path=/                                                                   # Nexus section                                                                         # nexus-edition=nexus-pro-edition                                                       # nexus-features=\\                                                                       #  nexus-pro-feature  ")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("启动服务，以下为nexus服务命令:")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" nexus start "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动 nexus 服务")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" nexus restart "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启 nexus 服务")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" nexus stop "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 停止 nexus 服务")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" nexus status "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看 nexus 服务状态")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("查看日志检查服务状态：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v(" -f /opt/sonatype-work/nexus3/log/nexus.log\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("至此，nexus 服务已搭建完毕！可使用默认账号admin/admin123 登录ip:8073后对npm仓库进行管理")]),s._v(" "),n("p",[n("img",{attrs:{src:t(592),alt:"image-20200823000635046"}})])]),s._v(" "),n("li",[n("h5",{attrs:{id:"仓库管理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#仓库管理"}},[s._v("#")]),s._v(" 仓库管理")]),s._v(" "),n("p",[s._v("创建仓库，npm 仓库有三种，这三种我们都需要创建")]),s._v(" "),n("p",[n("img",{attrs:{src:t(593),alt:"image-20200823000809366"}})]),s._v(" "),n("ol",[n("li",[n("p",[s._v("npm(proxy) - 代理npm仓库")]),s._v(" "),n("p",[s._v("将公共 npm 服务器的资源代理缓存，减少重复下载，加快开发人员和CI服务器的下载速度。")]),s._v(" "),n("p",[s._v("创建时需填写Name("),n("code",[s._v("npm-external")]),s._v(")和Remote Storage(公有库地址，填写官方或淘宝镜像，"),n("code",[s._v("https://registry.npmjs.org/")]),s._v(")。")]),s._v(" "),n("p",[s._v("该仓库地址为："),n("code",[s._v("http://ip:8073/repository/npm-external/")])])]),s._v(" "),n("li",[n("p",[s._v("npm(hosted) - 私有npm仓库")]),s._v(" "),n("p",[s._v("用于 上传自己的npm包 以及第三方npm包。")]),s._v(" "),n("p",[s._v("创建时只需填写Name("),n("code",[s._v("npm-internal")]),s._v(")。")]),s._v(" "),n("p",[s._v("该仓库地址为："),n("code",[s._v("http://ip:8073/repository/npm-internal/")])]),s._v(" "),n("blockquote",[n("p",[s._v("请注意：发布包时请将registry设为该地址。")])])]),s._v(" "),n("li",[n("p",[s._v("npm(group) - npm仓库组")]),s._v(" "),n("p",[s._v("用于将多个内部或外部 npm 仓库统一为一个 npm仓库。可以新建一个npm仓库组将 上面两个刚刚创建的两个 npm 仓库都添加进去。这样可以通过这个 npm仓库组，既可以访问 公有npm仓库 又可以访问自己的 私有npm仓库。")]),s._v(" "),n("p",[s._v("创建时需填写Name("),n("code",[s._v("npm-all")]),s._v(")，然后选择需要添加到组里的 其他 npm 仓库("),n("code",[s._v("npm-external")]),s._v("和"),n("code",[s._v("npm-internal")]),s._v(")。")]),s._v(" "),n("p",[s._v("该仓库地址为："),n("code",[s._v("http://ip:8073/repository/npm-all/")])]),s._v(" "),n("blockquote",[n("p",[s._v("请注意：安装包以及卸载包时请将registry设为该地址。")])])])]),s._v(" "),n("h5",{attrs:{id:"用户管理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#用户管理"}},[s._v("#")]),s._v(" 用户管理")]),s._v(" "),n("p",[s._v("将包发布到nexus npm仓库需要"),n("strong",[s._v("设置一下 Nexus Repository Manager 的权限。否则无法登陆到我们的私服")]),s._v("。在Security->Realms栏目里，将"),n("code",[s._v("npm Bearer Token Realm")]),s._v(" 选入Active。")]),s._v(" "),n("p",[n("img",{attrs:{src:t(594),alt:"image-20200823000856050"}})]),s._v(" "),n("p",[s._v("之后我们需要在Security->Users栏目里添加用户，只有这样添加的用户才可以发布包。经测试，在客户端使用 "),n("code",[s._v("npm adduser")]),s._v(" 创建的用户没有发布权限。")])])]),s._v(" "),n("p",[n("strong",[s._v("Docker方式安装：")])]),s._v(" "),n("ul",[n("li",[s._v("下载 "),n("code",[s._v("docker pull sonatype/nexus3")])]),s._v(" "),n("li",[s._v("运行 "),n("code",[s._v("docker run -d -p 8081:8081 sonatype/nexus3")])]),s._v(" "),n("li",[s._v("打开 http://localhost:8081/")]),s._v(" "),n("li",[s._v("用户名为 "),n("code",[s._v("admin")]),s._v(";   "),n("code",[s._v("find / -name 'admin.password'")]),s._v(" "),n("code",[s._v("cat 上面那个文件")]),s._v(" 就可以看到密码")])]),s._v(" "),n("h4",{attrs:{id:"使用verdaccio"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用verdaccio"}},[s._v("#")]),s._v(" 使用verdaccio")]),s._v(" "),n("p",[s._v("verdaccio是"),n("code",[s._v("nodejs")]),s._v(" 创建的轻量的私有npm proxy registry，froked于"),n("code",[s._v("sinopia@1.4.0")]),s._v(" ,是一个开源的npm私有库的搭建工具，可以搭建一套属于自己公司的npm仓库。")]),s._v(" "),n("ul",[n("li",[s._v("与"),n("code",[s._v("yarn")]),s._v(" 、"),n("code",[s._v("npm")]),s._v(" 和"),n("code",[s._v("pnmp")]),s._v("  100%兼容")]),s._v(" "),n("li",[s._v("提供的Docker和Kubernetes支持，很容易安装和使用")]),s._v(" "),n("li",[s._v("发布的包是私有和配置访问权限")]),s._v(" "),n("li",[s._v("verdaccio是需要缓存所有相关项，并且在本地或者私有网络下可以加速安装")])]),s._v(" "),n("blockquote",[n("p",[s._v("后面推荐用docker方式安装，方便统一管理；")])]),s._v(" "),n("h5",{attrs:{id:"配置说明【要点】"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置说明【要点】"}},[s._v("#")]),s._v(" 配置说明【要点】")]),s._v(" "),n("p",[s._v("config.yaml文件配置信息：https://verdaccio.org/docs/en/configuration")]),s._v(" "),n("p",[s._v("配置文件在"),n("code",[s._v("/root/.config/verdaccio/config.yaml")]),s._v("，相关配置字段意义在文件中都有注释")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# path to a directory with all packages")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("storage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /home/"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("user"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("/.local/share/verdaccio/storage "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 库存路径，需要考虑磁盘空间")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 包含所有包的目录路径,npm私服包的存放目录以及缓存地址")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("storage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ./storage "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置全路径，或者相对路径；")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 包含plugins的目录路径,默认插件的文件位置，一般只对docker部署有关系")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("plugins")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ./plugins\n\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("web")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 自定义web项，即浏览器访问页面")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("title")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Verdaccio\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# comment out to disable gravatar support 注释掉gravatar禁止使用")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# gravatar: false")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# by default packages are ordercer ascendant (asc|desc)  默认的packages是准备好的两个选择")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sort_packages: asc")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# convert your UI to the dark side  用户界面是黑夜模式")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# darkMode: true")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# translate your registry, api i18n not available yet  看看下你的注册表，i18n api还不能使用")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# i18n:")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# list of the available translations 查看可以使用的注册列表的地址：https://github.com/verdaccio/ui/tree/master/i18n/translations")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   web: en-US")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("auth")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("htpasswd")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("file")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ./htpasswd "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加用户（npm adduser）后自动创建，保存用户信息，可以初始化用户")]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# Maximum amount of users allowed to register, defaults to "+inf".允许注册的最大用户数量，可以是无穷大')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# You can set this to -1 to disable registration. 你可以设置-1去禁止用户通过 npm adduser 去注册")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# max_users: 1000  #默认注册人数最大数量是1000")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("uplinks")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可以配置多个上游地址，后面packages中的proxy指定用哪个")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("npmjs")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# url: https://registry.npmjs.org/")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("url")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" https"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//registry.npm.taobao.org/ "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 更改此上游地址")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("agent_options")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#代理的配置项")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("keepAlive")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v(" \n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("maxSockets")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("40")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("maxFreeSockets")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 包的权限管理，$all为所有人，$authenticated为通过验证人")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 分布和安装两种权限，值可以特指某几人")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("packages")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("'@*/*'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 跟package.json中的name属性进行匹配 # 一种是@/表示某下面所属的某项目,关键字匹配")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# scoped packages   配置权限管理")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("access")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" $all "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 表示哪一类用户可以对匹配的项目进行安装(install)和查看包的信息")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("publish")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" $authenticated "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 表示哪一类用户可以对匹配的项目进行发布(publish)")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("unpublish")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" $authenticated "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 表示哪一类用户可以对匹配的项目进行卸载(publish)")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# proxy: npmjs # 这里的值是对应于 uplinks 的名称，如果本地不存在，允许去对应的uplinks去拉取")]),s._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("'**'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 另一种是*匹配项目名称(名称在package.json中有定义)")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# allow all users (including non-authenticated users) to read and")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# publish all packages")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 允许所有用户（包括未经身份验证的用户）读取和发布所有包")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# you can specify usernames/groupnames (depending on your auth plugin) 您可以指定用户名/组织名称（取决于验证身份的插件）")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# and three keywords: "$all", "$anonymous", "$authenticated" 三个关键字:所有的,匿名的,验证过的  也可以使用具体的用户名或者组织名称(公司私有的名字)和配置的用户表 htpasswd 有关')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("access")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" $all\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# allow all known users to publish/publish packages 允许所有用户去发布包")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# (anyone can register by default, remember?)  任何人都可以默认注册")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("publish")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" $authenticated\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("unpublish")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" $authenticated\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# if package is not available locally, proxy requests to 'npmjs' registry 如果包不允许在本机使用，可以用proxy请求npmjs注册表的代理")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("proxy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" npmjs\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# You can specify HTTP/1.1 server keep alive timeout in seconds for incoming connections. 传入的指定连接的HTTP/1.1服务器保持活跃状态直到超时，以秒为单位")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# A value of 0 makes the http server behave similarly to Node.js versions prior to 8.0.0, which did not have a keep-alive timeout.  值为0的时候的服务表现行为和8.0.0之前版本的nodejs链接的时候没有保持活跃状态导致超时")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# WORKAROUND: Through given configuration you can workaround following issue  解决办法：通过已知的配置，你可以解决这些问题: https://github.com/verdaccio/verdaccio/issues/301. Set to 0 in case 60 is not enough.  如果60不够的话可以设置为0")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("server")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("keepAliveTimeout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v(" \n\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("middlewares")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("audit")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("enabled")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("logs")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" stdout"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("format")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pretty"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("level")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#- {type: file, path: verdaccio.log, level: info}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#experiments: 实验性的")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  # support for npm token command  支持npm的token令牌")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  token: false")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  # support for the new v1 search endpoint, functional by incomplete read more on ticket 1732")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  search: false")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  # disable writing body size to logs, read more on ticket 1912")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  bytesin_off: false")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# This affect the web and api (not developed yet) 这些会影响web和api(尚未开发的功能)")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#i18n:")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#web: en-US")]),s._v("\n  \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#默认是没有的，只能在本机访问，添加后可以通过外网访问")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("listen")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 0.0.0.0"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4873")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置监听地址，0.0.0.0匹配本机地址")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br")])]),n("blockquote",[n("h4",{attrs:{id:"私有库的权限管理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#私有库的权限管理"}},[s._v("#")]),s._v(" 私有库的权限管理")])]),s._v(" "),n("p",[s._v("因为verdaccio默认是人人都可以注册的，所以需要先将注册窗口关闭")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("auth")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("htpasswd")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("file")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ./htpasswd\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("max_users")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("-1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 此配置项可以关闭注册功能")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("verdaccio 的认证是基于 "),n("a",{attrs:{href:"https://www.npmjs.com/package/verdaccio-htpasswd",target:"_blank",rel:"noopener noreferrer"}},[s._v("verdaccio-htpasswd"),n("OutboundLink")],1),s._v("， 可以通过官方提供的工具来生成 "),n("a",{attrs:{href:"http://www.htaccesstools.com/htpasswd-generator/",target:"_blank",rel:"noopener noreferrer"}},[s._v("htaccesstools"),n("OutboundLink")],1),s._v("，将生成的段字符串添加到 "),n("code",[s._v("htpasswd")]),s._v(" 中即可，这样的话就可以登录npm私有库")]),s._v(" "),n("p",[s._v("之后就需要修改verdaccio文件下的config.yaml的配置：针对不同的包来设置access，publish，unpublish对应的权限组，因为htpasswd是默认的鉴权插件，所以只能写入相应的用户名，all，authenticated，$anonymous")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("auth")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("htpasswd")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("file")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ./htpasswd\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("max_users")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("-1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#此配置项可以关闭注册功能")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("duGroup")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#这里可以自定义用户组")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("demoPublish")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("xiaoming"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" xiaohong"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" xiaoli"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("demoUnpublish")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("xiaojun"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" xiaoming"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("testPublish")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("xiaoming"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("xiaojun"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("packages")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("'@demo/*'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("access")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" $all\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#针对不同的包，可以指定不同的用户组来满足权限控制")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("publish")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" demoPublish\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("unpublish")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" demoUnpublish\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("proxy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" npmjs\n     "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("'test'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("access")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" $all\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("publish")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" testPublish\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("unpublish")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" demoUnpublish\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("proxy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" npmjs\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br")])]),n("p",[s._v("或者通过安装"),n("a",{attrs:{href:"https://www.npmjs.com/package/htpasswd-for-sinopia",target:"_blank",rel:"noopener noreferrer"}},[s._v("htpasswd-for-sinopia"),n("OutboundLink")],1),s._v("工具来添加账号")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" htpasswd-for-sinopia -g\n sinopia-adduser   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#在 htpasswd 目录执行")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("为其他登录的用户生成用户名和密码，之后将用户名和密码写入verdaccio文件夹下的htpasswd文件中，然后就跟上文是一样的步骤。")]),s._v(" "),n("h5",{attrs:{id:"源码方式安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#源码方式安装"}},[s._v("#")]),s._v(" 源码方式安装")]),s._v(" "),n("ul",[n("li",[n("h5",{attrs:{id:"服务器上安装node"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#服务器上安装node"}},[s._v("#")]),s._v(" 服务器上安装node")]),s._v(" "),n("p",[s._v("Node 官网已经把 linux 下载版本更改为已编译好的版本了，可以直接下载解压后使用，"),n("a",{attrs:{href:"https://nodejs.org/dist/",target:"_blank",rel:"noopener noreferrer"}},[s._v("下载链接"),n("OutboundLink")],1)]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://nodejs.org/dist/v11.9.0/node-v11.9.0-linux-x64.tar.gz   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#下载")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" xf node-v11.9.0-linux-x64.tar.gz       "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#解压")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" node-v11.9.0-linux-x64/                 "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进入解压目录")]),s._v("\n$ ./bin/node -v                              "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#执行node命令 查看版本")]),s._v("\nv11.9.0\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("使用ln命令设置软链接到/usr/local/bin目录，/usr/local/bin是给用户放置自己的可执行程序的地方：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" -s /usr/local/node-v11.9.0-linux-x64/bin/npm   /usr/local/bin/ \n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" -s /usr/local/node-v11.9.0-linux-x64/bin/node   /usr/local/bin/\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])])]),s._v(" "),n("li",[n("h5",{attrs:{id:"服务器上安装verdaccio"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#服务器上安装verdaccio"}},[s._v("#")]),s._v(" 服务器上安装verdaccio")]),s._v(" "),n("p",[s._v("使用默认npmjs.org registry，在服务器上安装verdaccio：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code")]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"})])])]),s._v(" "),n("p",[s._v("$ npm install -g verdaccio\n$ verdaccio"),n("br"),s._v("\n-bash: verdaccio: command not found     #测试verdaccio命令，此时会报找不到命令")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("\n找不到命令，原因在于环境变量没设置，修改/etc/profile文件，在末尾添加以下内容：\n\n```bash\nexport NODE_HOME=/usr/local/node-v11.9.0-linux-x64  #Node所在路径\nexport PATH=$NODE_HOME/bin:$PATH\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[s._v("执行命令 source /etc/profile使生效，再次运行verdaccio：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("$ verdaccio doesn"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'t need superuser privileges. Don'")]),s._v("t run it under root.\n warn  --- config "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("  - /root/.config/verdaccio/config.yaml\n warn  --- http address - http://localhost:4873/\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("修改iptables设置，开放4873端口：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("$ iptables -I INPUT "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" -p tcp -m state --state NEW -m tcp --dport "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4873")]),s._v("  -j ACCEPT        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#允许 4873  端口")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" iptables save                         "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#保存 iptables  规则")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[n("strong",[s._v("【坑1】访问虚拟机的npm仓库地址被拒绝")])]),s._v(" "),n("p",[s._v("除了开放iptables的4873端口外，还需要在sinopia的配置文件末尾加上：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("listen: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:4873\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("重新启动")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("$ Sinopia doesn"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'t need superuser privileges. Don'")]),s._v("t run it under root.\n warn  --- config "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("  - /root/.config/verdaccio/config.yaml\n warn  --- http address - http://0.0.0.0:4873/\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("这样我们就能通过自己虚拟机的ip:4873访问了")]),s._v(" "),n("ul",[n("li",[n("h5",{attrs:{id:"使用守护进程启动-pm2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用守护进程启动-pm2"}},[s._v("#")]),s._v(" 使用守护进程启动（pm2）")])])]),s._v(" "),n("p",[s._v("​\t安装："),n("code",[s._v("npm install -g pm2")]),s._v(" 启动："),n("code",[s._v("pm2 start verdaccio")])]),s._v(" "),n("ul",[n("li",[n("h5",{attrs:{id:"用户管理-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#用户管理-2"}},[s._v("#")]),s._v(" 用户管理")]),s._v(" "),n("p",[s._v("配置文件中关于鉴权的默认配置为：")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("auth")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("htpasswd")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("file")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ./htpasswd   //保存用户的账号密码等信息\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# Maximum amount of users allowed to register, defaults to "+inf".')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# You can set this to -1 to disable registration.")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("max_users")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 1000  //默认为1000，改为"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("1后，禁止注册\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[s._v("添加用户的方法：在客户端终端运行 "),n("code",[s._v("npm adduser --registry http://xxxxx:4873/")]),s._v(" ，设置相应的用户名、密码、邮箱后即可登录、发布包。")]),s._v(" "),n("p",[n("strong",[s._v("如果将配置项max_users设为-1，表示禁用 npm adduser 命令来创建用户，需手动在htpasswd文件中添加用户信息来初始化用户。")])])])]),s._v(" "),n("h5",{attrs:{id:"npm方式安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#npm方式安装"}},[s._v("#")]),s._v(" npm方式安装")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -g verdaccio  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#npm下载")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("yarn")]),s._v(" global "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" verdaccio  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#yarn下载  用yarn下载的时候 verdaccio运行不起来的时候请换成npm下载")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#或者nrm切换下源地址  要是报权限错误的话，请选择cmd<以管理员身份运行>在输入一次")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#或者在cmd输入下面的命令：--unsafe-perm添加上是为了防止报 gyp ERR! permission denied 的权限问题")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -g verdaccio --unsafe-perm\nverdaccio\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令行工具")]),s._v("\nverdaccio --listen "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4000")]),s._v(" --config ~./config.yaml\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -g pm2 "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#安装pm2")]),s._v("\npm2 start verdaccio "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启动verdaccio  status为online即为成功 ")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("h5",{attrs:{id:"docker方式安装【推荐】"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#docker方式安装【推荐】"}},[s._v("#")]),s._v(" "),n("strong",[s._v("Docker方式安装")]),s._v("【推荐】")]),s._v(" "),n("p",[n("strong",[s._v("1: 拉取镜像")])]),s._v(" "),n("p",[n("strong",[s._v("一般倾向于指定版本")]),s._v("; 提供的Docker镜像版本 : https://hub.docker.com/r/verdaccio/verdaccio/tags/")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("docker pull verdaccio/verdaccio:4\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[n("strong",[s._v("2: 资源外挂映射")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("docker run --restart"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("always -d  --name verdaccio4.7.2 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n                     -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7373")]),s._v(":4873 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(" \n           -v /data/verdaccio/conf:/verdaccio/conf "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n           -v /data/verdaccio/storage:/verdaccio/storage "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n           -v /data/verdaccio/plugins:/verdaccio/plugins "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n           -v /data/verdaccio/node_modules:/opt/verdaccio/node_modules "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n           verdaccio/verdaccio:4.7.2\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("可能会出现的问题：")]),s._v(" "),n("blockquote",[n("h5",{attrs:{id:"adduser-command-error-verdaccio-conf-htpasswd-permission-denied"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#adduser-command-error-verdaccio-conf-htpasswd-permission-denied"}},[s._v("#")]),s._v(" adduser command Error :'verdaccio/conf/htpasswd' permission denied")])]),s._v(" "),n("p",[s._v("处理："),n("code",[s._v("sudo chown 10001:65533 htpasswd")])]),s._v(" "),n("p",[s._v("因为verdaccio容器内的verdaccio用户无法对宿主机进行写入操作，所以还需执行")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" conf\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v(" htpasswd\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10001")]),s._v(":65533 ~/docker/verdaccio/conf/htpasswd\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" -R "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10001")]),s._v(":65533 ~/docker/verdaccio/storage\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("也可以固定用户：")]),s._v(" "),n("p",[s._v("1.直接添加用户")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("npm adduser --registry http://localhost:4873\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("输入username password 以及邮箱即可")]),s._v(" "),n("p",[s._v("2.在注册用户文件中添加用户")]),s._v(" "),n("p",[s._v("使用htpasswd生成器为htpasswd文件创建密码。http://www.htaccesstools.com/htpasswd-generator")]),s._v(" "),n("p",[s._v("然后复制出来 打开 ~/docker/verdaccio/conf/htpasswd 粘贴进去")]),s._v(" "),n("p",[s._v("相关"),n("code",[s._v("config.yaml")])]),s._v(" "),n("ul",[n("li",[s._v("https://verdaccio.org/docs/en/docker.html")]),s._v(" "),n("li",[s._v("https://github.com/verdaccio/verdaccio/blob/master/conf/docker.yaml")])]),s._v(" "),n("div",{staticClass:"language-yml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# path to a directory with all packages")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("storage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /verdaccio/storage\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("auth")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("htpasswd")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("file")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ./htpasswd "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# setting ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    max_users: -1")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#security:")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  api:")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    jwt:")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#      sign:")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        expiresIn: 60d")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        notBefore: 1")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  web:")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    sign:")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#      expiresIn: 7d")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("uplinks")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("npmjs")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("url")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" https"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//registry.taobao.org/ "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# https://registry.npmjs.org/")]),s._v("\n     "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("agent_options")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#代理的配置项")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("keepAlive")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v(" \n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("maxSockets")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("40")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("maxFreeSockets")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("packages")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("'@*/*'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("access")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" $authenticated\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("publish")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" $authenticated\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("proxy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" npmjs\n\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("'**'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("access")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" $authenticated\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("publish")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" $authenticated\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("proxy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" npmjs\n\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("server")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("keepAliveTimeout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("middlewares")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("audit")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("enabled")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("logs")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" stdout"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("format")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pretty"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("level")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" trace"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#- {type: file, path: verdaccio.log, level: info}")]),s._v("\n  \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#i18n:")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#web: en-US")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br")])]),n("h5",{attrs:{id:"using-docker-compose"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#using-docker-compose"}},[s._v("#")]),s._v(" Using docker-compose")]),s._v(" "),n("ol",[n("li",[s._v("Get the latest version of "),n("a",{attrs:{href:"https://github.com/docker/compose",target:"_blank",rel:"noopener noreferrer"}},[s._v("docker-compose"),n("OutboundLink")],1),s._v(".")]),s._v(" "),n("li",[s._v("Build and run the container:")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("docker-compose up -d --build\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("You can set the port to use (for both container and host) by prefixing the above command with "),n("code",[s._v("VERDACCIO_PORT=5000")]),s._v(".")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3.1'")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("verdaccio")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" verdaccio/verdaccio\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("container_name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"verdaccio"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("networks")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" node"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("network\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("environment")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" VERDACCIO_PORT=4873\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"4873:4873"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./storage:/verdaccio/storage"')]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./config:/verdaccio/conf"')]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./plugins:/verdaccio/plugins"')]),s._v("  \n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("networks")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("node-network")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("driver")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" bridge\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])]),n("p",[s._v("查看容器日志："),n("code",[s._v("docker logs --tail 20 verdaccio")])]),s._v(" "),n("blockquote",[n("p",[s._v("EACCES: permission denied, open '/verdaccio/conf/htpasswd'")])]),s._v(" "),n("p",[s._v("根据官方文档和文末的最后一篇文章得知，docker 容器中的 uid 和 gid 和宿主机是共享的，只不过没有具体的名称，而容器内 verdaccio 使用的 uid 为 10001，gid 为 65533，")]),s._v(" "),n("p",[s._v("所以在宿主机改一下 htpasswd 文件的权限："),n("code",[s._v("sudo chown 10001:65533 htpasswd")])]),s._v(" "),n("p",[s._v("同理，storage 目录是 verdaccio 存放包数据的目录，也需要修改一下权限："),n("code",[s._v("sudo chown -R 10001:65533 storage")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10001")]),s._v(":65533 htpasswd\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" -R "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10001")]),s._v(":65533 storage\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("然后再试一下添加用户/发布包，就成功；")]),s._v(" "),n("h4",{attrs:{id:"使用cnpm-cnpmjs-org"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用cnpm-cnpmjs-org"}},[s._v("#")]),s._v(" 使用cnpm+cnpmjs.org")]),s._v(" "),n("p",[n("code",[s._v("sinopia")]),s._v(" 的优点是配置简单，对环境依赖少（仅 node 就够了），并且支持 "),n("code",[s._v("windows")]),s._v(" 系统下运行。")]),s._v(" "),n("p",[s._v("但它也有缺点，主要是以下几点：")]),s._v(" "),n("ul",[n("li",[s._v("权限管理比较弱，对用户权限，发布权限，下载权限控制不是很得心应手；")]),s._v(" "),n("li",[n("strong",[s._v("缓存优化不足，经常会在安装共有包的时候处于挂起状态")]),s._v("；")]),s._v(" "),n("li",[s._v("不能做官方仓库的镜像。")])]),s._v(" "),n("p",[s._v("所以，"),n("code",[s._v("sinopia")]),s._v(" 比较适合个人搭建在本地作为 npm 缓存，这样，安装过的包会直接从缓存中获取，加快安装速度。")]),s._v(" "),n("p",[s._v("对于企业级的应用来说，就需要另外一个解决方案了："),n("a",{attrs:{href:"https://github.com/cnpm/cnpm",target:"_blank",rel:"noopener noreferrer"}},[s._v("cnpm"),n("OutboundLink")],1),s._v(" + "),n("a",{attrs:{href:"https://github.com/cnpm/cnpmjs.org",target:"_blank",rel:"noopener noreferrer"}},[s._v("cnpmjs.org"),n("OutboundLink")],1)]),s._v(" "),n("p",[s._v("环境依赖：")]),s._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"http://nodejs.org/",target:"_blank",rel:"noopener noreferrer"}},[s._v("node"),n("OutboundLink")],1),s._v(" >= 4.3.1")]),s._v(" "),n("li",[s._v("linux（不支持 windows）")]),s._v(" "),n("li",[s._v("数据库（"),n("a",{attrs:{href:"http://dev.mysql.com/downloads/",target:"_blank",rel:"noopener noreferrer"}},[s._v("mysql"),n("OutboundLink")],1),s._v(", "),n("a",{attrs:{href:"https://npm.taobao.org/package/sqlite3",target:"_blank",rel:"noopener noreferrer"}},[s._v("sqlite"),n("OutboundLink")],1),s._v(", MariaDB, PostgreSQL）")])]),s._v(" "),n("p",[n("strong",[s._v("安装")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -g cnpm\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -g cnpmjs.org\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[n("strong",[s._v("配置")])]),s._v(" "),n("p",[s._v("配置文件位于 "),n("code",[s._v("~/.cnpmjs.org/config.json")]),s._v(" 中")]),s._v(" "),n("div",{staticClass:"language-json line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-json"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"debug"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 是否启动 debug 模式")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"enableCluster"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 是否启用 cluster 模式")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"mysqlServers"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 数据库配置，以 mysql 为例")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"host"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"host"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"port"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"user"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"user"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"password"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"password"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"mysqlDatabase"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cnpmjs"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 数据库名")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"enablePrivate"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 是否启用私有化，这样只有定义在 `admins` 中的用户才能发布")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"admins"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 管理员配置，可以配置多个")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"senntyou"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"yessz@foxmail.com"')]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"syncModel"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"exist"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 同步模式")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"scopes"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 包前缀，如果不是以这个前缀命名的包将不能发布，可以配置多个")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"@test"')]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"registryHost"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://your.company.npm.registry.com"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 对应的 npm registry 地址")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"sourceNpmRegistry"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://registry.npm.taobao.org"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 找不到的包，会上游到哪里去找")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br")])]),n("p",[s._v("更多配置参考 "),n("a",{attrs:{href:"https://github.com/cnpm/cnpmjs.org/blob/master/config/index.js",target:"_blank",rel:"noopener noreferrer"}},[s._v("cnpmjs.org config"),n("OutboundLink")],1)]),s._v(" "),n("p",[n("strong",[s._v("设置 cnpm registry 属性")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("$ cnpm config "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" registry http://your.company.npm.registry.com\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[n("strong",[s._v("运行")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("cnpmjs.org start\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("运行的时候将会开启两个端口："),n("strong",[s._v("7001（registry），7002（web")]),s._v("）。")]),s._v(" "),n("p",[n("strong",[s._v("7001（registry）")])]),s._v(" "),n("p",[s._v("用来在命令行发布，下载包等对用的远程 registry 地址。比如一些比较常用的 registry 地址：")]),s._v(" "),n("ul",[n("li",[n("code",[s._v("npm")]),s._v(": https://registry.npmjs.org/ npm 官方仓库地址")]),s._v(" "),n("li",[n("code",[s._v("cnpm")]),s._v(": http://r.cnpmjs.org/ cnpmjs.org 官方仓库地址")]),s._v(" "),n("li",[n("code",[s._v("taobao")]),s._v(": https://registry.npm.taobao.org/ 淘宝 NPM 镜像")])]),s._v(" "),n("p",[s._v("用 "),n("a",{attrs:{href:"http://nginx.org/",target:"_blank",rel:"noopener noreferrer"}},[s._v("nginx"),n("OutboundLink")],1),s._v(" 配置 url 地址到 7001 端口：")]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v(" your"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("company"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("npm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("registry"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Forwarded"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("For "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$proxy_add_x_forwarded_for")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Forwarded"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Proto "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$scheme")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Real"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("IP "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" Host "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$http_host")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7001")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("well"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("known "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("allow")]),s._v(" all"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("client_max_body_size")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("m"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br")])]),n("p",[s._v("重启 nginx，现在"),n("strong",[s._v("可以通过 "),n("code",[s._v("http://your.company.npm.registry.com")]),s._v(" 去发布私有包到这个仓库里")]),s._v("（如果没有其他问题的话）。")]),s._v(" "),n("p",[n("strong",[s._v("7002（web）")])]),s._v(" "),n("p",[s._v("用来在 web 端查看仓库信息，搜索包，包信息等。比如一些比较常用的地址：")]),s._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"http://npmjs.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("npm 官方"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"https://cnpmjs.org/",target:"_blank",rel:"noopener noreferrer"}},[s._v("cnpmjs.org 官方"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"https://npm.taobao.org/",target:"_blank",rel:"noopener noreferrer"}},[s._v("淘宝 NPM 镜像"),n("OutboundLink")],1)])]),s._v(" "),n("p",[s._v("用 "),n("a",{attrs:{href:"http://nginx.org/",target:"_blank",rel:"noopener noreferrer"}},[s._v("nginx"),n("OutboundLink")],1),s._v(" 配置 url 地址到 7002 端口：")]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v(" your"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("company"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("npm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Forwarded"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("For "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$proxy_add_x_forwarded_for")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Forwarded"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Proto "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$scheme")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Real"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("IP "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" Host "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$http_host")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7002")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("well"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("known "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("allow")]),s._v(" all"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("client_max_body_size")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("m"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br")])]),n("p",[s._v("重启 nginx，现在你就可以通过 "),n("code",[s._v("http://your.company.npm.com")]),s._v(" 访问仓库web页面了（如果没有其他问题的话）。")]),s._v(" "),n("p",[n("strong",[s._v("永久运行")])]),s._v(" "),n("p",[s._v("如果仅通过 "),n("code",[s._v("cnpmjs.org start")]),s._v(" 运行，一旦关闭终端，程序就会停止运行。"),n("strong",[s._v("推荐使用 "),n("code",[s._v("screen")]),s._v(" 命令开启永久运行")]),s._v("，可以通过 "),n("a",{attrs:{href:"http://www.runoob.com/linux/linux-comm-screen.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Linux screen"),n("OutboundLink")],1),s._v(" 了解下这个命令的用法。")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("screen")]),s._v(" -S cnpmjs "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建一个名为 cnpmjs 的窗口")]),s._v("\n$ cnpmjs.org start "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 运行程序")]),s._v("\nCtrl+a+d "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 按Ctrl+a，然后再按d，离开当前窗口，而程序不会终止")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("screen")]),s._v(" -r cnpmjs "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重新进入 cnpmjs 的窗口，做更多的操作")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h3",{attrs:{id:"配置-nginx"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置-nginx"}},[s._v("#")]),s._v(" 配置 nginx")]),s._v(" "),n("blockquote",[n("p",[s._v("为了npm私有服务器安全，要服务器上再加一层ngx代理；")])]),s._v(" "),n("p",[s._v("如果 nginx 直接安装在宿主机，直接新建配置文件填入以下内容即可：")]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v(" your"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("npm"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v("              "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4873")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v("        Host "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("h3",{attrs:{id:"迁移"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#迁移"}},[s._v("#")]),s._v(" 迁移")]),s._v(" "),n("p",[s._v("由于笔者是从 Verdaccio@3.0 升级到 4.3，所以将原服务器上的 config.yaml、htpasswd 和 storage 文件夹 scp 过去，然后修改一下权限即可。")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" config.yaml user@remoteServer:/path/to/config.yaml\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" htpasswd user@remoteServer:/path/to/htpasswd\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" -r storage user@remoteServer:/path/to/storage\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("同时迁移后注意修改 config.yaml 中的 htpasswd 和 storage 路径。")]),s._v(" "),n("h3",{attrs:{id:"客户端使用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#客户端使用"}},[s._v("#")]),s._v(" 客户端使用")]),s._v(" "),n("h4",{attrs:{id:"发布-安装-卸载组件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#发布-安装-卸载组件"}},[s._v("#")]),s._v(" 发布/安装/卸载组件")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" adduser --registry http://localhost:4873      "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#添加功能，无账号的添加完毕直接包")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" login --registry"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://localhost:4873        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#登录功能，有账号的话可以直接使用这个")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" publish --registry http://localhost:4873      "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#发布包")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("或者用后面的nrm管理源后再操作；")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("nrm "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" company http://localhost:4873  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#company可以换任意名称  url地址  添加功能")]),s._v("\nnrm use company       "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#使用company的源地址")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#这样的话简单了结，不用手动输入registry")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" addUser  \n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" login\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" publish\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" npm-test  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#要是没有切换的话，请手动添加 --registry=http://localhost:4873")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" unpublish npm-test --force  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除发布的包")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("h4",{attrs:{id:"设置-npm-registry-属性"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#设置-npm-registry-属性"}},[s._v("#")]),s._v(" 设置 npm registry 属性")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" config "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" registry http://"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("服务器ip"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(":4873/\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" config "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" registry http://localhost:8081/repository/group-npm/\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("推荐使用 "),n("a",{attrs:{href:"https://github.com/Pana/nrm",target:"_blank",rel:"noopener noreferrer"}},[s._v("nrm"),n("OutboundLink")],1),s._v(" 来快速切换 npm registry 配置。")]),s._v(" "),n("h4",{attrs:{id:"使用-nrm-管理registry"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用-nrm-管理registry"}},[s._v("#")]),s._v(" "),n("strong",[s._v("使用 nrm 管理registry")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$npm")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -g nrm\n \n$ nrm "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\n* "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" ---- https://registry.npmjs.org/\n  cnpm --- http://r.cnpmjs.org/\n  taobao - https://registry.npm.taobao.org/\n  nj ----- https://registry.nodejitsu.com/\n  rednpm - http://registry.mirror.cqupt.edu.cn/\n  npmMirror  https://skimdb.npmjs.com/registry/\n  edunpm - http://registry.enpmjs.org/\n  \n$ nrm "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" bdp http://XXXXXX:4873 "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加私服的npm镜像地址")]),s._v("\n$ nrm use bdp "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用私服的镜像地址")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("h2",{attrs:{id:"相关链接"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#相关链接"}},[s._v("#")]),s._v(" 相关链接")]),s._v(" "),n("p",[s._v("https://verdaccio.org/docs/zh-CN/installation")])])}),[],!1,null,null,null);a.default=e.exports},592:function(s,a,t){s.exports=t.p+"assets/img/image-20200823000635046.3dcb3e1c.png"},593:function(s,a,t){s.exports=t.p+"assets/img/image-20200823000809366.afc9e839.png"},594:function(s,a,t){s.exports=t.p+"assets/img/image-20200823000856050.8fd62c87.png"}}]);