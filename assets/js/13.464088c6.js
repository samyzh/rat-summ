(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{1077:function(s,a,t){s.exports=t.p+"assets/img/image-20220213112033397.c45d3631.png"},1078:function(s,a,t){s.exports=t.p+"assets/img/image-20220213112311012.068ae828.png"},1079:function(s,a,t){s.exports=t.p+"assets/img/image-20220213112238002.2b54ff78.png"},1080:function(s,a,t){s.exports=t.p+"assets/img/image-20220215191714036.a81748d8.png"},1081:function(s,a,t){s.exports=t.p+"assets/img/image-20220215200646193.f7ea94ec.png"},1082:function(s,a,t){s.exports=t.p+"assets/img/image-20220215194733253.28aa8aee.png"},1083:function(s,a,t){s.exports=t.p+"assets/img/image-20220215194752432.8c74e498.png"},1084:function(s,a,t){s.exports=t.p+"assets/img/image-20220215194844722.af69e6a9.png"},1085:function(s,a,t){s.exports=t.p+"assets/img/image-20220215202409099.574d3dc3.png"},1086:function(s,a,t){s.exports=t.p+"assets/img/image-20220215202449744.5d67ed9b.png"},1087:function(s,a,t){s.exports=t.p+"assets/img/image-20220215202847271.5a012a8b.png"},1088:function(s,a,t){s.exports=t.p+"assets/img/image-20220215202859974.cbfeeafc.png"},1089:function(s,a,t){s.exports=t.p+"assets/img/image-20220215203033276.b27fc16a.png"},1090:function(s,a,t){s.exports=t.p+"assets/img/image-20220215203049445.908fb057.png"},1091:function(s,a,t){s.exports=t.p+"assets/img/image-20220215193346869.a234bec9.png"},1092:function(s,a,t){s.exports=t.p+"assets/img/image-20220215195029404.cd57c909.png"},1093:function(s,a,t){s.exports=t.p+"assets/img/image-20220215195134866.9955746e.png"},1094:function(s,a,t){s.exports=t.p+"assets/img/image-20220215195241745.d06ebc40.png"},1095:function(s,a,t){s.exports=t.p+"assets/img/image-20220215203335226.fbd206d7.png"},1096:function(s,a,t){s.exports=t.p+"assets/img/image-20220215193709475.6edff6f3.png"},1097:function(s,a,t){s.exports=t.p+"assets/img/image-20220215193728669.8d81138b.png"},2005:function(s,a,t){"use strict";t.r(a);var e=t(14),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h2",{attrs:{id:"简介"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[s._v("#")]),s._v(" 简介")]),s._v(" "),e("p",[s._v("SonarQube(sonar)是一个开源平台，用于管理源代码的质量。 SonarQube不只是一个质量数据报告工具，更是代码质量管理平台。")]),s._v(" "),e("h2",{attrs:{id:"特性"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#特性"}},[s._v("#")]),s._v(" 特性")]),s._v(" "),e("p",[s._v("支持java, C#, C/C++, PL/SQL, Cobol, JavaScrip, Groovy 等等二十几种编程语言的代码质量管理与检测。 "),e("strong",[s._v("SonarQube可以从以下七个维度检测代码质量，而作为开发人员至少需要处理前5种代码质量问题。")])]),s._v(" "),e("h3",{attrs:{id:"持续检查"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#持续检查"}},[s._v("#")]),s._v(" 持续检查")]),s._v(" "),e("ul",[e("li",[s._v("项目整体的健康程度\n项目的主页面会给出，项目整体的Bugs、Vulnerabilities、Code Smells")]),s._v(" "),e("li",[s._v("专注于漏洞\nwater-leak-paradigm可以有效的管理代码质量：新特性，增加的，改变的\n（water-leak-paradigm是sonarqube研究的一种代码管理方法）\n在项目监测报告中，需要密切关注：New Bugs、New Vulnerabilities")]),s._v(" "),e("li",[s._v("实施质量阈值\n在团队项目中，可以设置质量阈值（Quality Gate），用于监管质量")]),s._v(" "),e("li",[s._v("分支分析\n确保干净的代码才会被合并到主分支中")])]),s._v(" "),e("h3",{attrs:{id:"集成devops"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#集成devops"}},[s._v("#")]),s._v(" 集成DevOps")]),s._v(" "),e("h3",{attrs:{id:"集中质量"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#集中质量"}},[s._v("#")]),s._v(" 集中质量")]),s._v(" "),e("h4",{attrs:{id:"七个维度检测代码质量"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#七个维度检测代码质量"}},[s._v("#")]),s._v(" 七个维度检测代码质量")]),s._v(" "),e("ul",[e("li",[s._v("(1) "),e("strong",[s._v("不遵循代码标准")]),s._v(" SonarQube可以通过PMD,CheckStyle,Findbugs等等代码规则检测工具规范代码编写。")]),s._v(" "),e("li",[s._v("(2) "),e("strong",[s._v("潜在的缺陷")]),s._v(" SonarQube可以通过PMD,CheckStyle,Findbugs等等代码规则检测工具检 测出潜在的缺陷。")]),s._v(" "),e("li",[s._v("(3) "),e("strong",[s._v("糟糕的复杂度分布")]),s._v(" 文件、类、方法等，如果复杂度过高将难以改变，这会使得开发人员 难以理解它们, 且如果没有自动化的单元测试，对于程序中的任何组件的改变都将可能导致需要全面的回归测试。")]),s._v(" "),e("li",[s._v("(4) "),e("strong",[s._v("重复")]),s._v(" 显然程序中包含大量复制粘贴的代码是质量低下的，SonarQube可以展示 源码中重复严重的地方。")]),s._v(" "),e("li",[s._v("(5) "),e("strong",[s._v("注释不足或者过多")]),s._v(" 没有注释将使代码可读性变差，特别是当不可避免地出现人员变动时，程序的可读性将大幅下降 而过多的注释又会使得开发人员将精力过多地花费在阅读注释上，亦违背初衷。")]),s._v(" "),e("li",[s._v("(6) "),e("strong",[s._v("缺乏单元测试")]),s._v(" SonarQube可以很方便地统计并展示单元测试覆盖率。")]),s._v(" "),e("li",[s._v("(7) "),e("strong",[s._v("糟糕的设计")]),s._v(" 通过SonarQube可以找出循环，展示包与包、类与类之间的相互依赖关系，可以检测自定义的架构规则 通过SonarQube可以管理第三方的jar包，可以利用LCOM4检测单个任务规则的应用情况， 检测耦合。")])]),s._v(" "),e("p",[s._v("再整理：")]),s._v(" "),e("ul",[e("li",[s._v("复杂度分布(complexity):代码复杂度过高将难以理解")]),s._v(" "),e("li",[s._v("重复代码(duplications):程序中包含大量复制、粘贴的代码而导致代码臃肿，sonar可以展示源码中重复严重的地方")]),s._v(" "),e("li",[s._v("单元测试统计(unit tests):统计并展示单元测试覆盖率，开发或测试可以清楚测试代码的覆盖情况")]),s._v(" "),e("li",[s._v("代码规则检查(coding rules):通过Findbugs,PMD,CheckStyle等检查代码是否符合规范")]),s._v(" "),e("li",[s._v("注释率(comments):若代码注释过少，特别是人员变动后，其他人接手比较难接手；若过多，又不利于阅读")]),s._v(" "),e("li",[s._v("潜在的Bug(potential bugs):通过Findbugs,PMD,CheckStyle等检测潜在的bug")]),s._v(" "),e("li",[s._v("结构与设计(architecture & design):找出循环，展示包与包、类与类之间的依赖、检查程序之间耦合度")])]),s._v(" "),e("h2",{attrs:{id:"原理架构图"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#原理架构图"}},[s._v("#")]),s._v(" 原理架构图")]),s._v(" "),e("p",[s._v("SonarQube与sql配合基本架构图")]),s._v(" "),e("p",[e("img",{attrs:{src:t(368),alt:"image-20220213111951443"}})]),s._v(" "),e("p",[s._v("SonarQube与项目持续集成架构图")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1077),alt:"image-20220213112033397"}})]),s._v(" "),e("p",[s._v("流程说明：")]),s._v(" "),e("ul",[e("li",[s._v("用户本地使用IDE的插件进行代码分析")]),s._v(" "),e("li",[s._v("用户上传到源代码版本控制服务器")]),s._v(" "),e("li",[s._v("持续集成，使用Sonar Scanner进行扫描")]),s._v(" "),e("li",[s._v("将扫描结果上传到SonarQube服务器")]),s._v(" "),e("li",[s._v("SonarQube server将结果写入db")]),s._v(" "),e("li",[s._v("用户通过web ui查看扫描结果")]),s._v(" "),e("li",[s._v("SonarQube导出结果到其他需要的服务")])]),s._v(" "),e("h2",{attrs:{id:"相关指标说明"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#相关指标说明"}},[s._v("#")]),s._v(" 相关指标说明")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1078),alt:"image-20220213112311012"}})]),s._v(" "),e("p",[e("img",{attrs:{src:t(1079),alt:"image-20220213112238002"}})]),s._v(" "),e("h3",{attrs:{id:"代码质量阈"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#代码质量阈"}},[s._v("#")]),s._v(" 代码质量阈")]),s._v(" "),e("p",[s._v("代码整体质量的统计，"),e("strong",[s._v("可以帮助用户理解项目是否已经可以投入生产")])]),s._v(" "),e("p",[s._v("默认配置(可以根据项目实际情况重新配置)：")]),s._v(" "),e("h2",{attrs:{id:"安装及配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装及配置"}},[s._v("#")]),s._v(" 安装及配置")]),s._v(" "),e("h3",{attrs:{id:"步骤"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#步骤"}},[s._v("#")]),s._v(" 步骤")]),s._v(" "),e("ol",[e("li",[e("p",[s._v("下载："),e("RouterLink",{attrs:{to:"/《技能记录》/15.性能/20.辅助工具/www.sonarqube.org/downloads/"}},[s._v("下载链接")]),s._v(" (下载社区版就可以了)")],1)]),s._v(" "),e("li",[e("p",[s._v("解压进入/bin,效果如下;")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1080),alt:"image-20220215191714036"}})])]),s._v(" "),e("li",[e("p",[s._v("启动：根据自己的操作系统，进入相应的目录，我这边选择的是macosx-universal-64，然后执行： ./sonar.sh console；")])]),s._v(" "),e("li",[e("p",[s._v("访问"),e("a",{attrs:{href:"http://localhost:9000/",target:"_blank",rel:"noopener noreferrer"}},[s._v("SonarQube本地网址"),e("OutboundLink")],1),s._v("；")])])]),s._v(" "),e("p",[e("strong",[s._v("win启动的情况：")])]),s._v(" "),e("p",[s._v("可能出现的意外情况：StartSonar.bat打开后，运行几秒钟后退出，此时Sonar服务并没有成功启动。\n解决办法：打开任务管理器（Ctrl+Alt+Delete），找到 Java(TM) Platform SE binary，通常情况下会有2-3个，结束任务，之后重新双击启动StartSonar.bat，或者 打开cmd命令窗口，执行"),e("code",[s._v("StartSonar")]),s._v(";")]),s._v(" "),e("p",[s._v("看到"),e("code",[s._v("SonarQube is up")]),s._v("字样，说明SonarQube服务器启动成功;")]),s._v(" "),e("h3",{attrs:{id:"配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置"}},[s._v("#")]),s._v(" 配置")]),s._v(" "),e("p",[s._v("SonarQube工具需要数据库的支持，Scanner（后续会讲到）扫描项目时，会将分析结果存入数据库，web页面生成报告时会读取数据库的数据；")]),s._v(" "),e("p",[s._v("SonarQube目前支持Oracle、MySQL、PostgreSQL、MS SQL,数据库版本以及要求，"),e("a",{attrs:{href:"https://docs.sonarqube.org/latest/requirements/requirements/",target:"_blank",rel:"noopener noreferrer"}},[s._v("参照文档"),e("OutboundLink")],1),s._v("；")]),s._v(" "),e("p",[s._v("SonarQube与sql配合基本架构图")]),s._v(" "),e("p",[e("img",{attrs:{src:t(368),alt:"image-20220213111951443"}})]),s._v(" "),e("h4",{attrs:{id:"新建数据库"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#新建数据库"}},[s._v("#")]),s._v(" 新建数据库")]),s._v(" "),e("p",[s._v("命令行 窗口：mysql -u root -p //登录数据库")]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("database")]),s._v(" sonar7 "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("character")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" utf8 "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("collate")]),s._v(" utf8_general_ci"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("//创建数据库，默认编码utf8\nMySQL数据库必须是InnoDB存储引擎，不支持MyISAM；")]),s._v(" "),e("h4",{attrs:{id:"配置-sonar-properties"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置-sonar-properties"}},[s._v("#")]),s._v(" 配置 sonar.properties")]),s._v(" "),e("p",[s._v("打开安装目录下的conf文件，找到sonar.properties，编辑mysql节点的配置文件（不同的数据库对应不同的节点，sonar.properties中有guide）")]),s._v(" "),e("div",{staticClass:"language-ruby line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-ruby"}},[e("code",[s._v("sonar"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("jdbc"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("url"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("jdbc"),e("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":mysql")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("localhost"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("sonar7"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v("useUnicode"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("characterEncoding"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("utf8"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("rewriteBatchedStatements"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("useConfigs"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("maxPerformance"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("useSSL"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#数据库连接地址")]),s._v("\nsonar"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("jdbc"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("username"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("root  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#数据库账号")]),s._v("\nsonar"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("jdbc"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("password"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("xxxx "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#数据库密码")]),s._v("\nsonar"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sorceEncoding"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token constant"}},[s._v("UTF")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\nsonar"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("login"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("admin "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#web页面注册的账号")]),s._v("\nsonar"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("password"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("xxxx "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#web页面注册的密码")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("p",[s._v("配置完成后，重新启动StartSonar.bat, 如果启动不成功，可以结束Java(TM) Platform SE binary。\n启动成功的标志，下述三项，缺一不可")]),s._v(" "),e("ul",[e("li",[s._v("sonarqube is up")]),s._v(" "),e("li",[s._v("localhost:9000 可以打开")]),s._v(" "),e("li",[s._v("数据库中，生成了十几张表")])]),s._v(" "),e("h3",{attrs:{id:"配置scanner"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置scanner"}},[s._v("#")]),s._v(" 配置Scanner")]),s._v(" "),e("p",[s._v("SonarQube需要与SonarScanner配套起来才能完成代码质量检测功能。SonarScaner有多种版本;")]),s._v(" "),e("p",[s._v("不依赖任何构建工具，可以独立使用的是SonarSCanner CLI版，点击上图的下载按钮下载的就是CLI版, 与构建工具结合使用的Sonar扫描器有两种下载途径：")]),s._v(" "),e("ol",[e("li",[s._v("可在对应构建工具的应用市场去找 (推荐);")]),s._v(" "),e("li",[s._v("SonarQube官方也提供了下载地址，"),e("a",{attrs:{href:"https://docs.sonarqube.org/latest/analysis/scan/sonarscanner/",target:"_blank",rel:"noopener noreferrer"}},[s._v("点击下载"),e("OutboundLink")],1)])]),s._v(" "),e("p",[s._v("下载完成后，配置conf文件夹下的"),e("code",[s._v("sonar-scanner.properties")]),s._v(";")]),s._v(" "),e("div",{staticClass:"language-properties line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-properties"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#----- Default SonarQube server")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("sonar.host.url")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("http://localhost:9000")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#----- Default source code encoding")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("sonar.sourceEncoding")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("UTF-8")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[s._v("为安装目录配置环境变量")]),s._v(" "),e("ul",[e("li",[s._v("新建变量，name=SONAR_SCANNER_HOME。value=G:\\develop\\sonarqube-7.4\\sonar-scanner-3.2.0.1227-windows")]),s._v(" "),e("li",[s._v("打开path，输入%SONAR_SCANNER_HOME%\\bin;")]),s._v(" "),e("li",[s._v("sonar-scanner -h，出现以下信息，则表示环境变量设置成功")])]),s._v(" "),e("h3",{attrs:{id:"项目配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#项目配置"}},[s._v("#")]),s._v(" 项目配置")]),s._v(" "),e("p",[s._v("进入待检测的项目目录中，新建"),e("code",[s._v("sonar-project.properties")]),s._v("，增加以下内容：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# must be unique in a given SonarQube instance")]),s._v("\nsonar.projectKey"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("my:project\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# this is the name and version displayed in the SonarQube UI. Was mandatory prior to SonarQube 6.1.")]),s._v("\nsonar.projectName"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("My project\nsonar.projectVersion"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v(" \n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# Path is relative to the sonar-project.properties file. Replace "\\" by "/" on Windows.')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# This property is optional if sonar.modules is set. ")]),s._v("\nsonar.sources"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(".\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Encoding of the source code. Default is default system encoding")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#sonar.sourceEncoding=UTF-8")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br")])]),e("p",[s._v("打开命令行窗口，切换目录到项目目录，输入"),e("code",[s._v("sonar-scanner")]),s._v("\n运行成功后，打开web界面，即可看到对当前项目的分析。")]),s._v(" "),e("p",[e("strong",[s._v("其他参考配置：")])]),s._v(" "),e("div",{staticClass:"language-properties line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-properties"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#项目的唯一标识，必填")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("sonar.psonar.projectKey")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("sonar-test-prj")]),s._v("\n项目名称\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("sonar.projectName")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("sonar-test-prj")]),s._v("\n项目版本\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("sonar.projectVersion")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("1.0")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#扫描目录")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("sonar.sources")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("src")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#检测语言")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("sonar.language")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("js")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#扫描结果上报地址")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("sonar.host.url")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("http://127.0.0.1:9000")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#登录账号")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("sonar.login")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("admin")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("sonar.password")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("xxx#文件编码")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("sonar.sourceEncoding")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("UTF-8")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br")])]),e("h2",{attrs:{id:"插件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#插件"}},[s._v("#")]),s._v(" 插件")]),s._v(" "),e("h3",{attrs:{id:"chinese-pack"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#chinese-pack"}},[s._v("#")]),s._v(" Chinese Pack")]),s._v(" "),e("p",[s._v("sonar市场在线下载中文语言包Chinese Pack;")]),s._v(" "),e("h3",{attrs:{id:"sonarlint"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#sonarlint"}},[s._v("#")]),s._v(" sonarlint")]),s._v(" "),e("h4",{attrs:{id:"步骤-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#步骤-2"}},[s._v("#")]),s._v(" 步骤")]),s._v(" "),e("p",[s._v("在"),e("code",[s._v("vscode")]),s._v("配置"),e("code",[s._v("sonarlint")]),s._v("，需要做如下工作：")]),s._v(" "),e("ol",[e("li",[s._v("下载"),e("code",[s._v("sonarlint")]),s._v("的"),e("code",[s._v("vscode")]),s._v("的插件，并安装；")]),s._v(" "),e("li",[s._v("登录自己的"),e("code",[s._v("sonarQube")]),s._v("账号，获得自己的"),e("code",[s._v("generate token")]),s._v("；")]),s._v(" "),e("li",[s._v("配置自己的"),e("code",[s._v("vscode")]),s._v("的"),e("code",[s._v("settings.json")]),s._v("；")])]),s._v(" "),e("h4",{attrs:{id:"生产token"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#生产token"}},[s._v("#")]),s._v(" 生产token")]),s._v(" "),e("p",[s._v("登录自己的"),e("code",[s._v("sonarQube")]),s._v(" => 点击自己的头像 => 进入myAccount => 进入Security一栏 => 写一个自己定义的token name => 复制生成的token并保存好。 注意这个token只能生成时看到，后面就看不到了，所以要保存好，配置时要用。")]),s._v(" "),e("h4",{attrs:{id:"配置settings-json"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置settings-json"}},[s._v("#")]),s._v(" 配置settings.json")]),s._v(" "),e("p",[s._v("找到已经安装好的"),e("code",[s._v("sonarlint")]),s._v("插件，进入介绍部分。可以看到介绍部分有教我们如何配置自己的"),e("code",[s._v("sonarlint")]),s._v("。")]),s._v(" "),e("p",[s._v("至此配置结束，重启"),e("code",[s._v("vscode")]),s._v("可以看到"),e("code",[s._v("sonarlint")]),s._v("的错误提示。现在可以有效避免生产严重警告的问题。")]),s._v(" "),e("div",{staticClass:"language-json line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-json"}},[e("code",[e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"sonarlint.connectedMode.project"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"serverId"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"warming"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 自定义的id要和下面的serverId保持一致")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"projectKey"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"juejin:frontend:master"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 在sonarQube可以看到项目的key")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"sonarlint.connectedMode.servers"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"serverId"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"warming"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 和上面的serverId相同")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"serverUrl"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://sonar.juejin.im/"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 这个不用改动，大家的url相同")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"token"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"******************"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 之前获取到自己的token")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"sonarlint.ls.javaHome"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"C:\\\\\\\\Program Files\\\\Java\\\\jdk1.8.0_91"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 需要配置一下javaHome")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("h3",{attrs:{id:"分支插件branch-plugin"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#分支插件branch-plugin"}},[s._v("#")]),s._v(" 分支插件branch-plugin")]),s._v(" "),e("p",[s._v("sonarqube社区版不支持branch功能，每个project都只能展示一个分支。要支持多个分支共同展示功能需要安装"),e("a",{attrs:{href:"https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fmc1arke%2Fsonarqube-community-branch-plugin",target:"_blank",rel:"noopener noreferrer"}},[s._v("sonarqube-community-branch-plugin"),e("OutboundLink")],1),s._v(" 插件，当然我选择这个插件还有另外一个重要原因，它可以支持pull Request 修饰的功能；【根据不同SonarQube 版本选择对应插件版本】")]),s._v(" "),e("h2",{attrs:{id:"项目实践"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#项目实践"}},[s._v("#")]),s._v(" 项目实践")]),s._v(" "),e("h3",{attrs:{id:"整体思路"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#整体思路"}},[s._v("#")]),s._v(" 整体思路")]),s._v(" "),e("p",[s._v("1、当有代码push到代码仓库的时候，gitlab是知道的，gitlab检测到有代码push的时候，执行一个钩子（gitlab上叫hook），可以理解为触发一个推送时间，推送到jenkins；")]),s._v(" "),e("p",[s._v("2、jenkins 检测到这个事件之后，自动构建（不用手动了）；")]),s._v(" "),e("p",[s._v("3、jenkins可以配置构建后动作，配置构建后自动执行sonarqube检测。至此，完成自动构建+自动检测的全过程。")]),s._v(" "),e("h3",{attrs:{id:"与jenkins配合使用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#与jenkins配合使用"}},[s._v("#")]),s._v(" 与Jenkins配合使用")]),s._v(" "),e("h4",{attrs:{id:"环境准备"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#环境准备"}},[s._v("#")]),s._v(" 环境准备")]),s._v(" "),e("p",[s._v("清单如下")]),s._v(" "),e("ul",[e("li",[s._v("Java环境")]),s._v(" "),e("li",[s._v("Maven环境")]),s._v(" "),e("li",[s._v("SonarQube平台")]),s._v(" "),e("li",[s._v("Jenkins平台")]),s._v(" "),e("li",[s._v("数据库(例如MySQL)")])]),s._v(" "),e("h4",{attrs:{id:"拉取代码"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#拉取代码"}},[s._v("#")]),s._v(" 拉取代码")]),s._v(" "),e("p",[s._v("推荐配置 token方式，访问"),e("code",[s._v("Gitee")]),s._v("和"),e("code",[s._v("Gitlab")]),s._v("仓库；不建议用用户名及密码方式；")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1081),alt:"image-20220215200646193"}})]),s._v(" "),e("h4",{attrs:{id:"使用说明"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用说明"}},[s._v("#")]),s._v(" 使用说明")]),s._v(" "),e("h5",{attrs:{id:"使用情况"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用情况"}},[s._v("#")]),s._v(" 使用情况")]),s._v(" "),e("p",[s._v("使用一：码覆盖率测试 ; 使用sonar插件，进行代码检测并提交检测结果")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("sonar:sonar\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("使用二：主动检测；")]),s._v(" "),e("h5",{attrs:{id:"配置环境"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置环境"}},[s._v("#")]),s._v(" 配置环境")]),s._v(" "),e("ol",[e("li",[s._v("插件管理中安装 SonarQube Scanner 插件；")]),s._v(" "),e("li",[s._v("全局工具配置中指定Sonar扫描器的安装路径；"),e("code",[s._v("Manage Jenkins ==> Global Tool Configuration")]),s._v(";")])]),s._v(" "),e("p",[e("img",{staticStyle:{zoom:"50%"},attrs:{src:"_image/02.sonarqube实践及分析/image-20220215200907598.png",alt:"image-20220215200907598"}}),e("img",{staticStyle:{zoom:"50%"},attrs:{src:"_image/02.sonarqube实践及分析/image-20220215200920326.png",alt:"image-20220215200920326"}})]),s._v(" "),e("h5",{attrs:{id:"构建配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#构建配置"}},[s._v("#")]),s._v(" "),e("strong",[s._v("构建配置")])]),s._v(" "),e("blockquote",[e("h5",{attrs:{id:"每次提交代码-自动检测代码质量配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#每次提交代码-自动检测代码质量配置"}},[s._v("#")]),s._v(" 每次提交代码，自动检测代码质量配置")])]),s._v(" "),e("ol",[e("li",[e("p",[s._v("设置触发器，选中“Build when a change is pushed to GitLab. GitLab webhook”，记住项目地址；")])]),s._v(" "),e("li",[e("p",[s._v("选择下面的高级，点击生成，生成secret token，记住这个token；")])]),s._v(" "),e("li",[e("p",[s._v("配置构建后动作——sonarqube扫描；")]),s._v(" "),e("div",{staticClass:"language-properties line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-properties"}},[e("code",[e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("sonar.projectKey")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("project-demo")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("sonar.projectName")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("project-demo")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("sonar.projectVersion")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("1.0 ")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("sonar.language")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("java ")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("sonar.java.binaries")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("target/classes")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("sonar.sources")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("src/main/java")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])])])]),s._v(" "),e("p",[e("img",{attrs:{src:t(1082),alt:"image-20220215194733253"}})]),s._v(" "),e("p",[e("img",{attrs:{src:t(1083),alt:"image-20220215194752432"}})]),s._v(" "),e("p",[e("img",{attrs:{src:t(1084),alt:"image-20220215194844722"}})]),s._v(" "),e("h4",{attrs:{id:"sonarqube有权限构建配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#sonarqube有权限构建配置"}},[s._v("#")]),s._v(" SonarQube有权限构建配置")]),s._v(" "),e("h5",{attrs:{id:"添加jenkins访问server的凭证"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#添加jenkins访问server的凭证"}},[s._v("#")]),s._v(" 添加Jenkins访问Server的凭证")]),s._v(" "),e("p",[e("strong",[s._v("在SonarQube Server中生成token")])]),s._v(" "),e("p",[s._v("登录 SonarQube 后，在 “我的账号” ==> “安全” 中生成 token，注意生成的令牌不会再显示第二次，要立即复制；")]),s._v(" "),e("p",[e("strong",[s._v("在Jenkins下添加 Jenkins访问SonarQube Sever的凭证")])]),s._v(" "),e("p",[e("img",{attrs:{src:t(1085),alt:"image-20220215202409099"}})]),s._v(" "),e("p",[e("img",{attrs:{src:t(1086),alt:"image-20220215202449744"}})]),s._v(" "),e("h5",{attrs:{id:"git源及构建面板修改"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#git源及构建面板修改"}},[s._v("#")]),s._v(" git源及构建面板修改")]),s._v(" "),e("p",[s._v("配置sonar扫描参数；")]),s._v(" "),e("div",{staticClass:"language-properties line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-properties"}},[e("code",[e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("sonar.projectKey")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("sonar-test--react-visual-editor")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("sonar.projectName")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("react-visual-editor")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("sonar.projectVersion")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("1.0")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("sonar.sources")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("packages")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("sonar.language")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("js,ts")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("sonar.eslint.eslintconfigpath")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v(".eslintrc")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("sonar.eslint.ruleconfigs")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v(".eslintrc")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("sonar.sourceEncoding")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("UTF-8")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("sonar.exclusions")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("**/__test__/**,**/demo/**,**/*.bak.*,**/*.bak")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("p",[e("strong",[s._v("注意点：")])]),s._v(" "),e("p",[s._v("要应用eslint规则的话，需要下载一个插件**"),e("a",{attrs:{href:"https://github.com/sleroy/SonarEsLintPlugin/releases",target:"_blank",rel:"noopener noreferrer"}},[s._v("sonar-eslint-plugin-0.4.0"),e("OutboundLink")],1),s._v("**，放置在SonarQube安装目录下的 "),e("strong",[s._v("extension==>plugins")]),s._v(" 目录下。\n下载地址："),e("a",{attrs:{href:"https://github.com/sleroy/SonarEsLintPlugin/releases",target:"_blank",rel:"noopener noreferrer"}},[s._v("sonar-eslint-plugin-0.4.0.jar"),e("OutboundLink")],1)]),s._v(" "),e("p",[e("img",{attrs:{src:t(1087),alt:"image-20220215202847271"}})]),s._v(" "),e("p",[e("img",{attrs:{src:t(1088),alt:"image-20220215202859974"}})]),s._v(" "),e("h5",{attrs:{id:"配置sonar扫描未通过的执行逻辑"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置sonar扫描未通过的执行逻辑"}},[s._v("#")]),s._v(" 配置sonar扫描未通过的执行逻辑")]),s._v(" "),e("p",[s._v("所有指标通过是返回：")]),s._v(" "),e("div",{staticClass:"language-json line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-json"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"measures"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"metric"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"alert_status"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"value"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"OK"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"component"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sonar-test--wx-minipro-ci"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("没有通过时返回：")]),s._v(" "),e("div",{staticClass:"language-json line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-json"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"measures"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"metric"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"alert_status"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"value"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ERROR"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"component"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sonar-test--wx-minipro-ci"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("据此，SonarQube检测是否通过的判断条件可以写成：")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("@echo off\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -sb -H "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Accept: application/json"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://localhost:9000/api/measures/search?projectKeys=sonar-test--react-visual-editor&metricKeys=alert_status"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" findstr "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"OK"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("err")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("%errorlevel%\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%err%"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sonarQube代码质量检测通过"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sonarQube代码质量检测未通过"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("p",[e("img",{attrs:{src:t(1089),alt:"image-20220215203033276"}})]),s._v(" "),e("p",[e("img",{attrs:{src:t(1090),alt:"image-20220215203049445"}})]),s._v(" "),e("h3",{attrs:{id:"与gitlab配合使用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#与gitlab配合使用"}},[s._v("#")]),s._v(" 与GitLab配合使用")]),s._v(" "),e("h4",{attrs:{id:"背景"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[s._v("#")]),s._v(" 背景")]),s._v(" "),e("p",[s._v("实现代码提交、合并前进行自动化代码扫描并实现Pull Request 修饰，具体效果如图:")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1091),alt:"image-20220215193346869"}})]),s._v(" "),e("h4",{attrs:{id:"分支插件及配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#分支插件及配置"}},[s._v("#")]),s._v(" 分支插件及配置")]),s._v(" "),e("p",[s._v("详见上面介绍；")]),s._v(" "),e("p",[e("strong",[s._v("安装及配置：")])]),s._v(" "),e("ol",[e("li",[s._v("下载对应版本jar包；")]),s._v(" "),e("li",[s._v("复制jar包 到SonarQube 下的extensions/plugins/ 和 lib/common/目录下;")]),s._v(" "),e("li",[s._v("重启SonarQube;")]),s._v(" "),e("li",[s._v("用管理员账号登陆SonarQube 配置，并配置Server base URL;")]),s._v(" "),e("li",[s._v("关于pull Request 修饰后面介绍；")])]),s._v(" "),e("h4",{attrs:{id:"配置gitlab-gitee"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置gitlab-gitee"}},[s._v("#")]),s._v(" 配置gitlab/gitee")]),s._v(" "),e("h5",{attrs:{id:"token生产"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#token生产"}},[s._v("#")]),s._v(" token生产")]),s._v(" "),e("ol",[e("li",[e("p",[s._v("重新注册一个用户名为SonarQube 的用户")])]),s._v(" "),e("li",[e("p",[s._v("登陆超级管理员账号进行Approve，SonarQube账号生效")])]),s._v(" "),e("li",[e("p",[s._v("登陆SonarQube 账号及创建 GitLab OAuth app(将GitLab用作OAuth提供程序的应用程序)")]),s._v(" "),e("p",[s._v("点击保存，会自动跳转到另一个页面，里面有"),e("strong",[s._v("Application ID")]),s._v(" 和 Secret 信息，千万记得记得这个要保存起来，SonarQube 那里会用到这两个信息；")])]),s._v(" "),e("li",[e("p",[s._v("生成 personal access token（用于修饰合并请求，留评论的账号的Access Token）")]),s._v(" "),e("p",[s._v("点击创建，之后token 生成，记得把这个token 记下，SonarQube 里面gitlab 的集成需要使用到;")])])]),s._v(" "),e("h5",{attrs:{id:"gitlab配合jks触发"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#gitlab配合jks触发"}},[s._v("#")]),s._v(" gitlab配合jks触发")]),s._v(" "),e("ol",[e("li",[s._v("在项目中，选择设置——》集成——》添加钩子。")]),s._v(" "),e("li",[s._v("填入url和secret token（jenkins配置中的两个记住），"),e("strong",[s._v("取消选中")]),s._v("“SSL证书验证“")]),s._v(" "),e("li",[s._v("测试，点击 test——》push event； 如果测试通过，会返回：Hook executed successfully: HTTP 200。")]),s._v(" "),e("li",[s._v("这会 jenkins 会自动构建，构建好之后，会生成sonarqube检测结果，直接通过jenkins界面访问sonarqube界面即可。")])]),s._v(" "),e("p",[e("img",{attrs:{src:t(1092),alt:"image-20220215195029404"}})]),s._v(" "),e("p",[e("img",{attrs:{src:t(1093),alt:"image-20220215195134866"}})]),s._v(" "),e("p",[e("img",{attrs:{src:t(1094),alt:"image-20220215195241745"}})]),s._v(" "),e("h5",{attrs:{id:"gitee的webhook配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#gitee的webhook配置"}},[s._v("#")]),s._v(" gitee的webhook配置")]),s._v(" "),e("p",[s._v("将Jenkins中生成的webhook通知地址，webhook密码，填写到gitee中的webhook对应配置项中")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1095),alt:"image-20220215203335226"}})]),s._v(" "),e("h4",{attrs:{id:"配置sonarqube"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置sonarqube"}},[s._v("#")]),s._v(" 配置SonarQube")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1096),alt:"image-20220215193709475"}})]),s._v(" "),e("p",[e("img",{attrs:{src:t(1097),alt:"image-20220215193728669"}})]),s._v(" "),e("h2",{attrs:{id:"相关链接"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#相关链接"}},[s._v("#")]),s._v(" 相关链接")]),s._v(" "),e("p",[s._v("https://www.cnblogs.com/wangpenghui522/p/13853935.html")]),s._v(" "),e("p",[s._v("https://juejin.cn/post/7006221414663454734")])])}),[],!1,null,null,null);a.default=n.exports},368:function(s,a,t){s.exports=t.p+"assets/img/image-20220213111951443.071adbde.png"}}]);