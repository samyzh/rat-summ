(window.webpackJsonp=window.webpackJsonp||[]).push([[172],{1593:function(s,t,a){s.exports=a.p+"assets/img/image-20211230115330626.5fe3add5.png"},2265:function(s,t,a){"use strict";a.r(t);var n=a(14),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"简介"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[s._v("#")]),s._v(" 简介")]),s._v(" "),n("p",[s._v("Vue.js 从 1.x 到 2.0 版本，最大的升级就是引入了虚拟 DOM 的概念，它为后续做服务端渲染以及跨端框架 Weex 提供了基础；")]),s._v(" "),n("h3",{attrs:{id:"vue2-x的痛点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#vue2-x的痛点"}},[s._v("#")]),s._v(" vue2.x的痛点")]),s._v(" "),n("ul",[n("li",[s._v("源码自身的维护性；")]),s._v(" "),n("li",[s._v("数据量大后带来的渲染和更新的性能问题；")]),s._v(" "),n("li",[s._v("一些想舍弃但为了兼容一直保留的鸡肋 API 等；")]),s._v(" "),n("li",[s._v("TypeScript 支持；")])]),s._v(" "),n("h3",{attrs:{id:"vue2与vue3的对比"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#vue2与vue3的对比"}},[s._v("#")]),s._v(" Vue2与Vue3的对比")]),s._v(" "),n("ul",[n("li",[s._v("对TypeScript支持不友好（所有属性都放在了this对象上，难以推倒组件的数据类型）")]),s._v(" "),n("li",[s._v("大量的API挂载在Vue对象的原型上，难以实现TreeShaking。")]),s._v(" "),n("li",[s._v("架构层面对跨平台dom渲染开发支持不友好")]),s._v(" "),n("li",[s._v("CompositionAPI。受ReactHook启发")]),s._v(" "),n("li",[s._v("对虚拟DOM进行了重写、对模板的编译进行了优化操作...")]),s._v(" "),n("li",[s._v("从vue2中使用的Flow换成了Typescript;")])]),s._v(" "),n("h2",{attrs:{id:"monorepo"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#monorepo"}},[s._v("#")]),s._v(" monorepo")]),s._v(" "),n("h3",{attrs:{id:"简介-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#简介-2"}},[s._v("#")]),s._v(" 简介")]),s._v(" "),n("p",[s._v("monorepo是一种将多个package放在一个repo中的代码管理模式")]),s._v(" "),n("p",[s._v("Vue3中 使用 "),n("code",[s._v("yarn workspace + lerna")]),s._v(" 来管理项目")]),s._v(" "),n("div",{staticClass:"language-json line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-json"}},[n("code",[n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"workspaces"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"packages/*"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("blockquote",[n("p",[s._v("通过 "),n("code",[s._v("workspaces")]),s._v(" 来指定需要管理的模块")])]),s._v(" "),n("h3",{attrs:{id:"管理源码"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#管理源码"}},[s._v("#")]),s._v(" 管理源码")]),s._v(" "),n("p",[s._v("monorepo 把这些模块拆分到不同的 package 中，每个 package 有各自的 API、类型定义和测试。这样使得模块拆分更细化，职责划分更明确，模块之间的依赖关系也更加明确，开发人员也更容易阅读、理解和更改所有模块源码，提高代码的可维护性。")]),s._v(" "),n("h4",{attrs:{id:"源码目录"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#源码目录"}},[s._v("#")]),s._v(" "),n("strong",[s._v("源码目录")])]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[s._v("vue"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("next\n├─scripts\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("    ├─build"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("js\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("    ├─dev"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("js\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("    ├─utils"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("js\n├─packages\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("    ├─global"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("d"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ts\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("    ├─vue\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("    ├─template"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("explorer\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("    ├─size"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("check\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("    ├─shared\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("    ├─server"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("renderer\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("    ├─runtime"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("dom\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("    ├─runtime"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("core\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("    ├─reactivity\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("    ├─compiler"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ssr\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("    ├─compiler"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("sfc\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("    ├─compiler"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("dom\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("    ├─compiler"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("core\n├─test"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("dts\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br")])]),n("ul",[n("li",[s._v("reactivity:响应式系统")]),s._v(" "),n("li",[s._v("runtime-core:与平台无关的运行时核心 (可以创建针对特定平台的运行时 - 自定义渲染器)")]),s._v(" "),n("li",[s._v("runtime-dom: 针对浏览器的运行时。包括DOM API，属性，事件处理等")]),s._v(" "),n("li",[s._v("runtime-test:用于测试")]),s._v(" "),n("li",[s._v("server-renderer:用于服务器端渲染")]),s._v(" "),n("li",[s._v("compiler-core:与平台无关的编译器核心")]),s._v(" "),n("li",[s._v("compiler-dom: 针对浏览器的编译模块")]),s._v(" "),n("li",[s._v("compiler-ssr: 针对服务端渲染的编译模块")]),s._v(" "),n("li",[s._v("template-explorer：用于调试编译器输出的开发工具shared：多个包之间共享的内容vue:完整版本,包括运行时和编译器")]),s._v(" "),n("li",[s._v("shared：多个包之间共享的内容")]),s._v(" "),n("li",[s._v("vue:完整版本,包括运行时和编译器")])]),s._v(" "),n("h4",{attrs:{id:"个包关系"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#个包关系"}},[s._v("#")]),s._v(" 个包关系")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1593),alt:"image-20211230115330626"}})]),s._v(" "),n("div",{staticClass:"language-md line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-md"}},[n("code",[s._v("                                    +---------------------+\n                                    |                     |\n                                    |  @vue/compiler-sfc  |\n                                    |                     |\n                                    +-----+--------+------+\n                                          |        |\n                                          v        v\n                      +---------------------+    +----------------------+\n                      |                     |    |                      |\n        +------------\x3e|  @vue/compiler-dom  +---\x3e|  @vue/compiler-core  |\n        |             |                     |    |                      |\n   +----+----+        +---------------------+    +----------------------+\n   |         |\n   |   vue   |\n   |         |\n   +----+----+        +---------------------+    +----------------------+    +-------------------+\n        |             |                     |    |                      |    |                   |\n        +------------\x3e|  @vue/runtime-dom   +---\x3e|  @vue/runtime-core   +---\x3e|  @vue/reactivity  |\n                      |                     |    |                      |    |                   |\n                      +---------------------+    +----------------------+    +-------------------+\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br")])]),n("h2",{attrs:{id:"lerna"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#lerna"}},[s._v("#")]),s._v(" lerna")]),s._v(" "),n("h3",{attrs:{id:"简介-3"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#简介-3"}},[s._v("#")]),s._v(" 简介")]),s._v(" "),n("p",[s._v("lerna是在js项目中用来管理多个package的工具")]),s._v(" "),n("ul",[n("li",[s._v("全局安装")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" lerna -g\nlerna init\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("ul",[n("li",[s._v("常用命令")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("lerna bootstrap "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装依赖生成软链")]),s._v("\nlerna "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看所有包")]),s._v("\nlerna publish "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 发布包")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h3",{attrs:{id:"实践"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#实践"}},[s._v("#")]),s._v(" 实践")]),s._v(" "),n("p",[s._v("详见"),n("RouterLink",{attrs:{to:"/pages/monorepo-lerna-yarn-use/"}},[s._v("monorepo-lerna-yarn的实践")])],1),s._v(" "),n("h2",{attrs:{id:"性能优化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#性能优化"}},[s._v("#")]),s._v(" 性能优化")]),s._v(" "),n("h3",{attrs:{id:"源码体积优化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#源码体积优化"}},[s._v("#")]),s._v(" 源码体积优化")]),s._v(" "),n("ul",[n("li",[s._v("首先，移除一些冷门的 feature（比如 filter、inline-template 等）；")]),s._v(" "),n("li",[s._v("其次，引入 "),n("code",[s._v("tree-shaking")]),s._v(" 的技术，减少打包体积。")])]),s._v(" "),n("p",[n("code",[s._v("tree-shaking")]),s._v(" 依赖 ES2015 模块语法的静态结构（即 import 和 export），通过编译阶段的静态分析，找到没有引入的模块并打上标记。然后压缩阶段会利用例如 uglify-js、terser 等压缩工具真正地删除这些没有用到的代码。")]),s._v(" "),n("p",[s._v("例如，如果你在项目中没有引入 Transition、KeepAlive 等组件，那么它们对应的代码就不会打包，这样也就间接达到了减少项目引入的 Vue.js 包体积的目的。")]),s._v(" "),n("h3",{attrs:{id:"数据劫持优化proxy"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#数据劫持优化proxy"}},[s._v("#")]),s._v(" 数据劫持优化"),n("code",[s._v("Proxy")])]),s._v(" "),n("p",[n("code",[s._v("Object.defineProperty")]),s._v(" 切换成 es6的"),n("code",[s._v("Proxy")]),s._v("实现")]),s._v(" "),n("p",[s._v("Proxy 劫持了我们对 observed 对象的一些操作，比如：")]),s._v(" "),n("ul",[n("li",[s._v("访问对象属性会触发 get 函数；")]),s._v(" "),n("li",[s._v("设置对象属性会触发 set 函数；")]),s._v(" "),n("li",[s._v("删除对象属性会触发 deleteProperty 函数；")]),s._v(" "),n("li",[s._v("in 操作符会触发 has 函数；")]),s._v(" "),n("li",[s._v("通过 Object.getOwnPropertyNames 访问对象属性名会触发 ownKeys 函数。")])]),s._v(" "),n("p",[s._v("Proxy 劫持的是对象本身，并不能劫持子对象的变化，这点和 Object.defineProperty API 一致。但是 Object.defineProperty 是在初始化阶段，即定义劫持对象的时候就已经递归执行了，而 Proxy 是在对象属性被访问的时候才递归执行下一步 reactive，这其实是一种延时定义子对象响应式的实现，在性能上会有较大的提升。")]),s._v(" "),n("h3",{attrs:{id:"编译优化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#编译优化"}},[s._v("#")]),s._v(" 编译优化")]),s._v(" "),n("ul",[n("li",[s._v("Vue.js 2.x 的数据更新并触发重新渲染的粒度是组件级的，虽然 Vue 能保证触发更新的组件最小化，但在单个组件内部依然需要遍历该组件的整个 vnode 树。")]),s._v(" "),n("li",[s._v("vue3做到动静分离，执行diff时仅对比动态节点。")]),s._v(" "),n("li",[s._v("除此之外，"),n("strong",[s._v("Vue.js 3.0 在编译阶段还包含了对 Slot 的编译优化、事件侦听函数的缓存优化，并且在运行时重写了 diff 算法")]),s._v("。")])]),s._v(" "),n("h3",{attrs:{id:"diff算法优化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#diff算法优化"}},[s._v("#")]),s._v(" diff算法优化")]),s._v(" "),n("p",[s._v("深度递归遍历vnode树，节点的标签和key相同认为是同一个节点则更新，不同则删除，然后处理子节点。")]),s._v(" "),n("p",[n("strong",[s._v("子节点分这几种情况处理")]),s._v("：")]),s._v(" "),n("p",[s._v("纯文本、vnode 数组和空")]),s._v(" "),n("ol",[n("li",[s._v("空往往意味着添加或删除；")]),s._v(" "),n("li",[s._v("纯文本相同直接更新innerText，不同则删除；")]),s._v(" "),n("li",[s._v("新旧子节点都是vnode数组则diff算法来处理；")])]),s._v(" "),n("p",[n("strong",[s._v("vue3.0 diff算法思想")])]),s._v(" "),n("ol",[n("li",[s._v("编译模版时进行"),n("code",[s._v("静态分析")]),s._v("，"),n("code",[s._v("标记动态节点")]),s._v("，"),n("strong",[s._v("diff对比差异时仅对比动态节点")]),s._v("（性能提升明显）；")]),s._v(" "),n("li",[s._v("diff算法先"),n("code",[s._v("去头去尾")]),s._v("，借此缩短遍历对比数组长度（对数组插入和删除操作性能优化明显）；")]),s._v(" "),n("li",[s._v("通过对更新前后子节点数组"),n("code",[s._v("建立映射表")]),s._v("的方式，将O(n^2)复杂度的遍历降低到O(n)；")]),s._v(" "),n("li",[s._v("通过"),n("code",[s._v("最长递增子序列")]),s._v("方法了来diff前后的子节点数组，减少移动操作的次数；")])]),s._v(" "),n("p",[s._v("最长递增子序列算法实现：")]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*\n * 寻找最长递增子序列\n * 使用动态规划思想，a -> c = a -> b + b -> c\n * 其中p数组存储的是从p[p[i]] 到 p[i] 的最长递增子序列索引，也就是前一个b的索引；\n * r数组存储最后一个元素也就是c的索引\n */")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getSequenceOfLIS")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("arr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" p "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" result "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" i "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" arr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("length"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" val "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" arr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" top "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" result"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("result"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("length "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("arr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("top"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" val"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            p"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" top"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            result"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("push")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("continue")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 二分法搜索")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" l "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" r "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" result"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("length "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("l "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" r"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" c "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("l "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" r"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("arr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("result"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("c"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" val"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                l "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                r "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("val "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" arr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("result"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("l"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("l "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                p"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" result"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("l "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            result"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("l"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 回朔p数组，找出最长递增子序列")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" preIndex "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" result"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("result"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("length "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" i "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" result"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("length "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        result"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" preIndex"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        preIndex "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" p"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("preIndex"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" result"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br")])]),n("h2",{attrs:{id:"语法-api-优化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#语法-api-优化"}},[s._v("#")]),s._v(" 语法 API 优化")]),s._v(" "),n("h3",{attrs:{id:"composition-api"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#composition-api"}},[s._v("#")]),s._v(" Composition API")]),s._v(" "),n("h3",{attrs:{id:"优化逻辑组织"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#优化逻辑组织"}},[s._v("#")]),s._v(" 优化逻辑组织")]),s._v(" "),n("p",[s._v("编写组件本质就是在编写一个“包含了描述组件选项的对象”，我们把它称为 Options API，符合直觉思维。")]),s._v(" "),n("p",[n("code",[s._v("Options API")]),s._v(" 的设计是按照 methods、computed、data、props 这些不同的选项分类，当组件小的时候，这种分类方式一目了然；但是在大型组件中，一个组件可能有多个逻辑关注点，当使用 Options API 的时候，每一个关注点都有自己的 Options，如果需要修改一个逻辑点关注点，就需要在单个文件中不断上下切换和寻找。")]),s._v(" "),n("p",[n("code",[s._v("Composition API")]),s._v("将某个逻辑关注点相关的代码全都放在一个函数里，这样当需要修改一个功能时，就不再需要在文件中跳来跳去。")]),s._v(" "),n("h3",{attrs:{id:"优化逻辑复用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#优化逻辑复用"}},[s._v("#")]),s._v(" 优化逻辑复用")]),s._v(" "),n("ul",[n("li",[s._v("vue2 有mixin 变量命名容易冲突的问题")]),s._v(" "),n("li",[s._v("Composition API 显示的将变量引入当前组件，解决明明冲突问题")]),s._v(" "),n("li",[s._v("简单组件使用Options API，复杂组件使用 Composition API")])]),s._v(" "),n("h2",{attrs:{id:"vue2-3-diff算法区别"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#vue2-3-diff算法区别"}},[s._v("#")]),s._v(" Vue2/3 Diff算法区别")]),s._v(" "),n("p",[s._v("我们知道在数据变更触发页面重新渲染，会生成虚拟 DOM 并进行 patch 过程，这一过程在 Vue3 中的优化有如下")]),s._v(" "),n("p",[s._v("编译阶段的优化：")]),s._v(" "),n("ul",[n("li",[s._v("事件缓存：将事件缓存(如: @click)，可以理解为变成静态的了")]),s._v(" "),n("li",[s._v("静态提升：第一次创建静态节点时保存，后续直接复用")]),s._v(" "),n("li",[s._v("添加静态标记：给节点添加静态标记，以优化 Diff 过程")])]),s._v(" "),n("p",[s._v('由于编译阶段的优化，除了能更快的生成虚拟 DOM 以外，还使得 Diff 时可以跳过"永远不会变化的节点"，Diff 优化如下')]),s._v(" "),n("ul",[n("li",[s._v("Vue2 是全量 Diff，Vue3 是静态标记 + 非全量 Diff")]),s._v(" "),n("li",[s._v("使用最长递增子序列优化了对比流程")])]),s._v(" "),n("p",[s._v("根据尤大公布的数据就是 Vue3 "),n("code",[s._v("update")]),s._v(" 性能提升了 "),n("code",[s._v("1.3~2 倍")])])])}),[],!1,null,null,null);t.default=e.exports}}]);