(window.webpackJsonp=window.webpackJsonp||[]).push([[204],{1239:function(s,a,t){s.exports=t.p+"assets/img/image-20220225144314367.9e4b617b.png"},2079:function(s,a,t){"use strict";t.r(a);var n=t(14),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"环境安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#环境安装"}},[s._v("#")]),s._v(" 环境安装")]),s._v(" "),n("h3",{attrs:{id:"安装步骤示范"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装步骤示范"}},[s._v("#")]),s._v(" 安装步骤示范")]),s._v(" "),n("ol",[n("li",[n("p",[s._v("通过 uname -r 命令查看你当前的内核版本\n"),n("code",[s._v("uname -r")])])]),s._v(" "),n("li",[n("p",[s._v("使用 root 权限登录 Centos。确保 yum 包更新到最新。\n"),n("code",[s._v("yum -y update")])])]),s._v(" "),n("li",[n("p",[s._v("卸载旧版本(如果安装过旧版本的话)\n"),n("code",[s._v("yum remove docker docker-common docker-selinux docker-engine")])])]),s._v(" "),n("li",[n("p",[s._v("安装需要的软件包， yum-util 提供yum-config-manager功能，另外两个是devicemapper驱动依赖的\n"),n("code",[s._v("yum install -y yum-utils device-mapper-persistent-data lvm2")])])]),s._v(" "),n("li",[n("p",[s._v("设置yum源\n"),n("code",[s._v("yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo")])])]),s._v(" "),n("li",[n("p",[s._v("可以查看所有仓库中所有docker版本，并选择特定版本安装\n"),n("code",[s._v("yum list docker-ce --showduplicates | sort -r")])])]),s._v(" "),n("li",[n("p",[s._v("安装docker\n"),n("code",[s._v("sudo yum install -y docker-ce #由于repo中默认只开启stable仓库，故这里安装的是最新稳定版18.03.1")])])]),s._v(" "),n("li",[n("p",[s._v("启动并加入开机启动")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("systemctl start docker     "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启动docker")]),s._v("\nsystemctl "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" docker    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置为开机启动")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#其他相关系统 docker操作命令")]),s._v("\nsystemctl "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" docker "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置docker系统启动")]),s._v("\nsystemctl start docker "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启动docker")]),s._v("\nsystemctl status docker "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看docker状态")]),s._v("\nsystemctl stop docker "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#停止")]),s._v("\nsystemctl restart docker "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#重启")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("验证安装是否成功(有client和service两部分表示docker安装启动都成功了)\n"),n("code",[s._v("docker version")])])])]),s._v(" "),n("p",[n("strong",[s._v("可以封装成脚本优化")])]),s._v(" "),n("p",[n("code",[s._v("docker.sh")])]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash ")]),s._v("\nyum -y "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" \n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /etc/yum.repos.d/\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" http://mila.oss-cn-shenzhen.aliyuncs.com/docker.repo\nyum clean all "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" yum makecache\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /root\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" http://mila.oss-cn-shenzhen.aliyuncs.com/soft/docker-engine-17.05.0.ce-1.el7.centos.x86_64.rpm\nyum -y localinstall ./docker-engine-17.05.0.ce-1.el7.centos.x86_64.rpm\nsystemctl "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" docker\nsystemctl start docker\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("p",[n("code",[s._v("chmod +x docker.sh")])]),s._v(" "),n("h3",{attrs:{id:"各系统参考"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#各系统参考"}},[s._v("#")]),s._v(" 各系统参考")]),s._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://docs.docker.com/engine/install/ubuntu/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Docker安装步骤"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"https://docs.docker.com/compose/install/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Docker compose安装步骤"),n("OutboundLink")],1)])]),s._v(" "),n("h3",{attrs:{id:"镜像加速"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#镜像加速"}},[s._v("#")]),s._v(" 镜像加速")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /etc/docker\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tee")]),s._v(" /etc/docker/daemon.json "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<-")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'EOF'")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"registry-mirrors"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://xxx.mirror.aliyuncs.com"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tee")]),s._v(" /etc/docker/daemon.json "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<-")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'EOF'")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"registry-mirrors"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://xxx.mirror.aliyuncs.com"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" EOF\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"registry-mirrors"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://xxx.mirror.aliyuncs.com"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl daemon-reload\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("h2",{attrs:{id:"docker"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#docker"}},[s._v("#")]),s._v(" Docker")]),s._v(" "),n("h3",{attrs:{id:"简介"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[s._v("#")]),s._v(" 简介")]),s._v(" "),n("p",[n("code",[s._v("![](~/20-55-11.jpg)")])]),s._v(" "),n("h3",{attrs:{id:"相关系统操作命令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#相关系统操作命令"}},[s._v("#")]),s._v(" "),n("strong",[s._v("相关系统操作命令")])]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl daemon-reload\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl restart docker\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#其他相关系统 docker操作命令")]),s._v("\nsystemctl "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" docker "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置docker系统启动")]),s._v("\nsystemctl start docker "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启动docker")]),s._v("\nsystemctl status docker "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看docker状态")]),s._v("\nsystemctl stop docker "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#停止")]),s._v("\nsystemctl restart docker "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#重启")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("h3",{attrs:{id:"常用管理命令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#常用管理命令"}},[s._v("#")]),s._v(" 常用管理命令")]),s._v(" "),n("blockquote",[n("p",[s._v("docker -help")])]),s._v(" "),n("h4",{attrs:{id:"run命令运行以及参数详解"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#run命令运行以及参数详解"}},[s._v("#")]),s._v(" "),n("strong",[s._v("run命令运行以及参数详解")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("docker run命令运行以及参数详解\n命令格式：\n-a, --attach"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("            登录容器（必须是以docker run -d启动的容器）  \n-w, --workdir"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("           指定容器的工作目录  \n-c, --cpu-shares"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("         设置容器CPU权重，在CPU共享场景使用    \n-e, --env"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("               指定环境变量，容器中可以使用该环境变量    \n-m, --memory"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("            指定容器的内存上限    \n-P, --publish-all"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("false    指定容器暴露的端口    \n-p, --publish"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("           指定容器暴露的端口   \n-h, --hostname"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("          指定容器的主机名    \n-v, --volume"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("            给容器挂载存储卷，挂载到容器的某个目录    \n--volumes-from"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("          给容器挂载其他容器上的卷，挂载到容器的某个目录  \n--cap-add"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("               添加权限，权限清单详见：http://linux.die.net/man/7/capabilities    \n--cap-drop"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("              删除权限，权限清单详见：http://linux.die.net/man/7/capabilities    \n--cidfile"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("               运行容器后，在指定文件中写入容器PID值，一种典型的监控系统用法    \n--cpuset"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("                设置容器可以使用哪些CPU，此参数可以用来容器独占CPU    \n--device"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("                添加主机设备给容器，相当于设备直通    \n--dns"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("                   指定容器的dns服务器    \n--dns-search"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("            指定容器的dns搜索域名，写入到容器的/etc/resolv.conf文件    \n--entrypoint"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("            覆盖image的入口点    \n--env-file"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("              指定环境变量文件，文件格式为每行一个环境变量    \n--expose"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("                指定容器暴露的端口，即修改镜像的暴露端口    \n--link"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("                  指定容器间的关联，使用其他容器的IP、env等信息    \n--lxc-conf"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("              指定容器的配置文件，只有在指定--exec-driver"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("lxc时使用    \n--name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("                  指定容器名字，后续可以通过名字进行容器管理，links特性需要使用名字    \n--net"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"bridge"')]),s._v("             容器网络设置:\n                                bridge 使用docker daemon指定的网桥\n                                   "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v("     //容器使用主机的网络\n                                  container:NAME_or_ID  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("//使用其他容器的网路，共享IP和PORT等网络资源\n                                  none 容器使用自己的网络（类似--net"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("bridge"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(",但是不进行配置\n\n--privileged"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("false         指定容器是否为特权容器，特权容器拥有所有的capabilities    \n--restart"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"no"')]),s._v("             指定容器停止后的重启策略:\n                                  no：容器退出时不重启\n                                  on-failure：容器故障退出（返回值非零）时重启\n                                  always：容器退出时总是重启    \n--rm"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("false                 指定容器停止后自动删除容器"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("不支持以docker run -d启动的容器"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("    \n--sig-proxy"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true           设置由代理接受并处理信号，但是SIGCHLD、SIGSTOP和SIGKILL不能被代理\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br")])]),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("docker run -it --name myjava java -p  -v "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker run -t -i --name test2 centos7:7.3.1611 /bin/bash")]),s._v("\ndocker run -it --name test2 centos7:7.3.1611 /bin/bash\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h4",{attrs:{id:"执行命令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#执行命令"}},[s._v("#")]),s._v(" "),n("strong",[s._v("执行命令")])]),s._v(" "),n("p",[s._v("docker exec ：在运行的容器中执行命令;")]),s._v(" "),n("ul",[n("li",[s._v("-d :分离模式: 在后台运行")]),s._v(" "),n("li",[s._v("-i :即使没有附加也保持STDIN（标准输入） 打开,以交互模式运行容器，通常与 -t 同时使用；")]),s._v(" "),n("li",[s._v("-t: 为容器重新分配一个伪输入终端，通常与 -i 同时使用；")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启动容器后，直接进入容器；")]),s._v("\ndocker run -t -i --name test1 docker.io/ubuntu /bin/bash\ndocker run -it --name test1 docker.io/ubuntu /bin/bash\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进入已经启动的容器中；")]),s._v("\ndocker "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it  f94d2c317477 /bin/bash\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h4",{attrs:{id:"停止-删除容器或镜像"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#停止-删除容器或镜像"}},[s._v("#")]),s._v(" "),n("strong",[s._v("停止/删除容器或镜像")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#停止所有的container（容器），这样才能够删除其中的images：")]),s._v("\ndocker stop "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -a -q"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#或者 docker stop $(docker ps -aq) ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#如果想要删除所有container（容器）的话再加一个指令：")]),s._v("\ndocker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -a -q"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#或者 docker rm $(docker ps -aq) ")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除images（镜像），通过image的id来指定删除谁")]),s._v("\ndocker rmi "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("image id"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#或者 docker rmi 镜像名称：版本（TAG）")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#想要删除untagged images，也就是那些id为的image的话可以用 #删除id为none的镜像【非常有用】")]),s._v("\ndocker rmi "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("docker images "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"^<none>"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{print '),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$3")]),s._v('}"')]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除none的镜像，要先删除镜像中的容器。要删除镜像中的容器，必须先停止容器")]),s._v("\ndocker stop "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -a "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Exited"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v(" }'")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#停止容器  ")]),s._v("\ndocker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -a "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Exited"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v(" }'")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除容器 ")]),s._v("\ndocker rmi "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("docker images "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"none"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$3")]),s._v("}'")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除镜像")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#要删除全部image（镜像）的话")]),s._v("\ndocker rmi "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("docker images -q"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#强制删除全部image的话")]),s._v("\ndocker rmi -f "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("docker images -q"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除所有停止的容器")]),s._v("\ndocker container prune\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除所有不使用的镜像")]),s._v("\ndocker image prune --force --all "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#或者 docker image prune -f -a")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br")])]),n("p",[n("code",[s._v("remove-none-img.sh")])]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("docker stop "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -a "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Exited"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v(" }'")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#停止容器  ")]),s._v("\ndocker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -a "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Exited"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v(" }'")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除容器 ")]),s._v("\ndocker rmi "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("docker images "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"none"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$3")]),s._v("}'")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除镜像")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[n("strong",[s._v("容器相关操作")])]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#停止、启动、杀死、重启一个容器")]),s._v("\ndocker stop Name或者ID  \ndocker start Name或者ID  \ndocker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("kill")]),s._v(" Name或者ID  \ndocker restart name或者ID\n\ndocker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" –a "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看所有容器列表：")]),s._v("\ndocker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看启动的容器列表：")]),s._v("\ndocker start 容器ID或容器名 "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启动容器：")]),s._v("\ndocker restart 容器ID或容器名 "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#重启容器：")]),s._v("\ndocker -t stop 容器ID或容器名,"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#限时关闭容器： ")]),s._v("\ndocker -60 stop,容器 "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#如60秒以内关闭容器： 60秒以内未关闭，则直接关闭容器。")]),s._v("\ndocker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("kill")]),s._v(" 容器ID或容器名 "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#直接关闭容器：")]),s._v("\ndocker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" 容器id "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除终止状态的容器：")]),s._v("\ndocker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -f 容器id "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除运行中的容器：")]),s._v("\ndocker stop "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -a -q"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#停止所有容器：")]),s._v("\ndocker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -a -q"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除所有终止状态的容器：")]),s._v("\n\ndocker logs 容器id "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看容器日志：")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])]),n("p",[n("strong",[s._v("镜像相关操作")])]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("docker images "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看镜像列表：")]),s._v("\ndocker rmi "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("image id"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 或者docker rmi 镜像名称：版本（TAG）"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除镜像：")]),s._v("\ndocker rmi "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("docker images "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"^<none>"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{print '),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$3")]),s._v('}"')]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除id为none的镜像：")]),s._v("\ndocker rmi "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("docker images -q"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除所有未使用的镜像：")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h4",{attrs:{id:"inspect目录挂载及查看"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#inspect目录挂载及查看"}},[s._v("#")]),s._v(" inspect目录挂载及查看")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("docker run -it -v /test2 centos /bin/bash\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("同样使用docker inspect命令查看宿主机的挂载目录；")]),s._v(" "),n("p",[n("code",[s._v("docker inspect autorun-pro")])]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("   "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Mounts"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Name"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"96256232eb74edb139d652746f0fe426e57fbacdf73376963e3acdb411b3d73a"')]),s._v(",\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Source"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/lib/docker/volumes/96256232eb74edb139d652746f0fe426e57fbacdf73376963e3acdb411b3d73a/_data"')]),s._v(",\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Destination"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/test2"')]),s._v(",\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Driver"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"local"')]),s._v(",\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Mode"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(",\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"RW"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("p",[n("strong",[s._v("具体过滤")])]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("docker inspect --format"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{{.NetworkSettings.IPAddress}}'")]),s._v(" f5b1bfc2811a\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".5.2\n\ndocker inspect --format "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{{.State.Running}}'")]),s._v(" autorun-pro\n"),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n\ndocker inspect -f "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{{.State.Running}}'")]),s._v(" autorun-pro\n\ndocker container inspect -f "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{{if .State}}{{.State.Status}}{{else}}undefined{{end}}'")]),s._v(" autorun-pro\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Error: No such container: autorun-pro")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("p",[s._v("启动脚本")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PRO_NAME")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("autorun-pro\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PRO_VERSION")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("latest \n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("isRemove")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("false\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("isRemove")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$isRemove")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"---容器stop,rm---再run处理---"')]),s._v("\n    docker stop "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PRO_NAME")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n    docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PRO_NAME")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("EXIST")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -a "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" $PRO_NAME "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wc")]),s._v(" -l"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$EXIST")]),s._v(" -ne "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("STATUS")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("docker inspect -f "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{{.State.Status}}'")]),s._v(" $PRO_NAME"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("case")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$STATUS")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"running"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"---容器是running状态---将不做处理---"')]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"exited"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"---容器是exited状态---将start处理..."')]),s._v("\n            docker start "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PRO_NAME")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"paused"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"---容器是paused状态---将unpause处理..."')]),s._v("\n            docker unpause "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PRO_NAME")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        *"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"---容器是特使状态---暂时没有处理..."')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("esac")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"---检查到容器不存在---将run处理中..."')]),s._v("\n  docker run -d "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("28080")]),s._v(":80 -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("26379")]),s._v(":6379 -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("23306")]),s._v(":3306 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    -v /data/autorun/mysql/log:/var/log/mysql "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    -v /data/autorun/mysql/data:/var/lib/mysql "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    --name "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PRO_NAME")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PRO_NAME")]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PRO_VERSION")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\ndocker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -a "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PRO_NAME")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br")])]),n("h4",{attrs:{id:"主从数据复制"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#主从数据复制"}},[s._v("#")]),s._v(" "),n("strong",[s._v("主从数据复制")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#从容器到宿主机复制")]),s._v("\ndocker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" tomcat:/webapps/js/text.js /home/admin\ndocker  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" 容器名:容器路径       宿主机路径   \n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#从宿主机到容器复制")]),s._v("\ndocker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" /home/admin/text.js tomcat:/webapps/js\ndocker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" 宿主路径中文件      容器名:容器路径   \n\ndocker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" dockerV/file.zip  c1cb:tmp/\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("h4",{attrs:{id:"创建镜像、修改、上传镜像"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建镜像、修改、上传镜像"}},[s._v("#")]),s._v(" "),n("strong",[s._v("创建镜像、修改、上传镜像")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#通过现在运行中的容器,做成一个新的镜像;")]),s._v("\ndocker commit "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OPTIONS"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" CONTAINER "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("REPOSITORY"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(":TAG"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#主要参数选项包括：")]),s._v("\n    -a ，–author"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("”” 作者信息\n    -m，–message"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("”” 提交信息\n    -p，–pause"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true 提交是暂停容器运行\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#提交")]),s._v("\ndocker commit -a "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"samy"')]),s._v(" -m "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"back up "')]),s._v(" -p containerId meeting-kz:v1115\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#复制重命名")]),s._v("\ndocker tag testimage:lastest samy/testimage:lastes\ndocker push samy/testimage:lastest\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("h4",{attrs:{id:"导入及导出命令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#导入及导出命令"}},[s._v("#")]),s._v(" "),n("strong",[s._v("导入及导出命令")])]),s._v(" "),n("p",[s._v("可以依据具体使用场景来选择命令")]),s._v(" "),n("ul",[n("li",[s._v("若是只想备份images，使用save、load即可")]),s._v(" "),n("li",[s._v("若是在启动容器后，容器内容有变化，需要备份，则使用export、import")])]),s._v(" "),n("h5",{attrs:{id:"export-import"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#export-import"}},[s._v("#")]),s._v(" "),n("strong",[s._v("export/import")])]),s._v(" "),n("blockquote",[n("p",[s._v("基于现在有的容器到处镜像；")])]),s._v(" "),n("p",[s._v("压缩导出保存")]),s._v(" "),n("ul",[n("li",[s._v("docker export xxx -o/> xxx.tar")]),s._v(" "),n("li",[s._v("docker export xxx ｜ gzip  > xxx.tar.gz")])]),s._v(" "),n("p",[s._v("导入")]),s._v(" "),n("ul",[n("li",[s._v("docker import  xxx.tar")]),s._v(" "),n("li",[s._v("docker import xxx.tar  xxx：导入重命名；")])]),s._v(" "),n("blockquote",[n("p",[s._v("OPTIONS说明：**-c :"),n("strong",[s._v("应用docker 指令创建镜像；")]),s._v("-m 😗*提交时的说明文字；")])]),s._v(" "),n("p",[s._v("联合使用")]),s._v(" "),n("ul",[n("li",[s._v("docker export test | docker import - test:3.0")])]),s._v(" "),n("p",[s._v("命令：")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("docker "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" nginx-test -o nginx-test.tar \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#其中-o表示输出到文件，nginx-test.tar为目标文件，nginx-test是源容器名（name）")]),s._v("\ndocker "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" nginx-test "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" nginx-test1.tar \ndocker "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" nginx-test "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("gzip")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" nginx-test1.tar.gz \n\ndocker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("\ndocker "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" ubuntu_test_container "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ubuntu_test_container.tar\n\ndocker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" ubuntu_test_container.tar\ndocker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" ubuntu_test_container "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" ubuntu_test_container.tar\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#支持同时导入多个")]),s._v("\ndocker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" ubuntu_test_container.tar ubuntu_test_container:test\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#从上面的命令可以看出，docker import将container导入后会成为一个image，而不是恢复为一个container。")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#注：容器导出的tar包是文件系统，且大小比镜像导出的tar小。")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#实践")]),s._v("\ndocker "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" autorun-pro "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("gzip")]),s._v(" -o ./images/autorun-pro:1.0.0.tar.gz\ndocker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" images/autorun-pro:1.0.0.tar.gz autorun-pro:1.0.0\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#已文件的方式导入;")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /home/alic/ubuntu.tar.gz "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" - ubuntu:14.04\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" exampleimage.tgz "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" - exampleimagelocal:new\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" exampleimage.tgz "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" --message "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"New image imported from tarball"')]),s._v(" - exampleimagelocal:new\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#以http的方式导入")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" http://example.com/example.tgz example/imagere:demo\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -a\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Import from a local directory with new configurations")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -c "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" --change "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ENV DEBUG=true"')]),s._v(" - exampleimagedir\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Import from a local directory")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -c "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" - exampleimagedir\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#运行这样的容器，要加这个参数；/bin/bash")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Docker导入容器快照，执行报错：docker: Error response from daemon: No command specified.")]),s._v("\ndocker run --name nginxDockerfileCopy -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8093")]),s._v(":80 -d username/nginx-dockerfilecopy /bin/bash\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#参考以上COMMAND，将run命令修改为：")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查询容器状态，发现容易已经停止。虽然执行中加了-d后台执行的参数，还是自动停止了。看来/bin/bash命令不能满足启动nginx的需求")]),s._v("\ndocker run --name testImportSnapshot -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8094")]),s._v(":80 -d username/nginx-importsnapshot nginx -g "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'daemon off;'")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#说明此次容器快照导出、导入生成新镜像，新镜像执行生成容器，容器具有导出之前一样的功能。")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br")])]),n("h5",{attrs:{id:"save-load"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#save-load"}},[s._v("#")]),s._v(" "),n("strong",[s._v("save/load")])]),s._v(" "),n("p",[s._v("导出保存为文件")]),s._v(" "),n("ul",[n("li",[s._v("docker save xx -o xx.tar")]),s._v(" "),n("li",[s._v("docker save xx > xx.tar   docker save xx | gzip > xx.tar.gz")])]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用 docker save 命令根据 ID 将镜像保存成一个文件")]),s._v("\ndocker save 0fdf2b4c26d3 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" server.tar\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#还可以同时将多个 image 打包成一个文件，比如下面将镜像库中的 postgres 和 mongo 打包：")]),s._v("\ndocker save -o images-all.tar postgres:9.6 mongo:3.4\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("压缩处理：")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 其中-o和>表示输出到文件，nginx.tar为目标文件，nginx:latest是源镜像名（name:tag）")]),s._v("\ndocker save -o nginx.tar nginx:latest\ndocker save "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" nginx.tar nginx:latest\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#加入|gzip管道才有压缩效果；")]),s._v("\ndocker save java "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("gzip")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /home/java.tar.gz\n\ndocker save -o mask_detection_v5.tar mask_detection:v5\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -zcvf mask_detection_v5.tar.gz mask_detection_v5.tar\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#还有一种容器的打包和压缩一步到位的方法：")]),s._v("\ndocker save mask_detection:v5 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("gzip")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" mask_detection_v5.tar.gz\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# import")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker save autorun-pro | gzip > ./images/autorun-pro:0.1.0.tar.gz")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker load < ./images/autorun-pro:0.1.0.tar.gz")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker save $PRO_NAME | gzip > ./images/$PRO_NAME:$PRO_VERSION.tar.gz")]),s._v("\ndocker load "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" ./images/"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PRO_NAME")]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PRO_VERSION")]),s._v(".tar.gz\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[s._v("导入从文件载入镜像")]),s._v(" "),n("ul",[n("li",[s._v("docker load --input 文件")]),s._v(" "),n("li",[s._v("docker load <")])]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("docker load "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" server.tar\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h5",{attrs:{id:"上面两操作区别"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#上面两操作区别"}},[s._v("#")]),s._v(" "),n("strong",[s._v("上面两操作区别")])]),s._v(" "),n("p",[s._v("1，文件大小不同")]),s._v(" "),n("p",[n("strong",[s._v("export")]),s._v(" 导出的镜像文件体积小于 "),n("strong",[s._v("save")]),s._v(" 保存的镜像")]),s._v(" "),n("p",[s._v("2，是否可以对镜像重命名")]),s._v(" "),n("ul",[n("li",[n("strong",[s._v("docker import")]),s._v(" 可以为镜像指定新名称")]),s._v(" "),n("li",[n("strong",[s._v("docker load")]),s._v(" 不能对载入的镜像重命名")])]),s._v(" "),n("p",[s._v("3，是否可以同时将多个镜像打包到一个文件中；【特殊】")]),s._v(" "),n("ul",[n("li",[n("strong",[s._v("docker export")]),s._v(" 不支持")]),s._v(" "),n("li",[n("strong",[s._v("docker save")]),s._v(" 支持;")])]),s._v(" "),n("p",[s._v("4，是否包含镜像历史")]),s._v(" "),n("ul",[n("li",[n("strong",[s._v("export")]),s._v(" 导出（"),n("strong",[s._v("import")]),s._v(" 导入）是根据容器拿到的镜像，再导入时会丢失镜像所有的历史记录和元数据信息（即仅保存容器当时的快照状态），所以无法进行回滚操作。")]),s._v(" "),n("li",[s._v("而 "),n("strong",[s._v("save")]),s._v(" 保存（"),n("strong",[s._v("load")]),s._v(" 加载）的镜像，没有丢失镜像的历史，可以回滚到之前的层（"),n("strong",[s._v("layer")]),s._v("）。")])]),s._v(" "),n("p",[s._v("5，应用场景不同")]),s._v(" "),n("ul",[n("li",[n("strong",[s._v("docker export 的应用场景")]),s._v("：主要用来制作基础镜像，比如我们从一个 "),n("strong",[s._v("ubuntu")]),s._v(" 镜像启动一个容器，然后安装一些软件和进行一些设置后，使用 "),n("strong",[s._v("docker export")]),s._v(" 保存为一个基础镜像。然后，把这个镜像分发给其他人使用，比如作为基础的开发环境。")]),s._v(" "),n("li",[n("strong",[s._v("docker save 的应用场景")]),s._v("：如果我们的应用是使用 "),n("strong",[s._v("docker-compose.yml")]),s._v(" 编排的"),n("strong",[s._v("多个镜像组合")]),s._v("，但我们要部署的客户服务器并不能连外网。这时就可以使用 "),n("strong",[s._v("docker save")]),s._v(" 将用到的镜像打个包，然后拷贝到客户服务器上使用 "),n("strong",[s._v("docker load")]),s._v(" 载入。")])]),s._v(" "),n("p",[s._v("辅助命令，"),n("strong",[s._v("比较大小")])]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" -lh\ndocker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("history")]),s._v(" java-test\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[n("strong",[s._v("特别注意：两种方法不可混用。")])]),s._v(" "),n("p",[s._v("如果使用 "),n("strong",[s._v("import")]),s._v(" 导入 "),n("strong",[s._v("save")]),s._v(' 产生的文件，虽然导入不提示错误，但是启动容器时会提示失败，会出现类似"'),n("strong",[s._v("docker: Error response from daemon: Container command not found or does not exist")]),s._v('"的错误。兼容上面的方式实现：')]),s._v(" "),n("p",[s._v("镜像和容器导出的tar包组织结构完全不同，可根据tar中标志性文件区分两种类型tar包并分别使用相应的docker load或docker import导入镜像。")]),s._v(" "),n("p",[s._v("可选择如下文件作为两种类型tar包的区分：")]),s._v(" "),n("p",[n("strong",[s._v("镜像tar包：manifest.json repositories")])]),s._v(" "),n("p",[n("strong",[s._v("容器tar包：.dockerenv")])]),s._v(" "),n("p",[n("code",[s._v("docker_upload.sh")])]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#/bin/sh")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$#")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Usage: '),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$0")]),s._v(' *.tar"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" -1\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("TAR_FILE")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" tvf "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${TAR_FILE}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" -e "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'manifest'")]),s._v(" -e "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'repositories'")]),s._v(" -q  \n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$?")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n    docker load -i "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${TAR_FILE}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--------\x3etar format is error!"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" tvf "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${TAR_FILE}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'dockerenv'")]),s._v(" -q "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${TAR_FILE}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--------\x3etar format is error!"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("./docker_upload.sh ubuntu_test.tar \ndocker images "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" ubuntu\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#注：因为参数只有一个tar名，所以导入容器时搜索到的镜像和tag都是<none>。")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h5",{attrs:{id:"实践"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#实践"}},[s._v("#")]),s._v(" "),n("strong",[s._v("实践")])]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker save redis:5-alpine "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("gzip")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" images/redis:5-alpine.tar.gz\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker load "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" ./docker/images/etag:1.1.1.tar.gz\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h4",{attrs:{id:"查看日志"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#查看日志"}},[s._v("#")]),s._v(" 查看日志")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("docker logs -f myjenkins\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h4",{attrs:{id:"update命令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#update命令"}},[s._v("#")]),s._v(" update命令")]),s._v(" "),n("p",[s._v("docker container update 命令用于更新一个或多个容器的配置。")]),s._v(" "),n("p",[n("strong",[s._v("用法")])]),s._v(" "),n("p",[n("code",[s._v("docker container update [OPTIONS] CONTAINER [CONTAINER...]")])]),s._v(" "),n("p",[n("strong",[s._v("选项")])]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",[s._v("名称,简写")]),s._v(" "),n("th",[s._v("默认值")]),s._v(" "),n("th",[s._v("描述")])])]),s._v(" "),n("tbody",[n("tr",[n("td",[n("code",[s._v("--blkio-weight")])]),s._v(" "),n("td",[s._v("0")]),s._v(" "),n("td",[s._v("阻塞IO(相对权重)，介于"),n("code",[s._v("10")]),s._v("和"),n("code",[s._v("1000")]),s._v("之间，或"),n("code",[s._v("0")]),s._v("禁用(默认为"),n("code",[s._v("0")]),s._v(")")])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("--cpu-period")])]),s._v(" "),n("td",[s._v("0")]),s._v(" "),n("td",[s._v("限制CPU CFS(完全公平的调度程序)周期")])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("--cpu-quota")])]),s._v(" "),n("td",[s._v("0")]),s._v(" "),n("td",[s._v("限制CPU CFS(完全公平的调度程序)配额")])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("--cpu-rt-period")])]),s._v(" "),n("td",[s._v("0")]),s._v(" "),n("td",[s._v("限制CPU实时周期(以微秒为单位)")])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("--cpu-rt-runtime")])]),s._v(" "),n("td",[s._v("0")]),s._v(" "),n("td",[s._v("以微秒为单位限制CPU实时运行时间")])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("--cpu-shares, -c")])]),s._v(" "),n("td",[s._v("0")]),s._v(" "),n("td",[s._v("CPU份额(相对权重)")])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("--cpuset-cpus")])]),s._v(" "),n("td"),s._v(" "),n("td",[s._v("允许执行的CPU(0-3,0)")])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("--cpuset-mems")])]),s._v(" "),n("td"),s._v(" "),n("td",[s._v("允许执行的内存率(0-3,0.1)")])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("--kernel-memory")])]),s._v(" "),n("td"),s._v(" "),n("td",[s._v("内核内存限制")])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("--memory, -m")])]),s._v(" "),n("td"),s._v(" "),n("td",[s._v("内存限制")])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("--memory-reservation")])]),s._v(" "),n("td"),s._v(" "),n("td",[s._v("内存软限制")])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("--memory-swap")])]),s._v(" "),n("td"),s._v(" "),n("td",[s._v("交换限制等于内存加交换：’"),n("code",[s._v("-1")]),s._v("‘以启用无限制的交换")])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("--restart")])]),s._v(" "),n("td"),s._v(" "),n("td",[s._v("重新启动在容器退出时应用的策略")])])])]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#docker run -d \\")]),s._v("\n -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(":8080 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n -v "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/your/local/assets/"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(":/www/assets "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n --restart"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("always "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n samy/homer:latest\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#sudo docker run --name=mysql --restart=always -e MYSQL_ROOT_PASSWORD=mypassword -v /path/to/directory:/var/lib/mysql -d mysql")]),s._v("\ndocker update mysql --restart"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("always\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("h3",{attrs:{id:"镜像压缩与优化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#镜像压缩与优化"}},[s._v("#")]),s._v(" 镜像压缩与优化")]),s._v(" "),n("p",[n("strong",[s._v("压缩镜像主要有以下")]),s._v("：")]),s._v(" "),n("p",[s._v("总括")]),s._v(" "),n("ul",[n("li",[n("p",[n("strong",[s._v(".dockerignore")]),s._v("用于忽略非必须文件")])]),s._v(" "),n("li",[n("p",[s._v("优化基础镜像；")])]),s._v(" "),n("li",[n("p",[s._v("优化程序依赖, 优化Dockerfile顺序逻辑；移除不必要安装依赖，及资源下载；"),n("strong",[s._v("及时清理下载")])])]),s._v(" "),n("li",[n("p",[s._v("串联 Dockerfile 指令；")])]),s._v(" "),n("li",[n("p",[s._v("压缩自己的镜像；比如 export 和 import配合gzip或者docker-squash")]),s._v(" "),n("p",[n("strong",[s._v("启用squash特性")]),s._v(": 通过启用squash特性（实验性功能）"),n("code",[s._v("docker build --squash -t curl:v3 .")]),s._v(" 可以构建的镜像压缩为一层。但是为了充分发挥容器镜像层共享的优越设计，这种方法不被推荐。")])]),s._v(" "),n("li",[n("p",[s._v("选用更合适的开发语言;")])])]),s._v(" "),n("p",[s._v("详细介绍")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("选择比较小的基础镜像，也就是FROM后面的那个镜像尽量要小; 比如：alpine")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("对比常用的、没有压缩过的基础镜像（在写作时使用的是:latest标签）：")]),s._v(" "),n("ul",[n("li",[n("code",[s._v("scratch")]),s._v(" 或者"),n("code",[s._v("busybox")]),s._v(" 1-5MB")]),s._v(" "),n("li",[n("code",[s._v("Alpine")]),s._v(" - 4.8MB")]),s._v(" "),n("li",[n("code",[s._v("Ubuntu")]),s._v(" - 124.8 MB")]),s._v(" "),n("li",[n("code",[s._v("Centos")]),s._v(" - 196MB")])])]),s._v(" "),n("li",[n("p",[n("a",{attrs:{href:"https://link.zhihu.com/?target=https%3A//alpinelinux.org/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Alpine Linux"),n("OutboundLink")],1),s._v(" 是一个基于 "),n("a",{attrs:{href:"https://link.zhihu.com/?target=https%3A//www.musl-libc.org/",target:"_blank",rel:"noopener noreferrer"}},[s._v("musl libc"),n("OutboundLink")],1),s._v(" 和 "),n("a",{attrs:{href:"https://link.zhihu.com/?target=https%3A//www.busybox.net/",target:"_blank",rel:"noopener noreferrer"}},[s._v("busybox"),n("OutboundLink")],1),s._v(" 的轻量级 Linux 发行版，主打安全。")])]),s._v(" "),n("li",[n("p",[s._v("关于 scratch：")]),s._v(" "),n("ul",[n("li",[s._v("一个空镜像，只能用于构建镜像，通过 "),n("code",[s._v("FROM scratch")])]),s._v(" "),n("li",[s._v("在构建一些基础镜像，比如 "),n("code",[s._v("debian")]),s._v(" 、 "),n("code",[s._v("busybox")]),s._v("，非常有用")]),s._v(" "),n("li",[s._v("用于构建超少镜像，比如构建一个包含所有库的二进制文件")])]),s._v(" "),n("p",[s._v("关于 "),n("code",[s._v("busybox")])]),s._v(" "),n("ul",[n("li",[s._v("只有 1~5M 的大小")]),s._v(" "),n("li",[s._v("包含了常用的 UNIX 工具")]),s._v(" "),n("li",[s._v("非常方便构建小镜像")])])])])]),s._v(" "),n("li",[n("p",[s._v("RUN 命令要尽量写在一条里，每次 RUN 命令都是在之前的镜像上封装，只会增大不会减小;")]),s._v(" "),n("ul",[n("li",[s._v("不用修改固定层放一起,常用修改的一层分开处理下一层;")]),s._v(" "),n("li",[s._v("wget下载后的资源，再删除，其实这个是压缩不到的；详见下图显示处理；")]),s._v(" "),n("li",[s._v("Dockerfile 中的 RUN 指令通过 && 和 / 支持将命令串联在一起，有时能达到意想不到的精简效果。")])]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("RUN "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$WORKDIR")]),s._v("/soft/nginx "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$WORKDIR")]),s._v("/soft/nginx "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$URLBASE")]),s._v("/soft/nginx/nginx-1.18.0.tar.gz "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])])]),s._v(" "),n("li",[n("p",[n("strong",[s._v("RUN命令中执行apt、apk或者yum类工具技巧")]),s._v("; 每次进行依赖安装后，记得yum clean all【centos】 ; "),n("strong",[s._v("yum clean all 清除缓存中的rpm头文件和包文件")]),s._v("；")]),s._v(" "),n("ul",[n("li",[s._v("执行 "),n("code",[s._v("apt-get install -y")]),s._v("时增加选项"),n("code",[s._v("--no-install-recommends")]),s._v(" ，可以不用安装建议性（非必须）的依赖，也可以在执行 "),n("code",[s._v("apk add")]),s._v("时添加选项"),n("code",[s._v("--no-cache")]),s._v("达到同样效果；")]),s._v(" "),n("li",[s._v("组件的安装和清理要串联在一条指令里面，如 "),n("code",[s._v("apt-get install zip && rm -rf /var/cache/apk/*")])]),s._v(" "),n("li",[s._v("Ubuntu或 Debian可以使用 rm -rf /"),n("strong",[s._v("var")]),s._v("/lib/apt/lists/* 清理镜像中缓存文件；CentOS 等系统使用 yum clean all 命令清理。")])])]),s._v(" "),n("li",[n("p",[n("strong",[s._v("上下文管理")]),s._v(";经常会用到的COPY指令; COPY会把"),n("strong",[s._v("整个")]),s._v(" "),n("strong",[s._v("构建上下文")]),s._v("复制到镜像中，并生产新的缓存层。为了不必要的文件如日志、缓存文件、Git 历史记录被加载到构建上下文，我们最好添加**.dockerignore**用于忽略非必须文件。这也是精简镜像关键一步，同时能更好的保证我们构建的镜像安全性;")])]),s._v(" "),n("li",[n("p",[s._v("移除不必要安装依赖，及资源下载；"),n("strong",[s._v("及时清理下载")]),s._v(";")]),s._v(" "),n("p",[s._v("虽然使用了"),n("code",[s._v("rm")]),s._v("删除download.zip包，由于镜像分层的问题，download.zip是在新的一层被删除，上一层仍然存在。我们要在一层中及时清理下载")]),s._v(" "),n("p",[s._v("比如现在用nodejs环境；用 distroless 去除所有不必要的东西；")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("FROM node:8 as build\nWORKDIR /app\nCOPY package.json index.js ./\nRUN "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n\nFROM node:8\nCOPY --from"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("build /app /\nEXPOSE "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),s._v("\nCMD "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"index.js"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\ndocker build "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" -t node-multi-stage\ndocker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("history")]),s._v(" node-multi-stage\ndocker images "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" node-\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#新镜像显示；")]),s._v("\nFROM node:8 as build\nWORKDIR /app\nCOPY package.json index.js ./\nRUN "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n\nFROM gcr.io/distroless/nodejs\nCOPY --from"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("build /app /\nEXPOSE "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),s._v("\nCMD "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"index.js"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\ndocker build -t node-distroless "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\ndocker images "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" node-distroless\ndocker run -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),s._v(":3000 -ti --rm --init node-distroless\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("使用export和import后得到的镜像不会保存镜像的历史，所以镜像会变小；【推荐】")]),s._v(" "),n("p",[s._v("但麻烦的是需要先将容器运行起来，而且这个过程中你会丢失镜像原有的一些信息，比如：导出端口，环境变量，默认指令。")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("$ docker run -d redis:lab-3\n$ docker "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" 71b1c0ad0a2b "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" - redis:lab-4\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("导出的文件通过gzip管道压缩；")]),s._v(" "),n("p",[n("code",[s._v("docker save <image>:<tag> | gzip > /文件目录/压缩包名称.tar.gz")])])]),s._v(" "),n("li",[n("p",[s._v("使用"),n("a",{attrs:{href:"https://github.com/jwilder/docker-squash#installation",target:"_blank",rel:"noopener noreferrer"}},[s._v("docker-squash"),n("OutboundLink")],1),s._v("；目前项目已经不维护； 注： 该工具在 Mac 下并不好使，请在 Linux 下使用；")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("docker save "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("img"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker-squash -t newtag "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" docker load\n\ndocker save redis:lab-3 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(" \n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker-squash -verbose -t redis:lab-4  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(" \n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" docker load\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("新python库(docker-squash)[https://github.com/goldmann/docker-squash]")])]),s._v(" "),n("li",[n("p",[s._v("squash功能一方面压缩了镜像的大小，另一方面保存了镜像的构建信息，但是该方法属于实验特性，需要谨慎使用。"),n("strong",[s._v("Experimental features 默认关闭，需要手动开启。")])]),s._v(" "),n("p",[n("strong",[s._v("设置")]),s._v("：Daemon 进程启动前，要将 experimental 参数设置为 true; 通过修改"),n("code",[s._v("/etc/docker/daemon.json")]),s._v("开启："),n("code",[s._v('"experimental": true')]),s._v(";")]),s._v(" "),n("p",[s._v("编译时，增加"),n("code",[s._v("--squash")]),s._v("参数;")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" docker restart\n\ndocker version\ndocker version -f "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{{.Server.Experimental}}'")]),s._v("\ndocker system info\n\ndocker build --no-cache --squash -t autorun-pro2 "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[n("strong",[s._v("服务中设置")]),s._v("："),n("strong",[s._v("修改docker配置文件")]),s._v("docker.conf：")]),s._v(" "),n("p",[n("code",[s._v("systemctl status docker.service")]),s._v(" 查看配置路径；")]),s._v(" "),n("p",[s._v("Centos："),n("code",[s._v("/usr/lib/systemd/system/docker.service")])]),s._v(" "),n("p",[s._v("Ubuntu: "),n("code",[s._v("/etc/systemd/system/docker.service.d/docker.conf")])]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /etc/systemd/system/docker.service.d/docker.conf ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Service"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nExecStart"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\nExecStart"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bin"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("dockerd "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("H fd"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("experimental"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("并重启：")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl daemon-reload\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl restart docker\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])])])]),s._v(" "),n("h3",{attrs:{id:"镜像打包加速【要点】"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#镜像打包加速【要点】"}},[s._v("#")]),s._v(" 镜像打包加速【要点】")]),s._v(" "),n("ul",[n("li",[n("strong",[s._v("借助"),n("code",[s._v("docker history xxx")]),s._v(",")]),s._v(" 可以查看到每一层命令的大小，方便定位优化；")]),s._v(" "),n("li",[s._v("镜像压缩优化，变成一行处理；")]),s._v(" "),n("li",[s._v("借助阿里云镜像在线打包及加速配置；")]),s._v(" "),n("li",[s._v("分基处理打镜像,再分具体业务镜像； pdftk,liboffice；")])]),s._v(" "),n("p",[n("img",{attrs:{src:t(1239),alt:"image-20220225144314367"}})]),s._v(" "),n("h3",{attrs:{id:"网络模式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#网络模式"}},[s._v("#")]),s._v(" 网络模式")]),s._v(" "),n("h4",{attrs:{id:"五种网络模式比较"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#五种网络模式比较"}},[s._v("#")]),s._v(" 五种网络模式比较")]),s._v(" "),n("ul",[n("li",[n("strong",[s._v("bridge")]),s._v("：桥接，"),n("em",[n("strong",[s._v("默认的网络驱动")])]),s._v("，如果不指定驱动，将默认使用桥接。通常用在同一个docker主机中的多个容器间通信。")]),s._v(" "),n("li",[n("strong",[s._v("host")]),s._v("：去掉容器和宿主机之间的网络隔离，"),n("strong",[s._v("直接使用宿主机的网络")]),s._v("。通常用在网络不与宿主机隔离但是其他资源需要隔离的场景。")]),s._v(" "),n("li",[n("strong",[s._v("none")]),s._v("：禁用网络。swarm不支持。")]),s._v(" "),n("li",[n("strong",[s._v("overlay")]),s._v("：叠加网络，将多个docker daemon连接到一起。"),n("strong",[s._v("主要用在运行在不同宿主机上的容器间通信")]),s._v("。")]),s._v(" "),n("li",[n("strong",[s._v("macvlan")]),s._v("：允许为容器分配一个MAC地址，让它成为一个物理设备。")])]),s._v(" "),n("h5",{attrs:{id:"模式比较-正常机器下"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#模式比较-正常机器下"}},[s._v("#")]),s._v(" 模式比较：正常机器下")]),s._v(" "),n("ul",[n("li",[s._v("1.bridge网络")])]),s._v(" "),n("p",[s._v("容器的默认网络模式，docker在安装时会创建一个名为docker0的Linux bridge，"),n("strong",[s._v("在不指定--network的情况下，创建的容器都会默认挂到docker0上面。")])]),s._v(" "),n("ul",[n("li",[s._v("2.host网络")])]),s._v(" "),n("p",[s._v("通过命令--network=host指定，使用host模式的容器可以直接使用docker host的IP地址与外界通信，容器内部的服务端口也可以使用宿主机的端口，"),n("strong",[s._v("不需要进行NAT，host最大的优势就是网络性能比较好，但是docker host上已经使用的端口就不能再用了，网络的隔离性不好")]),s._v("。")]),s._v(" "),n("ul",[n("li",[s._v("3.none网络")])]),s._v(" "),n("p",[s._v("这种网络模式下容器只有lo回环网络，没有其他网卡。none网络可以在容器创建时通过--network=none来指定。"),n("strong",[s._v("这种类型的网络没有办法联网，封闭的网络能很好的保证容器的安全性")]),s._v("。")]),s._v(" "),n("ul",[n("li",[s._v("4.container模式")])]),s._v(" "),n("p",[n("strong",[s._v("创建容器时使用--network=container:NAME_or_ID这个模式在创建新的容器的时候指定容器的网络和一个已经存在的容器共享一个Network Namespace")]),s._v("，但是并不为docker容器进行任何网络配置，这个docker容器没有网卡、IP、路由等信息，"),n("strong",[s._v("需要手动的去为docker容器添加网卡、配置IP等")]),s._v("。")]),s._v(" "),n("ul",[n("li",[s._v("5.user-defined模式")])]),s._v(" "),n("p",[s._v("用户自定义模式主要可选的有三种网络驱动："),n("code",[s._v("bridge")]),s._v("、"),n("code",[s._v("overlay")]),s._v("、"),n("code",[s._v("macvlan")]),s._v("。")]),s._v(" "),n("p",[n("strong",[s._v("bridge")]),s._v("驱动用于创建类似于前面提到的bridge网络；")]),s._v(" "),n("p",[n("strong",[s._v("overlay")]),s._v("和"),n("strong",[s._v("macvlan")]),s._v("驱动用于"),n("strong",[s._v("创建跨主机的网络")]),s._v("。")]),s._v(" "),n("p",[s._v("ps:window环境下，"),n("a",{attrs:{href:"https://docs.docker.com/docker-for-windows/networking/",target:"_blank",rel:"noopener noreferrer"}},[s._v("host模式不支持"),n("OutboundLink")],1),s._v("；")]),s._v(" "),n("h5",{attrs:{id:"模式比较-虚拟器下"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#模式比较-虚拟器下"}},[s._v("#")]),s._v(" 模式比较：虚拟器下")]),s._v(" "),n("blockquote",[n("p",[s._v("主机跟虚拟机中的docker情况下")])]),s._v(" "),n("ul",[n("li",[s._v("本地网络")])]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",[s._v("网络类型")]),s._v(" "),n("th",[s._v("说明")])])]),s._v(" "),n("tbody",[n("tr",[n("td",[s._v("bridge")]),s._v(" "),n("td",[s._v("–net=bridge 默认模式,NAT转发")])]),s._v(" "),n("tr",[n("td",[s._v("host")]),s._v(" "),n("td",[s._v("–net=host 使用宿主机网络")])]),s._v(" "),n("tr",[n("td",[s._v("none")]),s._v(" "),n("td",[s._v("–net=none 无网卡")])]),s._v(" "),n("tr",[n("td",[s._v("container")]),s._v(" "),n("td",[s._v("–net=container:容器名或ID ,共用其它容器网络")])])])]),s._v(" "),n("p",[s._v("如果"),n("strong",[s._v("要是容器与宿主机进行通讯则不可选择host和container这两种网络")]),s._v("，如果你仅需要Docker容器与宿主机网段相同，容器与其他同网段节点相互通信，不与宿主机进行通信，可以使用host网络模型！")]),s._v(" "),n("ul",[n("li",[s._v("跨主机网络")])]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",[s._v("网络类型")]),s._v(" "),n("th",[s._v("说明")])])]),s._v(" "),n("tbody",[n("tr",[n("td",[s._v("overlay")]),s._v(" "),n("td",[s._v("vxlan模式")])]),s._v(" "),n("tr",[n("td",[s._v("macvlan")]),s._v(" "),n("td",[s._v("使用外部lan,需手动配置")])])])]),s._v(" "),n("p",[s._v("macvlan的原理是在宿主机物理网卡上虚拟出多个子网卡，通过不同的MAC地址在数据链路层进行网络数据转发的，它是比较新的网络虚拟化技术，需要较新的内核支持，使用macVLAN模式的容器，无法ping通宿主机，宿主机也无法ping通该容器，对其他同网段的服务器和容器都可以联通。")]),s._v(" "),n("h5",{attrs:{id:"虚拟机的设置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#虚拟机的设置"}},[s._v("#")]),s._v(" "),n("strong",[s._v("虚拟机的设置")])]),s._v(" "),n("p",[n("strong",[s._v("“桥接”和“NAT”的区别")]),s._v("：")]),s._v(" "),n("p",[s._v("使用NAT模式可以实现在虚拟系统里访问互联网，虚拟系统无法和本局域网中的其他真实主机进行通讯。")]),s._v(" "),n("p",[s._v("而使用桥接模式下虚拟出来的操作系统就像是局域网中的一台独立的主机，它可以访问网内任何一台机器。")]),s._v(" "),n("p",[s._v("所以Docker0是属于桥接模式。")]),s._v(" "),n("h4",{attrs:{id:"net、network-mode、networks"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#net、network-mode、networks"}},[s._v("#")]),s._v(" net、network_mode、networks")]),s._v(" "),n("p",[n("strong",[s._v("net")])]),s._v(" "),n("p",[n("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/#version-1",target:"_blank",rel:"noopener noreferrer"}},[s._v("Version 1 file format"),n("OutboundLink")],1),s._v(" only. In version 2, use "),n("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/#network_mode",target:"_blank",rel:"noopener noreferrer"}},[s._v("network_mode"),n("OutboundLink")],1),s._v(".")]),s._v(" "),n("p",[s._v("为容器指定网络类型，version 1专用，version 2使用network_mode.")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('net: "bridge"\nnet: "host"\nnet: "none"\nnet: "container:[service name or container name/id]"\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[n("strong",[s._v("network_mode")])]),s._v(" "),n("p",[n("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/#version-2",target:"_blank",rel:"noopener noreferrer"}},[s._v("Version 2 file format"),n("OutboundLink")],1),s._v(" only. In version 1, use "),n("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/#net",target:"_blank",rel:"noopener noreferrer"}},[s._v("net"),n("OutboundLink")],1),s._v(".")]),s._v(" "),n("p",[s._v("为容器指定网络类型.")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('network_mode: "bridge"\nnetwork_mode: "host"\nnetwork_mode: "none"\nnetwork_mode: "service:[service name]"\nnetwork_mode: "container:[container name/id]"\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[n("strong",[s._v("networks")])]),s._v(" "),n("blockquote",[n("p",[n("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/#version-2",target:"_blank",rel:"noopener noreferrer"}},[s._v("Version 2 file format"),n("OutboundLink")],1),s._v(" only. In version 1, use "),n("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/#net",target:"_blank",rel:"noopener noreferrer"}},[s._v("net"),n("OutboundLink")],1),s._v(".")])]),s._v(" "),n("p",[s._v("Networks to join, referencing entries under the "),n("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/#network-configuration-reference",target:"_blank",rel:"noopener noreferrer"}},[s._v("top-level "),n("code",[s._v("networks")]),s._v(" key"),n("OutboundLink")],1),s._v(".")]),s._v(" "),n("p",[s._v("services:")]),s._v(" "),n("p",[s._v("some-service:")]),s._v(" "),n("p",[s._v("networks:")]),s._v(" "),n("p",[s._v("- some-network")]),s._v(" "),n("p",[s._v("- other-network")]),s._v(" "),n("p",[s._v("指定网络模式。"),n("strong",[s._v('注意“network_mode: "host"”不能与 links 选项合用。')])]),s._v(" "),n("p",[s._v("** links\n关联另一个服务中的容器。如果同时指定了该选项和 networks 选项，那个关联的服务之间应该至少要有一个共同的网络才能相互通信。")]),s._v(" "),n("h3",{attrs:{id:"docker-opts设置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#docker-opts设置"}},[s._v("#")]),s._v(" DOCKER_OPTS设置")]),s._v(" "),n("h4",{attrs:{id:"ubuntu"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ubuntu"}},[s._v("#")]),s._v(" ubuntu")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("$ "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'DOCKER_OPTS=\"-H tcp://0.0.0.0:2376\"'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /etc/default/docker\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" docker start\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h4",{attrs:{id:"centos"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#centos"}},[s._v("#")]),s._v(" centos")]),s._v(" "),n("p",[s._v("不同于Ubuntu目录 /etc/default/docker。 在 CentOS7中Docker默认配置的路径在 ；"),n("code",[s._v("/usr/lib/systemd/system/docker.service")]),s._v("\n【例如修改 --icc = false】CentOS7中需要如下设置")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /usr/lib/systemd/system/docker.service\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ExecStart=/usr/bin/dockerd-current -H tcp://0.0.0.0:4343 -H unix:///var/run/docker.sock")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStart")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/bin/dockerd -H tcp://0.0.0.0:4343 -H fd:// --containerd"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/run/containerd/containerd.sock\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# DOCKER_OPTS=/usr/bin/dockerd-current -H tcp://0.0.0.0:4343 -H unix:///var/run/docker.sock")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#DOCKER_OPTS='-H tcp://0.0.0.0:4343 -H unix:///var/run/docker.sock'")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("echo方式设置："),n("code",[s._v("DOCKER_OPTS='-H tcp://0.0.0.0:2376 -H unix:///var/run/docker.sock'")])]),s._v(" "),n("p",[s._v("设置完毕后，执行重启；")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("docker daemon -reload\nsystemctl restart docker\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看是否生效")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -ef "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" docker \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h4",{attrs:{id:"全局设置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#全局设置"}},[s._v("#")]),s._v(" 全局设置")]),s._v(" "),n("img",{staticStyle:{zoom:"67%"},attrs:{src:"_image/01.docker&compose及swarm的使用/image-20220121105223636.png",alt:"image-20220121105223636"}}),s._v(" "),n("h3",{attrs:{id:"容器启动与状态"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#容器启动与状态"}},[s._v("#")]),s._v(" 容器启动与状态")]),s._v(" "),n("h4",{attrs:{id:"run-start的区别"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#run-start的区别"}},[s._v("#")]),s._v(" run/start的区别")]),s._v(" "),n("ul",[n("li",[n("strong",[s._v("docker run 只在第一次运行时使用")]),s._v("，将镜像放到容器中，以后再次启动这个容器时，只需要使用命令docker start 即可。")]),s._v(" "),n("li",[s._v("docker run相当于执行了两步操作：\n"),n("ul",[n("li",[s._v("将镜像放入容器中（docker create）,然后将容器启动，使之变成运行时容器（docker start）。")]),s._v(" "),n("li",[s._v("而docker start的作用是，重新启动已存在的镜像；也就是说，如果使用这个命令，我们必须事先知道这个容器的ID，或者这个容器的名字，我们可以使用docker; ps找到这个容器的信息。")])])])]),s._v(" "),n("h4",{attrs:{id:"kill-stop的区别与联系"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#kill-stop的区别与联系"}},[s._v("#")]),s._v(" kill/stop的区别与联系")]),s._v(" "),n("p",[s._v("相同点：")]),s._v(" "),n("ul",[n("li",[s._v("两者都是停掉容器，并把容器状态指定到stopped。")])]),s._v(" "),n("p",[s._v("不同点：")]),s._v(" "),n("ul",[n("li",[s._v("被kill杀死容器，进入stopped状态被重新start后，会开启新的进程号；")]),s._v(" "),n("li",[s._v("被stop停掉的容器，再次被重新start后，进程号不变，还是原来的。")])]),s._v(" "),n("p",[s._v("kill命令比较生猛，不管容器死活，直接给系统发送SIGKILL的系统信号强行kill掉进程，就是要用kill -9干掉容器；")]),s._v(" "),n("p",[s._v("stop比较温柔，先给容器发送一个TERM信号，给容器充足时间(默认10秒)保存数据，让容器自动安全停止运行，超时后再给系统发送SIGKILL的系统信号强行kill掉进程，最后转变为stop状态。")]),s._v(" "),n("p",[n("strong",[s._v("使用docker stop -t [s, default 10],可调整超时时间（docker stop -t 20 mynginx）")])]),s._v(" "),n("h4",{attrs:{id:"pause-unpause暂停和取消暂停"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#pause-unpause暂停和取消暂停"}},[s._v("#")]),s._v(" pause/unpause暂停和取消暂停")]),s._v(" "),n("ul",[n("li",[s._v("pause  暂停容器中所有的进程，状态为Pause(暂停对外提供服务)")]),s._v(" "),n("li",[s._v("unpause 取消暂停，将容器恢复为Up上线状态")])]),s._v(" "),n("p",[s._v("使用场景：在各个容器之间调试时使用。")]),s._v(" "),n("p",[s._v("语法：docker pause [OPTIONS] CONTAINER [CONTAINER...]")]),s._v(" "),n("p",[s._v("-t, --time int   Seconds to wait for stop before killing it (default 10)")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("docker pause mynginx\n\ndocker pause mynginx -t "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#该命令首先向容器发送SIGTERM信号，等待一段时间后（-t 参数指定，默认为10s），再发送SIGKILL信号来终止容器。")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h4",{attrs:{id:"prune命令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#prune命令"}},[s._v("#")]),s._v(" "),n("code",[s._v("prune")]),s._v("命令")]),s._v(" "),n("p",[n("code",[s._v("docker container prune")]),s._v("命令，会自动清除掉所有处于停止状态的容器")]),s._v(" "),n("h4",{attrs:{id:"生命周期演示"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#生命周期演示"}},[s._v("#")]),s._v(" 生命周期演示")]),s._v(" "),n("p",[s._v("常见的五种状态："),n("code",[s._v("created")]),s._v(","),n("code",[s._v("running")]),s._v(","),n("code",[s._v("exited")]),s._v(","),n("code",[s._v("paused")]),s._v(",其他,")]),s._v(" "),n("p",[s._v("更好的展示效果，先停掉Docker服务")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#service docker stop")]),s._v("\n或者\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#systemctl stop docker ")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h5",{attrs:{id:"create状态为create创建状态"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#create状态为create创建状态"}},[s._v("#")]),s._v(" create状态为create创建状态")]),s._v(" "),n("blockquote",[n("p",[s._v("发现：create命令，创建容器后，#docker ps 并看不到该容器，因为ps命令不带任何任何参数时，只显示状态为Up的容器。"),n("strong",[s._v("此时的容器状态是Created")]),s._v("。")])]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("docker create tomcat:8.5.46-jdk8-openjdk  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建容器（并没有启动）")]),s._v("\ndocker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看容器列表（只显示已启动的）")]),s._v("\ndocker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -a  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看所有容器（可以看到状态是Created的容器）")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h5",{attrs:{id:"start状态为up上线状态"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#start状态为up上线状态"}},[s._v("#")]),s._v(" start状态为up上线状态")]),s._v(" "),n("blockquote",[n("p",[s._v("发现：start命令后，容器状态"),n("strong",[s._v("由Created变为Up")])])]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("docker start bf88214f5f6d  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#根据容器id启动容器")]),s._v("\ndocker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#可以看到容器状态为up，已上线状态")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h5",{attrs:{id:"pause-unpause状态为pause暂停-上线状态"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#pause-unpause状态为pause暂停-上线状态"}},[s._v("#")]),s._v(" pause/unpause状态为pause暂停/上线状态")]),s._v(" "),n("blockquote",[n("p",[s._v("发现：pause命令后，容器状态"),n("strong",[s._v("从Up变为Paused; unpause命令后，状态又切回Up状态。")])])]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("docker pause bf88214f5f6d  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#根据容器id启动容器")]),s._v("\ndocker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#可以看到容器状态为up(pause)，已上线(暂停)状态")]),s._v("\ndocker unpause bf88214f5f6d  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#取消暂停容器")]),s._v("\ndocker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h5",{attrs:{id:"stop停掉容器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#stop停掉容器"}},[s._v("#")]),s._v(" stop停掉容器")]),s._v(" "),n("blockquote",[n("p",[s._v("发现：stop命令后,容器状态"),n("strong",[s._v("从Up变为Exited")]),s._v("，退出状态。")])]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("docker stop bf88214f5f6d\ndocker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -a\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h5",{attrs:{id:"rm-f强制删除容器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#rm-f强制删除容器"}},[s._v("#")]),s._v(" rm -f强制删除容器")]),s._v(" "),n("blockquote",[n("p",[s._v("发现：容器被rm命令移除后，docker ps -a 看不到任何容器")])]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -f  bf88214f5f6d \ndocker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -a\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h5",{attrs:{id:"也通过命令inspect查看"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#也通过命令inspect查看"}},[s._v("#")]),s._v(" 也通过命令"),n("code",[s._v("inspect")]),s._v("查看")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#docker ps -a | grep $PRO_NAME")]),s._v("\ndocker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -a "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" autorun-pro\n\ndocker inspect autorun-pro\ndocker inspect --format "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{{.State.Status}}'")]),s._v(" autorun-pro\ndocker inspect --format "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{{.State.Running}}'")]),s._v(" autorun-pro\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#running, exited, paused, 其他err")]),s._v("\nTemplate parsing error: template: :1:8: executing "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" at "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(".State.Status"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(": map has no entry "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" key "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"State"')]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("docker start autorun-pro\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"State"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Status"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"running"')]),s._v(",\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Running"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" true,\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Paused"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false,\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Restarting"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false,\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"OOMKilled"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false,\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Dead"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false,\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Pid"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8940")]),s._v(",\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ExitCode"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(",\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Error"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(",\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"StartedAt"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2022-03-02T07:27:57.407867285Z"')]),s._v(",\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"FinishedAt"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2022-03-02T07:25:59.451068304Z"')]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n\ndocker stop autorun-pro\ndocker start autorun-pro\n "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"State"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Status"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"exited"')]),s._v(",\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Running"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false,\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Paused"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false,\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Restarting"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false,\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"OOMKilled"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false,\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Dead"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false,\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Pid"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(",\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ExitCode"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("137")]),s._v(",\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Error"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(",\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"StartedAt"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2022-03-02T07:06:10.631579416Z"')]),s._v(",\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"FinishedAt"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2022-03-02T07:25:59.451068304Z"')]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n      \ndocker pause autorun-pro\ndocker unpause autorun-pro\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"State"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Status"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"paused"')]),s._v(",\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Running"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" true,\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Paused"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" true,\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Restarting"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false,\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"OOMKilled"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false,\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Dead"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false,\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Pid"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8940")]),s._v(",\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ExitCode"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(",\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Error"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(",\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"StartedAt"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2022-03-02T07:27:57.407867285Z"')]),s._v(",\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"FinishedAt"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2022-03-02T07:25:59.451068304Z"')]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br")])]),n("h4",{attrs:{id:"脚本处理启动状态变化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#脚本处理启动状态变化"}},[s._v("#")]),s._v(" 脚本处理启动状态变化")]),s._v(" "),n("p",[n("code",[s._v("start.sh")])]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("###")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @Author: samy")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @email: yessz#foxmail.com")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @time: 2022-02-18 13:21:47")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @modAuthor: samy")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @modTime: 2022-02-28 17:20:34")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @desc: 容器启动")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Copyright © 2015~2022 BDP FE")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#autorun-pro:latest")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PRO_NAME")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("autorun-pro\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PRO_VERSION")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("latest \n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker inspect --format '{{.State.Running}}' autorun-pro")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker inspect --format '{{.State.Status}}' autorun-pro")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# EXIST=`docker ps -a | grep $PRO_NAME | wc -l`")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("EXISTS")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("docker inspect --format "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{{.State.Status}}'")]),s._v(" $PRO_NAME"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("case")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$EXISTS")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"running"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"---容器是running状态---将不做处理---"')]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"exited"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"---容器是exited状态---将start处理..."')]),s._v("\n        docker start "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PRO_NAME")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"paused"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"---容器是paused状态---将unpause处理..."')]),s._v("\n        docker unpause "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PRO_NAME")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n     "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"created"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"---容器是created状态---将start处理..."')]),s._v("\n            docker start "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PRO_NAME")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    *"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"---检查到容器不存在---将run处理中..."')]),s._v("\n        docker run -d "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n          -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("28080")]),s._v(":80 -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("26379")]),s._v(":6379 -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("23306")]),s._v(":3306 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n          -v /data/autorun/mysql/log:/var/log/mysql "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n          -v /data/autorun/mysql/data:/var/lib/mysql "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n          --name "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PRO_NAME")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PRO_NAME")]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PRO_VERSION")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("esac")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br")])]),n("h3",{attrs:{id:"build设置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#build设置"}},[s._v("#")]),s._v(" Build设置")]),s._v(" "),n("p",[n("code",[s._v("-t,-f")]),s._v(" 指定版本；")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("docker build -f /path/to/a/Dockerfile "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n\ndocker build -t runoob/ubuntu:v1 "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[n("code",[s._v("--no-cache")]),s._v("不使用缓存；")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker build -t autorun-pro .")]),s._v("\ndocker build --no-cache -t autorun-pro "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h3",{attrs:{id:"dockerfile"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile"}},[s._v("#")]),s._v(" Dockerfile")]),s._v(" "),n("h4",{attrs:{id:"格式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#格式"}},[s._v("#")]),s._v(" "),n("strong",[s._v("格式")])]),s._v(" "),n("h5",{attrs:{id:"from"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#from"}},[s._v("#")]),s._v(" FROM")]),s._v(" "),n("blockquote",[n("p",[s._v("指定基于哪个基础镜像")])]),s._v(" "),n("p",[s._v("格式 FROM"),n("code",[s._v("<image>")]),s._v(" 或者  FROM "),n("code",[s._v("<image>:<tag>")]),s._v("，  比如")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[s._v("FROM centos\nFROM centos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("latest\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h5",{attrs:{id:"maintainer"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#maintainer"}},[s._v("#")]),s._v(" MAINTAINER")]),s._v(" "),n("blockquote",[n("p",[s._v("指定作者信息")])]),s._v(" "),n("p",[s._v("格式  MAINTAIN "),n("code",[s._v("<name>")]),s._v("，比如")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[s._v("MAINTAINER  samy  samy@163.com\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h5",{attrs:{id:"workdir"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#workdir"}},[s._v("#")]),s._v(" WORKDIR")]),s._v(" "),n("blockquote",[n("p",[s._v("格式 "),n("strong",[s._v("WORKDIR  /path/to/workdir")])])]),s._v(" "),n("p",[s._v("为后续的RUN、CMD或者ENTRYPOINT指定工作目录；")]),s._v(" "),n("p",[s._v("WORKDIR 用来切换工作目录的。Docker 默认的工作目录是/，只有 RUN 能执行 cd 命令切换目录，而且还只作用在当下下的 RUN，也就是说每一个 RUN 都是独立进行的。"),n("strong",[s._v("如果想让其他指令在指定的目录下执行，就得靠 WORKDIR。WORKDIR 动作的目录改变是持久的，不用每个指令前都使用一次 WORKDIR")]),s._v("。")]),s._v(" "),n("h5",{attrs:{id:"user"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#user"}},[s._v("#")]),s._v(" USER")]),s._v(" "),n("blockquote",[n("p",[s._v("格式 USER daemon")])]),s._v(" "),n("p",[s._v("指定运行容器的用户")]),s._v(" "),n("h5",{attrs:{id:"run"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#run"}},[s._v("#")]),s._v(" RUN")]),s._v(" "),n("blockquote",[n("p",[s._v("镜像操作指令")])]),s._v(" "),n("p",[s._v("格式为 RUN "),n("command",[s._v("  或者 RUN [“executable”, “param1”, “param2”]，比如")])],1),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[s._v("RUN  yum install  httpd\nRUN "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/bin/bash"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-c"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"echo hello"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h5",{attrs:{id:"env"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#env"}},[s._v("#")]),s._v(" ENV")]),s._v(" "),n("p",[s._v("格式 ENV  "),n("code",[s._v("<key> <value>")]),s._v("；")]),s._v(" "),n("p",[s._v("格式有两种：")]),s._v(" "),n("ul",[n("li",[n("code",[s._v("ENV <key> <value>")])]),s._v(" "),n("li",[n("code",[s._v("ENV <key1>=<value1> <key2>=<value2>...")])])]),s._v(" "),n("p",[s._v("它主要是为后续的RUN指令提供一个环境变量，我们也可以定义一些自定义的变量")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[s._v("ENV MYSQL_version 5.6\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#定义工作目录")]),s._v("\nENV WORKDIR /srv/app\nWORKDIR $WORKDIR\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# COPY . .")]),s._v("\nADD entrypoint.sh $WORKDIR/\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("设置JDK环境：")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[s._v("ENV JAVA_HOME=/usr/local/java\nENV JRE_HOME=/usr/local/java/jre\nENV CLASSPATH=."),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("$JAVA_HOME/lib/dt.jar"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("$JAVA_HOME/lib/tools.jar"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("$JRE_HOME/lib"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("$CLASSPATH\nENV PATH=$PATH"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("$JAVA_HOME/bin\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h5",{attrs:{id:"add"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#add"}},[s._v("#")]),s._v(" ADD")]),s._v(" "),n("blockquote",[n("p",[s._v("格式 add "),n("code",[s._v("<src> <dest>")])])]),s._v(" "),n("p",[s._v("两种格式")]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ADD")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("chown"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("user"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("group"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("src"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("...")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("dest"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ADD")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("chown"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("user"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("group"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"<src>"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("...")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"<dest>"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("--chown：仅适用于 linux 上的 dockerfile，在 window 上没有用户、组的概念；")]),s._v(" "),n("p",[s._v("将本地的一个文件或目录拷贝到容器的某个目录里。 其中src为Dockerfile所在目录的相对路径，它也可以是一个url；")]),s._v(" "),n("p",[s._v("ADD的另外一个特性是有能力自动解压文件。如果"),n("code",[s._v("<src>")]),s._v("参数是一个可识别的压缩格式（tar, gzip, bzip2, etc）的本地文件（所以实现不了同时下载并解压），就会被解压到指定容器文件系统的路径"),n("code",[s._v("<dest>")]),s._v("。")]),s._v(" "),n("p",[n("src",[s._v(" 是压缩格式（gzip、bzip2、identity、xz）的本地 tar 文件")])],1),s._v(" "),n("ul",[n("li",[s._v("会将它自动解压为目录")]),s._v(" "),n("li",[s._v("但来自远程 URL 资源不会被解压缩")]),s._v(" "),n("li",[s._v("当一个目录被复制或解压时，它的行为与 tar -x 相同")]),s._v(" "),n("li",[s._v("注意：文件是否被识别为可识别的压缩格式完全取决于文件的内容，而不是文件的名称；例如，如果一个空文件恰好以 .tar.gz 结尾，黄不会被识别为压缩文件，也不会生成任何类型的解压缩错误消息，而只会将该文件复制到目标位置")])]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[s._v("ADD <conf/vhosts"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v(" </usr/local/nginx/conf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("\n\nADD http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//foo.com/bar.go /tmp/main.go\nADD http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//foo.com/bar.go /tmp/\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#会使foo.tar.gz压缩文件解压到容器的/tmp目录")]),s._v("\nADD /foo.tar.gz /tmp/\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[n("strong",[s._v("有如下注意事项")])]),s._v(" "),n("ul",[n("li",[s._v("如果源路径是个文件，且目标路径是以 / 结尾， 则docker会把目标路径当作一个目录，会把源文件拷贝到该目录下。\n如果目标路径不存在，则会自动创建目标路径。")]),s._v(" "),n("li",[s._v("如果源路径是个文件，且目标路径是不是以 / 结尾，则docker会把目标路径当作一个文件。\n如果目标路径不存在，会以目标路径为名创建一个文件，内容同源文件；\n如果目标文件是个存在的文件，会用源文件覆盖它，当然只是内容覆盖，文件名还是目标文件名。\n如果目标文件实际是个存在的目录，则会源文件拷贝到该目录下。 注意，这种情况下，最好显示的以 / 结尾，以避免混淆。")]),s._v(" "),n("li",[s._v("如果源路径是个目录，且目标路径不存在，则docker会自动以目标路径创建一个目录，把源路径目录下的文件拷贝进来。\n如果目标路径是个已经存在的目录，则docker会把源路径目录下的文件拷贝到该目录下。")]),s._v(" "),n("li",[s._v("如果源文件是个归档文件（压缩文件），则docker会自动帮解压。")])]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[s._v("ADD config/ /config/\n\nADD test1.txt test1.txt\nADD test1.txt test1.txt.bak\nADD test1.txt /mydir/\nADD data1 data1\nADD data2 data2\nADD zip.tar /myzip\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[n("strong",[s._v("ADD 和 COPY 的区别和使用场景")])]),s._v(" "),n("ul",[n("li",[s._v("ADD 支持添加远程 url 和自动提取压缩格式的文件，COPY 只允许从本机中复制文件")]),s._v(" "),n("li",[s._v("COPY 支持从其他构建阶段中复制源文件（--from）")]),s._v(" "),n("li",[s._v("根据官方 Dockerfile 最佳实践，除非真的需要从远程 url 添加文件或自动提取压缩文件才用 ADD，其他情况一律使用 COPY")])]),s._v(" "),n("p",[n("strong",[s._v("注意")])]),s._v(" "),n("ul",[n("li",[s._v("ADD 从远程 url 获取文件和复制的效果并不理想，"),n("strong",[s._v("因为该文件会增加 Docker Image 最终的大小")]),s._v(";")]),s._v(" "),n("li",[s._v("相反，应该使用 curl 或者 wget 来获取远程文件，然后在不需要它时进行删除;")])]),s._v(" "),n("h5",{attrs:{id:"copy"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#copy"}},[s._v("#")]),s._v(" COPY")]),s._v(" "),n("blockquote",[n("p",[s._v("格式同add")])]),s._v(" "),n("p",[s._v("使用方法和add一样，不同的是，"),n("strong",[s._v("它不支持url")])]),s._v(" "),n("p",[n("strong",[s._v("Docker 团队的建议是在大多数情况下使用COPY。拷贝文件的原则：使用COPY（除非你明确你需要ADD）;")])]),s._v(" "),n("p",[s._v("<目标路径> 可以是容器内的绝对路径，"),n("strong",[s._v("也可以是相对于工作目录的相对路径（工作目录可以用 WORKDIR 指令来指定）")]),s._v("。目标路径不需要事先创建，如果目录不存在会在复制文件前先行")]),s._v(" "),n("p",[s._v("创建缺失目录。")]),s._v(" "),n("p",[n("code",[s._v("COPY <源路径>... <目标路径>")]),s._v(" "),n("code",[s._v('COPY ["<源路径1>",... "<目标路径>"]')])]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#正确：")]),s._v("\nCOPY ./package.json /app/\nCOPY package.json /usr/src/app/\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#错误：")]),s._v("\nCOPY "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/package.json /app\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#或者 COPY /opt/xxxx /app")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("注意：")]),s._v(" "),n("p",[s._v("此外，还需要注意一点，使用 COPY 指令，源文件的各种元数据都会保留。比如读、写、执\n行权限、文件变更时间等。")]),s._v(" "),n("p",[n("strong",[s._v("复制保留子目录结构")])]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[s._v("COPY files/ /files/\nRUN ls "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("la /files/*\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("完整示范：")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[s._v("FROM centos\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加文件到目录下")]),s._v("\nADD test.txt /mydir/\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将文件内容写入 mytest")]),s._v("\nADD test.txt /mytest\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 压缩文件,自动解压")]),s._v("\nADD jmeter.log.zip /myzipdir/\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加目录")]),s._v("\nADD TeamFile /\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 其他文件")]),s._v("\nADD jmeter.log /mydir/\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 多个文件")]),s._v("\nADD test1.txt test2.txt /mydir/\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 通配符,dest 不存在自动创建")]),s._v("\nADD test"),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("*.txt")]),s._v(" /mydir/test/\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 特殊字符串")]),s._v("\nADD add"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("0"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(".txt /mydir/\n\nWORKDIR /data\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 相对路径")]),s._v("\nADD test.txt test/\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br")])]),n("h5",{attrs:{id:"cmd"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#cmd"}},[s._v("#")]),s._v(" CMD")]),s._v(" "),n("blockquote",[n("p",[s._v("三种格式：")]),s._v(" "),n("ul",[n("li",[s._v('CMD ["executable", "param1", "param2"]')]),s._v(" "),n("li",[s._v("CMD command param1 param2")]),s._v(" "),n("li",[s._v('CMD ["param1", "param2"]')])])]),s._v(" "),n("p",[s._v("RUN和CMD看起来挺像，但是CMD用来指定"),n("strong",[s._v("容器启动时用到的命令")]),s._v("，只能有一条。比如")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[s._v("CMD "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/bin/bash"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/local/nginx/sbin/nginx"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-c"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/local/nginx/conf/nginx.conf"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[n("strong",[s._v("cmd执行外部脚本")])]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[s._v("FROM ubuntu"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("14.04")]),s._v("\nADD shell.sh /usr/local/bin/shell.sh\nRUN chmod 777 /usr/local/bin/shell.sh\nCMD /usr/local/bin/shell.sh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("...")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h5",{attrs:{id:"expose"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#expose"}},[s._v("#")]),s._v(" EXPOSE")]),s._v(" "),n("p",[s._v("格式为 EXPOSE "),n("code",[s._v("<port> [<port>...] ,")]),s._v(" 比如")]),s._v(" "),n("p",[s._v("EXPOSE 22 80 8443")]),s._v(" "),n("p",[s._v("这个用来指定要映射出去的端口，比如容器内部我们启动了sshd和nginx，所以我们需要把22和80端口暴漏出去。这个需要配合-P（大写）来工作，也就是说在"),n("strong",[s._v("启动容器时，需要加上-P，让它自动分配")]),s._v("。如果想"),n("strong",[s._v("指定具体的端口，也可以使用-p（小写）来指定")]),s._v("。")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("docker run -itd -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("19876")]),s._v(":80  --name autorun-test autorun-test\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h5",{attrs:{id:"entrypoint【要点】"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#entrypoint【要点】"}},[s._v("#")]),s._v(" ENTRYPOINT【要点】")]),s._v(" "),n("blockquote",[n("p",[s._v("格式类似CMD")])]),s._v(" "),n("p",[s._v("容器启动时要执行的命令，它和CMD很像，也是只有一条生效，如果写多个只有最后一条有效。和CMD不同是：")]),s._v(" "),n("p",[s._v("如果同时有cmd和entrypoint的话，都会执行：")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[s._v("FROM ubuntu\nMAINTAINER sofija\nRUN apt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("get update\nENTRYPOINT "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("“echo”"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" “Hello”"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nCMD "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("“World”"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Hello World")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[n("strong",[s._v("CMD 是可以被 docker run 指令覆盖的，而ENTRYPOINT不能覆盖")]),s._v("。")]),s._v(" "),n("p",[s._v("CMD 和 ENTRYPOINT 区别")]),s._v(" "),n("ul",[n("li",[s._v("CMD                   # 指定这个容器启动的时候要运行的命令，不可以追加命令")]),s._v(" "),n("li",[s._v("ENTRYPOINT            # 指定这个容器启动的时候要运行的命令，可以追加命令")])]),s._v(" "),n("p",[s._v("比如，容器名字为aming")]),s._v(" "),n("p",[s._v("我们在Dockerfile中指定如下CMD：")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[s._v("CMD "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/bin/echo"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# CMD ["/usr/sbin/nginx", "-g" ,"daemon off;"]')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# CMD ["nginx", "-g", "daemon off;"]')]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("启动容器的命令是  docker run aming 这样会输出 test")]),s._v(" "),n("p",[s._v("假如启动容器的命令是 docker run -it aming  /bin/bash  什么都不会输出")]),s._v(" "),n("p",[n("strong",[s._v("ENTRYPOINT不会被覆盖，而且会比CMD或者docker run指定的命令要靠前执行")])]),s._v(" "),n("p",[s._v('ENTRYPOINT ["echo", "test"]')]),s._v(" "),n("p",[s._v("docker run -it aming  123")]),s._v(" "),n("p",[s._v("则会输出 test  123 ，这相当于要执行命令  echo test  123")]),s._v(" "),n("p",[s._v("ps：如果设置cmd或者ENTRYPOINT，启动容器时，不要设置bash命令；要分两部处理i；")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\ndocker stop autorun-test\ndocker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" autorun-test\ndocker run -itd -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("19876")]),s._v(":80  --name autorun-test autorun-test\ndocker "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it autorun-test "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[n("strong",[s._v("ENTRYPOINT执行外部脚本")])]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[s._v("ENTRYPOINT "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/bin/bash"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./entrypoint.sh"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[n("code",[s._v("./entrypoint.sh")])]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\nredis /usr/local/redis/redis.conf\nnginx -g "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"daemon off;"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nginx -c /usr/local/nginx/conf/nginx.conf")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h5",{attrs:{id:"volume"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#volume"}},[s._v("#")]),s._v(" VOLUME")]),s._v(" "),n("blockquote",[n("p",[s._v('格式  VOLUME ["/data"]')])]),s._v(" "),n("p",[s._v("创建一个可以从本地主机或其他容器挂载的挂载点。")]),s._v(" "),n("h4",{attrs:{id:"构建"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#构建"}},[s._v("#")]),s._v(" 构建")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用说明:")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动脚本:sudo bash ./docker/build.sh")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker build -t etag -f docker/Dockerfile "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h4",{attrs:{id:"源、时间动态设置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#源、时间动态设置"}},[s._v("#")]),s._v(" 源、时间动态设置")]),s._v(" "),n("div",{staticClass:"language-dockerfile line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" alpine"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("3.9\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置时区为上海")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" apk add tzdata && cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime \\\n    && echo "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Asia/Shanghai"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v(" /etc/timezone \\\n    && apk del tzdata\n    \n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" echo  "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://mirrors.aliyun.com/alpine/v3.7/main/"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v(" /etc/apk/repositories\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#apk update")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("p",[s._v("示例：")]),s._v(" "),n("div",{staticClass:"language-dockerfile line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" ubuntu"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("16.04\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LABEL")]),s._v(" author="),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"samy"')]),s._v(" version="),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1.0.0"')]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" apt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("get update \\\n    && apt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("get install "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("y sudo \\\n    && apt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("get install "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("y language"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pack"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("zh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("hans \\\n    && apt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("get install "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("y language"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pack"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("en \\\n    && apt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("get install python2.7 python2.7"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("dev make gcc "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("y \\\n    && apt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("get install "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("y curl \\\n    && curl "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("sL https"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//deb.nodesource.com/setup_10.x "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v(" sudo "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("E bash "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" \\\n    && apt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("get install "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("y nodejs \\\n    && apt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("get install "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("y build"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("essential \\\n    && apt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("get install "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("y vim && \\\n    rm "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("rf /tmp/* /var/lib/apt/* /var/cache/* /var/log/*\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" LANG en_US.UTF"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("8 \\\n    && NODE_PATH=/usr/local/lib/node_modules/"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/usr/local/lib  NODE_ENV=docker \\\n    && PRO_PATH ./\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" ../\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" npm install "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("g cnpm "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("registry=https"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//registry.npm.taobao.org \\\n    && cnpm install "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("g node"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("gyp \\\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   && cnpm install -g pm2 \\")]),s._v("\n    && cnpm install\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"pm2-docker"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"docker-process.json"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPOSE")]),s._v(" 8004\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br")])]),n("div",{staticClass:"language-dockerfile line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" node"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("10.14"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("alpine\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" apk "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("update add tzdata \\\n    && cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime \\\n    && echo "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Asia/Shanghai"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v(" /etc/timezone \\\n    && apk del tzdata\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" apk add "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("update "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("no"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cache make gcc g++ \\\n    curl bash tree vim git \\\n&& rm "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("r /usr/share/man \\\n&& rm "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("r /var/cache/apk/*\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" PYTHONUNBUFFERED=1\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Install python3 & pip3")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" apk add "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("no"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cache python python"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("dev && \\\n    python3 python3"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("dev \\\n    linux"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("headers build"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("base ca"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("certificates && \\\n    python3 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("m ensurepip && \\\n    rm "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("r /usr/lib/python*/ensurepip && \\\n    pip3 install "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("upgrade pip setuptools && \\\n    pip3 install "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("no"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cache Pillow numpy PyCRC qrcode argparse && \\\n    if "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" ! "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("e /usr/bin/pip "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("; then ln "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("s pip3 /usr/bin/pip ; fi && \\\n    rm "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("r /root/.cache\n\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" mkdir "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p /usr/src/app\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" /usr/src/app\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" package.json /usr/src/app/\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# RUN npm i  --registry=https://registry.npm.taobao.org --production")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" npm i  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("registry=https"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//registry.npm.taobao.org\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" . .\n   \n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPOSE")]),s._v(" 7082\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# CMD npm run docker")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" npm run dev\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br")])]),n("h2",{attrs:{id:"docker-compose"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose"}},[s._v("#")]),s._v(" Docker compose")]),s._v(" "),n("h3",{attrs:{id:"常见命令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#常见命令"}},[s._v("#")]),s._v(" 常见命令")]),s._v(" "),n("ul",[n("li",[n("strong",[s._v("ps")]),s._v("：列出所有运行容器")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("docker-compose "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[n("strong",[s._v("logs")]),s._v("：查看服务日志输出")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("docker-compose logs\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[n("strong",[s._v("port")]),s._v("：打印绑定的公共端口，下面命令可以输出 eureka 服务 8761 端口所绑定的公共端口")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("docker-compose port eureka "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8761")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[n("strong",[s._v("build")]),s._v("：构建或者重新构建服务")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("docker-compose build\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[n("strong",[s._v("start")]),s._v("：启动指定服务已存在的容器")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("docker-compose start eureka\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[n("strong",[s._v("stop")]),s._v("：停止已运行的服务的容器")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("docker-compose stop eureka\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[n("strong",[s._v("rm")]),s._v("：删除指定服务的容器")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("docker-compose "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" eureka\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[n("strong",[s._v("up")]),s._v("：构建、启动容器")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("docker-compose up\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[n("strong",[s._v("kill")]),s._v("：通过发送 SIGKILL 信号来停止指定服务的容器")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("docker-compose "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("kill")]),s._v(" eureka\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[n("strong",[s._v("pull")]),s._v("：下载服务镜像")]),s._v(" "),n("li",[n("strong",[s._v("scale")]),s._v("：设置指定服务运气容器的个数，以 service=num 形式指定")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("docker-compose scale "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("user")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("movie")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[n("strong",[s._v("run")]),s._v("：在一个服务上执行一个命令")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("docker-compose run web "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h3",{attrs:{id:"docker-compose-yml-属性"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose-yml-属性"}},[s._v("#")]),s._v(" docker-compose.yml 属性")]),s._v(" "),n("ul",[n("li",[n("strong",[s._v("version")]),s._v("：指定 docker-compose.yml 文件的写法格式")]),s._v(" "),n("li",[n("strong",[s._v("services")]),s._v("：多个容器集合")]),s._v(" "),n("li",[n("strong",[s._v("build")]),s._v("：配置构建时，Compose 会利用它自动构建镜像，该值可以是一个路径，也可以是一个对象，用于指定 Dockerfile 参数")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("build: ./dir\n---------------\nbuild:\n    context: ./dir\n    dockerfile: Dockerfile\n    args:\n        buildno: 1\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("ul",[n("li",[n("strong",[s._v("command")]),s._v("：覆盖容器启动后默认执行的命令")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("command: bundle exec thin -p 3000\n----------------------------------\ncommand: [bundle,exec,thin,-p,3000]\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("ul",[n("li",[n("strong",[s._v("dns")]),s._v("：配置 dns 服务器，可以是一个值或列表")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("dns: 8.8.8.8\n------------\ndns:\n    - 8.8.8.8\n    - 9.9.9.9\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("ul",[n("li",[n("strong",[s._v("dns_search")]),s._v("：配置 DNS 搜索域，可以是一个值或列表")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("dns_search: example.com\n------------------------\ndns_search:\n    - dc1.example.com\n    - dc2.example.com\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("ul",[n("li",[n("strong",[s._v("environment")]),s._v("：环境变量配置，可以用数组或字典两种方式")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("environment:\n    RACK_ENV: development\n    SHOW: 'ture'\n-------------------------\nenvironment:\n    - RACK_ENV=development\n    - SHOW=ture\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("ul",[n("li",[n("strong",[s._v("env_file")]),s._v("：从文件中获取环境变量，可以指定一个文件路径或路径列表，其优先级低于 environment 指定的环境变量")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("env_file: .env\n---------------\nenv_file:\n    - ./common.env\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("ul",[n("li",[n("strong",[s._v("expose")]),s._v("：暴露端口，只将端口暴露给连接的服务，而不暴露给主机")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('expose:\n    - "3000"\n    - "8000"\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("ul",[n("li",[n("strong",[s._v("image")]),s._v("：指定服务所使用的镜像")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("image: java\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[n("strong",[s._v("network_mode")]),s._v("：设置网络模式")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('network_mode: "bridge"\nnetwork_mode: "host"\nnetwork_mode: "none"\nnetwork_mode: "service:[service name]"\nnetwork_mode: "container:[container name/id]"\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("ul",[n("li",[n("strong",[s._v("ports")]),s._v("：对外暴露的端口定义，和 expose 对应")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('ports:   # 暴露端口信息  - "宿主机端口:容器暴露端口"\n- "8763:8763"\n- "8763:8763"\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("ul",[n("li",[n("strong",[s._v("links")]),s._v("：将指定容器连接到当前连接，可以设置别名，避免ip方式导致的容器重启动态改变的无法连接情况")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("links:    # 指定服务名称:别名 \n    - docker-compose-eureka-server:compose-eureka\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("ul",[n("li",[n("strong",[s._v("volumes")]),s._v("：卷挂载路径")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("volumes:\n  - /lib\n  - /var\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("ul",[n("li",[n("strong",[s._v("logs")]),s._v("：日志输出信息")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("--no-color          单色输出，不显示其他颜.\n-f, --follow        跟踪日志输出，就是可以实时查看日志\n-t, --timestamps    显示时间戳\n--tail              从日志的结尾显示，--tail=200\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h3",{attrs:{id:"docker-compose-其它"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose-其它"}},[s._v("#")]),s._v(" Docker Compose 其它")]),s._v(" "),n("h4",{attrs:{id:"更新容器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#更新容器"}},[s._v("#")]),s._v(" 更新容器")]),s._v(" "),n("ul",[n("li",[s._v("当服务的配置发生更改时，可使用 docker-compose up 命令更新配置")]),s._v(" "),n("li",[s._v("此时，Compose 会删除旧容器并创建新容器，新容器会以不同的 IP 地址加入网络，名称保持不变，任何指向旧容起的连接都会被关闭，重新找到新容器并连接上去")])]),s._v(" "),n("h4",{attrs:{id:"links"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#links"}},[s._v("#")]),s._v(" links")]),s._v(" "),n("ul",[n("li",[s._v("服务之间可以使用服务名称相互访问，links 允许定义一个别名，从而使用该别名访问其它服务")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("version: '2'\nservices:\n    web:\n        build: .\n        links:\n            - \"db:database\"\n    db:\n        image: postgres\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("ul",[n("li",[s._v("这样 Web 服务就可以使用 db 或 database 作为 hostname 访问 db 服务了")])]),s._v(" "),n("h4",{attrs:{id:"build"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#build"}},[s._v("#")]),s._v(" build")]),s._v(" "),n("p",[s._v("服务除了可以基于指定的镜像，还可以基于一份 Dockerfile，在使用 up 启动之时执行构建任务，这个构建标签就是 build，它可以指定 Dockerfile 所在文件夹的路径。Compose 将会利用它自动构建这个镜像，然后使用这个镜像启动服务容器。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("build: /path/to/build/dir\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("也可以是相对路径，只要上下文确定就可以读取到 Dockerfile。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("build: ./dir\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("设定上下文根目录，然后以该目录为准指定 Dockerfile。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("build:\n  context: ../\n  dockerfile: path/of/Dockerfile\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("注意 build 都是一个目录，如果你要指定 Dockerfile 文件需要在 build 标签的子级标签中使用 dockerfile 标签指定，如上面的例子。\n如果你同时指定了 image 和 build 两个标签，那么 Compose 会构建镜像并且把镜像命名为 image 后面的那个名字。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("build: ./dir\nimage: webapp:tag\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("既然可以在 docker-compose.yml 中定义构建任务，那么一定少不了 arg 这个标签，就像 Dockerfile 中的 ARG 指令，它可以在构建过程中指定环境变量，但是在构建成功后取消，在 docker-compose.yml 文件中也支持这样的写法：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("build:\n  context: .\n  args:\n    buildno: 1\n    password: secret\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("下面这种写法也是支持的，一般来说下面的写法更适合阅读。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("build:\n  context: .\n  args:\n    - buildno=1\n    - password=secret\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("与 ENV 不同的是，ARG 是允许空值的。例如：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("args:\n  - buildno\n  - password\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("这样构建过程可以向它们赋值。")]),s._v(" "),n("p",[n("strong",[s._v("mysql配置及启动依赖")])]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[s._v("    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("links")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" redis\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" mysql\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("depends_on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" redis\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" mysql\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mysqld "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("character"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("set"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("server=utf8mb4 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("collation"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("server=utf8mb4_unicode_ci "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("init"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("connect='SET NAMES utf8mb4;' "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("innodb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("flush"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("log"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("at"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("trx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("commit=0\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("h3",{attrs:{id:"常用示例"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#常用示例"}},[s._v("#")]),s._v(" 常用示例")]),s._v(" "),n("p",[n("code",[s._v("docker-compose.yml")])]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2.2'")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("redis")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("5"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("alpine\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" /srv/etag/redis/data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/data\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("network_mode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" host\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restart")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" always\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mysql")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mysql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("5.7.24\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("network_mode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" host\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" /srv/etag/mysql/data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/var/lib/mysql\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" /srv/etag/mysql/init"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/docker"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("entrypoint"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("initdb.d/\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mysqld "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("character"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("set"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("server=utf8mb4 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("collation"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("server=utf8mb4_unicode_ci "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("init"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("connect='SET NAMES utf8mb4;' "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("innodb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("flush"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("log"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("at"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("trx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("commit=0\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("environment")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" MYSQL_ROOT_PASSWORD=xxx\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# - MYSQL_DATABASE=etag_dev")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restart")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" always\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("etag")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("depends_on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" redis\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" mysql\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" etag"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("1.1.1\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("network_mode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" host\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" /srv/etag/config/config.json"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/usr/src/app/database/config.json\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" /srv/etag/config/config.default.js"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/usr/src/app/config/config.default.js\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" /srv/etag/config/config.prod.js"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/usr/src/app/config/config.prod.js\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" /srv/etag/logs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/usr/src/app/logs\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" /srv/etag/public"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/usr/src/app/public\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restart")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" always\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br")])]),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("FROM node:10.14-alpine\n\nRUN apk --update "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" tzdata "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" /usr/share/zoneinfo/Asia/Shanghai /etc/localtime "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Asia/Shanghai"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/timezone "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" apk del tzdata\n\nRUN apk "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" --update --no-cache "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" gcc g++ "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v(" tree "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -r /usr/share/man "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -r /var/cache/apk/*\n\nENV "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PYTHONUNBUFFERED")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Install python3 & pip3")]),s._v("\nRUN apk "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" --no-cache python python-dev "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     python3 python3-dev \\")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     linux-headers build-base ca-certificates && \\")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     python3 -m ensurepip && \\")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     rm -r /usr/lib/python*/ensurepip && \\")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     pip3 install --upgrade pip setuptools && \\")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     pip3 install --no-cache Pillow numpy PyCRC qrcode argparse && \\")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    if [ ! -e /usr/bin/pip ]; then ln -s pip3 /usr/bin/pip ; fi && \\")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -r /root/.cache\n\n\nRUN "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /usr/src/app\nWORKDIR /usr/src/app\n\nCOPY package.json /usr/src/app/\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# RUN npm i  --registry=https://registry.npm.taobao.org --production")]),s._v("\nRUN "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" i  --registry"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https://registry.npm.taobao.org\n\nCOPY "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n   \nEXPOSE "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7082")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# CMD npm run docker")]),s._v("\nCMD "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" run dev\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br")])]),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2.2'")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("delos")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("container_name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rap2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("delos\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# build from ./Dockerfile")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    build: .")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# build from images")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# you can find last tag from https://hub.docker.com/r/blackdog1987/rap2-delos")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" blackdog1987/rap2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("delos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("2.6.aa3be03\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("environment")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# if you have your own mysql, config it here, and disable the 'mysql' config blow")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" MYSQL_URL=rap2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("mysql "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# links will maintain /etc/hosts, just use 'container_name'")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" MYSQL_PORT=3306\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" MYSQL_USERNAME=root\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" MYSQL_PASSWD=\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" MYSQL_SCHEMA=rap2\n\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# redis config")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" REDIS_URL=rap2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("redis\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" REDIS_PORT=6379\n\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# production / development")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" NODE_ENV=production\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("working_dir")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /app\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("privileged")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("###### 'sleep 30 && node scripts/init' will drop the tables")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("###### RUN ONLY ONCE THEN REMOVE 'sleep 30 && node scripts/init'")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /bin/sh "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("c 'sleep 30; node scripts/init; node dispatch.js'\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# init the databases")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    command: sleep 30 && node scripts/init && node dispatch.js")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# without init")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    command: node dispatch.js")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("links")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" redis\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" mysql\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("depends_on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" redis\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" mysql\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"38080:8080"')]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# expose 38080")]),s._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("redis")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("container_name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rap2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("redis\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("4.0.9\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# disable this if you have your own mysql")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mysql")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("container_name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rap2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("mysql\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mysql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("5.7.22\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# expose 33306 to client (navicat)")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ports:")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   - 33306:3306")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# change './docker/mysql/volume' to your own path")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# WARNING: without this line, your data will be lost.")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./docker/mysql/volume:/var/lib/mysql"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mysqld "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("character"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("set"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("server=utf8mb4 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("collation"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("server=utf8mb4_unicode_ci "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("init"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("connect='SET NAMES utf8mb4;' "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("innodb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("flush"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("log"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("at"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("trx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("commit=0\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("environment")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("MYSQL_ALLOW_EMPTY_PASSWORD")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("MYSQL_DATABASE")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rap2"')]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("MYSQL_USER")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"root"')]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("MYSQL_PASSWORD")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br")])]),n("h2",{attrs:{id:"docker-swarm"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#docker-swarm"}},[s._v("#")]),s._v(" Docker swarm")]),s._v(" "),n("p",[n("strong",[s._v("docker部署 code-push-server")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("//启动swarm\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker swarm init\n//部署\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker stack deploy -c docker-compose.yml code-push-server\n//查看服务日志\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" logs code-push-server_server\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" logs code-push-server_db\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" logs code-push-server_redis\n//销毁退出应用\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker stack "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" code-push-server\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker swarm leave --force\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("h2",{attrs:{id:"制作示范"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#制作示范"}},[s._v("#")]),s._v(" 制作示范")]),s._v(" "),n("h3",{attrs:{id:"目录结构"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#目录结构"}},[s._v("#")]),s._v(" 目录结构")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取示例项目")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone https://github.com/samy/jenkins_demo.git\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 项目文件")]),s._v("\n├── index.html              "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 页面文件")]),s._v("\n├── Dockerfile              "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 镜像文件")]),s._v("\n├── docker-compose.src.yml  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Docker 部署文件")]),s._v("\n├── deploy_jenkins.sh       "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 部署脚本")]),s._v("\n├── Jenkinsfile             "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Jenkins Pipeline 文件")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("h3",{attrs:{id:"准备文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#准备文件"}},[s._v("#")]),s._v(" 准备文件")]),s._v(" "),n("p",[n("code",[s._v("index.html")])]),s._v(" "),n("div",{staticClass:"language-html line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-html"}},[n("code",[n("span",{pre:!0,attrs:{class:"token doctype"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<!")]),n("span",{pre:!0,attrs:{class:"token doctype-tag"}},[s._v("DOCTYPE")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token name"}},[s._v("html")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("html")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("head")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("meta")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("charset")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("utf-8"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("title")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("Jenkins demo"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("title")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("head")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("body")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("h1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("Jenkins demo"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("h1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("body")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("html")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("p",[n("code",[s._v("Dockerfile")])]),s._v(" "),n("div",{staticClass:"language-dockerfile line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("1.15.2\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" REFRESHED_AT 2018"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("08"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("09\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" ./index.html /usr/share/nginx/html/index.html\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" ln "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("sf /dev/stdout /var/log/nginx/access.log \\\n    && ln "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("sf /dev/stderr /var/log/nginx/error.log\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPOSE")]),s._v(" 80\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("STOPSIGNAL")]),s._v(" SIGTERM\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-g"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"daemon off;"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("p",[n("code",[s._v("docker-compose.src.yml")])]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3.4'")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("jenkins_demo")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" IMAGE_LATEST\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("deploy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restart_policy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("condition")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("failure\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("expose")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"80"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 8081"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[s._v("部署脚本："),n("code",[s._v("deploy_jenkins.sh")])]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 容器名称")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CONTAINER")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"jenkins_demo"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 镜像名称（以日期时间为镜像标签，防止重复）")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("IMAGE")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CONTAINER")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('":"')]),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("date")]),s._v(" -d "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"today"')]),s._v(" +"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%Y%m%d_%H%M%S"')]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除滚动更新残留的容器")]),s._v("\ndocker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -a "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" -w $CONTAINER"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_"')]),s._v("$CONTAINER "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v("}'")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 强制删除滚动更新残留的镜像")]),s._v("\ndocker rmi --force "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("docker images "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" -w $CONTAINER "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$3")]),s._v("}'")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建新镜像")]),s._v("\ndocker build -t "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$IMAGE")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除 docker-compose.jenkins.yml 文件，防止使用相同镜像")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf docker-compose.jenkins.yml "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 复制 docker-compose.src.yml 文件，防止污染原文件")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" docker-compose.src.yml docker-compose.jenkins.yml "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 替换镜像名标志位为最新镜像")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i s%IMAGE_LATEST%"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$IMAGE")]),s._v("%g docker-compose.jenkins.yml "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用 docker stack 启动服务")]),s._v("\ndocker stack deploy -c docker-compose.jenkins.yml "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CONTAINER")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br")])]),n("h2",{attrs:{id:"相关问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#相关问题"}},[s._v("#")]),s._v(" 相关问题")]),s._v(" "),n("h3",{attrs:{id:"在docker里面使用systemctl"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#在docker里面使用systemctl"}},[s._v("#")]),s._v(" 在Docker里面使用systemctl")]),s._v(" "),n("p",[s._v("我们有时在使用docker的时候，会发现在容器中是用systemctl 或者 service的时候，会遇到下面的错误：\n"),n("code",[s._v("Failed to connect to bus: No such file or directory")])]),s._v(" "),n("p",[n("strong",[s._v("原因")])]),s._v(" "),n("blockquote",[n("p",[s._v("That’s because “systemctl” talks to the systemd daemon by using the d-bus. In a container there is no systemd-daemon. Asking for a start will probably not quite do what you expect - the dev-mapping need to be a bit longer.")])]),s._v(" "),n("p",[s._v("容器里面是没有systemd进程的，所以不能正常开启systemctl。为什么docker会这样呢：")]),s._v(" "),n("blockquote",[n("p",[s._v("This is by design. Docker should be running a process in the foreground in your container and it will be spawned as PID 1 within the container’s pid namespace. Docker is designed for process isolation, not for OS virtualization, so there are no other OS processes and daemons running inside the container (like systemd, cron, syslog, etc), only your entrypoint or command you run.\nIf they included systemd commands, you’d find a lot of things not working since your entrypoint replaces init. Systemd also makes use to cgroups which docker restricts inside of containers since the ability to change cgroups could allow a process to escape the container’s isolation. Without systemd running as init inside your container, there’s no daemon to process your start and stop commands.")])]),s._v(" "),n("p",[s._v("docker只是提供了进程隔离，不是操作系统的虚拟。")]),s._v(" "),n("p",[n("strong",[s._v("解决方案")])]),s._v(" "),n("ol",[n("li",[s._v("我们可以在启动容器的时候将在启动参数加上 /sbin/init 来让其生效。\n以centos为例：\n"),n("code",[s._v("docker run -d -v /sys/fs/cgroup/:/sys/fs/cgroup:ro --cap-add SYS_ADMIN --name systemd_websrv centos /sbin/init")]),s._v("\n就可以正常使用systemd了\n但是如果容器重启，那么就可能导致失效。")]),s._v(" "),n("li",[s._v("替换systemctl\n使用 "),n("a",{attrs:{href:"https://github.com/gdraheim/docker-systemctl-replacement",target:"_blank",rel:"noopener noreferrer"}},[s._v("docker-systemctl-replacement"),n("OutboundLink")],1),s._v("替换容器中的systemctl。\n以ubuntu镜像为例：\n1). 安装python2\n"),n("code",[s._v("sudo apt install python")]),s._v("\n2). 替换systemcl (注意路径，可以使用"),n("code",[s._v("whereis systemctl")]),s._v("查看当前默认路径)\n"),n("code",[s._v("wget https://raw.githubusercontent.com/gdraheim/docker-systemctl-replacement/master/files/docker/systemctl.py -O /bin/systemctl")]),s._v("\n3). 给定权限\n"),n("code",[s._v("sudo chmod a+x /bin/systemctl")]),s._v("\n这样接可以使用非systemd的systemctl，但是因为是非官方的systemcl所以可能存在一些未知问题。")])]),s._v(" "),n("p",[s._v("最好还是建议将docker作为进程隔离环境，"),n("code",[s._v("single app single container")]),s._v("， 但是遇到非常特殊的情况下，可以上述两个解决方案；")]),s._v(" "),n("h3",{attrs:{id:"no-such-file-or-directory"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#no-such-file-or-directory"}},[s._v("#")]),s._v(" no such file or directory")]),s._v(" "),n("blockquote",[n("h4",{attrs:{id:"var-lib-docker-tmp-docker-import-525555606-repositories-no-such-file-or-directory"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#var-lib-docker-tmp-docker-import-525555606-repositories-no-such-file-or-directory"}},[s._v("#")]),s._v(" /var/lib/docker/tmp/docker-import-525555606/repositories: no such file or directory")])]),s._v(" "),n("p",[n("strong",[s._v("第一种可能：load/import错乱；")])]),s._v(" "),n("p",[s._v("首先得明白docker load 和docker import 的区别：docker load 用来载入镜像包，docker import 用来载入容器包，但两者都会恢复为镜像。docker export保存的容器，需要docker import载入，而docker save的镜像包，需要docker load载入。")]),s._v(" "),n("blockquote",[n("h5",{attrs:{id:"docker-save-与-docker-export-以及-docker-load-和-docker-import-的区别"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#docker-save-与-docker-export-以及-docker-load-和-docker-import-的区别"}},[s._v("#")]),s._v(" docker save 与 docker export 以及 docker load 和 docker import 的区别")])]),s._v(" "),n("ul",[n("li",[s._v("docker save保存的是镜像（image），docker export保存的是容器（container）；")]),s._v(" "),n("li",[s._v("docker load用来载入镜像包，docker import用来载入容器包，但两者都会恢复为镜像；")]),s._v(" "),n("li",[s._v("docker load不能对载入的镜像重命名，而docker import可以为镜像指定新名称。")])]),s._v(" "),n("p",[s._v("因为压缩包如果是用 docker save 打包的，就可以用 docker load，但是如果压缩包是用 docker export 打包的，那就需要用 docker import")]),s._v(" "),n("p",[n("strong",[s._v("第二种可能：导入进去的根本不是镜像；检查那压缩文件是否是镜像；")])]),s._v(" "),n("h2",{attrs:{id:"相关链接"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#相关链接"}},[s._v("#")]),s._v(" 相关链接")]),s._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://docs.docker.com/engine/reference/builder",target:"_blank",rel:"noopener noreferrer"}},[s._v("Dockerfile reference"),n("OutboundLink")],1)]),s._v(" "),n("li",[s._v("https://docker-practice.github.io/zh-cn")])])])}),[],!1,null,null,null);a.default=e.exports}}]);