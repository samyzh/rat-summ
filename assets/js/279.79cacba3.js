(window.webpackJsonp=window.webpackJsonp||[]).push([[279],{1418:function(s,a,t){s.exports=t.p+"assets/img/image-20220224150146478.b98bacc9.png"},2199:function(s,a,t){"use strict";t.r(a);var n=t(14),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"简介"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[s._v("#")]),s._v(" 简介")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("SSH(Secure SHell)目的是要在非安全网络上提供安全的远程登录和其他安全服务")])]),s._v(" "),n("li",[n("p",[s._v("OpenSSH是 SSH 协议的免费开源实现,默认的SSH协议是版本2(支持RSA和DSA)")])]),s._v(" "),n("li",[n("p",[s._v("OpenSSH支持的用户认证方式有基于 PAM 的用户口令认证和用户密钥认证")])])]),s._v(" "),n("h2",{attrs:{id:"安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看SSH是否安装")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rpm")]),s._v(" -qa "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v("\nyum list installed "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" openssh-server\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#卸载SSH")]),s._v("\nyum remove openssh-server\n\nyum "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y openssl openssh-server\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("h2",{attrs:{id:"配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置"}},[s._v("#")]),s._v(" 配置")]),s._v(" "),n("h3",{attrs:{id:"修改配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#修改配置"}},[s._v("#")]),s._v(" 修改配置")]),s._v(" "),n("h4",{attrs:{id:"常见的配置选项"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#常见的配置选项"}},[s._v("#")]),s._v(" 常见的配置选项")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("Port=22  设置SSH的端口号是22(默认端口号为22)")])]),s._v(" "),n("li",[n("p",[s._v("Protocol 2  启用SSH版本2协议")])]),s._v(" "),n("li",[n("p",[s._v("ListenAddress 192.168.0.222  设置服务监听的地址")])]),s._v(" "),n("li",[n("p",[s._v("DenyUsers   user1 user2 foo  拒绝访问的用户(用空格隔开)")])]),s._v(" "),n("li",[n("p",[s._v("AllowUsers  root osmond vivek  允许访问的用户(用空格隔开)")])]),s._v(" "),n("li",[n("p",[s._v("PermitRootLogin  no  禁止root用户登陆")])]),s._v(" "),n("li",[n("p",[s._v("PermitEmptyPasswords no  用户登陆需要密码认证")])]),s._v(" "),n("li",[n("p",[s._v("PasswordAuthentication  yes  启用口令认证方式")])])]),s._v(" "),n("p",[n("img",{attrs:{src:t(1418),alt:"image-20220224150146478"}})]),s._v(" "),n("h4",{attrs:{id:"常用配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#常用配置"}},[s._v("#")]),s._v(" 常用配置")]),s._v(" "),n("p",[n("code",[s._v("vim /etc/ssh/sshd_config")])]),s._v(" "),n("p",[s._v("# 将 PermitRootLogin, RSAAuthentication, PubkeyAuthentication 设置为 yes")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("Port "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#定义ssh监听的端口号，默认为22 ")]),s._v("\nListenAddress "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置ssh服务器绑定的ip地址，默认为所有可用的ip地址 ")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#禁用root账户登录，如果是用root用户登录请开启")]),s._v("\nPermitRootLogin "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 要改这个要谨慎；要确定第二个帐号可用登陆或者免密设置成功；")]),s._v("\n \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否让 sshd 去检查用户家目录或相关档案的权限数据，")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这是为了担心使用者将某些重要档案的权限设错，可能会导致一些问题所致。")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 例如使用者的 ~.ssh/ 权限设错时，某些特殊情况下会不许用户登入")]),s._v("\nStrictModes no\n \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否允许用户自行使用成对的密钥系统进行登入行为，仅针对 version 2。")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 至于自制的公钥数据就放置于用户家目录下的 .ssh/authorized_keys 内")]),s._v("\nRSAAuthentication "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\nPubkeyAuthentication "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\nAuthorizedKeysFile      .ssh/authorized_keys\n \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 有了证书登录了，就禁用密码登录吧，安全要紧")]),s._v("\nPasswordAuthentication no\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])]),n("h3",{attrs:{id:"设置开机自动启动"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#设置开机自动启动"}},[s._v("#")]),s._v(" 设置开机自动启动")]),s._v(" "),n("blockquote",[n("p",[n("strong",[s._v("注册使用服务")])])]),s._v(" "),n("p",[n("strong",[s._v("将sshd服务添加之自启动列表中")])]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("systemctl "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" sshd\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl enable sshd 等价于 systemctl enable sshd.service")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[n("strong",[s._v("并查看是否开启自启动sshd服务")])]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("systemctl list-unit-files "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" sshd\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h3",{attrs:{id:"启动ssh的服务"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#启动ssh的服务"}},[s._v("#")]),s._v(" 启动ssh的服务")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("systemctl start sshd.service\n\nsystemctl start sshd\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" sshd start\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" sshd restart\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("h3",{attrs:{id:"docker内启动服务【要点】"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#docker内启动服务【要点】"}},[s._v("#")]),s._v(" docker内启动服务【要点】")]),s._v(" "),n("h4",{attrs:{id:"安装库"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装库"}},[s._v("#")]),s._v(" 安装库")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("yum "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y openssh-server openssh-clients\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("/usr/sbin/sshd -D "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("11593")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@628b677f368b app"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Could not load host key: /etc/ssh/ssh_host_rsa_key")]),s._v("\nCould not load "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" key: /etc/ssh/ssh_host_ecdsa_key\nCould not load "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" key: /etc/ssh/ssh_host_ed25519_key\nsshd: no hostkeys available -- exiting.\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建sshd服务使用的的host key:")]),s._v("\nssh-keygen -A \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#/usr/sbin/sshd-keygen -A")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#或者/etc/ssh# ssh-keygen -t rsa -b 2048 -f /etc/ssh/ssh_host_rsa_key")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令执行成功后，在 /etc/ssh 下会看到有两个文件生成：ssh_host_rsa_key 和 ssh_host_rsa_key.pub ，前者是私钥，后者是公钥")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ssh-keygen -t rsa #客户端设置")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建sshd服务运行目录:")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#mkdir /run/sshd")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启动ssh服务:")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#/usr/sbin/sshd")]),s._v("\n/usr/sbin/sshd -D "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n\nsshd -D "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br")])]),n("h4",{attrs:{id:"修改root密码"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#修改root密码"}},[s._v("#")]),s._v(" 修改root密码")]),s._v(" "),n("p",[n("strong",[s._v("进入容器普通设置")])]),s._v(" "),n("p",[s._v("通过这种方式达成新镜像commit; "),n("code",[s._v("docker commit xxx")])]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("root@e1c328726835:/etc/ssh"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# passwd root")]),s._v("\nNew password: \nRetype new password: \n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#测试本地连接,输入密码；")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" localhost\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[n("strong",[s._v("在dockerfile中设置")]),s._v("【推荐】")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("RUN "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'root:Docker!'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" chpasswd\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#或者")]),s._v("\nRUN "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Docker!'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("passwd")]),s._v(" --stdin root\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[n("strong",[s._v("正在运行的容器中创建/更改root密码")])]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("docker "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -itu root "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("containerName"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("passwd")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[n("strong",[s._v("运行Docker覆盖USER设置")])]),s._v(" "),n("p",[s._v("在正在运行的容器中创建/更改 root 密码;")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("docker "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -itu "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("container"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("passwd")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("用-u选项时，可以使用root用户(ID = 0)而不是提供的默认用户登录Docker容器")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#docker exec -it --user $(username) $(containername) /bin/bash")]),s._v("\n\ndocker "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -u "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" -it containername "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h4",{attrs:{id:"免密码本机跳本机"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#免密码本机跳本机"}},[s._v("#")]),s._v(" 免密码本机跳本机")]),s._v(" "),n("p",[s._v("为了免密码本机跳本机，执行如下命令：")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("ssh-keygen -t rsa -P "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v(" -f ~/.ssh/id_rsa\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" ~/.ssh/id_rsa.pub "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" ~/.ssh/authorized_keys\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" 0600 ~/.ssh/authorized_keys\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" localhost "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#至此，执行ssh localhost就能成功")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h3",{attrs:{id:"防火墙设置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#防火墙设置"}},[s._v("#")]),s._v(" 防火墙设置")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" firewall-cmd --zone"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("public --add-port"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v("/tcp --permanent\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h3",{attrs:{id:"检查服务是否启动"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#检查服务是否启动"}},[s._v("#")]),s._v(" 检查服务是否启动")]),s._v(" "),n("p",[n("strong",[s._v("本地测试")])]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -e "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" sshd\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#或者")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("netstat")]),s._v(" -an "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[n("strong",[s._v("客户端通过ssh远程连接服务器")])]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" username@hostname"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("hostIP"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  \n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" user1@192.168.10.10\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h3",{attrs:{id:"客户端免密设置【要点】"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#客户端免密设置【要点】"}},[s._v("#")]),s._v(" 客户端免密设置【要点】")]),s._v(" "),n("h4",{attrs:{id:"配置说明"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置说明"}},[s._v("#")]),s._v(" 配置说明")]),s._v(" "),n("p",[s._v("客户端安装git 默认会有这两个命令；")]),s._v(" "),n("p",[s._v("涉及两命令：")]),s._v(" "),n("ul",[n("li",[n("strong",[s._v("ssh-keygen")]),s._v(" 产生公钥与私钥对.")]),s._v(" "),n("li",[n("strong",[s._v("ssh-copy-id")]),s._v(" 将本机的公钥复制到远程机器的authorized_keys文件中，ssh-copy-id也能让你有到远程机器的home, ~./ssh , 和 ~/.ssh/authorized_keys的权利；")])]),s._v(" "),n("p",[n("strong",[s._v("生产私钥四个文件夹")])]),s._v(" "),n("ul",[n("li",[s._v("authorized_keys: 存放远程免密登录的公钥, 主要通过这个文件记录多台机器的公钥。")]),s._v(" "),n("li",[s._v("id_rsa: 生成的私钥文件")]),s._v(" "),n("li",[s._v("id_rsa.pub: 生成的公钥文件")]),s._v(" "),n("li",[s._v("known_hosts: 已知的主机公钥清单")])]),s._v(" "),n("p",[n("strong",[s._v("公钥拷贝到服务器的~/.ssh/authorized_keys文件中方法有如下几种:")])]),s._v(" "),n("blockquote",[n("p",[s._v("最常用的三种方式，一是通过 ssh-copy-id 命令，二是通过 scp 命令，三是手工复制。")])]),s._v(" "),n("ul",[n("li",[n("p",[n("strong",[s._v("通过ssh-copy-id程序，"),n("code",[s._v("ssh-copy-id -i ~/.ssh/id_rsa.pub root@192.168.111.111")]),s._v(" 推荐；")])])]),s._v(" "),n("li",[n("p",[s._v("将公钥通过scp拷贝到服务器上，然后追加到~/.ssh/authorized_keys文件中，这种方式比较麻烦；")]),s._v(" "),n("p",[n("code",[s._v("scp -P 22 ~/.ssh/id_rsa.pub user@host:~/")])])]),s._v(" "),n("li",[n("p",[s._v("可以通过"),n("code",[s._v("cat ~/.ssh/id_rsa.pub | ssh -p 22 user@host ‘cat >> ~/.ssh/authorized_keys")]),s._v("，这个也是比较常用的方法，因为可以更改端口号。")])])]),s._v(" "),n("h4",{attrs:{id:"本机跳本机免密码"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#本机跳本机免密码"}},[s._v("#")]),s._v(" 本机跳本机免密码")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("ssh-keygen -t rsa -P "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v(" -f ~/.ssh/id_rsa\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" ~/.ssh/id_rsa.pub "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" ~/.ssh/authorized_keys\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" 0600 ~/.ssh/authorized_keys\n\n/usr/sbin/sshd -D "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h4",{attrs:{id:"实践"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#实践"}},[s._v("#")]),s._v(" "),n("strong",[s._v("实践")])]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("ssh-keygen -t rsa\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#注意空格和换行；")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#公钥文件内容会追加写入到userb的 .ssh/authorized_keys 文件中")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" .ssh/id_rsa.pub \n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#将公钥上传到server服务器的ssh/authorized_keys 文件中")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ssh-copy-id -i ~/.ssh/id_rsa.pub root@192.168.111.111")]),s._v("\nssh-copy-id -i ~/.ssh/id_rsa.pub samy@192.168.11.111 \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看serverB服务器userb用户下的 ~/.ssh/authorized_keys文件")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" .ssh/authorized_keys\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#以看到登陆后会有known_hosts文件生成")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" userb@192.168.11.111\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);