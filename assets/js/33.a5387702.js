(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{1246:function(s,a,t){s.exports=t.p+"assets/img/image-20220118192115593.535b752e.png"},1247:function(s,a,t){s.exports=t.p+"assets/img/image-20220118174145136.b8ad48de.png"},1248:function(s,a,t){s.exports=t.p+"assets/img/image-20220121133017081.6bd557bf.png"},1249:function(s,a,t){s.exports=t.p+"assets/img/1059616-20200324081656648-789520421.fcd77352.png"},1250:function(s,a,t){s.exports=t.p+"assets/img/1059616-20200324090025305-204319206.1f02679d.png"},1251:function(s,a,t){s.exports=t.p+"assets/img/image-20220127192535318.78406bbd.png"},1252:function(s,a,t){s.exports=t.p+"assets/img/image-20220127193951504.3e3bda52.png"},1253:function(s,a,t){s.exports=t.p+"assets/img/image-20220322092918900.20a1839c.png"},1254:function(s,a,t){s.exports=t.p+"assets/img/image-20220322094442342.e1fe4027.png"},1255:function(s,a,t){s.exports=t.p+"assets/img/image-20220322094525265.01533428.png"},1256:function(s,a,t){s.exports=t.p+"assets/img/image-20220322094011738.e8fd7549.png"},2083:function(s,a,t){"use strict";t.r(a);var r=t(14),e=Object(r.a)({},(function(){var s=this,a=s.$createElement,r=s._self._c||a;return r("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[r("h2",{attrs:{id:"简介"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[s._v("#")]),s._v(" 简介")]),s._v(" "),r("p",[s._v("在 Docker 中，当我们执行 docker pull xxx 的时候 ，它实际上是从 registry.hub.docker.com 这个地址去查找，这就是Docker公司为我们提供的公共仓库。在工作中，我们不可能把企业项目push到公有仓库进行管理。所以为了更好的管理镜像，Docker不仅提供了一个中央仓库，同时也允许我们搭建本地私有仓库。")]),s._v(" "),r("ul",[r("li",[s._v("本地镜像：在把java程序打包成镜像，输出的镜像的位置就是本地镜像")]),s._v(" "),r("li",[s._v("公有仓库：一个叫docker hub的网站，类似于github，所有人都可以把自己的镜像上传上去，也可以使用别人的镜像")]),s._v(" "),r("li",[s._v("私有仓库：相当于自己建的docker hub，常用于不可公开的（例如公司），或者追求网速（镜像不像代码文件那么小）")])]),s._v(" "),r("h2",{attrs:{id:"基础环境安装-docker"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#基础环境安装-docker"}},[s._v("#")]),s._v(" 基础环境安装(docker)")]),s._v(" "),r("p",[s._v("yum-util 提供yum-config-manager功能，另外两个是devicemapper驱动依赖的")]),s._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[s._v("yum "),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y yum-utils device-mapper-persistent-data lvm2\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("p",[r("strong",[s._v("配置yum源")])]),s._v(" "),r("p",[s._v("将docker的源配置成阿里的;")]),s._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[r("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\n"),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" yum makecache fast\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br")])]),r("div",{staticClass:"language-sh line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[s._v("yum repolist  "),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#刷新yum源")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("p",[r("strong",[s._v("安装docker-ce与docker-compose")])]),s._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[s._v("yum "),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" docker-ce  -y  "),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#默认安装最新版本的docker-ce,需要使用指定版本可以使用yum install docker-ce -版本号安装")]),s._v("\nyum "),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" docker-compose\t-y  "),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#安装docker-compose")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br")])]),r("p",[r("strong",[s._v("启动docker")])]),s._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[s._v("systemctl start docker\t"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启动docker服务")]),s._v("\nsystemctl "),r("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" docker\t"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置docker服务开机启动")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br")])]),r("h2",{attrs:{id:"部署registry"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#部署registry"}},[s._v("#")]),s._v(" 部署registry")]),s._v(" "),r("h3",{attrs:{id:"安装启动"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#安装启动"}},[s._v("#")]),s._v(" 安装启动")]),s._v(" "),r("h4",{attrs:{id:"普通默认方式"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#普通默认方式"}},[s._v("#")]),s._v(" 普通默认方式")]),s._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[s._v("docker run -d -p "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v(":5000  /opt/registry:/var/lib/registry --restart always --name wdp-hub registry:2.7.1\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("ul",[r("li",[s._v("-d : 让容器可以后台运行;")]),s._v(" "),r("li",[s._v("-p ：指定映射端口（前者是宿主机的端口号，后者是容器的端口号）;")]),s._v(" "),r("li",[s._v("-v ：数据挂载（前者是宿主机的目录，后者是容器的目录）;")]),s._v(" "),r("li",[s._v("--name : 为运行的容器命名;")]),s._v(" "),r("li",[s._v("Docker容器的重启策略如下:\n"),r("ul",[r("li",[s._v("no:默认策略，在容器退出时不重启容器")]),s._v(" "),r("li",[s._v("on- failure:在容器非正常退出时(退出状态非0)，才会重启容器")]),s._v(" "),r("li",[s._v("on- failure:3 :在容器非正常退出时重启容器，最多重启3次")]),s._v(" "),r("li",[s._v("always:在容器退出时总是重启容器")]),s._v(" "),r("li",[s._v("unless-stopped:在容器退出时总是重启容器，但是不考虑在Docker守护进程启动时就已经停止了的容器")])])])]),s._v(" "),r("p",[s._v("默认情况下,仓库会被创建在容器的"),r("code",[s._v("/var/lib/registry")]),s._v("目录下,可以通过"),r("code",[s._v("-v")]),s._v("参数挂载本地的路径;")]),s._v(" "),r("p",[r("strong",[s._v("脚本封装")])]),s._v(" "),r("blockquote",[r("p",[s._v("register服务的docker启动脚本; "),r("code",[s._v("restartRegistry.sh")])])]),s._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[s._v("docker stop registry\ndocker "),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" registry\ndocker run -d -p "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v(":5000 --name"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("registry --restart"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("always "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --privileged"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --log-driver"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("none "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  -v /root/registry/registrydata:/var/lib/registry "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  registry:2\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br")])]),r("h4",{attrs:{id:"其他参数方式【推荐】"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#其他参数方式【推荐】"}},[s._v("#")]),s._v(" 其他参数方式【推荐】")]),s._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[s._v("docker run -d -v /data/registory:/var/lib/registry -p "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v(":5000 --restart"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("always --privileged"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true --name registry registry:latest\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker run -itd -v /data/registry:/var/lib/registry -p 5000:5000 --restart=always --name registry registry:latest")]),s._v("\n\n"),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /home/wdp-docker-bak/registry "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" -R "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(":1000 /home/wdp-docker-bak/registry\ndocker run -d -p "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v(":5000  /home/wdp-docker-bak/registry:/var/lib/registry --restart always --name wdp-hub registry:2.7.1\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br")])]),r("ul",[r("li",[s._v("-itd:在容器中打开一个伪终端进行交互操作，并在后台运行；")]),s._v(" "),r("li",[s._v("-v:把宿主机的/data/registry目录绑定到容器/var/lib/registry目录(这个目录是registry容器中存放镜像文件的目录)，来实现数据的持久化;")]),s._v(" "),r("li",[s._v("-p:映射端口;访问宿主机的5000端口就访问到registry容器的服务；")]),s._v(" "),r("li",[s._v("--restart=always: 这是重启的策略，在容器退出时总是重启容器；")]),s._v(" "),r("li",[s._v("--name registry: 创建容器命名为registry")])]),s._v(" "),r("p",[r("strong",[s._v("为什么是 /var/lib/registry/ 目录?")])]),s._v(" "),r("p",[s._v("仓库默认存放镜像等信息在容器的 "),r("code",[s._v("/var/lib/registry/docker")]),s._v(" 目录下，可以进入该目录查看已上传镜像信息，即使私有仓库的容器被误删，再次创建此容器，之前的镜像依然存在。")]),s._v(" "),r("p",[r("strong",[s._v("docker ps 可以看到仓库容器正在运行。进入到/data下，可以看到registory文件夹;")])]),s._v(" "),r("blockquote",[r("p",[r("code",[s._v("docker exec -it f94d2c317477 /bin/bash")])])]),s._v(" "),r("p",[r("img",{attrs:{src:t(1246),alt:"image-20220118192115593"}})]),s._v(" "),r("p",[r("img",{attrs:{src:t(1247),alt:"image-20220118174145136"}})]),s._v(" "),r("h3",{attrs:{id:"检查push及pull"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#检查push及pull"}},[s._v("#")]),s._v(" 检查push及pull")]),s._v(" "),r("blockquote",[r("h4",{attrs:{id:"以操作hello-world为例子"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#以操作hello-world为例子"}},[s._v("#")]),s._v(" 以操作"),r("code",[s._v("hello-world")]),s._v("为例子")])]),s._v(" "),r("h4",{attrs:{id:"创建镜像及推送"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#创建镜像及推送"}},[s._v("#")]),s._v(" "),r("strong",[s._v("创建镜像及推送")])]),s._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#拉取公共的")]),s._v("\ndocker pull hello-world\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#重命名本地镜像名字")]),s._v("\ndocker tag hello-world:latest "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.45")]),s._v(".xxx.116:5000/hello-world:latest\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#推送本地镜像到私库")]),s._v("\ndocker push "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.45")]),s._v(".xxx.116:5000/hello-world:latest\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#可能会报错；")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br")])]),r("h4",{attrs:{id:"http访问权限"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#http访问权限"}},[s._v("#")]),s._v(" http访问权限")]),s._v(" "),r("p",[s._v("原因是docker私有仓库服务器，默认是https协议，所以我们需要进行修改不使用https；")]),s._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[r("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/docker/daemon.json "),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#如果没有此文件，请创建")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("p",[s._v("添加下面这段代码; "),r("strong",[s._v("注意这里要个json文件格式，如果报错后面会重启docker失败；")])]),s._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"insecure-registries"')]),s._v(":"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.45.xxx.116:5000"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("div",{staticClass:"language-json line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-json"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n   "),r("span",{pre:!0,attrs:{class:"token property"}},[s._v('"registry-mirrors"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://hub-mirror.c.163.com"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n   "),r("span",{pre:!0,attrs:{class:"token property"}},[s._v('"insecure-registries"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.45.xx.xx:5000"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://host116:4433"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("     \n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br")])]),r("p",[r("strong",[s._v("重启docker服务")])]),s._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[s._v("systemctl daemon-reload\nsystemctl restart docker\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br")])]),r("p",[s._v("再次将镜像推送到私有仓库,即可推送成功")]),s._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[s._v("docker push "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.45")]),s._v(".xxx.116:5000/hello-world:latest\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("h4",{attrs:{id:"get验证pull部分"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#get验证pull部分"}},[s._v("#")]),s._v(" "),r("strong",[s._v("get验证pull部分")])]),s._v(" "),r("ul",[r("li",[s._v("查看私有仓库执行此命令："),r("code",[s._v("curl -XGET http://ip:端口/v2/_catalog")]),s._v(";")]),s._v(" "),r("li",[s._v("获取某个镜像的标签列表："),r("code",[s._v("curl -XGEThttp://127.0.0.1:5000/v2/私有仓库镜像名称/tags/list")]),s._v(";")]),s._v(" "),r("li",[s._v("也可通浏览器直接访问;\n"),r("ul",[r("li",[s._v("http://10.45.xxx.116:5000/v2/_catalog")]),s._v(" "),r("li",[s._v("http://10.45.xxx.116:5000/v2/xxx/tags/list")])])])]),s._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[r("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -XGET http://10.45.xxx.116:5000/v2/_catalog\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 若成功会返回以下值")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#{"repositories":["hello-world","nginxtest"]}')]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" http://10.45.xx.116:5000/v2/hello-world/tags/list\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#{"name":"hello-world","tags":["latest"]}')]),s._v("\n\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除本地重命名的镜像")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker rmi -f 8652b9f0cb4c ")]),s._v("\ndocker rmi "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.45")]),s._v(".xxx.116:5000/hello-world:latest\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 检查镜像")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker images\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 拉取私有库中的镜像")]),s._v("\ndocker pull "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.45")]),s._v(".xxx.116:5000/hello-world:latest\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 检查镜像")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker images\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br")])]),r("p",[r("img",{attrs:{src:t(1248),alt:"image-20220121133017081"}})]),s._v(" "),r("h2",{attrs:{id:"部署harbor【推荐】"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#部署harbor【推荐】"}},[s._v("#")]),s._v(" 部署harbor【推荐】")]),s._v(" "),r("blockquote",[r("p",[s._v("包含registry库；")])]),s._v(" "),r("p",[s._v("docker 官方提供的私有仓库 registry，用起来虽然简单 ，但在管理的功能上存在不足。 "),r("strong",[s._v("Harbor是一个用于存储和分发Docker镜像的企业级Registry服务器，harbor使用的是官方的docker registry(v2命名是distribution)服务去完成")]),s._v("。harbor在docker distribution的基础上增加了一些安全、访问控制、管理的功能以满足企业对于镜像仓库的需求。")]),s._v(" "),r("p",[r("strong",[r("a",{attrs:{href:"https://goharbor.io/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Harbor"),r("OutboundLink")],1)]),s._v(" 是一个开源镜像仓库，可通过基于角色的访问控制来保护镜像，新版本的Harbor还增加了扫描镜像中的漏洞并将镜像签名为受信任。")]),s._v(" "),r("p",[s._v("Docker官方也提供了公共的镜像仓库，但是从安全和效率等方面考虑，部署我们私有环境的Registry也是非常必要的。 所以Harbor孕育而生，Harbor是由VMware公司开源的企业级的Docker Registry管理项目，"),r("strong",[s._v("它包括权限管理(RBAC)、LDAP、日志审核、管理界面、自我注册、镜像复制和中文支持等功能。")])]),s._v(" "),r("p",[s._v("Harbor组件均以Docker容器方式启动，因此，你可以将其部署在任何支持Docker的Linux发行版上。")]),s._v(" "),r("p",[r("img",{attrs:{src:t(1249),alt:"img"}})]),s._v(" "),r("h3",{attrs:{id:"特性"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#特性"}},[s._v("#")]),s._v(" 特性")]),s._v(" "),r("ul",[r("li",[s._v("**☆ 易于部署：**可通过Docker compose或Helm Chart 部署 Harbor。")]),s._v(" "),r("li",[s._v("**"),r("em",[s._v("*☆*")]),s._v(" 云原生注册表：**Harbor 支持容器镜像和Helm图表，可作为容器原生运行时和编排平台等云原生环境的注册表。")]),s._v(" "),r("li",[s._v("**"),r("em",[s._v("*☆*")]),s._v(" 基于角色控制：**用户通过项目访问不同的存储库，并且用户可以对项目下的镜像或Helm图表具有不同的权限。")]),s._v(" "),r("li",[s._v("**"),r("em",[s._v("*☆*")]),s._v(" 基于策略的复制：**可以使用过滤器基于策略在多个注册表实例之间复制（同步）镜像和图表。")]),s._v(" "),r("li",[s._v("**"),r("em",[s._v("*☆*")]),s._v(" 镜像删除和垃圾收集：**系统管理员可以运行垃圾收集作业，以便可以删除镜像，并可以定期释放其空间。")]),s._v(" "),r("li",[s._v("**"),r("em",[s._v("*☆*")]),s._v(" 漏洞扫描：**Harbor会定期扫描映像中的漏洞，并进行策略检查以防止部署易受攻击的映像。")]),s._v(" "),r("li",[s._v("**"),r("em",[s._v("*☆*")]),s._v(" 公证人：**支持对容器镜像进行签名，以确保真实性和出处。")]),s._v(" "),r("li",[s._v("**"),r("em",[s._v("*☆*")]),s._v(" 审核：**通过日志跟踪对存储库的所有操作。")]),s._v(" "),r("li",[s._v("**"),r("em",[s._v("*☆*")]),s._v(" 图形门户：**用户可以轻松浏览，搜索存储库和管理项目。")]),s._v(" "),r("li",[s._v("**"),r("em",[s._v("*☆*")]),s._v(" 外部集成：**提供RESTful API有助于管理操作，并且易于与外部系统集成。")])]),s._v(" "),r("h3",{attrs:{id:"安装compose"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#安装compose"}},[s._v("#")]),s._v(" 安装compose")]),s._v(" "),r("p",[s._v("部署harbor要依赖; "),r("code",[s._v("yum install docker-compose")])]),s._v(" "),r("p",[r("strong",[s._v("compose 基本命令")])]),s._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动Harbor容器")]),s._v("\ndocker-compose start\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 停止Harbor容器")]),s._v("\ndocker-compose stop\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启Harbor容器")]),s._v("\ndocker-compose restart\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 停止并删除Harbor容器，加上-v参数可以同时移除挂载在容器上的目录")]),s._v("\ndocker-compose down\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建并启动Harbo容器，参数“-d”表示后台运行命令")]),s._v("\ndocker-compose up -d\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br")])]),r("h3",{attrs:{id:"下载harbor安装包并进行解压"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#下载harbor安装包并进行解压"}},[s._v("#")]),s._v(" 下载harbor安装包并进行解压")]),s._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用在线安装程序")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#wget -P /usr/local wget https://github.com/goharbor/harbor/releases/download/v2.3.2/harbor-online-installer-v2.3.2.tgz")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://github.com/goharbor/harbor/releases/download/v2.4.1/harbor-offline-installer-v2.4.1.tgz\n"),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" zxf harbor-offline-installer-v2.4.1.tgz  -C /usr/local/\n"),r("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local\n"),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" harbor/ wdp-harbor/\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br")])]),r("table",[r("thead",[r("tr",[r("th",[s._v("harbor安装位置")]),s._v(" "),r("th",[s._v("/usr/local/wdp-harbor")]),s._v(" "),r("th",[s._v("暂无")])])]),s._v(" "),r("tbody",[r("tr",[r("td",[s._v("harbor数据目录")]),s._v(" "),r("td",[s._v("/home/wdp-docker-bak/harbor")]),s._v(" "),r("td",[s._v("暂无")])])])]),s._v(" "),r("h3",{attrs:{id:"编写harbor配置文件"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#编写harbor配置文件"}},[s._v("#")]),s._v(" 编写harbor配置文件")]),s._v(" "),r("p",[s._v("配置参数位于安装目录的 harbor.yml 文件中。")]),s._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重命名")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local \n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改配置文件，根据自己的需求进行修改")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" wdp-harbor\n"),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" harbor.yml.tmpl harbor.yml\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# harbor.yml中按需修改或添加如下内容")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 修改hostname")]),s._v("\nhostname: harbor.test.com "),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#如果是ip的话，直接设置ip;")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 修改admin密码")]),s._v("\nharbor_admin_password: xxxxxxx\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 暂时关闭https")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#https:")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# https port for harbor, default is 443")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  port: 443")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The path of cert and key files for nginx")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  certificate: /your/certificate/path")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# private_key: /your/private/key/path")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 添加禁止用户自注册")]),s._v("\nself_registration: off\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 设置只有管理员可以创建项目（可选）")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# project_creation_restriction: adminonly")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 指定数据目录，若无则手动创建该目录")]),s._v("\ndata_volume: /home/wdp-docker-bak/harbor\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br"),r("span",{staticClass:"line-number"},[s._v("18")]),r("br"),r("span",{staticClass:"line-number"},[s._v("19")]),r("br"),r("span",{staticClass:"line-number"},[s._v("20")]),r("br"),r("span",{staticClass:"line-number"},[s._v("21")]),r("br"),r("span",{staticClass:"line-number"},[s._v("22")]),r("br"),r("span",{staticClass:"line-number"},[s._v("23")]),r("br")])]),r("h4",{attrs:{id:"harbor-yml"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#harbor-yml"}},[s._v("#")]),s._v(" "),r("code",[s._v("harbor.yml")])]),s._v(" "),r("p",[s._v("修改以下内容:")]),s._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[r("span",{pre:!0,attrs:{class:"token function"}},[s._v("hostname")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".xxx.204 "),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#修改harbor的启动ip，这里需要依据系统ip设置")]),s._v("\nport: "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#harbor的端口,有两个端口,http协议(80)和https协议(443)")]),s._v("\nharbor_admin_password "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" xxxx   "),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#修改harbor的admin用户的密码")]),s._v("\ndata_volume: /home/wdp-docker-bak/harbor "),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#修改harbor存储位置")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br")])]),r("p",[s._v("一般情况下，我们最少需要配置的内容如下：")]),s._v(" "),r("ul",[r("li",[r("strong",[s._v("hostname")]),s._v(" 需要配置为 "),r("strong",[s._v("127.0.0.1")]),s._v(" 之外的内容，以提供外部访问，本例中我配置为: docker.soulteary.com")]),s._v(" "),r("li",[r("strong",[s._v("https")]),s._v(" 的配置需要同时配置证书，生产环境中，如果使用 SLB 或者使用其他应用统一提供 SSL 接入，则可以删除。")]),s._v(" "),r("li",[r("strong",[s._v("harbor_admin_password")]),s._v(" 默认密码即可，但是初次使用登陆后台后需要修改密码。")]),s._v(" "),r("li",[r("strong",[s._v("data_volume")]),s._v(" 根据自己实际情况修改宿主机的文件储存地址。")])]),s._v(" "),r("h4",{attrs:{id:"必须参数"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#必须参数"}},[s._v("#")]),s._v(" 必须参数")]),s._v(" "),r("ul",[r("li",[s._v("hostname: 目标主机的主机名。它应该是目标计算机的 IP 地址或完全限定的域名（FQDN），例如：172.16.1.30 或 reg.yourdomain.com。不要使用 localhost 或 127.0.0.1 作为主机名。")]),s._v(" "),r("li",[s._v("data_volume: Harbor 数据的存储位置")]),s._v(" "),r("li",[s._v("harbor_admin_password: 管理员的初始密码。此密码仅在 Harbor 首次启动时生效。请注意，默认用户 名/密码为 admin / Harbor12345")]),s._v(" "),r("li",[s._v("database: 与本地数据库相关的配置。")]),s._v(" "),r("li",[s._v("password: 默认数据库密码为 root123，应该改为一个安全的生产环境密码。")])]),s._v(" "),r("h4",{attrs:{id:"可选参数"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#可选参数"}},[s._v("#")]),s._v(" 可选参数")]),s._v(" "),r("ul",[r("li",[s._v("http: port: 你的 http 的端口号。")]),s._v(" "),r("li",[s._v("https: 启用 https 协议。如果启用了秘钥，则必须设置为 https。\n"),r("ul",[r("li",[s._v("port: https 的端口号。")]),s._v(" "),r("li",[s._v("certificate: SSL 证书的路径，仅在协议设置为 https 时应用。")]),s._v(" "),r("li",[s._v("private_key: SSL 密钥的路径，仅在协议设置为 https 时应用。")])])])]),s._v(" "),r("h4",{attrs:{id:"网络端口"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#网络端口"}},[s._v("#")]),s._v(" 网络端口")]),s._v(" "),r("p",[r("img",{attrs:{src:t(1250),alt:"img"}})]),s._v(" "),r("h3",{attrs:{id:"修改docker配置文件"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#修改docker配置文件"}},[s._v("#")]),s._v(" "),r("strong",[s._v("修改docker配置文件")])]),s._v(" "),r("p",[r("strong",[s._v("修改docker配置文件，使docker支持harbor")])]),s._v(" "),r("p",[s._v("编辑客户机/etc/docker/daemon.json文件")]),s._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"insecure-registries"')]),s._v(":"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.100.204:80"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("p",[s._v("重启客户机docker服务")]),s._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[s._v("systemctl restart docker  "),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#或者(service docker restart) ")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("h3",{attrs:{id:"设置harbor开机启动【要点】"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#设置harbor开机启动【要点】"}},[s._v("#")]),s._v(" 设置Harbor开机启动【要点】")]),s._v(" "),r("p",[s._v("使用vim编辑器编辑配置文件vim /lib/systemd/system/harbor.service并向文件中写入")]),s._v(" "),r("div",{staticClass:"language-yaml line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-yaml"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Unit"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nDescription=Harbor\nAfter=docker.service systemd"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("networkd.service systemd"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("resolved.service\nRequires=docker.service\nDocumentation=http"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//github.com/vmware/harbor\n\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Service"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nType=simple\nRestart=on"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("failure\nRestartSec=5\n\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#需要注意harbor的安装位置")]),s._v("\nExecStart=/usr/bin/docker"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("compose "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f /usr/local/wdp"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("harbor/docker"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("compose.yml up\nExecStop=/usr/bin/docker"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("compose "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f /usr/local/wdp"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("harbor/docker"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("compose.yml down\n\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Install"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nWantedBy=multi"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("user.target\n\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#或者修改.yml 中每个的：restart: always；")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br"),r("span",{staticClass:"line-number"},[s._v("18")]),r("br"),r("span",{staticClass:"line-number"},[s._v("19")]),r("br")])]),r("div",{staticClass:"language-sh line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[s._v("systemctl "),r("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" harbor "),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置harbor开机自启")]),s._v("\nsystemctl start harbor "),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启动harbor")]),s._v("\n\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#临时脚本")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local/wdp-harbor\ndocker-compose up -d\ndocker-compose down\n\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看")]),s._v("\ndocker-compose "),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -a\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br")])]),r("h3",{attrs:{id:"启动harbor"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#启动harbor"}},[s._v("#")]),s._v(" 启动Harbor")]),s._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行安装脚本")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v(" ./install.sh\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br")])]),r("p",[s._v("最终目录结构：")]),s._v(" "),r("div",{staticClass:"language-python line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-python"}},[r("code",[s._v("root@harbor"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("local"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("harbor"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll")]),s._v("\ntotal "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v("\ndrwxr"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("xr"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("x  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" root root  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Aug "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("41")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\ndrwxr"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("xr"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("x "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(" root root  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Aug "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("03")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\ndrwxr"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("xr"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("x  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" root root  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Aug "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("03")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v(" common"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("rw"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("r"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("r"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("3361")]),s._v(" Aug "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("08")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("53")]),s._v(" common"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sh\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("rw"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("r"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("r"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("6066")]),s._v(" Aug "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("03")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("34")]),s._v(" docker"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("compose"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yml\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("rw"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("r"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("r"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("7919")]),s._v(" Aug "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("03")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("34")]),s._v(" harbor"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yml\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("rw"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("r"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("r"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("7840")]),s._v(" Aug "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("08")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("53")]),s._v(" harbor"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yml"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tmpl\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("rwxr"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("xr"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("x  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2500")]),s._v(" Aug "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("08")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("53")]),s._v(" install"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sh"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("rw"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("r"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("r"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("11347")]),s._v(" Aug "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("08")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("53")]),s._v(" LICENSE\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("rwxr"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("xr"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("x  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1881")]),s._v(" Aug "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("08")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("53")]),s._v(" prepare"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br")])]),r("h4",{attrs:{id:"查看容器的运行状态"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#查看容器的运行状态"}},[s._v("#")]),s._v(" 查看容器的运行状态")]),s._v(" "),r("div",{staticClass:"language-python line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-python"}},[r("code",[s._v("root@harbor"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("local"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("harbor"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker-compose ps")]),s._v("\n      Name                     Command                  State                      Ports                \n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("\nharbor"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("core         "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("harbor"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("entrypoint"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sh            Up "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("healthy"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                       \nharbor"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("db           "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("docker"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("entrypoint"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sh "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("96")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("      Up "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("healthy"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                       \nharbor"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("jobservice   "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("harbor"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("entrypoint"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sh            Up "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("healthy"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                       \nharbor"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("log          "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("bin")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("sh "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("c "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("local"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("bin")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("   Up "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("healthy"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1514")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("10514")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("tcp           \nharbor"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("portal       nginx "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("g daemon off"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("             Up "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("healthy"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                       \nnginx               nginx "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("g daemon off"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("             Up "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("healthy"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("tcp"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("tcp\nredis               redis"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("server "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("redis"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf     Up "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("healthy"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                       \nregistry            "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("home"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("harbor"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("entrypoint"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sh       Up "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("healthy"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                       \nregistryctl         "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("home"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("harbor"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("start"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sh            Up "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("healthy"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br")])]),r("h4",{attrs:{id:"启动注意事项"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#启动注意事项"}},[s._v("#")]),s._v(" 启动注意事项")]),s._v(" "),r("p",[r("strong",[s._v("如果修改"),r("code",[s._v("harbor.yml")]),s._v(",一定要通过"),r("code",[s._v("install.sh")]),s._v("脚本启动；")])]),s._v(" "),r("p",[s._v("当修改 "),r("code",[s._v("harbor.yml")]),s._v(" 后，我们需要执行 "),r("code",[s._v("bash prepare")]),s._v("，让配置能够得到更新。当然，历史存在的容器 container 也需要清理，除了使用 "),r("code",[s._v("docker rm")]),s._v(" 进行清理外，还可以使用 "),r("code",[s._v("docker system prune")]),s._v(" 进行清理。")]),s._v(" "),r("h3",{attrs:{id:"注册和创建仓库"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#注册和创建仓库"}},[s._v("#")]),s._v(" 注册和创建仓库")]),s._v(" "),r("p",[s._v("访问登录界面了。（用户admin，密码：x x x（在harbor配置文件中可以查看到）,新建个项目设置为wdp-test;设置项目仓库为公开模式；")]),s._v(" "),r("p",[r("img",{attrs:{src:t(1251),alt:"image-20220127192535318"}})]),s._v(" "),r("p",[s._v("修改tag,及推送；注意要多一次文档目录；")]),s._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#docker login 10.45.46.xxx:5000 #记得要登录后推送设置；")]),s._v("\ndocker tag SOURCE_IMAGE"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(":TAG"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.45")]),s._v(".46.xxx:5000/wdp/REPOSITORY"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(":TAG"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ndocker push "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.45")]),s._v(".xxx.116:5000/wdp/REPOSITORY"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(":TAG"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ndocker pull "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.45")]),s._v(".xxx.116:5000/wdp/REPOSITORY"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(":TAG"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br")])]),r("p",[r("img",{attrs:{src:t(1252),alt:"image-20220127193951504"}})]),s._v(" "),r("h3",{attrs:{id:"配置https-todo"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#配置https-todo"}},[s._v("#")]),s._v(" 配置https TODO")]),s._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 把这三个证书文件复制到docker相应的目录下，注意最后的路径名，要跟上面的保持一致")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /etc/docker/certs.d/www.harbor.mobi/\n"),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" www.harbor.mobi.cert /etc/docker/certs.d/www.harbor.mobi/\n"),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" www.harbor.mobi.key /etc/docker/certs.d/ywww.harbor.mobi/\n"),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" ca.crt /etc/docker/certs.d/www.harbor.mobi/\n\n最终docker目录结构：\n/etc/docker/certs.d/\n    └── www.harbor.mobi\n       ├── www.harbor.mobi.cert  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("-- Server certificate signed by CA\n       ├── www.harbor.mobi.key   "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("-- Server key signed by CA\n       └── ca.crt               "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("-- Certificate authority that signed the registry certificate\n\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 先停止harbor")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local/harbor\ndocker-compose down -v\n\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启docker")]),s._v("\nsystemctl restart docker.service\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br"),r("span",{staticClass:"line-number"},[s._v("18")]),r("br"),r("span",{staticClass:"line-number"},[s._v("19")]),r("br")])]),r("h3",{attrs:{id:"配置定时垃圾清理"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#配置定时垃圾清理"}},[s._v("#")]),s._v(" 配置定时垃圾清理")]),s._v(" "),r("blockquote",[r("p",[s._v("一定要记得设置这个定时清理功能，要不然随着不断推送tag会原来越大，导致磁盘空间不够，最终导致Harbor启动运行不正常；")])]),s._v(" "),r("p",[r("img",{attrs:{src:t(1253),alt:"image-20220322092918900"}})]),s._v(" "),r("p",[r("strong",[s._v("检查各磁盘空间的命令：")])]),s._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#全局查看")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("df")]),s._v(" -h \n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#依次查看各个目录的磁盘大小")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("du")]),s._v(" -ah --max-depth"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br")])]),r("p",[r("img",{attrs:{src:t(1254),alt:"image-20220322094442342"}})]),s._v(" "),r("p",[r("img",{attrs:{src:t(1255),alt:"image-20220322094525265"}})]),s._v(" "),r("p",[s._v("管理后台查看打下：")]),s._v(" "),r("p",[r("img",{attrs:{src:t(1256),alt:"image-20220322094011738"}})]),s._v(" "),r("h2",{attrs:{id:"迁移docker仓库"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#迁移docker仓库"}},[s._v("#")]),s._v(" 迁移Docker仓库")]),s._v(" "),r("h3",{attrs:{id:"采用registry部署的迁移方法"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#采用registry部署的迁移方法"}},[s._v("#")]),s._v(" 采用registry部署的迁移方法")]),s._v(" "),r("p",[s._v("大概流程就是导出registry镜像，在新的机器导入，然后把镜像文件放到相同的目录下，启动就可以了。")]),s._v(" "),r("p",[s._v("采用Harbor部署的迁移方法")]),s._v(" "),r("p",[s._v("编写脚本把镜像重新上传到Harbor;")]),s._v(" "),r("p",[r("a",{attrs:{href:"https://www.jianshu.com/p/0c4b55675b99",target:"_blank",rel:"noopener noreferrer"}},[s._v("参考文档"),r("OutboundLink")],1)]),s._v(" "),r("h3",{attrs:{id:"切换镜像仓库【推荐】"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#切换镜像仓库【推荐】"}},[s._v("#")]),s._v(" 切换镜像仓库【推荐】")]),s._v(" "),r("p",[s._v("不管以上如何实现，但切换镜像仓库的方法大致相同。在测试没问题的前提下，执行以下流程：")]),s._v(" "),r("ul",[r("li",[r("p",[s._v("如果选择registry，则只需要把原来registry仓库的镜像文件，直接复制到新的registry仓库的目录下。如过选用Harbor，则需要编写脚本把原来镜像仓库的镜像同步过去。")])]),s._v(" "),r("li",[r("p",[s._v("编写shell脚本通过ansible更新所有要与Registry交互的Docker主机。如果选择Insecure Registry需要更改所有 Docker主机的Docker Daemon。如果选择Secure Registry则是颁发证书。")])]),s._v(" "),r("li",[r("p",[s._v("通知新镜像仓库的地址，避免push、pull失败。")])])]),s._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[r("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker run -d -p "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v(":5000 --restart"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("always --name registry -v /app_data/registry/:/var/lib/registry registry:2\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("h2",{attrs:{id:"参考相关"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#参考相关"}},[s._v("#")]),s._v(" 参考相关")]),s._v(" "),r("ul",[r("li",[r("a",{attrs:{href:"https://www.cnblogs.com/sanduzxcvbnm/p/11956347.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Harbor仓库配置https访问"),r("OutboundLink")],1)]),s._v(" "),r("li",[s._v("[离线安装 Harbor v2](https://blog.atompi.com/2020/08/03/离线安装 Harbor v2/)")])])])}),[],!1,null,null,null);a.default=e.exports}}]);