(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{1259:function(s,t,a){s.exports=a.p+"assets/img/image-20210220235532607.5207ac54.png"},1260:function(s,t,a){s.exports=a.p+"assets/img/16b4ec9611588cf6.5d420375.png"},1261:function(s,t,a){s.exports=a.p+"assets/img/171b52d1ad77c270.b2bf4973.png"},1262:function(s,t,a){s.exports=a.p+"assets/img/171b52d642d6adbe.006ed2cf.png"},1263:function(s,t,a){s.exports=a.p+"assets/img/71885018.55276c18.png"},1264:function(s,t,a){s.exports=a.p+"assets/img/image-20210122001003105.ab0731af.png"},1265:function(s,t,a){s.exports=a.p+"assets/img/image-20210122001032928.b9fb8f54.png"},1266:function(s,t,a){s.exports=a.p+"assets/img/71984691.6c050d8b.png"},1267:function(s,t,a){s.exports=a.p+"assets/img/71968542.27d6ac98.png"},1268:function(s,t,a){s.exports=a.p+"assets/img/72100681.8c68c501.png"},1269:function(s,t,a){s.exports=a.p+"assets/img/72054394.d241260a.png"},2085:function(s,t,a){"use strict";a.r(t);var n=a(14),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"简介"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[s._v("#")]),s._v(" 简介")]),s._v(" "),n("p",[s._v("nginx是一个高性能的HTTP和反向代理服务器，也是一个通用的TCP/UDP代理服务器，最初由俄罗斯人Igor Sysoev编写。")]),s._v(" "),n("p",[s._v("Nginx以事件驱动的方式编写，所以有非常好的性能，同时也是一个非常高效的反向代理、负载平衡服务器。")]),s._v(" "),n("ul",[n("li",[s._v("在性能上，Nginx占用很少的系统资源，能支持更多的并发连接，达到更高的访问效率；")]),s._v(" "),n("li",[s._v("在功能上，Nginx是优秀的代理服务器和负载均衡服务器；在安装配置上，Nginx安装简单、配置灵活;")]),s._v(" "),n("li",[s._v("支持热部署，启动速度特别快，还可以"),n("strong",[s._v("在不间断服务的情况下对软件版本或配置进行升级，即使运行数月也无需重新启动。")])])]),s._v(" "),n("h3",{attrs:{id:"优势"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#优势"}},[s._v("#")]),s._v(" 优势")]),s._v(" "),n("ul",[n("li",[s._v("高并发高性能")]),s._v(" "),n("li",[s._v("可扩展性好")]),s._v(" "),n("li",[s._v("高可靠性")]),s._v(" "),n("li",[s._v("热部署")]),s._v(" "),n("li",[s._v("开源许可证")])]),s._v(" "),n("h3",{attrs:{id:"应用场景"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#应用场景"}},[s._v("#")]),s._v(" 应用场景")]),s._v(" "),n("ul",[n("li",[s._v("http服务器，静态资源服务，通过本地文件系统提供服务;")]),s._v(" "),n("li",[s._v("虚拟主机，反向代理服务、负载均衡;")]),s._v(" "),n("li",[s._v("API服务、权限控制，减少应用服务器压力;")])]),s._v(" "),n("h2",{attrs:{id:"常用配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#常用配置"}},[s._v("#")]),s._v(" 常用配置")]),s._v(" "),n("h3",{attrs:{id:"配置结构"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置结构"}},[s._v("#")]),s._v(" 配置结构")]),s._v(" "),n("p",[s._v("下面是一个nginx配置文件的基本结构：")]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",[s._v("模块")]),s._v(" "),n("th",[s._v("功能")])])]),s._v(" "),n("tbody",[n("tr",[n("td",[s._v("main")]),s._v(" "),n("td",[s._v("nginx的全局配置，对全局生效。")])]),s._v(" "),n("tr",[n("td",[s._v("events")]),s._v(" "),n("td",[s._v("配置影响nginx服务器或与用户的网络连接。")])]),s._v(" "),n("tr",[n("td",[s._v("http")]),s._v(" "),n("td",[s._v("可以嵌套多个server，配置代理，缓存，日志定义等绝大多数功能和第三方模块的配置。")])]),s._v(" "),n("tr",[n("td",[s._v("server")]),s._v(" "),n("td",[s._v("配置虚拟主机的相关参数，一个http中可以有多个server。")])]),s._v(" "),n("tr",[n("td",[s._v("location")]),s._v(" "),n("td",[s._v("配置请求的路由，以及各种页面的处理情况。")])]),s._v(" "),n("tr",[n("td",[s._v("upstream")]),s._v(" "),n("td",[s._v("配置后端服务器具体地址，负载均衡配置不可或缺的部分。")])])])]),s._v(" "),n("p",[s._v("简化版配置：")]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 全局区   有一个工作子进程，一般设置为CPU数 * 核数")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("worker_processes")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("events")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 一般是配置nginx进程与连接的特性")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如1个work能同时允许多少连接，一个子进程最大允许连接1024个连接")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("worker_connections")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置HTTP服务器配置段")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置虚拟主机段")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定位，把特殊的路径或文件再次定位。")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n \t\t\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br")])]),n("p",[s._v("基本示例及说明：")]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义Nginx运行的用户和用户组")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v("  nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nginx进程数，建议设置为等于CPU总核心数")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("worker_processes")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("   \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 错误日志存放目录和类型")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("error_log")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("var"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("log"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("error"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log warn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进程文件")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("pid")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("var"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("run"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("pid")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("events")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("worker_connections")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 单个进程最大连接数（最大连接数=连接数*进程数）")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设定http服务器")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("include")]),s._v("       "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mime"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("types")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 文件扩展名与类型映射表")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default_type")]),s._v("  application"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("octet"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("stream"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 默认文件类型")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置日志的格式")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("log_format")]),s._v("  main  "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'$remote_addr - $remote_user [$time_local] \"$request\" '")]),s._v("\n                      "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'$status $body_bytes_sent \"$http_referer\" '")]),s._v("\n                      "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'"$http_user_agent" "$http_x_forwarded_for"\'')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("access_log")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("var"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("log"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("access"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log  main"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nginx访问日志存放位置")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开启高效文件传输模式，sendfile指令指定nginx是否调用sendfile函数来输出文件，对于普通应用设为 on。")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果用来进行下载等应用磁盘IO重负载应用，可设置为off，以平衡磁盘与网络I/O处理速度，降低系统的负载。")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 注意：如果图片显示不正常把这个改成off。")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sendfile")]),s._v("        on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("   \n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("tcp_nopush")]),s._v("     on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 防止网络阻塞")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("keepalive_timeout")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("65")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 长连接超时时间，单位是秒")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("gzip")]),s._v("  on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开启gzip压缩")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("include")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("conf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("d"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 包含的子配置项位置和文件，表示conf.d文件夹下.conf后缀的文件都会归入nginx配置中")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 服务配置")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 监听端口")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 根目录下")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("myproject"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 选择哪个服务器列表")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br")])]),n("h3",{attrs:{id:"内置变量"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#内置变量"}},[s._v("#")]),s._v(" 内置变量")]),s._v(" "),n("p",[s._v("下面是 "),n("code",[s._v("nginx")]),s._v("一些配置中常用的内置全局变量，你可以在配置的任何位置使用它们。")]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",[s._v("变量名")]),s._v(" "),n("th",[s._v("功能")])])]),s._v(" "),n("tbody",[n("tr",[n("td",[n("code",[s._v("$host")])]),s._v(" "),n("td",[s._v("请求信息中的 "),n("code",[s._v("Host")]),s._v("，如果请求中没有 "),n("code",[s._v("Host")]),s._v("行，则等于设置的服务器名")])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("$request_method")])]),s._v(" "),n("td",[s._v("客户端请求类型，如 "),n("code",[s._v("GET")]),s._v("、 "),n("code",[s._v("POST")])])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("$remote_addr")])]),s._v(" "),n("td",[s._v("客户端的 "),n("code",[s._v("IP")]),s._v("地址")])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("$args")])]),s._v(" "),n("td",[s._v("请求中的参数")])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("$content_length")])]),s._v(" "),n("td",[s._v("请求头中的 "),n("code",[s._v("Content-length")]),s._v("字段")])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("$http_user_agent")])]),s._v(" "),n("td",[s._v("客户端agent信息")])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("$http_cookie")])]),s._v(" "),n("td",[s._v("客户端cookie信息")])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("$remote_addr")])]),s._v(" "),n("td",[s._v("客户端的IP地址")])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("$remote_port")])]),s._v(" "),n("td",[s._v("客户端的端口")])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("$server_protocol")])]),s._v(" "),n("td",[s._v("请求使用的协议，如 "),n("code",[s._v("HTTP/1.0")]),s._v("、·HTTP/1.1`")])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("$server_addr")])]),s._v(" "),n("td",[s._v("服务器地址")])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("$server_name")])]),s._v(" "),n("td",[s._v("服务器名称")])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("$server_port")])]),s._v(" "),n("td",[s._v("服务器的端口号")])])])]),s._v(" "),n("h3",{attrs:{id:"其他操作"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#其他操作"}},[s._v("#")]),s._v(" 其他操作")]),s._v(" "),n("h4",{attrs:{id:"声明变量-变量赋值"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#声明变量-变量赋值"}},[s._v("#")]),s._v(" 声明变量 & 变量赋值")]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 声明变量，并为变量赋值")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$username")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"samy"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h4",{attrs:{id:"读取cookie"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#读取cookie"}},[s._v("#")]),s._v(" 读取cookie")]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 读取请求携带的cookie，其中keyName是cookie的key")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$cookie_keyName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h4",{attrs:{id:"if-判断语句"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#if-判断语句"}},[s._v("#")]),s._v(" if 判断语句")]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$env")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$cookie_ENV")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# if 判断 ==  !=")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$cookie_ENV")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dev"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rewrite")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("^")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("website"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("blog"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dev"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h4",{attrs:{id:"文件-目录-判断"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#文件-目录-判断"}},[s._v("#")]),s._v(" 文件｜目录 判断")]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",[s._v("语句")]),s._v(" "),n("th",[s._v("功能")])])]),s._v(" "),n("tbody",[n("tr",[n("td",[s._v("-f")]),s._v(" "),n("td",[s._v("文件存在")])]),s._v(" "),n("tr",[n("td",[s._v("-d")]),s._v(" "),n("td",[s._v("目录存在")])]),s._v(" "),n("tr",[n("td",[s._v("!-d")]),s._v(" "),n("td",[s._v("目录不存在")])]),s._v(" "),n("tr",[n("td",[s._v("-e")]),s._v(" "),n("td",[s._v("文件或目录存在")])]),s._v(" "),n("tr",[n("td",[s._v("!-e")]),s._v(" "),n("td",[s._v("文件或目录都不存在")])]),s._v(" "),n("tr",[n("td",[s._v("-x")]),s._v(" "),n("td",[s._v("文件可执行")])]),s._v(" "),n("tr",[n("td",[s._v("!-x")]),s._v(" "),n("td",[s._v("文件不可执行")])])])]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果文件或者目录不存在则返回html")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("e "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$request_filename")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rewrite")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("^")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("website"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("blog"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("blog "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("sites"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("autoindex")]),s._v(" on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("expires")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("d"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 缓存30天")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("e "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$request_filename")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rewrite")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("^")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("blog"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("h4",{attrs:{id:"设置响应头-状态码"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#设置响应头-状态码"}},[s._v("#")]),s._v(" 设置响应头,状态码")]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在server里设置响应头 add_header")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add_header")]),s._v(" Access"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Control"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Allow")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Origin "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 通常在代理情况下使用 proxy_set_header：")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" Host "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置剔除的头部字段")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_hide_header")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Expires")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置状态码直接return即可")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("h2",{attrs:{id:"常用命令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#常用命令"}},[s._v("#")]),s._v(" 常用命令")]),s._v(" "),n("h3",{attrs:{id:"命令列表"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#命令列表"}},[s._v("#")]),s._v(" 命令列表")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" nginx "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置开机启动 ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" nginx start "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动 nginx 服务")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" nginx restart "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启 nginx 服务")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" nginx stop "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 停止 nginx 服务")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" nginx -t "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 检查语法")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" nginx reload "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重新加载配置，一般是在修改过 nginx 配置文件时使用。")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("nginx -h \t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#打开帮助信息")]),s._v("\nnginx -s reopen \t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#重启Nginx")]),s._v("\nnginx -s reload \t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#重新加载Nginx配置文件，然后以优雅的方式重启Nginx")]),s._v("\nnginx -s stop   \t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#强制停止Nginx服务")]),s._v("\nnginx -s quit   \t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#优雅地停止Nginx服务（即处理完所有请求后再停止服务）")]),s._v("\nnginx -v \t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#显示版本信息并退出")]),s._v("\nnginx -V\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#显示版本和配置选项信息，然后退出")]),s._v("\nnginx -t\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#检测配置文件是否有语法错误，然后退出")]),s._v("\nnginx -T\t \t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#检测配置文件是否有语法错误，转储并退出")]),s._v("\nnginx -q \t  \t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#在检测配置文件期间屏蔽非错误信息")]),s._v("\nnginx -p prefix   \t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置前缀路径(默认是:/usr/share/nginx/)")]),s._v("\nnginx -c filename\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置配置文件(默认是:/etc/nginx/nginx.conf)")]),s._v("\nnginx -g directives \t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置配置文件外的全局指令")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("kill")]),s._v(" all nginx\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#杀死所有nginx进程")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("kill")]),s._v(" -quit 进程编号\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("kill")]),s._v(" -9 进程编号 "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 强制停止:这个得分别干掉master进程和worker进程")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br")])]),n("h3",{attrs:{id:"命令详情"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#命令详情"}},[s._v("#")]),s._v(" 命令详情")]),s._v(" "),n("h4",{attrs:{id:"查看安装目录【要点】"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#查看安装目录【要点】"}},[s._v("#")]),s._v(" 查看安装目录【要点】")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -ef "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" nginx\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看服务是否启动成功")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# root 4593 1  0 Jan23 ? 00:00:00 nginx: master process /usr/sbin/nginx")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h4",{attrs:{id:"查看配置文件目录"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#查看配置文件目录"}},[s._v("#")]),s._v(" 查看配置文件目录")]),s._v(" "),n("p",[s._v("通过检查配置是否正确的方式来查看配置文件目录")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("nginx -t\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nginx: the configuration file /etc/nginx/nginx.conf syntax is ok")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("nginx: the configuration file "),n("code",[s._v("/etc/nginx/nginx.conf")]),s._v(" syntax is ok")]),s._v(" "),n("h4",{attrs:{id:"检查配置语法是否正确"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#检查配置语法是否正确"}},[s._v("#")]),s._v(" 检查配置语法是否正确")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("nginx -t\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nginx: the configuration file /etc/nginx/nginx.conf syntax is ok")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nginx: configuration file /etc/nginx/nginx.conf test is successful")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("其中：参数 "),n("code",[s._v("-c")]),s._v(" 指定了配置文件的路径，如果不加 -c 参数，Nginx 会默认加载其安装目录的 "),n("code",[s._v("conf")]),s._v(" 子目录中的 "),n("code",[s._v("nginx.conf")]),s._v(" 文件。")]),s._v(" "),n("h4",{attrs:{id:"启动-重启服务"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#启动-重启服务"}},[s._v("#")]),s._v(" 启动/重启服务")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 通过软连接，这样就可以直接使用 nginx 执行")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" -s /usr/local/nginx/sbin/nginx /usr/bin/nginx\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#配置了全局软应用后，就直接使用nginx命令；")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动nginx服务，ps：如果nginx已经开启了，再次执行nginx -c 命令时，会报错")]),s._v("\n/usr/sbin/nginx -c /etc/nginx/nginx.conf\n/usr/local/nginx/sbin/nginx -c conf/nginx.conf\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在启动的时候也可以指定pid的存储位置")]),s._v("\n/usr/local/nginx/sbin/nginx -g "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"pid /usr/local/nginx/nginx.pid;"')]),s._v("\n/usr/local/nginx/sbin/nginx -g "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"pid /usr/local/nginx/nginx.pid;"')]),s._v(" -s stop\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启nginx服务")]),s._v("\n/usr/sbin/nginx -s reload\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("h4",{attrs:{id:"停止服务"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#停止服务"}},[s._v("#")]),s._v(" 停止服务")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 快速强制停止Nginx服务")]),s._v("\n/usr/local/nginx/sbin/nginx -s stop\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 优雅停止nginx服务")]),s._v("\n/usr/local/nginx/sbin/nginx -s quit\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[n("code",[s._v("quit")]),s._v(" 参数首先会关闭监听端口，停止接收新的连接，然后把当前正在处理的连接全部处理完，最后再退出进程。")]),s._v(" "),n("h4",{attrs:{id:"查看nginx日志【要点】"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#查看nginx日志【要点】"}},[s._v("#")]),s._v(" 查看nginx日志【要点】")]),s._v(" "),n("p",[s._v("nginx的log日志分为access log 和 error log")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /etc/nginx/nginx.conf "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 直接输出整个文件的内容")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v(" -f /usr/local/etc/nginx/logs/access.log "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 实时输出日志")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v(" -n "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" -f ./logs/insure-adm/insure-adm-web.log\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v(" -f /var/log/nginx/access.log\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v(" -f /var/log/nginx/error.log\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v(" -n "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" -f ./logs/access.log\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("h4",{attrs:{id:"热加载命令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#热加载命令"}},[s._v("#")]),s._v(" 热加载命令")]),s._v(" "),n("p",[s._v("如果改变了Nginx的配置文件.nginx.conf，想要重启Nginx，首先需要验证nginx.conf的语法有没有问题")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("/usr/local/nginx/sbin/nginx -t\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("语法验证没有问题我们就可以通过 -s reload来重新加载配置文件了")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("/usr/local/nginx/sbin/nginx -s reload\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("获取通过发送信号量的方式来重新加载")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("kill")]),s._v(" -hup master进程编号\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h2",{attrs:{id:"应用实践"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#应用实践"}},[s._v("#")]),s._v(" 应用实践")]),s._v(" "),n("h3",{attrs:{id:"跨域【要点】"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#跨域【要点】"}},[s._v("#")]),s._v(" 跨域【要点】")]),s._v(" "),n("p",[s._v("同源策略限制了从同一个源加载的文档或脚本如何与来自另一个源的资源进行交互。这是一个用于隔离潜在恶意文件的重要安全机制。通常不允许不同源间的读操作。")]),s._v(" "),n("h4",{attrs:{id:"同源策略"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#同源策略"}},[s._v("#")]),s._v(" 同源策略")]),s._v(" "),n("p",[s._v("浏览器同源:如果两个页面的协议，端口（如果有指定）和域名都相同，则两个页面具有相同的源。")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1259),alt:"image-20210220235532607"}})]),s._v(" "),n("h4",{attrs:{id:"解决跨域"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#解决跨域"}},[s._v("#")]),s._v(" 解决跨域")]),s._v(" "),n("ul",[n("li",[s._v("前端server的域名为："),n("code",[s._v("fe.server.com")])]),s._v(" "),n("li",[s._v("后端服务的域名为："),n("code",[s._v("dev.server.com")])])]),s._v(" "),n("p",[s._v("现在在 "),n("code",[s._v("fe.server.com")]),s._v("对 "),n("code",[s._v("dev.server.com")]),s._v("发起请求一定会出现跨域。将 "),n("code",[s._v("server_name")]),s._v("设置为 "),n("code",[s._v("fe.server.com")]),s._v(", 然后设置相应的location以拦截前端需要跨域的请求，最后将请求代理回 "),n("code",[s._v("dev.server.com")]),s._v("。如下面的配置：")]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v("       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("  fe"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("api "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" dev"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n       "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# proxy_pass  http://127.0.0.1:3000;")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_redirect")]),s._v("     off"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v("   Host             "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 传递域名")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v("   X"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Real"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("IP        "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 传递ip")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v("   REMOTE"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("HOST      "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 传递远程host")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v("   X"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Forwarded"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("For  "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$proxy_add_x_forwarded_for")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n       "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# proxy_set_header   X-Scheme         $scheme;      # 传递协议")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("p",[s._v("实现原理：这样可以完美绕过浏览器的同源策略： "),n("code",[s._v("dev.server.com")]),s._v("访问 "),n("code",[s._v("nginx")]),s._v("的 "),n("code",[s._v("fe.server.com")]),s._v("属于同源访问，"),n("strong",[s._v("而 "),n("code",[s._v("nginx")]),s._v("对服务端转发的请求不会触发浏览器的同源策略;")])]),s._v(" "),n("h3",{attrs:{id:"管理虚拟主机"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#管理虚拟主机"}},[s._v("#")]),s._v(" 管理虚拟主机")]),s._v(" "),n("p",[s._v("虚拟主机使用的是特殊的软硬件技术，它把一台运行在因特网上的服务器主机分成一台台“虚拟”的主机，每台虚拟主机都可以是一个独立的网站，可以具有独立的域名，具有完整的Intemet服务器功能（WWW、FTP、Email等），同一台主机上的虚拟主机之间是完全独立的。从网站访问者来看，每一台虚拟主机和一台独立的主机完全一样。")]),s._v(" "),n("blockquote",[n("p",[s._v("一般这种会单独配置一个.conf文件加端口命名；")])]),s._v(" "),n("h4",{attrs:{id:"分类"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#分类"}},[s._v("#")]),s._v(" 分类")]),s._v(" "),n("h5",{attrs:{id:"基于域名"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#基于域名"}},[s._v("#")]),s._v(" 基于域名")]),s._v(" "),n("p",[s._v("1、在http大括号中添加如下代码段：")]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("  \n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("   \n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v(" samy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("              \n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v("    samy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  \n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("                 \n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  \n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("  \n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#listen  2022; #基于端口")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v(" samyz"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#基于域名")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#server_name  192.168.197.142; #基于IP地址")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("              \n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("home"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("samy"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("deploy"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("api"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("doc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  \n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("                 \n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  \n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#vue history模式")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("home"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("samy"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("deploy"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("avue"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("dist"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try_files")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br")])]),n("p",[s._v("2、切换安装目录：cd/usr/local/software/nginx")]),s._v(" "),n("p",[s._v("3、创建目录：mkdir samy")]),s._v(" "),n("p",[s._v("4、新建index.html文件：vi /usr/local/software/nginx/samy/index.html，文件内容：")]),s._v(" "),n("div",{staticClass:"language-html line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-html"}},[n("code",[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("html")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("head")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("meta")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("http-equiv")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("Content-Type"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("content")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("text/html; charset=UTF-8"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("head")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("body")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("h2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("samy"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("h2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("body")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("html")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("5、重新读取配置文件：")]),s._v(" "),n("p",[n("code",[s._v("/usr/local/software/nginx/sbin/nginx-s reload")])]),s._v(" "),n("p",[s._v("kill -HUP进程号")]),s._v(" "),n("p",[s._v("6、配置windows本机host：")]),s._v(" "),n("p",[s._v("192.168.197.142  samy.cn")]),s._v(" "),n("p",[s._v("7、访问：http://samy.cn:80/")]),s._v(" "),n("h5",{attrs:{id:"基于端口"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#基于端口"}},[s._v("#")]),s._v(" 基于端口")]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("     feng"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n           "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("home"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n           "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("h5",{attrs:{id:"基于ip地址"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#基于ip地址"}},[s._v("#")]),s._v(" 基于IP地址")]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[s._v("    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".197")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".142")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v("    ip"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("h4",{attrs:{id:"案例"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#案例"}},[s._v("#")]),s._v(" 案例")]),s._v(" "),n("h5",{attrs:{id:"ubuntu上部署"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ubuntu上部署"}},[s._v("#")]),s._v(" ubuntu上部署")]),s._v(" "),n("blockquote",[n("p",[s._v("sudo ln -s ,要点一定要记得配置软引用")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /etc/nginx\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /sites-available/insure-8181.conf\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" -s "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/sites-available/insure-8181.conf insure-8181.conf\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" nginx -t\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" nginx -s reload\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" xxxx/api/xxx\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" nginx restart\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("h5",{attrs:{id:"静态网页配置doc-原型"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#静态网页配置doc-原型"}},[s._v("#")]),s._v(" 静态网页配置doc&原型")]),s._v(" "),n("p",[n("img",{staticStyle:{zoom:"67%"},attrs:{src:"_image/02.nginx常用设置及实践/71771498.png",alt:"image-20210220235532607"}}),n("img",{staticStyle:{zoom:"67%"},attrs:{src:"_image/02.nginx常用设置及实践/48f103a8-a133-4c92-a382-3bfefd81a0fb.png",alt:"image-20210220235532607"}})]),s._v(" "),n("h5",{attrs:{id:"多域名及配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#多域名及配置"}},[s._v("#")]),s._v(" 多域名及配置")]),s._v(" "),n("blockquote",[n("p",[s._v("由于多个项目的nginx配置和日志等最好分开维护和部署，所以利用nginx模块化功能，分为多个子配置文件。")])]),s._v(" "),n("ul",[n("li",[n("code",[s._v("nginx.conf")]),s._v("：入口文件")])]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 加载其他子nginx配置")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("include")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("conf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("d"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("ul",[n("li",[s._v("服务端渲染服务配置文件 "),n("code",[s._v("/etc/nginx/conf.d/samy.ssr.com.conf")])])]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v(" samy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ssr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 域名")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("access_log")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("web_deployment"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("log"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("samy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ssr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("access"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("error_log")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("web_deployment"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("log"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("samy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ssr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("error"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ssr "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("sites"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ssr"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 代理到服务器本地3000端口上")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" Host samyz"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ssr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v("   X"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Forwarded"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("For  "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$proxy_add_x_forwarded_for")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v("   X"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Real"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("IP        "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" referer "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://$host"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("break")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br")])]),n("ul",[n("li",[s._v("文档站点静态资源配置文件 "),n("code",[s._v("/etc/nginx/conf.d/samy.docs.com.conf")])])]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v(" samyz"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("docs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 域名")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("access_log")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("web_deployment"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("log"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("samy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("docs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("access"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("error_log")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("web_deployment"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("log"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("samy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("docs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("error"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("docs "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("sites"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("docs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("e "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$request_filename")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rewrite")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("^")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("docs"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("h5",{attrs:{id:"其他案例"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#其他案例"}},[s._v("#")]),s._v(" 其他案例")]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8081")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("  test"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[s._v("重启Nginx，用浏览器访问 "),n("a",{attrs:{href:"http://test.com:8081",target:"_blank",rel:"noopener noreferrer"}},[s._v("test.com:8081"),n("OutboundLink")],1),s._v(" ，会发现无法访问。这因为在Host文件中还没把 test.com 指向 127.0.0.1 。")]),s._v(" "),n("p",[s._v("这里推荐一个修改 Host 的工具（Switchhosts!），可以自行百度搜索下载安装，修改好Host文件后，重新用浏览器访问 "),n("a",{attrs:{href:"http://test.com:8081",target:"_blank",rel:"noopener noreferrer"}},[s._v("test.com:8081"),n("OutboundLink")],1),s._v(" ，访问结果会和访问 http://localhost:80 的页面一样。")]),s._v(" "),n("h3",{attrs:{id:"静态资源"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#静态资源"}},[s._v("#")]),s._v(" 静态资源")]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("www"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 根目录")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("autoindex")]),s._v(" on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 自动显示目录下的index.html页面")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("expires")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("d"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 缓存30天")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" \\"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("png"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("gif"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("jpg"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("jpeg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("$ "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("static"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("autoindex")]),s._v(" on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("access_log")]),s._v("  off"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("expires")]),s._v("     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("h"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置过期时间为10小时")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("p",[s._v("匹配以 "),n("code",[s._v("png|gif|jpg|jpeg")]),s._v("为结尾的请求，并将请求转发到本地路径， "),n("code",[s._v("root")]),s._v("中指定的路径即nginx本地路径。同时也可以进行一些缓存的设置。")]),s._v(" "),n("h3",{attrs:{id:"请求过滤"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#请求过滤"}},[s._v("#")]),s._v(" 请求过滤")]),s._v(" "),n("h4",{attrs:{id:"根据状态码过滤"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#根据状态码过滤"}},[s._v("#")]),s._v(" 根据状态码过滤")]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("error_page")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("501")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("502")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("504")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("506")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("x"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("x"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#将跟路径改编为存放html的路径。")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("static"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h4",{attrs:{id:"根据url名称过滤"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#根据url名称过滤"}},[s._v("#")]),s._v(" 根据URL名称过滤")]),s._v(" "),n("blockquote",[n("p",[s._v("根据URL名称过滤，精准匹配URL，不匹配的URL全部重定向到主页;")])]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rewrite")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("^")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("$ "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html  redirect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h4",{attrs:{id:"根据请求类型过滤"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#根据请求类型过滤"}},[s._v("#")]),s._v(" 根据请求类型过滤")]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$request_method")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("^")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("GET"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("POST"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("HEAD"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("$ "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("403")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h4",{attrs:{id:"示范【推荐】"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#示范【推荐】"}},[s._v("#")]),s._v(" 示范【推荐】")]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("worker_processes")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("events")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("worker_connections")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("include")]),s._v("       mime"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("types")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default_type")]),s._v("  application"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("octet"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("stream"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("access_log")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("local"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("logs"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("access"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#nginx请求日志地址")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sendfile")]),s._v("        on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("keepalive_timeout")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("65")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v("       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("  localhost"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v("   html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("htm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 前端")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("blog "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("sites"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("autoindex")]),s._v(" on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("expires")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("d"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 缓存30天")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("e "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$request_filename")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rewrite")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("^")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("blog"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 后端，只转发 /blog/api 开头的请求")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("blog"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("api "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_redirect")]),s._v("     off"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v("   Host             "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 传递域名")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v("   X"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Real"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("IP        "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 传递ip")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v("   X"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Forwarded"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("For  "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$proxy_add_x_forwarded_for")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v("   X"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Scheme         "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$scheme")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("      "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 传递协议")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# redirect server error pages to the static page /50x.html")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("error_page")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("502")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("504")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("x"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("x"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v("   html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br")])]),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v("       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#静态文件及服务器")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("home"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("samy"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("deploy"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("xx"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("web"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("vue"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("  web"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("xx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#接口处理")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("api"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Real"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("IP "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Forwarded"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("For "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$proxy_add_x_forwarded_for")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" Host "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$http_host")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("NginX"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Proxy")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("localhost"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7002")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_redirect")]),s._v(" off"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#上传文件处理")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("uploads"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Real"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("IP "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Forwarded"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("For "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$proxy_add_x_forwarded_for")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" Host "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$http_host")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("NginX"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Proxy")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("localhost"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7002")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_redirect")]),s._v(" off"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#websocket处理")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("socket"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_http_version")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" Upgrade "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$http_upgrade")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" Connection "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"upgrade"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Forwarded"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("For "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$proxy_add_x_forwarded_for")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" Host "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("localhost"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7002")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# index  index.html;")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try_files")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n       "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n     "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("api"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("statistics"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("person"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("^")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("\\"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("jpg"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("jpeg"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("gif"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("png"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("ico"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("css"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("js"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("pdf"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("txt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("var"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("www"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("pro"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mall"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("current"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("public\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 图片样式缓存1年")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("app"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("\\"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("js"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("css"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("png"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("jpg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("$"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("access_log")]),s._v(" off"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("expires")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("365")]),s._v("d"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# html/xml/json 文件不缓存")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("app"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("\\"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("manifest"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("appcache"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("html"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("xml"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("json"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("$"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("expires")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br")])]),n("h3",{attrs:{id:"代理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#代理"}},[s._v("#")]),s._v(" 代理")]),s._v(" "),n("p",[n("strong",[s._v("代理")]),s._v("是在服务器和客户端之间假设的一层服务器，"),n("strong",[s._v("代理")]),s._v("将接收客户端的请求并将它转发给服务器，然后将服务端的响应转发给客户端。")]),s._v(" "),n("p",[s._v("不管是正向代理还是反向代理，实现的都是上面的功能。")]),s._v(" "),n("p",[s._v("代理有正向代理和反向代理两种，都是用"),n("code",[s._v("proxy_pass")]),s._v("指令来实现。")]),s._v(" "),n("ul",[n("li",[s._v("一句话解释正向代理，正向代理的对象是用户，用户知道访问那个服务器，而服务器"),n("strong",[s._v("不知道")]),s._v("是哪个用户访问它。")]),s._v(" "),n("li",[s._v("一句话解释反向代理，反向代理的对象是服务器，用户"),n("strong",[s._v("不知道")]),s._v("访问了哪个服务器，而服务器知道那个用户访问它。")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(1260),alt:"image"}})]),s._v(" "),n("p",[n("strong",[s._v("正向代理")]),s._v("是为我们服务的，即为客户端服务的，客户端可以根据正向代理访问到它本身无法访问到的服务器资源。")]),s._v(" "),n("p",[n("strong",[s._v("正向代理")]),s._v("对我们是透明的，对服务端是非透明的，即服务端并不知道自己收到的是来自代理的访问还是来自真实客户端的访问。")]),s._v(" "),n("p",[n("strong",[s._v("相关设置")])]),s._v(" "),n("ul",[n("li",[n("code",[s._v("server_name")]),s._v("指令主要用于配置基于名称虚拟主机")]),s._v(" "),n("li",[n("code",[s._v("gzip")]),s._v("的作用是是否需要开启压缩传输")]),s._v(" "),n("li",[n("code",[s._v("location")]),s._v("指令用于匹配 URL")]),s._v(" "),n("li",[n("code",[s._v("proxy_pass")]),s._v("指令用于设置被代理服务器的地址")]),s._v(" "),n("li",[n("code",[s._v("proxy_set_header")]),s._v("用来设定被代理服务器接收到的header信息（请求头）")])]),s._v(" "),n("h4",{attrs:{id:"正向代理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#正向代理"}},[s._v("#")]),s._v(" 正向代理")]),s._v(" "),n("p",[s._v("正向代理是为客户端服务的，通过代理客户端的请求，去访问客户端本身无法直接访问的服务器，"),n("strong",[s._v("翻墙工具就是最常见的正向代理。正向代理对于客户端透明，对于服务器端不透明。")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(1261),alt:"正向代理"}})]),s._v(" "),n("p",[s._v("nginx配置示例：")]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("resolver")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.8")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".8")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".8")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("       "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#指定DNS服务器IP地址 ")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("     "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设定代理服务器的协议和地址 ")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" HOST "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_buffers")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("256")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_max_temp_file_size")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_connect_timeout")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_send_timeout")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_read_timeout")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_next_upstream")]),s._v(" error "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("timeout")]),s._v(" invalid_header http_502"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("resolver")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.8")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".8")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".8")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 谷歌的域名解析地址")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 当客户端请求我的时候，我会把请求转发给它      ")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# $http_host 要访问的主机名 $request_uri 请求路径      ")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$http_host")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$request_uri")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("h4",{attrs:{id:"反向代理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#反向代理"}},[s._v("#")]),s._v(" 反向代理")]),s._v(" "),n("p",[s._v("反向代理是指为服务端服务的，反向代理接收来自客户端的请求，帮助服务器进行请求转发、负载均衡等。"),n("strong",[s._v("通常解决前端跨域问题也是通过反向代理实现的。反向代理对于服务端是透明的，对于客户端是不透明的。")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(1262),alt:"反向代理"}})]),s._v(" "),n("p",[s._v("nginx配置示例：")]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v("       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("  xx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" 监听地址\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v(" html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" xx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("b"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" 请求转向地址\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" 设置默认页\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("p",[n("strong",[s._v("nginx 反向代理时丢失端口的解决方案")])]),s._v(" "),n("p",[s._v("nginx没有正确的把端口信息传送到后端，没能正确的配置nginx，下面这行是关键")]),s._v(" "),n("p",[s._v("proxy_set_header Host $host:$server_port; 这一行是关键。")]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# the 90 port")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("90")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v(" xxxx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Forwarded"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Host "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Forwarded"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Server")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Forwarded"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("For "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$proxy_add_x_forwarded_for")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" Host "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$server_port")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#这里是重点,这样配置才不会丢失端口")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9001")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("x"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v(" html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("h3",{attrs:{id:"负载均衡"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#负载均衡"}},[s._v("#")]),s._v(" 负载均衡")]),s._v(" "),n("p",[s._v("负载均衡是指nginx将大量客户端的请求合理地分配到各个服务器上，以达到资服务端资源的充分利用和更快的响应请求。")]),s._v(" "),n("h4",{attrs:{id:"后端服务器状态"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#后端服务器状态"}},[s._v("#")]),s._v(" 后端服务器状态")]),s._v(" "),n("p",[s._v("后端服务器支持以下的状态配置：")]),s._v(" "),n("ul",[n("li",[s._v("down：当前服务器不参与负载均衡")]),s._v(" "),n("li",[s._v("backup：当其他节点都无法使用时的备用服务器")]),s._v(" "),n("li",[s._v("max_fails：允许请求失败的次数，若到达就会休眠")]),s._v(" "),n("li",[s._v("fail_timeout：经过max_fails次失败后，服务器的暂停时间，默认为10s")]),s._v(" "),n("li",[s._v("max_conns：限制每个服务器的最大接收连接数")])]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" samyz "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("66")]),s._v(" down"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("77")]),s._v(" backup"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("88")]),s._v("  max_fails"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" fail_timeout"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("s"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("99")]),s._v(" max_conns"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[n("img",{attrs:{src:a(1263),alt:"img"}})]),s._v(" "),n("p",[s._v("示范：")]),s._v(" "),n("p",[n("img",{staticStyle:{zoom:"67%"},attrs:{src:"_image/02.nginx常用设置及实践/71607014.png",alt:"image-20210220235532607"}}),n("img",{staticStyle:{zoom:"67%"},attrs:{src:"_image/02.nginx常用设置及实践/71619054.png",alt:"image-20210220235532607"}})]),s._v(" "),n("h4",{attrs:{id:"负载策略"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#负载策略"}},[s._v("#")]),s._v(" 负载策略")]),s._v(" "),n("p",[s._v("实现负载均衡有几种方案")]),s._v(" "),n("ul",[n("li",[n("strong",[s._v("轮询(默认）")]),s._v("，每个请求按照时间顺序轮流分配到不同的后端服务器，如果某台后端服务器宕机，Nginx 轮询列表会自动将它去除掉。")]),s._v(" "),n("li",[n("strong",[s._v("weight(加权轮询)")]),s._v("，轮询的加强版，weight 和访问几率成正比，主要用于后端服务器性能不均的场景。")]),s._v(" "),n("li",[n("strong",[s._v("ip_hash")]),s._v("，每个请求按照访问 IP 的 hash 结果分配，这样每个访问可以固定访问一个后端服务器。")]),s._v(" "),n("li",[n("strong",[s._v("url_hash")]),s._v("，按照访问 URL 的 hash 结果来分配请求，使得每个URL定向到同一个后端服务器上，主要应用于后端服务器为缓存时的场景。")]),s._v(" "),n("li",[n("strong",[s._v("自定义hash")]),s._v("，基于任意关键字作为 hash key 实现 hash 算法的负载均衡")]),s._v(" "),n("li",[n("strong",[s._v("fair")]),s._v("，按照后端服务器的响应时间来分配请求，响应时间短则优先分配。")])]),s._v(" "),n("p",[s._v("示范：在需要使用负载均衡的server中增加")]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" backserver"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ip_hash")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9090")]),s._v(" down"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("down 表示单前的"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v("暂时不参与负载"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(" weight"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("weight 默认为"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.")]),s._v("weight越大，负载的权重就越大"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6060")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7070")]),s._v(" backup"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("其它所有的非backup机器down或者忙的时候，请求backup机器"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("backserver"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("ul",[n("li",[s._v("max_fails ：允许请求失败的次数默认为1.当超过最大次数时，返回proxy_next_upstream 模块定义的错误。")]),s._v(" "),n("li",[s._v("fail_timeout:max_fails次失败后，暂停的时间。")])]),s._v(" "),n("h5",{attrs:{id:"轮询-默认"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#轮询-默认"}},[s._v("#")]),s._v(" 轮询 默认")]),s._v(" "),n("p",[s._v("默认策略，遍历服务器节点列表，逐一分配请求，如果服务器down掉，自动剔除。")]),s._v(" "),n("p",[s._v("轮询即Round Robin，根据Nginx配置文件中的顺序，依次把客户端的Web请求分发到不同的后端服务器。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("upstream backserver {\n    server 192.168.0.14;\n    server 192.168.0.15;\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h5",{attrs:{id:"加权轮询-weight"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#加权轮询-weight"}},[s._v("#")]),s._v(" 加权轮询 weight")]),s._v(" "),n("p",[s._v("每台服务器有不同的权重，一般权重越大意味着该服务器的性能越好，可以承载更多的请求。")]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" balanceServer "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".14")]),s._v(" weight"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".15")]),s._v(" weight"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("权重越高，在被访问的概率越大，如上例，分别是30%，70%。")]),s._v(" "),n("h5",{attrs:{id:"客户端ip绑定-ip-hash"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#客户端ip绑定-ip-hash"}},[s._v("#")]),s._v(" 客户端ip绑定  ip_hash")]),s._v(" "),n("p",[s._v("前述的两种负载均衡方案中，同一客户端连续的Web请求可能会被分发到不同的后端服务器进行处理，因此如果涉及到会话Session，那么会话会比较复杂。常见的是基于数据库的会话持久化。要克服上面的难题，可以使用基于IP地址哈希的负载均衡方案。这样的话，同一客户端连续的Web请求都会被分发到同一服务器进行处理。[将来自同一个ip的请求永远只分配给一台固定的服务器。]")]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" balanceServer "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ip_hash")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".14")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("88")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".15")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h5",{attrs:{id:"最快响应时间-fair"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#最快响应时间-fair"}},[s._v("#")]),s._v(" 最快响应时间 fair")]),s._v(" "),n("p",[s._v("按后端服务器的响应时间来分配请求，响应时间短的优先分配。")]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" balanceServer "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    fair"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.1")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".2")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.1")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".2")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".4")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" server1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" server2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("h5",{attrs:{id:"最小连接-least-conn"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#最小连接-least-conn"}},[s._v("#")]),s._v(" 最小连接 least_conn")]),s._v(" "),n("p",[s._v("将请求优先分配给压力较小的服务器，避免压力大的服务器添加更多的请求。")]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" balanceServer "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    least_conn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.1")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".2")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.1")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".2")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".4")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.1")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".2")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".5")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("h5",{attrs:{id:"访问-url-hash"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#访问-url-hash"}},[s._v("#")]),s._v(" 访问 url_hash")]),s._v(" "),n("p",[s._v("按访问url的hash结果来分配请求，使每个url定向到同一个（对应的）后端服务器，后端服务器为缓存时比较有效。")]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" backserver "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" squid1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3128")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" squid2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3128")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    hash "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$request_uri")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    hash_method crc32"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("h4",{attrs:{id:"配置示例"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置示例"}},[s._v("#")]),s._v(" 配置示例")]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#user  nobody;")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("worker_processes")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("events")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("worker_connections")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 最大并发数")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 待选服务器列表")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" balanceServer "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.1")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".2")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.1")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".2")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".4")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.1")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".2")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".5")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("  xx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("api "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("balanceServer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br")])]),n("h3",{attrs:{id:"配置gzip"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置gzip"}},[s._v("#")]),s._v(" 配置gzip")]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[s._v("    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("gzip")]),s._v("                    on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("gzip_http_version")]),s._v("       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("gzip_comp_level")]),s._v("         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("gzip_min_length")]),s._v("         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("gzip_types")]),s._v(" text"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("csv text"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("xml text"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("css text"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("plain text"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("javascript application"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("javascript application"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("x"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("javascript application"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("json application"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("xml"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("gzip_disable")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"MSIE [1-6]\\."')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("     "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# IE6无效")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("\\"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("jpg"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("png"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("gif"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("$ "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("    \n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("gzip")]),s._v(" off"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#关闭压缩    ")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("www"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("images"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("\\"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("html"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("js"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("css"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("$ "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("    \n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("gzip")]),s._v(" on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启用压缩    ")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("gzip_min_length")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 超过1K的文件才压缩    ")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("gzip_http_version")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启用gzip压缩所需的HTTP最低版本    ")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("gzip_comp_level")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 压缩级别，压缩比率越高，文件被压缩的体积越小    ")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("gzip_types")]),s._v(" text"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("css application"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("javascript"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进行压缩的文件类型   ")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("www"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("p",[s._v("并不是每个浏览器都支持 "),n("code",[s._v("gzip")]),s._v("的，如何知道"),n("strong",[s._v("客户端是否支持 "),n("code",[s._v("gzip")]),s._v("呢，请求头中的 "),n("code",[s._v("Accept-Encoding")]),s._v("来标识对压缩的支持")]),s._v("。")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1264),alt:"image-20210122001003105"}})]),s._v(" "),n("p",[s._v("启用 "),n("code",[s._v("gzip")]),s._v("同时需要客户端和服务端的支持，如果客户端支持 "),n("code",[s._v("gzip")]),s._v("的解析，那么只要服务端能够返回 "),n("code",[s._v("gzip")]),s._v("的文件就可以启用 "),n("code",[s._v("gzip")]),s._v("了,我们可以通过 "),n("code",[s._v("nginx")]),s._v("的配置来让服务端支持 "),n("code",[s._v("gzip")]),s._v("。"),n("strong",[s._v("下面的 "),n("code",[s._v("respone")]),s._v("中 "),n("code",[s._v("content-encoding:gzip")]),s._v("，指服务端开启了 "),n("code",[s._v("gzip")]),s._v("的压缩方式。")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(1265),alt:"image-20210122001032928"}})]),s._v(" "),n("h4",{attrs:{id:"gzip"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#gzip"}},[s._v("#")]),s._v(" gzip")]),s._v(" "),n("ul",[n("li",[s._v("开启或者关闭 "),n("code",[s._v("gzip")]),s._v("模块")]),s._v(" "),n("li",[s._v("默认值为 "),n("code",[s._v("off")])]),s._v(" "),n("li",[s._v("可配置为 "),n("code",[s._v("on/off")])])]),s._v(" "),n("h4",{attrs:{id:"gziphttpversion"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#gziphttpversion"}},[s._v("#")]),s._v(" gziphttpversion")]),s._v(" "),n("ul",[n("li",[s._v("启用 "),n("code",[s._v("GZip")]),s._v(" 所需的 "),n("code",[s._v("HTTP")]),s._v(" 最低版本")]),s._v(" "),n("li",[s._v("默认值为 "),n("code",[s._v("HTTP/1.1")])])]),s._v(" "),n("p",[n("code",[s._v("HTTP/1.1")]),s._v("默认支持 "),n("code",[s._v("TCP")]),s._v("持久连接， "),n("code",[s._v("HTTP/1.0")]),s._v(" 也可以通过显式指定 "),n("code",[s._v("Connection:keep-alive")]),s._v("来启用持久连接。对于 "),n("code",[s._v("TCP")]),s._v("持久连接上的 "),n("code",[s._v("HTTP")]),s._v(" 报文，客户端需要一种机制来准确判断结束位置，而在 "),n("code",[s._v("HTTP/1.0")]),s._v("中，这种机制只有 "),n("code",[s._v("Content-Length")]),s._v("。而在 "),n("code",[s._v("HTTP/1.1")]),s._v("中新增的 "),n("code",[s._v("Transfer-Encoding:chunked")]),s._v(" 所对应的分块传输机制可以完美解决这类问题。")]),s._v(" "),n("p",[n("code",[s._v("nginx")]),s._v("同样有着配置 "),n("code",[s._v("chunked的")]),s._v("属性 "),n("code",[s._v("chunked_transfer_encoding")]),s._v("，这个属性是默认开启的。")]),s._v(" "),n("p",[n("code",[s._v("Nginx")]),s._v("在启用了 "),n("code",[s._v("GZip")]),s._v("的情况下，不会等文件 "),n("code",[s._v("GZip")]),s._v(" 完成再返回响应，而是边压缩边响应，这样可以显著提高 "),n("code",[s._v("TTFB")]),s._v("( "),n("code",[s._v("TimeToFirstByte")]),s._v("，首字节时间，WEB 性能优化重要指标)。这样唯一的问题是， "),n("code",[s._v("Nginx")]),s._v(" 开始返回响应时，它无法知道将要传输的文件最终有多大，也就是无法给出 "),n("code",[s._v("Content-Length")]),s._v("这个响应头部。")]),s._v(" "),n("p",[s._v("所以，在 "),n("code",[s._v("HTTP1.0")]),s._v("中如果利用 "),n("code",[s._v("Nginx")]),s._v("启用了 "),n("code",[s._v("GZip")]),s._v("，是无法获得 "),n("code",[s._v("Content-Length")]),s._v("的，这导致HTTP1.0中开启持久链接和使用 "),n("code",[s._v("GZip")]),s._v("只能二选一，所以在这里 "),n("code",[s._v("gzip_http_version")]),s._v("默认设置为 "),n("code",[s._v("1.1")]),s._v("。")]),s._v(" "),n("h4",{attrs:{id:"gzipcomplevel"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#gzipcomplevel"}},[s._v("#")]),s._v(" gzipcomplevel")]),s._v(" "),n("ul",[n("li",[s._v("压缩级别，级别越高压缩率越大，当然压缩时间也就越长（传输快但比较消耗cpu）。")]),s._v(" "),n("li",[s._v("默认值为 "),n("code",[s._v("1")])]),s._v(" "),n("li",[s._v("压缩级别取值为 "),n("code",[s._v("1-9")])])]),s._v(" "),n("h4",{attrs:{id:"gzipminlength"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#gzipminlength"}},[s._v("#")]),s._v(" gzipminlength")]),s._v(" "),n("ul",[n("li",[s._v("设置允许压缩的页面最小字节数， "),n("code",[s._v("Content-Length")]),s._v("小于该值的请求将不会被压缩")]),s._v(" "),n("li",[s._v("默认值: "),n("code",[s._v("0")])]),s._v(" "),n("li",[n("strong",[s._v("当设置的值较小时，压缩后的长度可能比原文件大，建议设置 "),n("code",[s._v("1000")]),s._v("以上")])])]),s._v(" "),n("h4",{attrs:{id:"gzip-types"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#gzip-types"}},[s._v("#")]),s._v(" gzip_types")]),s._v(" "),n("ul",[n("li",[s._v("要采用gzip压缩的文件类型( "),n("code",[s._v("MIME")]),s._v("类型)")]),s._v(" "),n("li",[n("strong",[s._v("默认值: "),n("code",[s._v("text/html")]),s._v("(默认不压缩 "),n("code",[s._v("js")]),s._v("/ "),n("code",[s._v("css")]),s._v(")")])])]),s._v(" "),n("h3",{attrs:{id:"请求限制"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#请求限制"}},[s._v("#")]),s._v(" 请求限制")]),s._v(" "),n("p",[s._v("对于大流量恶意的访问，会造成带宽的浪费，给服务器增加压力。往往对于同一 IP 的连接数以及并发数进行限制。关于请求限制主要有两种类型：")]),s._v(" "),n("ul",[n("li",[s._v("limit_conn_module 连接频率限制")]),s._v(" "),n("li",[s._v("limit_req_module 请求频率限制")])]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# $binary_remote_addr 远程IP地址 zone 区域名称 10m内存区域大小")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("limit_conn_zone")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$binary_remote_addr")]),s._v(" zone"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("coon_zone"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("m"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("limit_conn")]),s._v(" conn_zone "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# conn_zone 设置对应的共享内存区域 1是限制的数量")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# $binary_remote_addr 远程IP地址 zone 区域名称 10m内存区域大小 rate 为请求频率 1s 一次")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("limit_req_zone")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$binary_remote_addr")]),s._v(" zone"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("req_zone"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("m rate"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("r"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("s"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置对应的共享内存区域 burst最大请求数阈值 nodelay不希望超过的请求被延迟")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("limit_req")]),s._v(" zone"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("req_zone burst"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" nodelay"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("h3",{attrs:{id:"访问控制"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#访问控制"}},[s._v("#")]),s._v(" 访问控制")]),s._v(" "),n("blockquote",[n("p",[n("strong",[s._v("快速实现简单的访问限制")])])]),s._v(" "),n("p",[s._v("关于访问控制主要有两种类型：")]),s._v(" "),n("ul",[n("li",[s._v("-http_access_module 基于 IP 的访问控制")]),s._v(" "),n("li",[s._v("-http_auth_basic_module 基于用户的信任登陆")])]),s._v(" "),n("p",[s._v("经常会遇到希望网站让某些特定用户的群体（比如只让公司内网）访问，或者控制某个uri不让人访问。")]),s._v(" "),n("p",[s._v("以下是基于 IP 的访问控制：")]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("^")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 匹配 index.html 页面 除了 127.0.0.1 以外都可以访问")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("deny")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("allow")]),s._v(" all"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("deny")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".100")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("allow")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".10")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("allow")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.110")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".50")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".16")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("deny")]),s._v("  all"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("h3",{attrs:{id:"配置socket-文件资源"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置socket-文件资源"}},[s._v("#")]),s._v(" 配置socket/文件资源")]),s._v(" "),n("p",[n("img",{staticStyle:{zoom:"67%"},attrs:{src:a(1266),alt:"image-20210122001032928"}}),n("img",{staticStyle:{zoom:"67%"},attrs:{src:a(1267),alt:"image-20210122001032928"}})]),s._v(" "),n("h3",{attrs:{id:"配置http-https"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置http-https"}},[s._v("#")]),s._v(" 配置http/https")]),s._v(" "),n("blockquote",[n("p",[s._v("详细配置请参考下文的配置https/http")])]),s._v(" "),n("h4",{attrs:{id:"简单示例【推荐】"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#简单示例【推荐】"}},[s._v("#")]),s._v(" 简单示例【推荐】")]),s._v(" "),n("p",[n("img",{staticStyle:{zoom:"67%"},attrs:{src:a(1268),alt:"image-20210122001032928"}}),n("img",{staticStyle:{zoom:"67%"},attrs:{src:a(1269),alt:"image-20210122001032928"}})]),s._v(" "),n("h3",{attrs:{id:"适配pc与移动环境"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#适配pc与移动环境"}},[s._v("#")]),s._v(" "),n("strong",[s._v("适配PC与移动环境")])]),s._v(" "),n("p",[s._v("现在很多网站都存在PC站和H5站两个站点，因此根据用户的浏览环境自动切换站点是很常见的需求。Nginx可以通过内置变量$http_user_agent，获取到请求客户端的userAgent，从而知道用户处于移动端还是PC，进而控制重定向到H5站还是PC站。")]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 移动端设备匹配")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$http_user_agent")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'(Android|webOS|iPhone|iPad|BlackBerry)'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$mobile_request")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$mobile_request")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rewrite")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("^")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("https")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mobile"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com \n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("h3",{attrs:{id:"合并请求"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#合并请求"}},[s._v("#")]),s._v(" "),n("strong",[s._v("合并请求")])]),s._v(" "),n("p",[s._v("前端性能优化中重要一点就是尽量减少http资源请求的数量。通过"),n("a",{attrs:{href:"https://github.com/alibaba/nginx-http-concat",target:"_blank",rel:"noopener noreferrer"}},[s._v("nginx-http-concat"),n("OutboundLink")],1),s._v("模块（淘宝开发的第三方模块，需要单独安装）用一种特殊的请求url规则")]),s._v(" "),n("h3",{attrs:{id:"图片处理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#图片处理"}},[s._v("#")]),s._v(" "),n("strong",[s._v("图片处理")])]),s._v(" "),n("p",[s._v("在前端开发中，经常需要不同尺寸的图片。现在的云储存基本对图片都提供有处理服务（一般是通过在图片链接上加参数）;在前端开发中，我们有时会需要不同尺寸的图片，而一些云服务都提供有带链接上添加参数来获取不同大小图片的服务。我们可以通过使用一个非基本模块（需安装）"),n("code",[s._v("ngx_http_image_filter_module")]),s._v("来实现。")]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[s._v("   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 图片缩放处理")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这里约定的图片处理url格式：以 mysite-base.com/img/路径访问")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("img"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("$ "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alias")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("Users"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("cc"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("Desktop"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("static"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("image"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("$"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#图片服务端储存地址")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$width")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#图片宽度默认值")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$height")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#图片高度默认值")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$arg_width")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$width")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$arg_width")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$arg_height")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$height")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$arg_height")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("image_filter")]),s._v(" resize "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$width")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$height")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置图片宽高")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("image_filter_buffer")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("M"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置Nginx读取图片的最大buffer。")]),s._v("\n        image_filter_interlace on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#是否开启图片图像隔行扫描")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("error_page")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("415")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("415.")]),s._v("png"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#图片处理错误提示图，例如缩放参数不是数字")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("h3",{attrs:{id:"防盗链处理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#防盗链处理"}},[s._v("#")]),s._v(" 防盗链处理")]),s._v(" "),n("p",[s._v("因为被大肆盗链使用图片而开启了防盗链处理**，防盗链处理是我们需要开启来保护服务器的一种方式**。")]),s._v(" "),n("p",[n("strong",[s._v("防盗链的原理")]),s._v("就是"),n("strong",[s._v("根据请求头中 referer 得到网页来源，从而实现访问控制。这样可以防止网站资源被非法盗用，从而保证信息安全，减少带宽损耗，减轻服务器压力。")])]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("\\"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("jpg"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("png"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("gif"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("$ "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 匹配防盗链资源的文件类型")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 通过 valid_referers 定义合法的地址白名单 $invalid_referer 不合法的返回403  ")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("valid_referers")]),s._v(" none blocked "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$invalid_referer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("403")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 匹配所有图片")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" \\"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("gif"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("jpg"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("png"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("bmp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("$ "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 验证是否为没有来路，或者有来路与域名或白名单进行匹配，也可以写正则,若匹配到字段为0，否则为1")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("valid_referers")]),s._v(" none blocked server_names www"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ite"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果验证不通过则返回403错误")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$invalid_referer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("403")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("h3",{attrs:{id:"页面内容修改"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#页面内容修改"}},[s._v("#")]),s._v(" "),n("strong",[s._v("页面内容修改")])]),s._v(" "),n("p",[s._v("Nginx可以通过向页面底部或者顶部插入额外的css和js文件，从而实现修改页面内容。")]),s._v(" "),n("h2",{attrs:{id:"性能测试"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#性能测试"}},[s._v("#")]),s._v(" 性能测试")]),s._v(" "),n("h3",{attrs:{id:"ab命令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ab命令"}},[s._v("#")]),s._v(" ab命令")]),s._v(" "),n("p",[s._v("ab命令全称为：Apache bench，是 Apache 自带的压力测试工具，也可以测试 Nginx、IIS 等其他 Web 服务器。")]),s._v(" "),n("ul",[n("li",[s._v("-n 总共的请求数")]),s._v(" "),n("li",[s._v("-c 并发的请求数")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("ab -n "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" -c "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v(" http://127.0.0.1/\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h2",{attrs:{id:"相关链接"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#相关链接"}},[s._v("#")]),s._v(" 相关链接")]),s._v(" "),n("p",[s._v("https://juejin.cn/post/6844903684967825421")]),s._v(" "),n("p",[s._v("https://juejin.cn/post/6844903793918738440")]),s._v(" "),n("p",[s._v("https://www.kancloud.cn/wizardforcel/nginx-doc/92353")])])}),[],!1,null,null,null);t.default=e.exports}}]);