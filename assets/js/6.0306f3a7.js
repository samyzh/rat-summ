(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{1981:function(t,s,a){"use strict";a.r(s);var n=a(14),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h2",{attrs:{id:"http"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#http"}},[t._v("#")]),t._v(" HTTP")]),t._v(" "),n("h3",{attrs:{id:"名称说明"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#名称说明"}},[t._v("#")]),t._v(" 名称说明")]),t._v(" "),n("h4",{attrs:{id:"uri"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#uri"}},[t._v("#")]),t._v(" URI")]),t._v(" "),n("p",[t._v("即统一资源标识符，服务器上每一种资源，比如文档、图像、视频片段、程序 "),n("strong",[t._v('都由一个通用资源标识符（Uniform Resource Identifier, 简称"URI"）进行定位。')])]),t._v(" "),n("h3",{attrs:{id:"概念及发展历史"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#概念及发展历史"}},[t._v("#")]),t._v(" 概念及发展历史")]),t._v(" "),n("p",[n("img",{attrs:{src:a(898),alt:""}})]),t._v(" "),n("h3",{attrs:{id:"http版本的比较【要点】"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#http版本的比较【要点】"}},[t._v("#")]),t._v(" http版本的比较【要点】")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("版本")]),t._v(" "),n("th",[t._v("内容")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("http0.9")]),t._v(" "),n("td",[t._v("只允许客户端发送 GET 这一种请求;且不支持请求头,协议只支持纯文本;无状态性,每个访问独立处理,完成断开;无状态码")])]),t._v(" "),n("tr",[n("td",[t._v("http1.0")]),t._v(" "),n("td",[t._v("解决 0.9 的缺点,"),n("strong",[t._v("增加 If-modify-since(last-modify)和 expires 缓存属性")])])]),t._v(" "),n("tr",[n("td",[t._v("http1.x")]),t._v(" "),n("td",[n("strong",[t._v("增加"),n("code",[t._v("keep-alive")]),t._v(", cache-control 和 If-none-match(etag)缓存属性")])])]),t._v(" "),n("tr",[n("td",[t._v("http2.0")]),t._v(" "),n("td",[n("strong",[t._v("采用二进制格式传输;多路复用;报头压缩;服务器推送")])])]),t._v(" "),n("tr",[n("td",[t._v("http3.0")]),t._v(" "),n("td",[t._v("采用 QUIC 协议,"),n("strong",[t._v("自定义连接机制")]),t._v(";自定义"),n("strong",[t._v("重传机制")]),t._v(";"),n("strong",[t._v("无阻塞的多路复用")])])])])]),t._v(" "),n("p",[n("img",{attrs:{src:a(899),alt:""}})]),t._v(" "),n("h4",{attrs:{id:"http-0-9"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#http-0-9"}},[t._v("#")]),t._v(" HTTP 0.9")]),t._v(" "),n("ul",[n("li",[t._v("只允许客户端发送 GET 这一种请求；")]),t._v(" "),n("li",[t._v("且不支持请求头，协议只支持纯文本；")]),t._v(" "),n("li",[t._v("无状态性，每个访问独立处理，完成断开；")]),t._v(" "),n("li",[t._v("无状态码。")])]),t._v(" "),n("h4",{attrs:{id:"http-1-0"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#http-1-0"}},[t._v("#")]),t._v(" HTTP 1.0")]),t._v(" "),n("p",[t._v("有身份认证，三次握手； 请求与响应支持头域； 请求头内容；")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("属性名")]),t._v(" "),n("th",[t._v("含义")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("Accept")]),t._v(" "),n("td",[t._v("可接受的 MIME 类型")])]),t._v(" "),n("tr",[n("td",[t._v("Accept-Encoding")]),t._v(" "),n("td",[t._v("数据可解码的格式")])]),t._v(" "),n("tr",[n("td",[t._v("Accept-Language")]),t._v(" "),n("td",[t._v("可接受语言")])]),t._v(" "),n("tr",[n("td",[t._v("Connection")]),t._v(" "),n("td",[t._v("值 keep-alive 是长连接")])]),t._v(" "),n("tr",[n("td",[t._v("Host")]),t._v(" "),n("td",[t._v("主机和端口")])]),t._v(" "),n("tr",[n("td",[t._v("Pragma")]),t._v(" "),n("td",[t._v("是否缓存,指定 no-cache 返回刷新")])]),t._v(" "),n("tr",[n("td",[t._v("Referer")]),t._v(" "),n("td",[t._v("页面路由")])]),t._v(" "),n("tr",[n("td",[n("strong",[t._v("If-Modified-Since")])]),t._v(" "),n("td",[n("strong",[t._v("值为时间")])])])])]),t._v(" "),n("p",[t._v("响应头内容；")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("属性名")]),t._v(" "),n("th",[t._v("含义")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("Connection")]),t._v(" "),n("td",[t._v("值 keep-alive 是长连接")])]),t._v(" "),n("tr",[n("td",[t._v("Content-Type")]),t._v(" "),n("td",[t._v("返回文档类型,常见的值有 text/plain,text/html,text/json")])]),t._v(" "),n("tr",[n("td",[t._v("Date")]),t._v(" "),n("td",[t._v("消息发送的时间")])]),t._v(" "),n("tr",[n("td",[t._v("Server")]),t._v(" "),n("td",[t._v("服务器名字")])]),t._v(" "),n("tr",[n("td",[n("strong",[t._v("Last-Modified")])]),t._v(" "),n("td",[n("strong",[t._v("值为时间,s 返回的最后修改时间")])])]),t._v(" "),n("tr",[n("td",[n("strong",[t._v("Expires")])]),t._v(" "),n("td",[n("strong",[t._v("缓存过期时间,b 和 s 时间做对比")])])])])]),t._v(" "),n("p",[n("strong",[t._v("注意")])]),t._v(" "),n("ul",[n("li",[t._v("expires 是响应头内容，返回一个固定的时间, 缺陷是时间到了服务器要重新设置;")]),t._v(" "),n("li",[t._v("请求头中如果有 If-Modified-Since，服务器会将时间与 last-modified 对比，相同返回 304;")]),t._v(" "),n("li",[t._v("响应对象以一个响应状态行开始;")]),t._v(" "),n("li",[t._v("响应对象不只限于超文本;")]),t._v(" "),n("li",[t._v("支持 GET、HEAD、POST 方法;")]),t._v(" "),n("li",[t._v("有状态码;")]),t._v(" "),n("li",[t._v("支持长连接（但默认还是使用短连接）、缓存机制以及身份认证。")])]),t._v(" "),n("h4",{attrs:{id:"http-1-1"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#http-1-1"}},[t._v("#")]),t._v(" HTTP 1.1")]),t._v(" "),n("p",[n("strong",[t._v("请求头增加 Cache-Control， If-None-Match")])]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",{staticStyle:{"text-align":"left"}},[t._v("属性名")]),t._v(" "),n("th",[t._v("含义")])])]),t._v(" "),n("tbody",[n("tr",[n("td",{staticStyle:{"text-align":"left"}},[t._v("Cache-Control")]),t._v(" "),n("td",[t._v("在1.1 引入的方法,指定请求和响应遵循的缓存机制,值有:public(b 和 s 都缓存),private(b 缓存),no-cache(不缓存),no-store(不缓存),max-age(缓存时间,s 为单位),min-fresh(最小更新时间),max-age=3600")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"left"}},[t._v("If-None-Match")]),t._v(" "),n("td",[t._v("上次请求响应头返回的 etag 值响应头增加 Cache-Control，表示所有的缓存机制是否可以缓存及哪种类型 etag 返回的哈希值,第二次请求头携带去和服务器值对比")])])])]),t._v(" "),n("p",[n("strong",[t._v("注意")]),t._v(": Cache-Control 的 "),n("strong",[t._v("max-age 返回是缓存的相对时间")]),t._v(" Cache-Control 优先级比 expires 高; 缺点：不能第一时间拿到最新修改文件")]),t._v(" "),n("h4",{attrs:{id:"http-2-0"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#http-2-0"}},[t._v("#")]),t._v(" HTTP 2.0")]),t._v(" "),n("blockquote",[n("h4",{attrs:{id:"http2-与-http1-1-有什么不同"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#http2-与-http1-1-有什么不同"}},[t._v("#")]),t._v(" http2 与 http1.1 有什么不同")])]),t._v(" "),n("ul",[n("li",[t._v("采用二进制格式传输; 分帧传输；")]),t._v(" "),n("li",[t._v("多路复用，其实就是"),n("strong",[t._v("将请求数据分成帧乱序发送到 TCP")]),t._v(" 中。"),n("strong",[t._v("TCP 只能有一个 steam")]),t._v("，所以还是会阻塞;")]),t._v(" "),n("li",[t._v("报头压缩;")]),t._v(" "),n("li",[t._v("服务器推送主动向 B 端发送静态资源，避免往返延迟。（server push）")])]),t._v(" "),n("blockquote",[n("p",[t._v("HTTP/2主要的目标就是改进性能，兼容HTTP/1.1")])]),t._v(" "),n("p",[t._v("问题1： HTTP/1.1 中只优化了 body （ gzip 压缩）并没有对头部进行处理")]),t._v(" "),n("p",[t._v("问题2： HTTP/1.1 问题在于当前请求未得到响应时，不能复用通道再次发送请求。需要")]),t._v(" "),n("p",[t._v("开启"),n("strong",[t._v("新的TCP连接")]),t._v("发送请求这就是我们所谓的管线化，但是后续的响应要遵循FIFO原则，如果第一个请求没有返回会被阻塞 **HTTP****队头阻塞问题。 (最多并发的请求是6个)")]),t._v(" "),n("h4",{attrs:{id:"http-3-0"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#http-3-0"}},[t._v("#")]),t._v(" HTTP 3.0")]),t._v(" "),n("p",[n("strong",[t._v("是基于 QUIC 协议，基于 UDP")]),t._v("; HTTP/3 目前还处于草案阶段;")]),t._v(" "),n("p",[t._v("HTTP2 帧中需要封装流， HTTP3 则可以直接使用 Quic 里的stream")]),t._v(" "),n("p",[n("strong",[t._v("特点")]),t._v(":")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("自定义连接机制")]),t._v("：TCP 以 IP/端口标识,变化重新连接握手，UDP 是一 64 位 ID 标识，是无连接；")]),t._v(" "),n("li",[n("code",[t._v("自定义重传机制")]),t._v("：TCP 使用序号和应答传输，QUIC 是使用递增序号传输；")]),t._v(" "),n("li",[n("code",[t._v("无阻塞的多路复用")]),t._v("：同一条 QUIC 可以创建多个 steam。")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(900),alt:"image-20211104202000270"}})]),t._v(" "),n("blockquote",[n("p",[t._v("解决TCP中"),n("strong",[t._v("队头阻塞")]),t._v("问题")])]),t._v(" "),n("p",[t._v("TCP为了保证可靠传输，如果在传输的过程中发生丢包，可能此时其他包已经接受完毕，但是仍要等待客户端重传丢失的包。这就是TCP协议本身"),n("strong",[t._v("队头阻塞")]),t._v("的问题。")]),t._v(" "),n("p",[n("strong",[t._v("QUIC 协议")])]),t._v(" "),n("p",[t._v("HTTP/3中关键的改变，那就是把下层的 TCP 换成了 UDP 。 UDP 无序从而解决了"),n("strong",[t._v("队头")])]),t._v(" "),n("blockquote",[n("p",[n("strong",[t._v("阻塞")]),t._v("的问题")])]),t._v(" "),n("ul",[n("li",[t._v("QUIC 基于 UDP 之前说过 UDP 是无连的，接速度比 TCP 快")]),t._v(" "),n("li",[t._v("QUIC 基于 UDP 实现了可靠传输、流量控制，引入流和多路复用")]),t._v(" "),n("li",[t._v("QUIC 全面采用加密通信, QUIC 使用了 TLS 1.3，首次连接只需要 1RTT")]),t._v(" "),n("li",[t._v("支持"),n("strong",[t._v("链接迁移")]),t._v("，不受 IP 及 port 影响而发生重连，通过 ConnectionID 进行链接")]),t._v(" "),n("li",[t._v("使用 QPACK 进行头部压缩， HPACK 要求传输过程有序（动态表），会导致队头阻塞。")])]),t._v(" "),n("h5",{attrs:{id:"http2与http3格式比较"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#http2与http3格式比较"}},[t._v("#")]),t._v(" HTTP2与HTTP3格式比较")]),t._v(" "),n("p",[n("img",{attrs:{src:a(901),alt:"image-20211104202229714"}})]),t._v(" "),n("h4",{attrs:{id:"https"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#https"}},[t._v("#")]),t._v(" HTTPS")]),t._v(" "),n("ul",[n("li",[t._v("1.https 是在 http 协议的基础上加了个 SSL；")]),t._v(" "),n("li",[t._v("2.主要包括："),n("strong",[t._v("握手(凭证交换和验证)"),n("strong",[t._v("和")]),t._v("记录协议(数据进行加密)")]),t._v("。")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(902),alt:"image-20211104202331295"}})]),t._v(" "),n("h3",{attrs:{id:"报文格式、请求及响应示例"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#报文格式、请求及响应示例"}},[t._v("#")]),t._v(" 报文格式、请求及响应示例")]),t._v(" "),n("p",[n("img",{attrs:{src:a(903),alt:""}}),t._v(" "),n("img",{attrs:{src:a(904),alt:""}})]),t._v(" "),n("h3",{attrs:{id:"http状态码【要点】"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#http状态码【要点】"}},[t._v("#")]),t._v(" HTTP状态码【要点】")]),t._v(" "),n("h4",{attrs:{id:"比较分类"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#比较分类"}},[t._v("#")]),t._v(" 比较分类")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("序列")]),t._v(" "),n("th",[t._v("详情")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("1XX(通知)")]),t._v(" "),n("td",[t._v("代表请求已被接受，需要继续处理。这类响应是临时响应，只包含状态行和某些可选的响应头信息，并以空行结束。"),n("strong",[t._v("101 Switching Protocols")])])]),t._v(" "),n("tr",[n("td",[t._v("2XX(成功)")]),t._v(" "),n("td",[t._v("200(成功)、"),n("strong",[t._v("201(服务器创建)")]),t._v("、202(服务器接收未处理)、203(非授权信息)、"),n("strong",[t._v("204(未返回内容)")]),t._v("、205(重置内容)、"),n("strong",[t._v("206(部分内容)")])])]),t._v(" "),n("tr",[n("td",[t._v("3XX(重定向)")]),t._v(" "),n("td",[n("strong",[t._v("301(永久移动)、302(临时移动)")]),t._v("、303(查看其他位置)、"),n("strong",[t._v("304(未修改)")]),t._v("、305(使用代理)、"),n("strong",[t._v("307(临时重定向)")])])]),t._v(" "),n("tr",[n("td",[t._v("4XX(客户端错误)")]),t._v(" "),n("td",[t._v("400(错误请求)、401(未授权)、403(禁止)、404(未找到)、405(方法禁用)、406(不接受)、407（需要代理授权）")])]),t._v(" "),n("tr",[n("td",[t._v("5XX(服务器错误)")]),t._v(" "),n("td",[t._v("500(服务器异常)、501（尚未实施）、"),n("strong",[t._v("502（错误网关）")]),t._v("、503（服务不可用）、"),n("strong",[t._v("504（网关超时）")]),t._v("、505（HTTP 版本不受支持）")])])])]),t._v(" "),n("p",[n("strong",[t._v("总括")]),t._v("：")]),t._v(" "),n("ul",[n("li",[t._v("1xx："),n("strong",[t._v("指示信息")]),t._v("–表示请求已接收，继续处理。")]),t._v(" "),n("li",[t._v("2xx："),n("strong",[t._v("指示成功")]),t._v("–表示请求已被成功接收、理解、接受。")]),t._v(" "),n("li",[t._v("3xx："),n("strong",[t._v("指示重定向")]),t._v("–要完成请求必须进行更进一步的操作。")]),t._v(" "),n("li",[t._v("4xx："),n("strong",[t._v("指示客户端错误")]),t._v("–请求有语法错误或请求无法实现。")]),t._v(" "),n("li",[t._v("5xx："),n("strong",[t._v("指示服务器端错误")]),t._v("–服务器未能实现合法的请求。")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(905),alt:""}})]),t._v(" "),n("h4",{attrs:{id:"常见的状态码"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#常见的状态码"}},[t._v("#")]),t._v(" 常见的状态码")]),t._v(" "),n("ul",[n("li",[t._v("200\t表示请求成功, 最喜欢见到的状态码")]),t._v(" "),n("li",[t._v("201   (Created)【post请求】")]),t._v(" "),n("li",[t._v("204   未返回内容【put请求】")]),t._v(" "),n("li",[t._v("301\t永久重定向；一般是用在域名换了；http升级到https;")]),t._v(" "),n("li",[t._v("302\t临时重定向；一般是访问某个网站的资源需要权限时，会需要用户去登录，跳转到登录页面之后登录之后，还可以继续访问。")]),t._v(" "),n("li",[t._v("304\t自上次请求，未修改的文件")]),t._v(" "),n("li",[t._v("400\t错误的请求")]),t._v(" "),n("li",[t._v("401\t未被授权，需要身份验证，例如token信息等等")]),t._v(" "),n("li",[t._v("403\t请求被拒绝")]),t._v(" "),n("li",[t._v("404\t资源缺失，接口不存在，或请求的文件不存在等等")]),t._v(" "),n("li",[t._v("405     (Method Not Allowed)")]),t._v(" "),n("li",[t._v("422    参数有误")]),t._v(" "),n("li",[t._v("500\t服务器端的未知错误")]),t._v(" "),n("li",[t._v("502\t网关错误；"),n("strong",[t._v("收到了上游响应但无法解析")])]),t._v(" "),n("li",[t._v("503\t服务暂时无法使用")]),t._v(" "),n("li",[t._v("504\t网关超时；"),n("strong",[t._v("上游响应超时")])])]),t._v(" "),n("p",[n("img",{attrs:{src:a(906),alt:""}})]),t._v(" "),n("h4",{attrs:{id:"特殊状态码"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#特殊状态码"}},[t._v("#")]),t._v(" 特殊状态码")]),t._v(" "),n("ul",[n("li",[t._v("301:请求的资源被永久转移到其他地方（重定向）;")]),t._v(" "),n("li",[t._v("302:临时转移；")]),t._v(" "),n("li",[t._v("501, 505(koa中有处理)")]),t._v(" "),n("li",[t._v("206:range范围请求； range范围请求【206】;显示一个请求文件的多少行\n模拟: `curl -r 0-10 http://127.0.0.1:9527/LICENSE (10行)")]),t._v(" "),n("li",[t._v("304:缓存(新鲜度)\nRequest Headers跟 Response Headers 中的 Last-Modified/ETag一样，才确保是新鲜的304；")])]),t._v(" "),n("blockquote",[n("h4",{attrs:{id:"http-状态码中-301-302和307有什么区别"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#http-状态码中-301-302和307有什么区别"}},[t._v("#")]),t._v(" http 状态码中 301，302和307有什么区别")])]),t._v(" "),n("ul",[n("li",[n("p",[t._v("301，Moved Permanently。"),n("strong",[t._v("永久重定向，该操作比较危险，需要谨慎操作")]),t._v("：如果设置了301，但是一段时间后又想取消，但是浏览器中已经有了缓存，还是会重定向。")])]),t._v(" "),n("li",[n("p",[t._v("302，Fount。临时重定向，"),n("strong",[t._v("但是会在重定向的时候改变 method")]),t._v(": 把 POST 改成 GET，于是有了 307")])]),t._v(" "),n("li",[n("p",[t._v("307，Temporary Redirect。临时重定向，"),n("strong",[t._v("在重定向时不会改变 method")])])])]),t._v(" "),n("blockquote",[n("h4",{attrs:{id:"http-状态码-502-和-504-有什么区别"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#http-状态码-502-和-504-有什么区别"}},[t._v("#")]),t._v(" http 状态码 502 和 504 有什么区别")])]),t._v(" "),n("ul",[n("li",[t._v("502 Bad Gateway The server was acting as a gateway or proxy and received an invalid response from the upstream server. "),n("strong",[t._v("收到了上游响应但无法解析")])]),t._v(" "),n("li",[t._v("504 Gateway Timeout The server was acting as a gateway or proxy and did not receive a timely response from the upstream server. "),n("strong",[t._v("上游响应超时")])])]),t._v(" "),n("blockquote",[n("h4",{attrs:{id:"http-向-https-做重定向应该使用哪个状态码"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#http-向-https-做重定向应该使用哪个状态码"}},[t._v("#")]),t._v(" http 向 https 做重定向应该使用哪个状态码")])]),t._v(" "),n("p",[n("strong",[t._v("一般用作 "),n("code",[t._v("301")]),t._v(" 的较为多，但是也有使用 "),n("code",[t._v("302")]),t._v("，如果开启了 "),n("code",[t._v("HSTS")]),t._v(" 则会使用 "),n("code",[t._v("307")])])]),t._v(" "),n("p",[t._v("如知乎使用了 302，淘宝使用了 301；")]),t._v(" "),n("div",{staticClass:"language-http line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-http"}},[n("code",[t._v("$ curl --head www.zhihu.com\n"),n("span",{pre:!0,attrs:{class:"token response-status"}},[t._v("HTTP/1.1 "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v("302 Found")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Date:")]),t._v(" Tue, 24 Dec 2019 00:13:54 GMT\n"),n("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Content-Length:")]),t._v(" 22\n"),n("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Connection:")]),t._v(" keep-alive\n"),n("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Server:")]),t._v(" NWS_TCloud_IPV6\n"),n("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Location:")]),t._v(" https://www.zhihu.com/\n"),n("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("X-NWS-LOG-UUID:")]),t._v(" 0e28d9a1-6aeb-42cd-9f6b-00bd6cf11500\n\n$ curl --head www.taobao.com\n"),n("span",{pre:!0,attrs:{class:"token response-status"}},[t._v("HTTP/1.1 "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v("301 Moved Permanently")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Server:")]),t._v(" Tengine\n"),n("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Date:")]),t._v(" Tue, 24 Dec 2019 00:13:58 GMT\n"),n("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Content-Type:")]),t._v(" text/html\n"),n("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Content-Length:")]),t._v(" 278\n"),n("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Connection:")]),t._v(" keep-alive\n"),n("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Location:")]),t._v(" https://www.taobao.com/\n"),n("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Via:")]),t._v(" cache20.cn1480[,0]\n"),n("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Timing-Allow-Origin:")]),t._v(" *\n"),n("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("EagleId:")]),t._v(" 6f3f38a815771464380412555e\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br"),n("span",{staticClass:"line-number"},[t._v("20")]),n("br")])]),n("h3",{attrs:{id:"http动词"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#http动词"}},[t._v("#")]),t._v(" HTTP动词")]),t._v(" "),n("p",[t._v("常用的HTTP动词有下面五个")]),t._v(" "),n("ul",[n("li",[t._v("GET（SELECT）：从服务器取出资源（一项或多项）。//200")]),t._v(" "),n("li",[t._v("POST（CREATE）：在服务器新建一个资源。//201")]),t._v(" "),n("li",[t._v("PUT（UPDATE）：在服务器更新资源（客户端"),n("strong",[t._v("提供改变后的完整资源")]),t._v("）。//204")]),t._v(" "),n("li",[t._v("PATCH（UPDATE）：在服务器更新资源（客户端"),n("strong",[t._v("提供改变的属性")]),t._v("）。")]),t._v(" "),n("li",[t._v("DELETE（DELETE）：从服务器删除资源。")])]),t._v(" "),n("h4",{attrs:{id:"几种请求方法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#几种请求方法"}},[t._v("#")]),t._v(" 几种请求方法")]),t._v(" "),n("p",[t._v("GET、POST、PUT、DELETE、HEAD、CONNECT、OPTIONS、TRACE;")]),t._v(" "),n("p",[n("strong",[t._v("常用的5+1种【CRUD操作+ H+P】")])]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("methods")]),t._v(" "),n("th",[t._v("CRUD")]),t._v(" "),n("th",[t._v("幂等")]),t._v(" "),n("th",[t._v("缓存")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("GET")]),t._v(" "),n("td",[t._v("Read")]),t._v(" "),n("td",[t._v("✓")]),t._v(" "),n("td",[t._v("✓")])]),t._v(" "),n("tr",[n("td",[t._v("POST")]),t._v(" "),n("td",[t._v("Create")]),t._v(" "),n("td"),t._v(" "),n("td")]),t._v(" "),n("tr",[n("td",[t._v("PUT")]),t._v(" "),n("td",[t._v("Update/Replace")]),t._v(" "),n("td",[t._v("✓")]),t._v(" "),n("td")]),t._v(" "),n("tr",[n("td",[t._v("PATCH")]),t._v(" "),n("td",[t._v("Update/Modify")]),t._v(" "),n("td"),t._v(" "),n("td")]),t._v(" "),n("tr",[n("td",[t._v("DELETE")]),t._v(" "),n("td",[t._v("Delete")]),t._v(" "),n("td",[t._v("✓")]),t._v(" "),n("td")])])]),t._v(" "),n("h4",{attrs:{id:"post-和-put-的区别"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#post-和-put-的区别"}},[t._v("#")]),t._v(" POST 和 PUT 的区别")]),t._v(" "),n("p",[t._v("POST 是新建 (create) 资源, 非幂等, 同一个请求如果重复 POST 会新建多个资源. PUT 是 Update/Replace, 幂等, 同一个 PUT 请求重复操作会得到同样的结果.")]),t._v(" "),n("h4",{attrs:{id:"get和post区别"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#get和post区别"}},[t._v("#")]),t._v(" get和post区别")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("请求方式")]),t._v(" "),n("th",[t._v("GET")]),t._v(" "),n("th",[t._v("POST")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("参数位置")]),t._v(" "),n("td",[t._v("参数拼接到url的后面")]),t._v(" "),n("td",[t._v("参数在请求体中")])]),t._v(" "),n("tr",[n("td",[t._v("参数大小")]),t._v(" "),n("td",[t._v("受限于浏览器url大小，"),n("strong",[t._v("一般不超过32K")])]),t._v(" "),n("td",[t._v("1G")])]),t._v(" "),n("tr",[n("td",[t._v("服务器数据接收")]),t._v(" "),n("td",[t._v("接收1次")]),t._v(" "),n("td",[t._v("根据数据大小，可分多次接收")])]),t._v(" "),n("tr",[n("td",[t._v("适用场景")]),t._v(" "),n("td",[t._v("从服务器端获取数据")]),t._v(" "),n("td",[t._v("向服务器提交数据")])]),t._v(" "),n("tr",[n("td",[t._v("安全性")]),t._v(" "),n("td",[t._v("参数携带在url中，安全性低")]),t._v(" "),n("td",[t._v("相对于GET请求，安全性更高")])])])]),t._v(" "),n("p",[t._v("接触 RESTful 才意识到, 这两个东西最根本的差别是语义, 引申了看, "),n("strong",[t._v('协议 (protocol) 这种东西就是人与人之间协商的约定, 什么行为是什么作用都是"约定"好的')]),t._v(", 而不是强制使用的, 非要把 GET 当 POST 这样不遵守约定的做法我们也爱莫能助. 简而言之, "),n("strong",[t._v("讨论这二者的区别最好从 RESTful 提倡的语义角度来讲_image/02.http协议相关_image/02.http协议相关比较符合当代程序员的逼格_image/02.http协议相关_image/02.http协议相关比较合理.")])]),t._v(" "),n("h4",{attrs:{id:"get请求传参长度的误区"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#get请求传参长度的误区"}},[t._v("#")]),t._v(" get请求传参长度的误区")]),t._v(" "),n("p",[t._v("误区：我们经常说get请求参数的大小存在限制，而post请求的参数大小是无限制的。")]),t._v(" "),n("p",[t._v("强调下面几点:")]),t._v(" "),n("ul",[n("li",[t._v("HTTP 协议 未规定 GET 和POST的长度限制；")]),t._v(" "),n("li",[n("strong",[t._v("GET的最大长度显示是因为 浏览器和 web服务器限制了 URI的长度")]),t._v("；")]),t._v(" "),n("li",[t._v("不同的浏览器和WEB服务器，限制的最大长度不一样；")]),t._v(" "),n("li",[t._v("要支持IE，则最大长度为2083byte，若只支持Chrome，则最大长度 8182byte；")])]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//MAX_GET_URL_LENGTH: 2048,")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("doGetAsPost")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("opt")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" delimiterPos "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" opt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("indexOf")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'?'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" fieldsIndex "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" opt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("indexOf")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'&fields'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  opt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("type "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"POST"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  opt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("headers"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"X-Http-Method-Override"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"GET"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("delimiterPos "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" query "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" fieldsIndex "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" opt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("substring")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("delimiterPos "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" fieldsIndex"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" opt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("substr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("delimiterPos "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    opt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("stringify")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"RequestInfo"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"query"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" query"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fieldsIndex "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      opt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" opt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("substr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" delimiterPos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'?'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" opt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("substr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fieldsIndex "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'&_='")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" App"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("dateTime")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      opt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" opt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("substr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" delimiterPos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'?_='")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" App"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("dateTime")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    opt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'?_='")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" App"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("dateTime")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" opt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("opt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" opt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'MAX_GET_URL_LENGTH'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  opt "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("doGetAsPost")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("opt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br"),n("span",{staticClass:"line-number"},[t._v("20")]),n("br"),n("span",{staticClass:"line-number"},[t._v("21")]),n("br"),n("span",{staticClass:"line-number"},[t._v("22")]),n("br"),n("span",{staticClass:"line-number"},[t._v("23")]),n("br"),n("span",{staticClass:"line-number"},[t._v("24")]),n("br"),n("span",{staticClass:"line-number"},[t._v("25")]),n("br"),n("span",{staticClass:"line-number"},[t._v("26")]),n("br")])]),n("h4",{attrs:{id:"get和post在缓存方面的区别"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#get和post在缓存方面的区别"}},[t._v("#")]),t._v(" get和post在缓存方面的区别")]),t._v(" "),n("ul",[n("li",[t._v("get请求类似于查找的过程，用户获取数据，可以不用每次都与数据库连接，所以可以使用缓存。")]),t._v(" "),n("li",[t._v("post不同，post做的一般是修改和删除的工作，所以必须与数据库交互，所以不能使用缓存。因此get请求适合于请求缓存。")])]),t._v(" "),n("h3",{attrs:{id:"请求响应头说明"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#请求响应头说明"}},[t._v("#")]),t._v(" 请求响应头说明")]),t._v(" "),n("p",[n("strong",[t._v("常用请求头：1.请求和响应报文的通用Header; 2.常用的响应Header;")]),t._v(" "),n("img",{attrs:{src:a(907),alt:""}})]),t._v(" "),n("h4",{attrs:{id:"cookie"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#cookie"}},[t._v("#")]),t._v(" Cookie")]),t._v(" "),n("p",[n("strong",[t._v("Set-Cookie/Cookie")]),t._v("用户第一次访问服务器的时候，服务器会写入身份标识，下次再请求的时候会携带 cookie 。通过Cookie可以实现有状态的会话")]),t._v(" "),n("h4",{attrs:{id:"管线化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#管线化"}},[t._v("#")]),t._v(" "),n("strong",[t._v("管线化")])]),t._v(" "),n("p",[t._v('如果值创建一条 TCP 连接来进行数据的收发，就会变成 "串行" 模式，如果某个请求过慢就会发生阻塞问题。 '),n("strong",[t._v("Head-of-line blocking")]),t._v("， HTTP/1.1中采用了管线化的方式，对一个域名同时发起多个长连接实现并发。 "),n("strong",[t._v("默认 chrome 为6个。"),n("code",[t._v("同一个域名有限制，那么我就多开几个域名 域名分片")])])]),t._v(" "),n("h4",{attrs:{id:"长链接keep-alive"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#长链接keep-alive"}},[t._v("#")]),t._v(" 长链接Keep-Alive")]),t._v(" "),n("h5",{attrs:{id:"要点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#要点"}},[t._v("#")]),t._v(" 要点")]),t._v(" "),n("ul",[n("li",[t._v("HTTP Keep-Alive 简单说就是"),n("strong",[t._v("保持当前的TCP连接，避免了重新建立连接")]),t._v("。")]),t._v(" "),n("li",[t._v("HTTP 长连接不可能一直保持; 例如 "),n("code",[t._v("Keep-Alive: timeout=5, max=100")]),t._v("，表示这个TCP通道可以保持5秒，max=100，表示这个长连接最多接收100次请求就断开。")]),t._v(" "),n("li",[t._v("HTTP 是一个无状态协议，这意味着每个请求都是独立的，Keep-Alive 没能改变这个结果。另外，Keep-Alive也不能保证客户端和服务器之间的连接一定是活跃的，在 HTTP1.1 版本中也如此。唯一能保证的就是当连接被关闭时你能得到一个通知，所以不应该让程序依赖于 Keep-Alive 的保持连接特性，否则会有意想不到的后果。")])]),t._v(" "),n("blockquote",[n("h4",{attrs:{id:"使用长连接后-客户端、服务器如何知道本次传输结束-两部分"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用长连接后-客户端、服务器如何知道本次传输结束-两部分"}},[t._v("#")]),t._v(" 使用长连接后，客户端、服务器如何知道本次传输结束？（两部分）")])]),t._v(" "),n("ul",[n("li",[n("p",[t._v("判断传输数据是否达到了Content-Length 指示的大小；")])]),t._v(" "),n("li",[n("p",[t._v("动态生成的文件没有 Content-Length ，它是分块传输（chunked），这时候就要根据 chunked 编码来判断，chunked 编码的数据"),n("strong",[t._v("在最后有一个空 chunked 块，表明本次传输数据结束")])])])]),t._v(" "),n("h5",{attrs:{id:"作用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#作用"}},[t._v("#")]),t._v(" 作用")]),t._v(" "),n("p",[t._v("在 "),n("code",[t._v("http 1.1")]),t._v(" 中，在响应头中"),n("strong",[t._v("设置 "),n("code",[t._v("keep-alive")]),t._v(" 可以在一个 TCP 连接上发送多个 http 请求")])]),t._v(" "),n("ol",[n("li",[t._v("避免了"),n("strong",[t._v("重开 TCP 连接的开销")]),t._v("; "),n("strong",[t._v("刷新时重新建立 SSL 连接的开销")])]),t._v(" "),n("li",[t._v("避免了QPS过大时，服务器的连接数过大;")]),t._v(" "),n("li",[t._v("解决无连接和无状态;\n"),n("ul",[n("li",[n("strong",[t._v("无连接")]),t._v("：可以"),n("strong",[t._v("通过自身属性 Keep-Alive")]),t._v("。")]),t._v(" "),n("li",[n("strong",[t._v("无状态")]),t._v("：HTTP 协议本身无法解决这个状态，"),n("strong",[t._v("只有通过 cookie 和 session 将状态做贮存")]),t._v("，常见的场景是登录状态保持；")])])])]),t._v(" "),n("p",[t._v("在服务器端使用响应头开启 "),n("code",[t._v("keep-alive")]),t._v(";  但是，keep-alive并不是免费的午餐,长时间的tcp连接容易导致系统资源无效占用。配置不当的keep-alive，有时比重复利用连接带来的损失还更大。所以，"),n("strong",[t._v("正确地设置keep-alive timeout时间非常重要。")])]),t._v(" "),n("div",{staticClass:"language-http line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-http"}},[n("code",[n("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Connection:")]),t._v(" Keep-Alive\n"),n("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Keep-Alive:")]),t._v(" timeout=5, max=1000 \n#表示这个TCP通道可以保持5秒，max=100，表示这个长连接最多接收100次请求就断开\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br")])]),n("h5",{attrs:{id:"处理长连接的方式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#处理长连接的方式"}},[t._v("#")]),t._v(" 处理长连接的方式")]),t._v(" "),n("p",[n("img",{attrs:{src:a(908),alt:""}})]),t._v(" "),n("blockquote",[n("h4",{attrs:{id:"既然-http-是无状态协议-那它是如何保持登录状态"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#既然-http-是无状态协议-那它是如何保持登录状态"}},[t._v("#")]),t._v(" 既然 http 是无状态协议，那它是如何保持登录状态")])]),t._v(" "),n("p",[t._v("通过 cookie 或者 Authorization header 来传递凭证，在服务端进行认证")]),t._v(" "),n("blockquote",[n("h4",{attrs:{id:"如何从-http-的报文中得知该服务使用的技术栈"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#如何从-http-的报文中得知该服务使用的技术栈"}},[t._v("#")]),t._v(" 如何从 http 的报文中得知该服务使用的技术栈")])]),t._v(" "),n("p",[t._v("一般有两个 response header，有时服务端为了隐蔽自己真实的技术栈会隐蔽这两个字段")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("X-Powerd-By")])]),t._v(" "),n("li",[n("code",[t._v("Server")])])]),t._v(" "),n("p",[t._v("可在nginx中关闭屏蔽这几个字段；")]),t._v(" "),n("h4",{attrs:{id:"content-type"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#content-type"}},[t._v("#")]),t._v(" content-type")]),t._v(" "),n("p",[t._v("如果 content-type 为 application/"),n("strong",[t._v("octet-stream")]),t._v("， 代表二进制流，"),n("strong",[t._v("一般用以下载文件")]),t._v("；")]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'content-type'")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'application/x-www-form-urlencoded'")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Is set automatically")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'content-type'")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'multipart/form-data'")]),t._v(" \n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// res.setHeader('Content-Type', 'text/plain');")]),t._v("\nres"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setHeader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Content-Type'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'text/html'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br")])]),n("h4",{attrs:{id:"编码格式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#编码格式"}},[t._v("#")]),t._v(" 编码格式")]),t._v(" "),n("p",[t._v("服务端返回压缩包的时候告诉浏览器一声，这其实是一个gz压缩包，浏览器你使用前先解压一下。而这个通知就是我们之前判断是否开启gzip压缩的请求头字段，Response Headers里的 "),n("strong",[t._v("content-encoding: gzip")]),t._v("。"),n("strong",[t._v("req.headers['accept-encoding']  // gzip deflate")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(909),alt:""}}),t._v(" "),n("img",{attrs:{src:a(910),alt:""}})]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("createGzip"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" createDeflate"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'zlib'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nmodule"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("exports")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("rs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" acceptEncoding "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("headers"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'accept-encoding'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("acceptEncoding "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("acceptEncoding"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("match")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token regex"}},[n("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v("\\b(gzip|deflate)\\b")]),n("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" rs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("acceptEncoding"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("match")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token regex"}},[n("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v("\\bgzip\\b")]),n("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setHeader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Content-Encoding'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'gzip'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" rs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("pipe")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createGzip")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("acceptEncoding"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("match")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token regex"}},[n("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v("\\bdeflate\\b")]),n("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setHeader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Content-Encoding'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'deflate'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" rs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("pipe")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createDeflate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br")])]),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" fs "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'fs'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" path "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'path'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Handlebars "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'handlebars'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" promisify "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'util'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("promisify"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" stat "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("promisify")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stat"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" readdir "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("promisify")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("readdir"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" mime "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./mime'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" compress "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./compress'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" range "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./range'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" isFresh "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./cache'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" tplPath "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'../template/dir.tpl'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// const source = fs.readFileSync(tplPath, 'utf-8');")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" source "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" fs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("readFileSync")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("tplPath"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//toString()")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" template "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Handlebars"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("compile")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("source"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("toString")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nmodule"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("exports")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" filePath"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" config")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" stats "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("stat")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("filePath"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("stats"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isFile")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" contentType "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("mime")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("filePath"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setHeader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Content-Type'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" contentType"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isFresh")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("stats"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//缓存【304】")]),t._v("\n        res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("statusCode "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("304")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("end")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" rs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" code"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" start"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" end "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("range")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("stats"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("size"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("code "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("statusCode "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        rs "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" fs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createReadStream")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("filePath"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// range范围请求【206】;显示一个请求文件的多少行")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 模拟:curl -r 0-10 http://127.0.0.1:9527/LICENSE (10行)")]),t._v("\n        res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("statusCode "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("206")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        rs "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" fs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createReadStream")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("filePath"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" start"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" end "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("filePath"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("match")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("config"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("compress"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//压缩 compress: /\\.(html|js|css|md)/,")]),t._v("\n        rs "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("compress")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("rs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      rs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("pipe")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//要点")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("stats"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDirectory")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" files "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("readdir")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("filePath"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("statusCode "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// res.setHeader('Content-Type', 'text/plain');")]),t._v("\n      res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setHeader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Content-Type'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'text/html'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" dir "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("relative")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("config"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("root"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" filePath"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// this渲染")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" data "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        title"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("basename")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("filePath"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        dir"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" dir "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("dir"),n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        files"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" files"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("map")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("file")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            file"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            icon"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("mime")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("file"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("end")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("template")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ex"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ex"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("statusCode "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("404")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setHeader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Content-Type'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'text/plain'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("end")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("filePath"),n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v(" is not a directory or file\\n ")]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("ex"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("toString")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br"),n("span",{staticClass:"line-number"},[t._v("20")]),n("br"),n("span",{staticClass:"line-number"},[t._v("21")]),n("br"),n("span",{staticClass:"line-number"},[t._v("22")]),n("br"),n("span",{staticClass:"line-number"},[t._v("23")]),n("br"),n("span",{staticClass:"line-number"},[t._v("24")]),n("br"),n("span",{staticClass:"line-number"},[t._v("25")]),n("br"),n("span",{staticClass:"line-number"},[t._v("26")]),n("br"),n("span",{staticClass:"line-number"},[t._v("27")]),n("br"),n("span",{staticClass:"line-number"},[t._v("28")]),n("br"),n("span",{staticClass:"line-number"},[t._v("29")]),n("br"),n("span",{staticClass:"line-number"},[t._v("30")]),n("br"),n("span",{staticClass:"line-number"},[t._v("31")]),n("br"),n("span",{staticClass:"line-number"},[t._v("32")]),n("br"),n("span",{staticClass:"line-number"},[t._v("33")]),n("br"),n("span",{staticClass:"line-number"},[t._v("34")]),n("br"),n("span",{staticClass:"line-number"},[t._v("35")]),n("br"),n("span",{staticClass:"line-number"},[t._v("36")]),n("br"),n("span",{staticClass:"line-number"},[t._v("37")]),n("br"),n("span",{staticClass:"line-number"},[t._v("38")]),n("br"),n("span",{staticClass:"line-number"},[t._v("39")]),n("br"),n("span",{staticClass:"line-number"},[t._v("40")]),n("br"),n("span",{staticClass:"line-number"},[t._v("41")]),n("br"),n("span",{staticClass:"line-number"},[t._v("42")]),n("br"),n("span",{staticClass:"line-number"},[t._v("43")]),n("br"),n("span",{staticClass:"line-number"},[t._v("44")]),n("br"),n("span",{staticClass:"line-number"},[t._v("45")]),n("br"),n("span",{staticClass:"line-number"},[t._v("46")]),n("br"),n("span",{staticClass:"line-number"},[t._v("47")]),n("br"),n("span",{staticClass:"line-number"},[t._v("48")]),n("br"),n("span",{staticClass:"line-number"},[t._v("49")]),n("br"),n("span",{staticClass:"line-number"},[t._v("50")]),n("br"),n("span",{staticClass:"line-number"},[t._v("51")]),n("br"),n("span",{staticClass:"line-number"},[t._v("52")]),n("br"),n("span",{staticClass:"line-number"},[t._v("53")]),n("br"),n("span",{staticClass:"line-number"},[t._v("54")]),n("br"),n("span",{staticClass:"line-number"},[t._v("55")]),n("br"),n("span",{staticClass:"line-number"},[t._v("56")]),n("br"),n("span",{staticClass:"line-number"},[t._v("57")]),n("br"),n("span",{staticClass:"line-number"},[t._v("58")]),n("br"),n("span",{staticClass:"line-number"},[t._v("59")]),n("br"),n("span",{staticClass:"line-number"},[t._v("60")]),n("br"),n("span",{staticClass:"line-number"},[t._v("61")]),n("br"),n("span",{staticClass:"line-number"},[t._v("62")]),n("br"),n("span",{staticClass:"line-number"},[t._v("63")]),n("br"),n("span",{staticClass:"line-number"},[t._v("64")]),n("br"),n("span",{staticClass:"line-number"},[t._v("65")]),n("br"),n("span",{staticClass:"line-number"},[t._v("66")]),n("br"),n("span",{staticClass:"line-number"},[t._v("67")]),n("br"),n("span",{staticClass:"line-number"},[t._v("68")]),n("br"),n("span",{staticClass:"line-number"},[t._v("69")]),n("br")])]),n("h3",{attrs:{id:"完整的http的工作流程【要点】"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#完整的http的工作流程【要点】"}},[t._v("#")]),t._v(" 完整的HTTP的工作流程【要点】")]),t._v(" "),n("blockquote",[n("p",[t._v("输入网址到显示网页的过程, 打开浏览器从输入网址到网页呈现在大家面前，背后原理;")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(911),alt:""}}),t._v("\n总体流程图，具体步骤请看下文分解！总体来说分为以下几个过程:")]),t._v(" "),n("blockquote",[n("p",[t._v("域名解析过程，三次握手过程，发起HTTP请求，响应HTTP请求并得到HTML代码，浏览器解析HTML代码，浏览器对页面进行渲染呈现给用户；")])]),t._v(" "),n("p",[n("strong",[t._v("在浏览器中输入"),n("code",[t._v("url")]),t._v("地址 ->> 显示主页的过程")])]),t._v(" "),n("blockquote",[n("p",[t._v("打开一个网页，整个过程会使用哪些协议")])]),t._v(" "),n("p",[t._v("域名解析过程：和三次握手过程； "),n("code",[t._v("SEQ")]),n("strong",[t._v("和")]),n("code",[t._v("ACK")]),n("strong",[t._v("，序列号与确认号")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(912),alt:""}}),t._v(" "),n("img",{attrs:{src:a(913),alt:""}}),t._v(" "),n("img",{attrs:{src:a(914),alt:""}})]),t._v(" "),n("h4",{attrs:{id:"从url输入到页面展现内部过程-8步"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#从url输入到页面展现内部过程-8步"}},[t._v("#")]),t._v(" 从URL输入到页面展现内部过程(8步)")]),t._v(" "),n("p",[n("strong",[t._v("总体流程")]),t._v("：(八部曲)：谐音 **【输缓域三,请响解四】")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("浏览器的地址栏输入URL并按下回车；")])]),t._v(" "),n("li",[n("p",[t._v("浏览器查找当前URL是否存在缓存，并比较缓存是否过期；")])]),t._v(" "),n("li",[n("p",[t._v("DNS 解析:  将域名解析成 IP 地址；")])]),t._v(" "),n("li",[n("p",[t._v("根据IP建立TCP连接（三次握手）；")])]),t._v(" "),n("li",[n("p",[t._v("发送 HTTP 请求；")])]),t._v(" "),n("li",[n("p",[t._v("服务器处理请求，浏览器接收HTTP响应。")])]),t._v(" "),n("li",[n("p",[t._v("浏览器通过渲染引擎将网页呈现在用户面前。")]),t._v(" "),n("ul",[n("li",[t._v("根据 HTML 解析出 DOM 树")]),t._v(" "),n("li",[t._v("根据 CSS 解析生成 CSS 规则树")]),t._v(" "),n("li",[t._v("结合 DOM 树和 CSS 规则树，生成渲染树")]),t._v(" "),n("li",[t._v("根据渲染树计算每一个节点的信息")]),t._v(" "),n("li",[t._v("根据计算好的信息绘制页面")])])]),t._v(" "),n("li",[n("p",[t._v("断开TCP连接：TCP 四次挥手 ；")])])]),t._v(" "),n("p",[n("strong",[t._v("详细步骤")]),t._v("：")]),t._v(" "),n("p",[t._v("TCP 三次握手结束后，开始发送 HTTP 请求报文。 请求报文由请求行（request line）、请求头（header）、请求体")]),t._v(" "),n("p",[t._v("1.请求行包含请求方法、URL、协议版本")]),t._v(" "),n("p",[t._v("2.请求头包含请求的附加信息，由关键字/值对组成，每行一对，关键字和值用英文冒号“:”分隔。 比如：Host，表示主机名，虚拟主机；Connection,HTTP/1.1 增加的，使用 keepalive，即持久连接，一个连接可以发多个请求；User-Agent，请求发出者，兼容性以及定制化需求。")]),t._v(" "),n("p",[t._v("3.请求体，可以承载多个请求参数的数据，包含回车符、换行符和请求数据，并不是所有请求都具有请求数据")]),t._v(" "),n("p",[t._v("首先浏览器发送过来的请求先经过控制器，控制器进行逻辑处理和请求分发，接着会调用模型，这一阶段模型会获取 redis db 以及 MySQL 的数据，获取数据后将渲染好的页面，响应信息会以响应报文的形式返回给客户端，")]),t._v(" "),n("p",[t._v("最后浏览器通过渲染引擎将网页呈现在用户面前。")]),t._v(" "),n("ul",[n("li",[t._v("根据 HTML 解析出 DOM 树")]),t._v(" "),n("li",[t._v("根据 CSS 解析生成 CSS 规则树")]),t._v(" "),n("li",[t._v("结合 DOM 树和 CSS 规则树，生成渲染树")]),t._v(" "),n("li",[t._v("根据渲染树计算每一个节点的信息")]),t._v(" "),n("li",[t._v("根据计算好的信息绘制页面")])]),t._v(" "),n("p",[t._v("当数据传送完毕，需要断开 tcp 连接，此时发起 tcp 四次挥手。")]),t._v(" "),n("h3",{attrs:{id:"http性能测试-ab测试"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#http性能测试-ab测试"}},[t._v("#")]),t._v(" Http性能测试（AB测试）")]),t._v(" "),n("p",[n("img",{attrs:{src:a(915),alt:""}})]),t._v(" "),n("h3",{attrs:{id:"cookie-与-session"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#cookie-与-session"}},[t._v("#")]),t._v(" Cookie 与 Session")]),t._v(" "),n("blockquote",[n("ul",[n("li",[n("strong",[t._v("session 是另一种记录服务器和客户端会话状态的机制")])]),t._v(" "),n("li",[n("strong",[t._v("session 是基于 cookie 实现的，session 存储在服务器端，sessionId 会被存储到客户端的cookie 中")])])])]),t._v(" "),n("p",[n("strong",[t._v("区别")])]),t._v(" "),n("ul",[n("li",[n("strong",[t._v("安全性：")]),t._v(" Session 比 Cookie 安全，Session 是存储在服务器端的，Cookie 是存储在客户端的。")]),t._v(" "),n("li",[n("strong",[t._v("存取值的类型不同")]),t._v("：Cookie 只支持存字符串数据，想要设置其他类型的数据，需要将其转换成字符串，"),n("strong",[t._v("Session 可以存任意数据类型")]),t._v("。")]),t._v(" "),n("li",[n("strong",[t._v("有效期不同：")]),t._v(" Cookie 可设置为长时间保持，比如我们经常使用的默认登录功能，Session 一般失效时间较短，客户端关闭（默认情况下）或者 Session 超时都会失效。")]),t._v(" "),n("li",[n("strong",[t._v("存储大小不同：")]),t._v(" 单个 Cookie 保存的数据不能超过 4K，Session 可存储数据远高于 Cookie，但是当访问量过多，会占用过多的服务器资源。")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(916),alt:""}}),t._v(" "),n("img",{attrs:{src:a(917),alt:""}})]),t._v(" "),n("h3",{attrs:{id:"cookie-与-token"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#cookie-与-token"}},[t._v("#")]),t._v(" Cookie 与 Token")]),t._v(" "),n("p",[t._v("基于"),n("code",[t._v("Cookie")]),t._v(","),n("code",[t._v("Token")]),t._v("的身份验证 & 验证流程\n"),n("img",{attrs:{src:a(918),alt:""}}),t._v(" "),n("img",{attrs:{src:a(919),alt:""}})]),t._v(" "),n("p",[n("img",{attrs:{src:a(920),alt:""}}),t._v(" "),n("img",{attrs:{src:a(921),alt:""}})]),t._v(" "),n("h4",{attrs:{id:"token"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#token"}},[t._v("#")]),t._v(" "),n("strong",[t._v("token")])]),t._v(" "),n("p",[n("strong",[t._v("登录注册，及权限认证；")])]),t._v(" "),n("p",[t._v("JWT(即Json Web Token)目前最流行的跨域身份验证解决方案之一。"),n("strong",[t._v("它的工作流程是这样的")]),t._v("：")]),t._v(" "),n("ol",[n("li",[t._v("前端向后端传递用户名和密码")]),t._v(" "),n("li",[t._v("用户名和密码在后端核实成功后，返回前端一个token(或存在cookie中)")]),t._v(" "),n("li",[t._v("前端拿到token并进行保存")]),t._v(" "),n("li",[t._v("前端访问后端接口时先进行token认证，认证通过才能访问接口。")])]),t._v(" "),n("p",[t._v("那么在koa中我们需要做哪些事情？")]),t._v(" "),n("p",[n("strong",[t._v("在生成token阶段")]),t._v("：首先是验证账户，然后生成token令牌，传给前端。")]),t._v(" "),n("p",[n("strong",[t._v("在认证token阶段")]),t._v(":  完成认证中间件的编写，对前端的访问做一层拦截，token认证过后才能访问后面的接口。")]),t._v(" "),n("p",[n("strong",[t._v("授权登录")]),t._v(":google登录(通过跳板登录,通过用户的帐号及密码获取到token，再跳板机中拿到token取获取google的用户信息)，")]),t._v(" "),n("p",[n("strong",[t._v("跳板机设置")]),t._v("：确保可以翻墙")]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'use strict'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Controller "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'egg'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Controller"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("OAuth2Client"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'google-auth-library'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("CLIENT_ID")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'xx332824282550-u22223uikjlf63c2qbhj1c8gi5egr9k3.apps.googleusercontent.com'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" client "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("OAuth2Client")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("CLIENT_ID")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HomeController")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Controller")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("index")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" ctx "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hi, egg'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("google")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" ctx "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" token "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("token\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" ticket "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" client"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("verifyIdToken")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      idToken"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" token"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      audience"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("CLIENT_ID")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Specify the CLIENT_ID of the app that accesses the backend")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Or, if multiple clients access the backend:")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//[CLIENT_ID_1, CLIENT_ID_2, CLIENT_ID_3]")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" payload "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ticket"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getPayload")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" user "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        provider"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'google'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        google_id"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" payload"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'sub'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        email"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" payload"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'email'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        nickname"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" payload"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'name'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        avatar"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" payload"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'picture'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        given_name"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" payload"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'given_name'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        family_name"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" payload"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'family_name'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        language"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" payload"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'locale'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// If request specified a G Suite domain:")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//const domain = payload['hd'];")]),t._v("\n      ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" user\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nmodule"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" HomeController"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br"),n("span",{staticClass:"line-number"},[t._v("20")]),n("br"),n("span",{staticClass:"line-number"},[t._v("21")]),n("br"),n("span",{staticClass:"line-number"},[t._v("22")]),n("br"),n("span",{staticClass:"line-number"},[t._v("23")]),n("br"),n("span",{staticClass:"line-number"},[t._v("24")]),n("br"),n("span",{staticClass:"line-number"},[t._v("25")]),n("br"),n("span",{staticClass:"line-number"},[t._v("26")]),n("br"),n("span",{staticClass:"line-number"},[t._v("27")]),n("br"),n("span",{staticClass:"line-number"},[t._v("28")]),n("br"),n("span",{staticClass:"line-number"},[t._v("29")]),n("br"),n("span",{staticClass:"line-number"},[t._v("30")]),n("br"),n("span",{staticClass:"line-number"},[t._v("31")]),n("br"),n("span",{staticClass:"line-number"},[t._v("32")]),n("br"),n("span",{staticClass:"line-number"},[t._v("33")]),n("br"),n("span",{staticClass:"line-number"},[t._v("34")]),n("br"),n("span",{staticClass:"line-number"},[t._v("35")]),n("br"),n("span",{staticClass:"line-number"},[t._v("36")]),n("br"),n("span",{staticClass:"line-number"},[t._v("37")]),n("br"),n("span",{staticClass:"line-number"},[t._v("38")]),n("br"),n("span",{staticClass:"line-number"},[t._v("39")]),n("br")])]),n("p",[n("strong",[t._v("role权限验证")]),t._v("：后面的方式不同于之前的方式，提前判断返回ctx.fail(xxx),还处理了status;\n"),n("img",{attrs:{src:a(922),alt:""}})]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//config/role.js")]),t._v("\nmodule"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("exports")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("app")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  app"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("role"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("failureHandler")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" action")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// console.log('+++++++++++++++++', ctx.acceptJSON, action)")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("user "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("user"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("failure")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'无效token'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("401")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("42010011")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("failure")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Forbidden, required role: '")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" action"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("403")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  app"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("role"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'admin'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("ctx")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("service"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("auth"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("authToken")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("user "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("user"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("role "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("user"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("role"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'admin'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("user"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  app"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("role"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'user'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("ctx")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("service"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("auth"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("authToken")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("user "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("user"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("role "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("user"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("role"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'user'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("user"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  app"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("role"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'auth'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("ctx")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("service"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("auth"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("authToken")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("user "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("user"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br"),n("span",{staticClass:"line-number"},[t._v("20")]),n("br"),n("span",{staticClass:"line-number"},[t._v("21")]),n("br"),n("span",{staticClass:"line-number"},[t._v("22")]),n("br"),n("span",{staticClass:"line-number"},[t._v("23")]),n("br")])]),n("h3",{attrs:{id:"会话跟踪"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#会话跟踪"}},[t._v("#")]),t._v(" 会话跟踪")]),t._v(" "),n("h4",{attrs:{id:"会话"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#会话"}},[t._v("#")]),t._v(" 会话")]),t._v(" "),n("p",[t._v("客户端打开与服务器的"),n("strong",[t._v("连接发出请求到服务器响应客户端请求的全过程")]),t._v("称之为会话。")]),t._v(" "),n("h4",{attrs:{id:"会话跟踪-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#会话跟踪-2"}},[t._v("#")]),t._v(" 会话跟踪")]),t._v(" "),n("p",[t._v("会话跟踪指的是"),n("strong",[t._v("对同一个用户对服务器的连续的请求和接受响应的监视")]),t._v("。")]),t._v(" "),n("h4",{attrs:{id:"会话跟踪必要"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#会话跟踪必要"}},[t._v("#")]),t._v(" 会话跟踪必要")]),t._v(" "),n("p",[t._v("浏览器与服务器之间的通信是通过HTTP协议进行通信的，而HTTP协议是”无状态”的协议，它不能保存客户的信息，即一次响应完成之后连接就断开了，下一次的请求需要重新连接，这样就需要判断是否是同一个用户，所以才有会话跟踪技术来实现这种要求。")]),t._v(" "),n("h4",{attrs:{id:"会话跟踪常用的方法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#会话跟踪常用的方法"}},[t._v("#")]),t._v(" 会话跟踪常用的方法")]),t._v(" "),n("h5",{attrs:{id:"url-重写"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#url-重写"}},[t._v("#")]),t._v(" URL 重写")]),t._v(" "),n("p",[t._v("URL(统一资源定位符)是Web上特定页面的地址，URL重写的技术就是在URL结尾添加一个附加数据以标识该会话,把会话ID通过URL的信息传递过去，以便在服务器端进行识别不同的用户。")]),t._v(" "),n("h5",{attrs:{id:"隐藏表单域"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#隐藏表单域"}},[t._v("#")]),t._v(" 隐藏表单域")]),t._v(" "),n("p",[t._v("将会话ID添加到HTML表单元素中提交到服务器，此表单元素并不在客户端显示")]),t._v(" "),n("h5",{attrs:{id:"cookie-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#cookie-2"}},[t._v("#")]),t._v(" Cookie")]),t._v(" "),n("p",[t._v("Cookie 是Web 服务器发送给客户端的一小段信息，客户端请求时可以读取该信息发送到服务器端，进而进行用户的识别。对于客户端的每次请求，服务器都会将 Cookie 发送到客户端,在客户端可以进行保存,以便下次使用。")]),t._v(" "),n("p",[t._v("客户端可以采用两种方式来保存这个 Cookie 对象，一种方式是保存在客户端内存中，称为临时 Cookie，浏览器关闭后这个 Cookie 对象将消失。另外一种方式是保存在客户机的磁盘上，称为永久 Cookie。以后客户端只要访问该网站，就会将这个 Cookie 再次发送到服务器上，前提是这个 Cookie 在有效期内，这样就实现了对客户的跟踪。Cookie 是可以被客户端禁用的。")]),t._v(" "),n("h5",{attrs:{id:"session"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#session"}},[t._v("#")]),t._v(" Session")]),t._v(" "),n("p",[t._v("每一个用户都有一个不同的 session，各个用户之间是不能共享的，是每个用户所独享的，在 session 中可以存放信息。")]),t._v(" "),n("p",[n("strong",[t._v("在服务器端会创建一个 session 对象，产生一个 sessionID 来标识这个 session 对象，然后将这个 sessionID 放入到 Cookie 中发送到客户端")]),t._v("，下一次访问时，sessionID 会发送到服务器，在服务器端进行识别不同的用户。")]),t._v(" "),n("p",[n("strong",[t._v("Session 的实现依赖于 Cookie，如果 Cookie 被禁用，那么 session 也将失效。")])]),t._v(" "),n("h2",{attrs:{id:"缓存"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#缓存"}},[t._v("#")]),t._v(" 缓存")]),t._v(" "),n("h3",{attrs:{id:"分类【要点】"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#分类【要点】"}},[t._v("#")]),t._v(" 分类【要点】")]),t._v(" "),n("h4",{attrs:{id:"按协议分"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#按协议分"}},[t._v("#")]),t._v(" 按协议分")]),t._v(" "),n("ul",[n("li",[n("strong",[t._v("非http协议层缓存")]),t._v("：利用 "),n("code",[t._v("meta")]),t._v(" 标签的 "),n("code",[t._v("http-equiv")]),t._v(" 属性值 ；"),n("code",[t._v("Expires")]),t._v(","),n("code",[t._v("set-cookie")]),t._v("。")]),t._v(" "),n("li",[n("strong",[t._v("协议层缓存")]),t._v("：利用 http 协议头属性值设置；")])]),t._v(" "),n("h4",{attrs:{id:"协议层缓存再分类"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#协议层缓存再分类"}},[t._v("#")]),t._v(" "),n("strong",[t._v("协议层缓存再分类")])]),t._v(" "),n("ul",[n("li",[n("strong",[t._v("强缓存")]),t._v("：利用 "),n("strong",[t._v("cache-control 和 expires")]),t._v(" 设置，直接返回一个过期时间，所以在缓存期间不请求；")]),t._v(" "),n("li",[n("strong",[t._v("协商缓存")]),t._v("：响应头返回 "),n("strong",[t._v("etag 或 last-modified")]),t._v(" 的哈希值，"),n("strong",[t._v("第二次请求头 If-none-match 或 IF-modify-since 携带上次哈希值")]),t._v("，一致则返回 304。")])]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("类型")]),t._v(" "),n("th",[t._v("特性")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("强缓存")]),t._v(" "),n("td",[t._v("通过 expires 和 cache-control 设置，属性值是时间，所以在时间内不用请求")])]),t._v(" "),n("tr",[n("td",[t._v("协商缓存")]),t._v(" "),n("td",[t._v("通过 If-none-match(etag)设置，etag 属性是哈希值，所以要请求和服务器值对比")])])])]),t._v(" "),n("h5",{attrs:{id:"缓存比较"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#缓存比较"}},[t._v("#")]),t._v(" 缓存比较")]),t._v(" "),n("blockquote",[n("p",[t._v("强制缓存的优先级高于协商缓存，当执行强制缓存时，如若缓存命中，则直接使用缓存数据库数据，不在进行缓存协商。")])]),t._v(" "),n("p",[n("strong",[t._v("协商缓存对比")]),t._v("： etag 优先级高于 last-modified；\n"),n("strong",[t._v("etag 精度高")]),t._v("，last-modified 精度是 s，1s 内 etag 修改多少次都会被记录；\n"),n("strong",[t._v("last-modified 性能好")]),t._v("，etag 要得到 hash 值。")]),t._v(" "),n("p",[t._v("如果不是强制刷新，而且请求头带上了if-modified-since和if-none-match两个字段，"),n("strong",[t._v("则先判断etag，再判断last-modified。")])]),t._v(" "),n("h5",{attrs:{id:"校验过期机制"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#校验过期机制"}},[t._v("#")]),t._v(" 校验过期机制")]),t._v(" "),n("ul",[n("li",[t._v("校验是否过期：   Expires, Cache-Control(max-age)")]),t._v(" "),n("li",[t._v("协议Etag头信息校验；  Etag")]),t._v(" "),n("li",[t._v("协议中Last-Modified头信息校验；Last-Modified")])]),t._v(" "),n("h5",{attrs:{id:"应用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#应用"}},[t._v("#")]),t._v(" 应用")]),t._v(" "),n("p",[t._v("webpack可以让在打包的时候，在文件的命名上带上hash值。可以得出一个较为合理的缓存方案：")]),t._v(" "),n("ul",[n("li",[n("strong",[t._v("HTML：使用协商缓存。")])]),t._v(" "),n("li",[n("strong",[t._v("CSS&JS&图片：使用强缓存，文件命名带上hash值。")])])]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("entry"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    main"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./main.js'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    vendor"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'react'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'antd'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\noutput"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    path"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./dist'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    publicPath"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/dist/'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    filname"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'bundle.[chunkhash].js'")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br")])]),n("blockquote",[n("h5",{attrs:{id:"哈希的设置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#哈希的设置"}},[t._v("#")]),t._v(" 哈希的设置")])]),t._v(" "),n("p",[t._v("webpack有三种哈希值计算方式，分别是hash、chunkhash和contenthash。")]),t._v(" "),n("ul",[n("li",[t._v("hash：跟整个项目的构建相关，"),n("strong",[t._v("构建生成的文件hash值都是一样的")]),t._v("，只要项目里有文件更改，整个项目构建的hash值都会更改。")]),t._v(" "),n("li",[t._v("chunkhash：根据"),n("strong",[t._v("不同的入口文件(Entry)进行依赖文件解析")]),t._v("、构建对应的chunk，生成对应的hash值。")]),t._v(" "),n("li",[t._v("contenthash：由"),n("strong",[t._v("文件内容产生的hash值")]),t._v("，内容不同产生的contenthash值也不一样。")])]),t._v(" "),n("p",[t._v("显然，是不会使用第一种的。改了一个文件，打包之后，其他文件的hash都变了，缓存自然都失效了。")]),t._v(" "),n("p",[t._v("那chunkhash和contenthash的主要应用场景是什么呢？在实际在项目中，我们"),n("strong",[t._v("一般会把项目中的css都抽离出对应的css文件来加以引用")]),t._v("。如果"),n("strong",[t._v("我们使用chunkhash，当我们改了css代码之后，会发现css文件hash值改变的同时，js文件的hash值也会改变。这时候，contenthash就派上用场了")]),t._v("。")]),t._v(" "),n("h3",{attrs:{id:"相关设置参数【要点】"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#相关设置参数【要点】"}},[t._v("#")]),t._v(" 相关设置参数【要点】")]),t._v(" "),n("h4",{attrs:{id:"expires"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#expires"}},[t._v("#")]),t._v(" Expires")]),t._v(" "),n("blockquote",[n("p",[t._v("Exprires的值为服务端返回的数据到期时间")])]),t._v(" "),n("p",[n("strong",[t._v("Expires是一个绝对时间，即服务器时间")]),t._v("。浏览器检查当前时间，如果还没到失效时间就直接使用缓存文件。但由于服务端时间和客户端时间可能有误差，这也将导致缓存命中的误差，另一方面，"),n("strong",[t._v("Expires是HTTP1.0的产物，故现在大多数使用Cache-Control替代。")])]),t._v(" "),n("h4",{attrs:{id:"cache-control"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#cache-control"}},[t._v("#")]),t._v(" Cache-Control")]),t._v(" "),n("p",[t._v("cache-control中的"),n("strong",[t._v("max-age保存一个相对时间")]),t._v("。例如Cache-Control: max-age = 484200，"),n("strong",[t._v("表示浏览器收到文件后，缓存在484200s内均有效")]),t._v("。如果同时存在cache-control和Expires，"),n("strong",[t._v("浏览器总是优先使用cache-control。")])]),t._v(" "),n("h5",{attrs:{id:"相关属性"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#相关属性"}},[t._v("#")]),t._v(" 相关属性")]),t._v(" "),n("p",[n("code",[t._v("private")]),t._v("：客户端可以缓存 ;\n"),n("code",[t._v("public")]),t._v("："),n("strong",[t._v("客户端和代理服务器")]),t._v("都可以缓存 【记】; "),n("code",[t._v("public,max-age=3600")]),t._v(" "),n("code",[t._v("max-age=t")]),t._v("：缓存内容将在t秒后失效 【记】;\n"),n("code",[t._v("no-cache")]),t._v("：需要"),n("strong",[t._v("使用协商缓存来验证缓存数据")]),t._v(" 【记】;\n"),n("code",[t._v("no-store")]),t._v("：所有内容都不会缓存")]),t._v(" "),n("h5",{attrs:{id:"请求响应头字段"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#请求响应头字段"}},[t._v("#")]),t._v(" 请求响应头字段")]),t._v(" "),n("p",[n("strong",[t._v("Cache-Control 作为请求头字段")]),t._v(" "),n("img",{attrs:{src:a(923),alt:""}}),t._v(" "),n("strong",[t._v("Cache-Control 作为响应头字段")]),t._v(" "),n("img",{attrs:{src:a(924),alt:""}}),t._v(" "),n("strong",[t._v("http1.1版本后请求头部字段 & 响应头部字段")]),t._v("添加了新字段；\n"),n("img",{attrs:{src:a(925),alt:""}})]),t._v(" "),n("p",[t._v("注意："),n("code",[t._v("If-None-Match")]),t._v("(etag)的优先级比"),n("code",[t._v("If-Modified-Since")]),t._v("(last-modified)高，两者同时存在时，遵从前者。")]),t._v(" "),n("p",[n("strong",[t._v("参数")])]),t._v(" "),n("p",[n("strong",[t._v("可缓存性")]),t._v("：public, private(当前浏览器可以缓存), "),n("strong",[t._v("no-cache(要服务器协商验证)")]),t._v(" "),n("strong",[t._v("到期")]),t._v(": "),n("code",[t._v("max-age=<seconds>")]),t._v(" ,"),n("code",[t._v("s-maxage=<seconds>")]),t._v(" , "),n("code",[t._v("max-stale=<seconds>")]),t._v(" "),n("strong",[t._v("重新验证")]),t._v("：must-revalidate,  proxy-revalidate\n"),n("strong",[t._v("其他")]),t._v("：no-store（本地，代理，都不能缓存）, no-transform")]),t._v(" "),n("h4",{attrs:{id:"last-modified-if-modified-since"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#last-modified-if-modified-since"}},[t._v("#")]),t._v(" Last-Modified/If-Modified-Since")]),t._v(" "),n("p",[n("strong",[t._v("last-modified是第一次请求资源时，服务器返回的字段")]),t._v("，表示最后一次更新的时间。"),n("strong",[t._v("下一次浏览器请求资源时就发送if-modified-since字段")]),t._v("。服务器用本地Last-modified时间与if-modified-since时间比较，如果不一致则认为缓存已过期并返回新资源给浏览器；如果时间一致则发送304状态码，让浏览器继续使用缓存。")]),t._v(" "),n("h4",{attrs:{id:"etag-if-none-match"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#etag-if-none-match"}},[t._v("#")]),t._v(" Etag/ If-None-Match")]),t._v(" "),n("p",[t._v("Etag："),n("strong",[t._v("资源的实体标识（哈希字符串）")]),t._v("，"),n("strong",[t._v("当资源内容更新时，Etag会改变。服务器会判断Etag是否发生变化")]),t._v("，如果变化则返回新资源，否则返回304。")]),t._v(" "),n("h4",{attrs:{id:"总括要点-4个-【ceel】"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#总括要点-4个-【ceel】"}},[t._v("#")]),t._v(" 总括要点(4个)【CEEL】")]),t._v(" "),n("h5",{attrs:{id:"优先级"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#优先级"}},[t._v("#")]),t._v(" 优先级")]),t._v(" "),n("ul",[n("li",[t._v("强制缓存的优先级高于协商缓存，当执行强制缓存时，如若缓存命中，则直接使用缓存数据库数据，不在进行缓存协商。")]),t._v(" "),n("li",[t._v("如果不是强制刷新，而且请求头带上了if-modified-since和if-none-match两个字段，"),n("strong",[t._v("则先判断etag，再判断last-modified。")])]),t._v(" "),n("li",[t._v("处理顺序："),n("strong",[t._v("强制缓存 > 协商缓存; cache-control > Expires > Etag > Last-modified")])])]),t._v(" "),n("p",[n("strong",[t._v("作用")]),t._v(": 减少网络传输的损耗以及降低服务器压力。")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("强缓存")]),t._v(" "),n("ul",[n("li",[t._v("Expires")]),t._v(" "),n("li",[t._v("cache-control")])])]),t._v(" "),n("li",[n("p",[t._v("协商缓存 , Cache-control 设置为no-cache，max-age=t过期时；")]),t._v(" "),n("ul",[n("li",[t._v("Last-Modified 和 If-Modified-Since")]),t._v(" "),n("li",[t._v("Etag 和 If-None-Match")])])])]),t._v(" "),n("h5",{attrs:{id:"nodejs自己设置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nodejs自己设置"}},[t._v("#")]),t._v(" nodejs自己设置")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("res.setHeader('Cache-Control',")]),t._v("public, max-age=${maxAge}"),n("code",[t._v(");")])]),t._v(" "),n("li",[n("code",[t._v("res.setHeader('Expires', (new Date(Date.now() + maxAge * 1000)).toUTCString());")])]),t._v(" "),n("li",[n("code",[t._v("res.setHeader('ETag',")]),t._v("${stats.size}-${stats.mtime.toUTCString()}"),n("code",[t._v(");")])]),t._v(" "),n("li",[n("code",[t._v("res.setHeader('Last-Modified', stats.mtime.toUTCString());")])])]),t._v(" "),n("blockquote",[n("h4",{attrs:{id:"http-响应头中的-date-与-last-modified-有什么不同-网站部署时需要注意什么"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#http-响应头中的-date-与-last-modified-有什么不同-网站部署时需要注意什么"}},[t._v("#")]),t._v(" http 响应头中的 Date 与 Last-Modified 有什么不同，网站部署时需要注意什么")])]),t._v(" "),n("p",[t._v("简而言之，一个静态资源"),n("strong",[t._v("没有设置 "),n("code",[t._v("Cache-Control")]),t._v(" 时会以这两个响应头来设置强制缓存时间，而非直接进行协商缓存")]),t._v("。在涉及到 CDN 时，表现更为明显，体现在更新代码部署后，界面没有更新。")]),t._v(" "),n("h3",{attrs:{id:"浏览器读取缓存流程-4步骤"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#浏览器读取缓存流程-4步骤"}},[t._v("#")]),t._v(" 浏览器读取缓存流程(4步骤)")]),t._v(" "),n("blockquote",[n("p",[t._v("F5 刷新会忽略强缓存不会忽略协商缓存，ctrl+f5 都失效")])]),t._v(" "),n("ol",[n("li",[n("strong",[t._v("会先判断强缓存")]),t._v("；Cache-Control(max-age) no-cache=true, public ；Expires,")]),t._v(" "),n("li",[n("strong",[t._v("再判断协商缓存 "),n("code",[t._v("etag")]),t._v("及"),n("code",[t._v("last-modified")]),t._v("是否存在")]),t._v("；存在利用属性 If-None-match（etag）If-Modified-since(last-modified)携带值(这一步叫做"),n("strong",[t._v("数据签名")]),t._v(")；")]),t._v(" "),n("li",[n("strong",[t._v("请求服务器,服务器对比 etag(last-modified)，生效返回 304")])])]),t._v(" "),n("p",[t._v("图示流程：")]),t._v(" "),n("p",[n("img",{attrs:{src:a(926),alt:""}}),t._v(" "),n("img",{attrs:{src:a(927),alt:""}})]),t._v(" "),n("p",[t._v("代码处理示例：\n"),n("img",{attrs:{src:a(928),alt:""}})]),t._v(" "),n("h3",{attrs:{id:"缓存的优点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#缓存的优点"}},[t._v("#")]),t._v(" 缓存的优点")]),t._v(" "),n("ol",[n("li",[t._v("减少了冗余的数据传递，"),n("strong",[t._v("节省宽带流量")])]),t._v(" "),n("li",[t._v("减少了"),n("strong",[t._v("服务器的负担，大大提高了网站性能")])]),t._v(" "),n("li",[n("strong",[t._v("加快了客户端加载网页的速度")]),t._v(" 这也正是HTTP缓存属于客户端缓存的原因。")])]),t._v(" "),n("h3",{attrs:{id:"缓存的流程图【要点】"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#缓存的流程图【要点】"}},[t._v("#")]),t._v(" 缓存的流程图【要点】")]),t._v(" "),n("p",[n("img",{attrs:{src:a(929),alt:""}})]),t._v(" "),n("p",[n("img",{attrs:{src:a(930),alt:""}})]),t._v(" "),n("h3",{attrs:{id:"不同刷新的请求执行过程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#不同刷新的请求执行过程"}},[t._v("#")]),t._v(" 不同刷新的请求执行过程")]),t._v(" "),n("ol",[n("li",[n("p",[n("strong",[t._v("浏览器地址栏中写入URL，回车")]),t._v(" 浏览器发现缓存中有这个文件了，不用继续请求了，直接去缓存拿."),n("strong",[t._v("（最快）")])])]),t._v(" "),n("li",[n("p",[n("strong",[t._v("F5")]),t._v(" F5就是告诉浏览器，别偷懒，好歹"),n("strong",[t._v("去服务器看看这个文件是否有过期")]),t._v("了。于是浏览器就胆胆襟襟的发送一个请求带上If-Modify-since。")])]),t._v(" "),n("li",[n("p",[n("strong",[t._v("Ctrl+F5")]),t._v(" 告诉浏览器，你先把你缓存中的这个文件给我删了，然后再去服务器请求个完整的资源文件下来。"),n("strong",[t._v("于是客户端就完成了强行更新的操作.")])])])]),t._v(" "),n("blockquote",[n("h4",{attrs:{id:"_200-from-cache和200-ok有什么区别"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_200-from-cache和200-ok有什么区别"}},[t._v("#")]),t._v(" 200 From cache和200 OK有什么区别")])]),t._v(" "),n("ul",[n("li",[t._v("顾名思义是form cache是强缓存，不会和服务器通信，")]),t._v(" "),n("li",[t._v("而200 OK即为服务器处理结果正确。以此可以从浏览器缓存、输入url回车、刷新页面以及强制刷新等方面展开缓存方面的讲解。")])]),t._v(" "),n("blockquote",[n("h4",{attrs:{id:"能不能说下-304-的过程-以及影响缓存的头部属性有哪些"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#能不能说下-304-的过程-以及影响缓存的头部属性有哪些"}},[t._v("#")]),t._v(" 能不能说下 304 的过程，以及影响缓存的头部属性有哪些？")])]),t._v(" "),n("p",[t._v("写那个缓存流程图即可；")]),t._v(" "),n("ul",[n("li",[t._v("1、对于强制缓存，服务器通知浏览器一个缓存时间，在缓存时间内，下次请求，直接用缓存，不在时间内，执行比较缓存策略；")]),t._v(" "),n("li",[t._v("2、对于比较缓存，将缓存信息中的Etag和Last-Modified通过请求发送给服务器，由服务器校验，返回304状态码时，浏览器直接使用缓存；")])]),t._v(" "),n("h3",{attrs:{id:"服务器处理缓存"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#服务器处理缓存"}},[t._v("#")]),t._v(" 服务器处理缓存")]),t._v(" "),n("h4",{attrs:{id:"etag的生成"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#etag的生成"}},[t._v("#")]),t._v(" etag的生成")]),t._v(" "),n("p",[t._v("**"),n("code",[t._v("nginx")]),t._v(" 中 "),n("code",[t._v("etag")]),t._v(" 由响应头的 "),n("code",[t._v("Last-Modified")]),t._v(" 与 "),n("code",[t._v("Content-Length")]),t._v(" 表示为十六进制组合而成。**而 "),n("code",[t._v("last_modified")]),t._v(" 又由 "),n("code",[t._v("mtime")]),t._v(" 组成；")]),t._v(" "),n("p",[t._v("源码: "),n("a",{attrs:{href:"https://github.com/nginx/nginx/blob/6c3838f9ed45f5c2aa6a971a0da3cb6ffe45b61e/src/http/ngx_http_core_module.c#L1582",target:"_blank",rel:"noopener noreferrer"}},[t._v("ngx_http_core_modules.c"),n("OutboundLink")],1)]),t._v(" "),n("div",{staticClass:"language-c line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[t._v("etag"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v("value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("len "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ngx_sprintf")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("etag"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v("value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\"%xT-%xO\\""')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                              r"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v("headers_out"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("last_modified_time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                              r"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v("headers_out"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("content_length_n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" etag"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v("value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br")])]),n("p",[t._v("由 "),n("code",[t._v("etag")]),t._v(" 计算 "),n("code",[t._v("Last-Modified")]),t._v(" 与 "),n("code",[t._v("Content-Length")]),t._v("，使用 "),n("code",[t._v("js")]),t._v(" 计算如下，结果相符")]),t._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" new Date"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("parseInt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'5cbee66d'")]),t._v(", "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" * "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(".toJSON"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2019-04-23T10:18:21.000Z"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" parseInt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'264'")]),t._v(", "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("612")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br")])]),n("blockquote",[n("h4",{attrs:{id:"如果-http-响应头中-etag-值改变了-是否意味着文件内容一定已经更改"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#如果-http-响应头中-etag-值改变了-是否意味着文件内容一定已经更改"}},[t._v("#")]),t._v(" 如果 http 响应头中 ETag 值改变了，是否意味着文件内容一定已经更改")])]),t._v(" "),n("p",[t._v("不一定，由服务器中 "),n("code",[t._v("ETag")]),t._v(" 的生成算法决定。\n比如 "),n("code",[t._v("nginx")]),t._v(" 中的 "),n("code",[t._v("etag")]),t._v(" 由 "),n("code",[t._v("last_modified")]),t._v(" 与 "),n("code",[t._v("content_length")]),t._v(" 组成，而 "),n("code",[t._v("last_modified")]),t._v(" 又由 "),n("code",[t._v("mtime")]),t._v(" 组成\n当编辑文件却未更改文件内容时，或者 "),n("code",[t._v("touch file")]),t._v("，"),n("code",[t._v("mtime")]),t._v(" 也会改变，此时 "),n("code",[t._v("etag")]),t._v(" 改变，但是文件内容没有更改。")]),t._v(" "),n("h4",{attrs:{id:"last-modified的生成"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#last-modified的生成"}},[t._v("#")]),t._v(" Last-Modified的生成")]),t._v(" "),n("p",[n("code",[t._v("Last-Modified")]),t._v(" 是由一个 "),n("code",[t._v("unix timestamp")]),t._v(" 表示，则"),n("strong",[t._v("意味着它只能作用于秒级的改变")])]),t._v(" "),n("p",[t._v("一般会选文件的 "),n("code",[t._v("mtime")]),t._v("，表示文件内容的修改时间；")]),t._v(" "),n("p",[n("code",[t._v("nginx")]),t._v(" 也是这样处理的，源码见: "),n("a",{attrs:{href:"https://github.com/nginx/nginx/blob/4bf4650f2f10f7bbacfe7a33da744f18951d416d/src/http/modules/ngx_http_static_module.c#L217",target:"_blank",rel:"noopener noreferrer"}},[t._v("ngx_http_static_module.c"),n("OutboundLink")],1)]),t._v(" "),n("div",{staticClass:"language-c line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[t._v("r"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v("headers_out"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" NGX_HTTP_OK"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nr"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v("headers_out"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("content_length_n "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" of"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("size"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nr"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v("headers_out"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("last_modified_time "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" of"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mtime"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br")])]),n("h4",{attrs:{id:"node处理示例"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#node处理示例"}},[t._v("#")]),t._v(" node处理示例")]),t._v(" "),n("p",[t._v("**在Express中，使用了"),n("a",{attrs:{href:"https://github.com/jshttp/fresh",target:"_blank",rel:"noopener noreferrer"}},[t._v("fresh"),n("OutboundLink")],1),t._v("这个包来判断是否是最新的资源。**主要源码如下：")]),t._v(" "),n("p",[t._v("可以看到，如果不是强制刷新，而且请求头带上了if-modified-since和if-none-match两个字段，"),n("strong",[t._v("则先判断etag，再判断last-modified")]),t._v("。当然，如果你不喜欢这种策略，也可以自己实现一个。")]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("fresh")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("reqHeaders"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" resHeaders")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// fields")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" modifiedSince "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" reqHeaders"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'if-modified-since'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" noneMatch "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" reqHeaders"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'if-none-match'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// unconditional request")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("modifiedSince "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("noneMatch"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Always return stale when Cache-Control: no-cache")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// to support end-to-end reload requests")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// https://tools.ietf.org/html/rfc2616#section-14.9.4")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" cacheControl "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" reqHeaders"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cache-control'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cacheControl "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("CACHE_CONTROL_NO_CACHE_REGEXP")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("test")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cacheControl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// if-none-match")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("noneMatch "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" noneMatch "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'*'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" etag "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" resHeaders"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'etag'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("etag"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" etagStale "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" matches "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("parseTokenList")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("noneMatch"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" i "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" matches"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" match "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" matches"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("match "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" etag "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" match "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'W/'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" etag "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'W/'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" match "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" etag"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        etagStale "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("break")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("etagStale"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// if-modified-since")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("modifiedSince"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" lastModified "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" resHeaders"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'last-modified'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" modifiedStale "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("lastModified "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("parseHttpDate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lastModified"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("parseHttpDate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("modifiedSince"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("modifiedStale"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br"),n("span",{staticClass:"line-number"},[t._v("20")]),n("br"),n("span",{staticClass:"line-number"},[t._v("21")]),n("br"),n("span",{staticClass:"line-number"},[t._v("22")]),n("br"),n("span",{staticClass:"line-number"},[t._v("23")]),n("br"),n("span",{staticClass:"line-number"},[t._v("24")]),n("br"),n("span",{staticClass:"line-number"},[t._v("25")]),n("br"),n("span",{staticClass:"line-number"},[t._v("26")]),n("br"),n("span",{staticClass:"line-number"},[t._v("27")]),n("br"),n("span",{staticClass:"line-number"},[t._v("28")]),n("br"),n("span",{staticClass:"line-number"},[t._v("29")]),n("br"),n("span",{staticClass:"line-number"},[t._v("30")]),n("br"),n("span",{staticClass:"line-number"},[t._v("31")]),n("br"),n("span",{staticClass:"line-number"},[t._v("32")]),n("br"),n("span",{staticClass:"line-number"},[t._v("33")]),n("br"),n("span",{staticClass:"line-number"},[t._v("34")]),n("br"),n("span",{staticClass:"line-number"},[t._v("35")]),n("br"),n("span",{staticClass:"line-number"},[t._v("36")]),n("br"),n("span",{staticClass:"line-number"},[t._v("37")]),n("br"),n("span",{staticClass:"line-number"},[t._v("38")]),n("br"),n("span",{staticClass:"line-number"},[t._v("39")]),n("br"),n("span",{staticClass:"line-number"},[t._v("40")]),n("br"),n("span",{staticClass:"line-number"},[t._v("41")]),n("br"),n("span",{staticClass:"line-number"},[t._v("42")]),n("br"),n("span",{staticClass:"line-number"},[t._v("43")]),n("br"),n("span",{staticClass:"line-number"},[t._v("44")]),n("br"),n("span",{staticClass:"line-number"},[t._v("45")]),n("br"),n("span",{staticClass:"line-number"},[t._v("46")]),n("br"),n("span",{staticClass:"line-number"},[t._v("47")]),n("br"),n("span",{staticClass:"line-number"},[t._v("48")]),n("br"),n("span",{staticClass:"line-number"},[t._v("49")]),n("br"),n("span",{staticClass:"line-number"},[t._v("50")]),n("br")])]),n("p",[t._v("自己实现的缓存处理；"),n("code",[t._v("cache.js")])]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("cache"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'../config/defaultConfig'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("refreshRes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("stats"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("maxAge"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" expires"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" cacheControl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" lastModified"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" etag"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" cache"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cacheControl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setHeader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Cache-Control'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("public, max-age=")]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("maxAge"),n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("expires"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setHeader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Expires'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Date")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Date"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("now")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" maxAge "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("toUTCString")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("etag"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setHeader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ETag'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("stats"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("size"),n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("stats"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mtime"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("toUTCString")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lastModified"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// mtime 需要转成字符串，否则在 windows 环境下会报错")]),t._v("\n        res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setHeader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Last-Modified'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" stats"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mtime"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("toUTCString")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nmodule"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("exports")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isFresh")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("stats"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("refreshRes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("stats"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//304请求跟提交的对比")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" lastModified "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("headers"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'if-modified-since'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" etag "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("headers"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'if-none-match'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("lastModified "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("etag"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("etag "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" etag "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getHeader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ETag'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Request Headers跟 Response Headers 中的 Last-Modified一样；")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lastModified "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" lastModified "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getHeader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Last-Modified'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//route.js")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isFresh")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("stats"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//缓存【304】")]),t._v("\n    res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("statusCode "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("304")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("end")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br"),n("span",{staticClass:"line-number"},[t._v("20")]),n("br"),n("span",{staticClass:"line-number"},[t._v("21")]),n("br"),n("span",{staticClass:"line-number"},[t._v("22")]),n("br"),n("span",{staticClass:"line-number"},[t._v("23")]),n("br"),n("span",{staticClass:"line-number"},[t._v("24")]),n("br"),n("span",{staticClass:"line-number"},[t._v("25")]),n("br"),n("span",{staticClass:"line-number"},[t._v("26")]),n("br"),n("span",{staticClass:"line-number"},[t._v("27")]),n("br"),n("span",{staticClass:"line-number"},[t._v("28")]),n("br"),n("span",{staticClass:"line-number"},[t._v("29")]),n("br"),n("span",{staticClass:"line-number"},[t._v("30")]),n("br"),n("span",{staticClass:"line-number"},[t._v("31")]),n("br"),n("span",{staticClass:"line-number"},[t._v("32")]),n("br"),n("span",{staticClass:"line-number"},[t._v("33")]),n("br"),n("span",{staticClass:"line-number"},[t._v("34")]),n("br"),n("span",{staticClass:"line-number"},[t._v("35")]),n("br"),n("span",{staticClass:"line-number"},[t._v("36")]),n("br"),n("span",{staticClass:"line-number"},[t._v("37")]),n("br"),n("span",{staticClass:"line-number"},[t._v("38")]),n("br"),n("span",{staticClass:"line-number"},[t._v("39")]),n("br"),n("span",{staticClass:"line-number"},[t._v("40")]),n("br")])]),n("h3",{attrs:{id:"http中的优化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#http中的优化"}},[t._v("#")]),t._v(" HTTP中的优化")]),t._v(" "),n("h4",{attrs:{id:"优化【要点】"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#优化【要点】"}},[t._v("#")]),t._v(" 优化【要点】")]),t._v(" "),n("ul",[n("li",[t._v("减少网站中使用的域名 域名越多 ， DNS 解析花费的时间越多。")]),t._v(" "),n("li",[t._v("减少网站中的重定向操作，重定向会增加请求数量。")]),t._v(" "),n("li",[t._v("选用高性能的Web服务器 Nginx 代理静态资源 。")]),t._v(" "),n("li",[t._v("资源大小优化：对资源进行压缩、合并（合并可以减少请求，也会产生文件缓存问题）， 使用 gzip/br 压缩。")]),t._v(" "),n("li",[t._v("给资源添加强制缓存和协商缓存。")]),t._v(" "),n("li",[t._v("升级 HTTP/1.x 到 HTTP/2")]),t._v(" "),n("li",[t._v("付费、将静态资源迁移至 CDN；")])]),t._v(" "),n("h4",{attrs:{id:"timing"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#timing"}},[t._v("#")]),t._v(" Timing")]),t._v(" "),n("p",[n("img",{attrs:{src:a(931),alt:"image-20211104202528136"}})]),t._v(" "),n("ul",[n("li",[t._v("Queuing : 请求发送前会根据优先级进行排队，同时每个域名最多处理6个TCP链接，")]),t._v(" "),n("li",[t._v("超过的也会进行排队，并且分配磁盘空间时也会消耗一定时间。")]),t._v(" "),n("li",[t._v("Stalled :请求发出前的等待时间（处理代理，链接复用）")]),t._v(" "),n("li",[t._v("DNS lookup :查找 DNS 的时间")]),t._v(" "),n("li",[t._v("initial Connection :建立TCP链接时间")]),t._v(" "),n("li",[t._v("SSL : SSL 握手时间（ SSL 协商）")]),t._v(" "),n("li",[t._v("Request Sent :请求发送时间（可忽略）")]),t._v(" "),n("li",[t._v("Waiting ( TTFB ) :等待响应的时间，等待返回首个字符的时间")]),t._v(" "),n("li",[t._v("Content Dowloaded :用于下载响应的时间")])]),t._v(" "),n("h3",{attrs:{id:"cdn"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#cdn"}},[t._v("#")]),t._v(" CDN")]),t._v(" "),n("p",[t._v("CDN 的全称是Content Delivery Network，受制于网络的限制，访问者离服务器越远访问速度就越慢")]),t._v(" "),n("p",[t._v("核心就是"),n("strong",[t._v("离你最近的服务器给你提供数据")]),t._v(" （代理 + 缓存）")]),t._v(" "),n("ul",[n("li",[t._v("先在全国各地架设 CDN 服务器")]),t._v(" "),n("li",[t._v("正常访问网站会通过 DNS 解析，解析到对应的服务器解析1：我们通过 CDN 域名访问时，会被解析到 CDN 专用 DNS 服务器。并返回 CDN 全")]),t._v(" "),n("li",[t._v("解析1：我们通过 CDN 域名访问时，会被解析到 CDN 专用 DNS 服务器。并返回 CDN 全局负载均衡服务器的 IP 地址。")]),t._v(" "),n("li",[t._v("解析2：向全局负载均衡服务器发起请求，全局负载均衡服务器会根据用户 IP 分配用户所属区域的负载均衡服务器。并返回一台 CDN 服务器 IP 地址")]),t._v(" "),n("li",[t._v("用户向 CDN 服务器发起请求。如果服务器上不存在此文件。则向上一级缓存服务器请求，直至查找到源服务器，返回结果并缓存到 DNS 服务器上。")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(932),alt:"image-20211104202709379"}})]),t._v(" "),n("h2",{attrs:{id:"https-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#https-2"}},[t._v("#")]),t._v(" HTTPS")]),t._v(" "),n("h3",{attrs:{id:"https传输过程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#https传输过程"}},[t._v("#")]),t._v(" https传输过程")]),t._v(" "),n("p",[t._v("HTTPS其实是有两部分组成：HTTP + SSL / TLS，也就是"),n("strong",[t._v("在HTTP上又加了一层处理加密信息的模块")]),t._v("。\n服务端和客户端的信息传输"),n("strong",[t._v("都会通过TLS进行加密")]),t._v("，所以传输的数据都是加密后的数据。具体是如何进行加密，解密，验证的，且看下图。")]),t._v(" "),n("p",[t._v("https并不是直接通过非对称加密传输过程，"),n("strong",[t._v("而是有握手过程，握手过程主要是和服务器做通讯")]),t._v("，生成私有秘钥，最后通过该秘钥对称加密传输数据。还有验证证书的正确性。 证书验证过程保证了对方是合法的，并且中间人无法通过伪造证书方式进行攻击。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(933),alt:""}})]),t._v(" "),n("p",[n("img",{attrs:{src:a(934),alt:"image-20211104200657521"}})]),t._v(" "),n("h3",{attrs:{id:"主要解决三个安全问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#主要解决三个安全问题"}},[t._v("#")]),t._v(" 主要解决三个安全问题")]),t._v(" "),n("ol",[n("li",[t._v("内容隐私")]),t._v(" "),n("li",[t._v("防篡改")]),t._v(" "),n("li",[t._v("确认对方身份")])]),t._v(" "),n("h3",{attrs:{id:"http-与https的区别"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#http-与https的区别"}},[t._v("#")]),t._v(" HTTP 与HTTPS的区别")]),t._v(" "),n("p",[n("img",{attrs:{src:a(935),alt:""}})]),t._v(" "),n("h3",{attrs:{id:"问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#问题"}},[t._v("#")]),t._v(" 问题")]),t._v(" "),n("blockquote",[n("h4",{attrs:{id:"https用哪些端口进行通信-这些端口分别有什么用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#https用哪些端口进行通信-这些端口分别有什么用"}},[t._v("#")]),t._v(" https用哪些端口进行通信，这些端口分别有什么用")])]),t._v(" "),n("ul",[n("li",[t._v("443端口用来验证服务器端和客户端的身份，比如验证证书的合法性")]),t._v(" "),n("li",[t._v("80端口用来传输数据（在验证身份合法的情况下，用来数据传输）")])]),t._v(" "),n("blockquote",[n("h4",{attrs:{id:"身份验证过程中会涉及到密钥-对称加密-非对称加密-摘要的概念-请解释一下"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#身份验证过程中会涉及到密钥-对称加密-非对称加密-摘要的概念-请解释一下"}},[t._v("#")]),t._v(" 身份验证过程中会涉及到密钥， 对称加密，非对称加密，摘要的概念，请解释一下")])]),t._v(" "),n("ul",[n("li",[n("strong",[t._v("密钥")]),t._v("：密钥是一种参数，它是在明文转换为密文或将密文转换为明文的算法中输入的参数。密钥分为对称密钥与非对称密钥，分别应用在对称加密和非对称加密上。")]),t._v(" "),n("li",[n("strong",[t._v("对称加密")]),t._v("："),n("code",[t._v("对称加密又叫做私钥加密")]),t._v("，即信息的发送方和接收方使用同一个密钥去加密和解密数据。对称加密的特点是算法公开、加密和解密速度快，适合于对大数据量进行加密，常见的对称加密算法有DES、3DES、TDEA、Blowfish、RC5和IDEA。")]),t._v(" "),n("li",[n("strong",[t._v("非对称加密")]),t._v("："),n("code",[t._v("非对称加密也叫做公钥加密")]),t._v("。非对称加密与对称加密相比，其安全性更好。对称加密的通信双方使用相同的密钥，如果一方的密钥遭泄露，那么整个通信就会被破解。而非对称加密使用一对密钥，即公钥和私钥，且二者成对出现。私钥被自己保存，不能对外泄露。公钥指的是公共的密钥，任何人都可以获得该密钥。用公钥或私钥中的任何一个进行加密，用另一个进行解密。")]),t._v(" "),n("li",[n("strong",[t._v("摘要")]),t._v("： "),n("code",[t._v("摘要算法又称哈希/散列算法")]),t._v("。它通过一个函数，把任意长度的数据转换为一个长度固定的数据串（通常用16进制的字符串表示）。"),n("strong",[t._v("算法不可逆")]),t._v("。")])]),t._v(" "),n("blockquote",[n("h4",{attrs:{id:"中间人攻击"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#中间人攻击"}},[t._v("#")]),t._v(" 中间人攻击")])]),t._v(" "),n("p",[t._v("HTTPS 的过程并不是密不透风的，HTTPS 有若干漏洞，给**中间人攻击（Man In The Middle Attack，简称 MITM）**提供了可能。")]),t._v(" "),n("p",[t._v("所谓中间人攻击，指攻击者与通讯的两端分别建立独立的联系，并交换其所收到的数据，使通讯的两端认为他们正在通过一个私密的连接与对方直接对话，但事实上整个会话都被攻击者完全控制。"),n("strong",[t._v("在中间人攻击中，攻击者可以拦截通讯双方的通话并插入新的内容。")])]),t._v(" "),n("blockquote",[n("h4",{attrs:{id:"为什么需要ca机构对证书签名"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#为什么需要ca机构对证书签名"}},[t._v("#")]),t._v(" 为什么需要CA机构对证书签名")])]),t._v(" "),n("p",[t._v("如果"),n("strong",[t._v("不签名会存在中间人攻击的风险")]),t._v("，签名之后保证了证书里的信息，比如公钥、服务器信息、企业信息等不被篡改，能够验证客户端和服务器端的“"),n("strong",[t._v("合法性")]),t._v("”。")]),t._v(" "),n("blockquote",[n("h4",{attrs:{id:"https验证身份也就是tsl-ssl身份验证的过程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#https验证身份也就是tsl-ssl身份验证的过程"}},[t._v("#")]),t._v(" https验证身份也就是TSL/SSL身份验证的过程")])]),t._v(" "),n("p",[t._v("简要图解如下：\n"),n("img",{attrs:{src:a(936),alt:""}})]),t._v(" "),n("h2",{attrs:{id:"restful"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#restful"}},[t._v("#")]),t._v(" RESTful")]),t._v(" "),n("p",[t._v("一种比较成熟的应用程序的API设计理论；URL定位资源，用HTTP动词（GET,POST,DELETE,DETC）描述操作。")]),t._v(" "),n("p",[t._v("作为开发者尽量按照这种API设计风格设置，方便对接前端及第三方使用；")]),t._v(" "),n("h3",{attrs:{id:"格式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#格式"}},[t._v("#")]),t._v(" 格式")]),t._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("GET /api/v2/topics                             "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v("\nGET /api/v2/topics/57ea257b3670ca3f44c5beb6    "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v("\nPOST /api/v2/topics                            "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("201")]),t._v("\nPUT /api/v2/topics/57ea257b3670ca3f44c5beb6    "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("204")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br")])]),n("h3",{attrs:{id:"http动词【crud-pho】"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#http动词【crud-pho】"}},[t._v("#")]),t._v(" HTTP动词【CRUD PHO】")]),t._v(" "),n("p",[t._v("对于资源的具体操作类型，由HTTP动词表示。")]),t._v(" "),n("p",[t._v("常用的HTTP动词有下面五个（括号里是对应的SQL命令）。")]),t._v(" "),n("blockquote",[n("ul",[n("li",[t._v("GET（SELECT）：从服务器取出资源（一项或多项）。")]),t._v(" "),n("li",[t._v("POST（CREATE）：在服务器新建一个资源。")]),t._v(" "),n("li",[t._v("PUT（UPDATE）：在服务器更新资源（客户端提供改变后的完整资源）。")]),t._v(" "),n("li",[t._v("PATCH（UPDATE）：在服务器更新资源（客户端提供改变的属性）。")]),t._v(" "),n("li",[t._v("DELETE（DELETE）：从服务器删除资源。")])])]),t._v(" "),n("p",[t._v("还有两个不常用的HTTP动词。")]),t._v(" "),n("blockquote",[n("ul",[n("li",[t._v("HEAD：获取资源的元数据。")]),t._v(" "),n("li",[t._v("OPTIONS：获取信息，关于资源的哪些属性是客户端可以改变的。")])])]),t._v(" "),n("p",[t._v("下面是一些例子。")]),t._v(" "),n("blockquote",[n("ul",[n("li",[t._v("GET /zoos：列出所有动物园")]),t._v(" "),n("li",[t._v("POST /zoos：新建一个动物园")]),t._v(" "),n("li",[t._v("GET /zoos/ID：获取某个指定动物园的信息")]),t._v(" "),n("li",[t._v("PUT /zoos/ID：更新某个指定动物园的信息（提供该动物园的全部信息）")]),t._v(" "),n("li",[t._v("PATCH /zoos/ID：更新某个指定动物园的信息（提供该动物园的部分信息）")]),t._v(" "),n("li",[t._v("DELETE /zoos/ID：删除某个动物园")]),t._v(" "),n("li",[t._v("GET /zoos/ID/animals：列出某个指定动物园的所有动物")]),t._v(" "),n("li",[t._v("DELETE /zoos/ID/animals/ID：删除某个指定动物园的指定动物")])])]),t._v(" "),n("p",[n("img",{attrs:{src:a(937),alt:"image-20211103103955493"}})]),t._v(" "),n("p",[n("img",{attrs:{src:a(938),alt:"image-20211103104135232"}})]),t._v(" "),n("h3",{attrs:{id:"过滤信息-filtering"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#过滤信息-filtering"}},[t._v("#")]),t._v(" 过滤信息（Filtering）")]),t._v(" "),n("p",[t._v("如果记录数量很多，服务器不可能都将它们返回给用户。API应该提供参数，过滤返回结果。")]),t._v(" "),n("p",[t._v("下面是一些常见的参数。")]),t._v(" "),n("blockquote",[n("ul",[n("li",[t._v("?limit=10：指定返回记录的数量")]),t._v(" "),n("li",[t._v("?offset=10：指定返回记录的开始位置。")]),t._v(" "),n("li",[t._v("?page=2&per_page=100：指定第几页，以及每页的记录数。")]),t._v(" "),n("li",[t._v("?sortby=name&order=asc：指定返回结果按照哪个属性排序，以及排序顺序。")]),t._v(" "),n("li",[t._v("?animal_type_id=1：指定筛选条件")])])]),t._v(" "),n("p",[t._v("参数的设计允许存在冗余，即允许API路径和URL参数偶尔有重复。比如，GET /zoo/ID/animals 与 GET /animals?zoo_id=ID 的含义是相同的。")]),t._v(" "),n("h3",{attrs:{id:"状态码-status-codes"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#状态码-status-codes"}},[t._v("#")]),t._v(" 状态码（Status Codes）")]),t._v(" "),n("p",[t._v("服务器向用户返回的状态码和提示信息，常见的有以下一些（方括号中是该状态码对应的HTTP动词）。")]),t._v(" "),n("blockquote",[n("ul",[n("li",[t._v("200 OK - [GET]：服务器成功返回用户请求的数据，该操作是幂等的（Idempotent）。")]),t._v(" "),n("li",[t._v("201 CREATED - "),n("strong",[t._v("[POST/PUT/PATCH]：用户新建或修改数据成功。")])]),t._v(" "),n("li",[t._v("202 Accepted - [*]：表示一个请求已经进入后台排队（异步任务）")]),t._v(" "),n("li",[t._v("204 NO CONTENT - "),n("strong",[t._v("[DELETE]：用户删除数据成功")]),t._v("。")]),t._v(" "),n("li",[t._v("400 INVALID REQUEST - [POST/PUT/PATCH]：用户发出的请求有错误，服务器没有进行新建或修改数据的操作，该操作是幂等的。")]),t._v(" "),n("li",[t._v("401 Unauthorized - [*]：表示用户没有权限（令牌、用户名、密码错误）。")]),t._v(" "),n("li",[t._v("403 Forbidden - [*] 表示用户得到授权（与401错误相对），但是访问是被禁止的。")]),t._v(" "),n("li",[t._v("404 NOT FOUND - [*]：用户发出的请求针对的是不存在的记录，服务器没有进行操作，该操作是幂等的。")]),t._v(" "),n("li",[t._v("406 Not Acceptable - [GET]：用户请求的格式不可得（比如用户请求JSON格式，但是只有XML格式）。")]),t._v(" "),n("li",[t._v("410 Gone -[GET]：用户请求的资源被永久删除，且不会再得到的。")]),t._v(" "),n("li",[t._v("422 Unprocesable entity - [POST/PUT/PATCH] "),n("strong",[t._v("当创建一个对象时，发生一个验证错误")]),t._v("。")]),t._v(" "),n("li",[t._v("500 INTERNAL SERVER ERROR - [*]：服务器发生错误，用户将无法判断发出的请求是否成功。")])])]),t._v(" "),n("p",[t._v("状态码的完全列表参见"),n("a",{attrs:{href:"https://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("这里"),n("OutboundLink")],1),t._v("。")]),t._v(" "),n("h3",{attrs:{id:"错误处理-error-handling"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#错误处理-error-handling"}},[t._v("#")]),t._v(" 错误处理（Error handling）")]),t._v(" "),n("p",[t._v("如果状态码是4xx，就应该向用户返回出错信息。一般来说，返回的信息中将error作为键名，出错信息作为键值即可。")]),t._v(" "),n("blockquote",[n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    error"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Invalid API key"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br")])])]),t._v(" "),n("h3",{attrs:{id:"返回结果"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#返回结果"}},[t._v("#")]),t._v(" 返回结果")]),t._v(" "),n("p",[t._v("针对不同操作，服务器向用户返回的结果应该符合以下规范。")]),t._v(" "),n("blockquote",[n("ul",[n("li",[t._v("GET /collection：返回资源对象的列表（数组）")]),t._v(" "),n("li",[t._v("GET /collection/resource：返回单个资源对象")]),t._v(" "),n("li",[t._v("POST /collection：返回新生成的资源对象")]),t._v(" "),n("li",[t._v("PUT /collection/resource：返回完整的资源对象")]),t._v(" "),n("li",[t._v("PATCH /collection/resource：返回完整的资源对象")]),t._v(" "),n("li",[t._v("DELETE /collection/resource：返回一个空文档")])])]),t._v(" "),n("h3",{attrs:{id:"hypermedia-api"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#hypermedia-api"}},[t._v("#")]),t._v(" Hypermedia API")]),t._v(" "),n("p",[t._v("RESTful API最好做到Hypermedia，即返回结果中提供链接，连向其他API方法，使得用户不查文档，也知道下一步应该做什么。")]),t._v(" "),n("p",[t._v("比如，当用户向api.example.com的根目录发出请求，会得到这样一个文档。")]),t._v(" "),n("blockquote",[n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"link"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"rel"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"collection https://www.example.com/zoos"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"href"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://api.example.com/zoos"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"title"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"List of zoos"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"type"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"application/vnd.yourformat+json"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br")])])]),t._v(" "),n("p",[t._v("上面代码表示，文档中有一个link属性，用户读取这个属性就知道下一步该调用什么API了。rel表示这个API与当前网址的关系（collection关系，并给出该collection的网址），href表示API的路径，title表示API的标题，type表示返回类型。")]),t._v(" "),n("p",[t._v("Hypermedia API的设计被称为"),n("a",{attrs:{href:"https://en.wikipedia.org/wiki/HATEOAS",target:"_blank",rel:"noopener noreferrer"}},[t._v("HATEOAS"),n("OutboundLink")],1),t._v("。Github的API就是这种设计，访问"),n("a",{attrs:{href:"https://api.github.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("api.github.com"),n("OutboundLink")],1),t._v("会得到一个所有可用API的网址列表。")]),t._v(" "),n("blockquote",[n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"current_user_url"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://api.github.com/user"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"authorizations_url"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://api.github.com/authorizations"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br")])])]),t._v(" "),n("p",[t._v("从上面可以看到，如果想获取当前用户的信息，应该去访问"),n("a",{attrs:{href:"https://api.github.com/user",target:"_blank",rel:"noopener noreferrer"}},[t._v("api.github.com/user"),n("OutboundLink")],1),t._v("，然后就得到了下面结果。")]),t._v(" "),n("blockquote",[n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"message"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Requires authentication"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"documentation_url"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://developer.github.com/v3"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br")])])]),t._v(" "),n("p",[t._v("上面代码表示，服务器给出了提示信息，以及文档的网址。")]),t._v(" "),n("h3",{attrs:{id:"其他"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#其他"}},[t._v("#")]),t._v(" 其他")]),t._v(" "),n("p",[t._v("（1）API的身份认证应该使用"),n("a",{attrs:{href:"https://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("OAuth 2.0"),n("OutboundLink")],1),t._v("框架。")]),t._v(" "),n("p",[t._v("（2）服务器返回的数据格式，应该尽量使用JSON，避免使用XML。")]),t._v(" "),n("h3",{attrs:{id:"egg的-url-定义"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#egg的-url-定义"}},[t._v("#")]),t._v(" egg的 URL 定义")]),t._v(" "),n("p",[t._v("eggjs如果想通过 RESTful 的方式来定义路由， 我们提供了 `app.resources('routerName', 'pathMatch', controller) 快速在一个路径上生成 "),n("a",{attrs:{href:"https://en.wikipedia.org/wiki/Create,_read,_update_and_delete",target:"_blank",rel:"noopener noreferrer"}},[t._v("CRUD"),n("OutboundLink")],1),t._v(" 路由结构。")]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("router"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("resources")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'users'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/api/v1/users'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" controller"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("v1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("users"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// app/controller/v1/users.js")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" methods "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'head'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'options'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'get'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'put'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'patch'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'post'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'delete'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'del'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'all'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'resources'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br")])]),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// app/router.js")]),t._v("\nmodule"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("exports")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("app")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" router"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" controller "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" app"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  router"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("resources")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'posts'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/api/posts'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" controller"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("posts"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  router"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("resources")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'users'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/api/v1/users'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" controller"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("v1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("users"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// app/controller/v1/users.js")]),t._v("\n    \n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//如果要考虑授权的情况下，会这样设置；")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" router"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" controller"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" config "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" app\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" baseAPI "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" config"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("adm\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" categories "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" controller"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("categories\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" module "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'categories'")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// router.resources('categories', '/categories', controller.categories)")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" nsRouter "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" router"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("namespace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("baseAPI"),n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("module"),n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//namespace(prefix, ...middlewares) {")]),t._v("\n    nsRouter"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("post")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" app"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("role"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("can")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'auth'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" categories"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("create"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    nsRouter"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("put")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/:id'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" app"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("role"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("can")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'auth'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" categories"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("update"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    nsRouter"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("delete")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/:id'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" app"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("role"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("can")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'auth'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" categories"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("destroy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    nsRouter"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/:id'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" categories"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("show"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    nsRouter"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" categories"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("index"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br")])]),n("p",[t._v("上面代码就在 "),n("code",[t._v("/posts")]),t._v(" 路径上部署了一组 CRUD 路径结构，对应的 Controller 为 "),n("code",[t._v("app/controller/posts.js")]),t._v(" 接下来， 你只需要在 "),n("code",[t._v("posts.js")]),t._v(" 里面实现对应的函数就可以了。")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("Method")]),t._v(" "),n("th",[t._v("Path")]),t._v(" "),n("th",[t._v("Route Name")]),t._v(" "),n("th",[t._v("Controller.Action")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("GET")]),t._v(" "),n("td",[t._v("/posts")]),t._v(" "),n("td",[t._v("posts")]),t._v(" "),n("td",[t._v("app.controllers.posts.index")])]),t._v(" "),n("tr",[n("td",[t._v("GET")]),t._v(" "),n("td",[t._v("/posts/new")]),t._v(" "),n("td",[t._v("new_post")]),t._v(" "),n("td",[t._v("app.controllers.posts.new")])]),t._v(" "),n("tr",[n("td",[t._v("GET")]),t._v(" "),n("td",[t._v("/posts/:id")]),t._v(" "),n("td",[t._v("post")]),t._v(" "),n("td",[t._v("app.controllers.posts.show")])]),t._v(" "),n("tr",[n("td",[t._v("GET")]),t._v(" "),n("td",[t._v("/posts/:id/edit")]),t._v(" "),n("td",[t._v("edit_post")]),t._v(" "),n("td",[t._v("app.controllers.posts.edit")])]),t._v(" "),n("tr",[n("td",[t._v("POST")]),t._v(" "),n("td",[t._v("/posts")]),t._v(" "),n("td",[t._v("posts")]),t._v(" "),n("td",[t._v("app.controllers.posts.create")])]),t._v(" "),n("tr",[n("td",[t._v("PUT")]),t._v(" "),n("td",[t._v("/posts/:id")]),t._v(" "),n("td",[t._v("post")]),t._v(" "),n("td",[t._v("app.controllers.posts.update")])]),t._v(" "),n("tr",[n("td",[t._v("DELETE")]),t._v(" "),n("td",[t._v("/posts/:id")]),t._v(" "),n("td",[t._v("post")]),t._v(" "),n("td",[t._v("app.controllers.posts.destroy")])])])]),t._v(" "),n("h3",{attrs:{id:"egg中的curl及request"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#egg中的curl及request"}},[t._v("#")]),t._v(" egg中的curl及request")]),t._v(" "),n("h4",{attrs:{id:"通过-app-ctx-使用-httpclient"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#通过-app-ctx-使用-httpclient"}},[t._v("#")]),t._v(" "),n("strong",[t._v("通过")]),t._v(" "),n("code",[t._v("app/ctx")]),t._v(" "),n("strong",[t._v("使用 HttpClient")])]),t._v(" "),n("p",[t._v("框架在应用初始化的时候，会自动将 "),n("a",{attrs:{href:"https://github.com/eggjs/egg/blob/master/lib/core/httpclient.js",target:"_blank",rel:"noopener noreferrer"}},[t._v("HttpClient"),n("OutboundLink")],1),t._v(" 初始化到 "),n("code",[t._v("app.httpclient")]),t._v("。 同时增加了一个 "),n("code",[t._v("app.curl(url, options) 方法，它等价于")]),t._v("app.httpclient.request(url, options)。这样就可以非常方便地使用 "),n("code",[t._v("app.curl")]),t._v(" 方法完成一次 HTTP 请求。")]),t._v(" "),n("p",[t._v("框架在 Context 中同样提供了 "),n("code",[t._v("ctx.curl(url, options) 和")]),t._v("ctx.httpclient"),n("code",[t._v("，保持跟 app 下的使用体验一致。 这样就可以在有 Context 的地方（如在 controller 中）非常方便地使用")]),t._v("ctx.curl() 方法完成一次 HTTP 请求。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(939),alt:""}})]),t._v(" "),n("h4",{attrs:{id:"基本-http-请求-封装后跟requet库操作类似"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#基本-http-请求-封装后跟requet库操作类似"}},[t._v("#")]),t._v(" 基本 HTTP 请求(封装后跟requet库操作类似)")]),t._v(" "),n("p",[t._v("HttpClient 的默认 method 会设置为 "),n("code",[t._v("GET")]),t._v("。")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("返回值 "),n("code",[t._v("result")]),t._v("会包含 3 个属性：")]),t._v(" "),n("p",[n("code",[t._v("status")]),t._v("、"),n("code",[t._v("headers")]),t._v("和 "),n("code",[t._v("data")])]),t._v(" "),n("ul",[n("li",[n("code",[t._v("status")]),t._v(": 响应状态码，如 "),n("code",[t._v("200")]),t._v(", "),n("code",[t._v("302")]),t._v(", "),n("code",[t._v("404")]),t._v(", "),n("code",[t._v("500")]),t._v(" 等等")]),t._v(" "),n("li",[n("code",[t._v("headers")]),t._v(": 响应头，类似 "),n("code",[t._v("{ 'content-type': 'text/html', ... }")])]),t._v(" "),n("li",[n("code",[t._v("data")]),t._v(": 响应 body，默认 HttpClient 不会做任何处理，会直接返回 Buffer 类型数据。 一旦设置了 "),n("code",[t._v("options.dataType")]),t._v("，HttpClient 将会根据此参数对 "),n("code",[t._v("data")]),t._v(" 进行相应的处理。")])])])]),t._v(" "),n("p",[t._v("完整的请求参数 "),n("code",[t._v("options")]),t._v(" 和返回值 "),n("code",[t._v("result")]),t._v(" 的说明请看下文的 "),n("a",{attrs:{href:"https://eggjs.org/zh-cn/core/httpclient.html#options-%E5%8F%82%E6%95%B0%E8%AF%A6%E8%A7%A3",target:"_blank",rel:"noopener noreferrer"}},[t._v("options 参数详解"),n("OutboundLink")],1),t._v(" 章节。")]),t._v(" "),n("p",[t._v("以下例子都会在 controller 代码中对 https://httpbin.org 发起请求来完成。")]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//get 读取数据几乎都是使用 GET 请求，它是 HTTP 世界最常见的一种，也是最广泛的一种，它的请求参数也是最容易构造的。")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" result "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://httpbin.org/get?foo=bar'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//post 创建数据的场景一般来说都会使用 POST 请求，它相对于 GET 来说多了请求 body 这个参数。")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" result "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://httpbin.org/post'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    method"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'POST'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 必须指定 method")]),t._v("\n    contentType"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'json'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 通过 contentType 告诉 HttpClient 以 JSON 格式发送")]),t._v("\n    dataType"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'json'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 明确告诉 HttpClient 以 JSON 格式处理返回的响应 body")]),t._v("\n    data"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        hello"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'world'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        now"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Date"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("now")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//put PUT 与 POST 类似，它更加适合更新数据和替换数据的语义。 除了 method 参数需要设置为 PUT，其他参数几乎跟 POST 一模一样。")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" result "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://httpbin.org/put'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    method"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'PUT'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    contentType"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'json'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    dataType"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'json'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    data"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        update"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'foo bar'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//delete  删除数据会选择 DELETE 请求，它通常可以不需要加请求 body，但是 HttpClient 不会限制。")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" result "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://httpbin.org/delete'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n     method"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'DELETE'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n     dataType"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'json'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" result"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br"),n("span",{staticClass:"line-number"},[t._v("20")]),n("br"),n("span",{staticClass:"line-number"},[t._v("21")]),n("br"),n("span",{staticClass:"line-number"},[t._v("22")]),n("br"),n("span",{staticClass:"line-number"},[t._v("23")]),n("br"),n("span",{staticClass:"line-number"},[t._v("24")]),n("br"),n("span",{staticClass:"line-number"},[t._v("25")]),n("br"),n("span",{staticClass:"line-number"},[t._v("26")]),n("br"),n("span",{staticClass:"line-number"},[t._v("27")]),n("br")])]),n("p",[n("code",[t._v("request")]),t._v("/"),n("code",[t._v("request-promise")]),t._v(" 库使用示例:")]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//request request-promise 库使用示例")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" rp "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'request-promise'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" options "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    method"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'POST'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    uri"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("https://devpython.iwifi.com:8082/Meet/face/V1804261328.U.JSON")]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//设备状态；")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// headers: {")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//   /* 'content-type': 'application/x-www-form-urlencoded' */ // Is set automatically")]),t._v("\n       "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* 'content-type': 'multipart/form-data' */")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// },")]),t._v("\n    json"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Automatically stringifies the body to JSON")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//qs: reqData,")]),t._v("\n    body"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" reqData"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//POST data to a JSON REST API")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// form: reqData,//POST like HTML forms do")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//formData: reqData,//if you want to include a file upload then use options.formData:")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("rp")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("parsedBody")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// POST succeeded...")]),t._v("\n    console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("parsedBody"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("catch")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("err")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// POST failed...")]),t._v("\n    console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br"),n("span",{staticClass:"line-number"},[t._v("20")]),n("br"),n("span",{staticClass:"line-number"},[t._v("21")]),n("br"),n("span",{staticClass:"line-number"},[t._v("22")]),n("br"),n("span",{staticClass:"line-number"},[t._v("23")]),n("br"),n("span",{staticClass:"line-number"},[t._v("24")]),n("br")])]),n("h2",{attrs:{id:"graphql"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#graphql"}},[t._v("#")]),t._v(" Graphql")]),t._v(" "),n("p",[n("img",{attrs:{src:a(940),alt:""}})]),t._v(" "),n("h2",{attrs:{id:"参考链接"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#参考链接"}},[t._v("#")]),t._v(" 参考链接")]),t._v(" "),n("p",[t._v("http://www.ruanyifeng.com/blog/2014/05/restful_api.html")])])}),[],!1,null,null,null);s.default=e.exports},898:function(t,s,a){t.exports=a.p+"assets/img/20-01-21.74f39883.jpg"},899:function(t,s,a){t.exports=a.p+"assets/img/20-02-35.a9b30d39.jpg"},900:function(t,s,a){t.exports=a.p+"assets/img/image-20211104202000270.aa9005ce.png"},901:function(t,s,a){t.exports=a.p+"assets/img/image-20211104202229714.4e448eff.png"},902:function(t,s,a){t.exports=a.p+"assets/img/image-20211104202331295.69a4365d.png"},903:function(t,s,a){t.exports=a.p+"assets/img/20-06-37.b0217b83.jpg"},904:function(t,s,a){t.exports=a.p+"assets/img/12-19-40.7a58a7c1.jpg"},905:function(t,s,a){t.exports=a.p+"assets/img/20-10-36.5d780d76.jpg"},906:function(t,s,a){t.exports=a.p+"assets/img/20-11-55.992d934d.jpg"},907:function(t,s,a){t.exports=a.p+"assets/img/21-47-37.e654a3f6.jpg"},908:function(t,s,a){t.exports=a.p+"assets/img/22-06-20.673184ea.jpg"},909:function(t,s,a){t.exports=a.p+"assets/img/21-50-24.08d6d4b4.jpg"},910:function(t,s,a){t.exports=a.p+"assets/img/21-50-48.69b9f234.jpg"},911:function(t,s,a){t.exports=a.p+"assets/img/19-53-40.1995c783.jpg"},912:function(t,s,a){t.exports=a.p+"assets/img/21-23-18.1f3a4c9d.jpg"},913:function(t,s,a){t.exports=a.p+"assets/img/21-23-50.b3070698.jpg"},914:function(t,s,a){t.exports=a.p+"assets/img/21-24-24.63af08f8.jpg"},915:function(t,s,a){t.exports=a.p+"assets/img/22-07-21.91fe27b2.jpg"},916:function(t,s,a){t.exports=a.p+"assets/img/10-56-12.b2424a4f.jpg"},917:function(t,s,a){t.exports=a.p+"assets/img/10-55-26.efabe1fc.jpg"},918:function(t,s,a){t.exports=a.p+"assets/img/12-27-48.716c80b6.jpg"},919:function(t,s,a){t.exports=a.p+"assets/img/12-27-14.a05fc1c1.jpg"},920:function(t,s,a){t.exports=a.p+"assets/img/12-22-41.f2184f42.jpg"},921:function(t,s,a){t.exports=a.p+"assets/img/12-26-41.e84c5736.jpg"},922:function(t,s,a){t.exports=a.p+"assets/img/12-33-06.fe9a29af.jpg"},923:function(t,s,a){t.exports=a.p+"assets/img/12-58-03.5f224f05.jpg"},924:function(t,s,a){t.exports=a.p+"assets/img/12-58-38.d0f0f9f3.jpg"},925:function(t,s,a){t.exports=a.p+"assets/img/12-59-16.efc30a19.jpg"},926:function(t,s,a){t.exports=a.p+"assets/img/20-40-14.07a56e0d.jpg"},927:function(t,s,a){t.exports=a.p+"assets/img/20-42-13.f3985b99.jpg"},928:function(t,s,a){t.exports=a.p+"assets/img/21-09-05.80bb80d9.jpg"},929:function(t,s,a){t.exports=a.p+"assets/img/10-03-56.95a824fd.jpg"},930:function(t,s,a){t.exports=a.p+"assets/img/12-55-20.149a22d3.jpg"},931:function(t,s,a){t.exports=a.p+"assets/img/image-20211104202528136.8d174d38.png"},932:function(t,s,a){t.exports=a.p+"assets/img/image-20211104202709379.69746c51.png"},933:function(t,s,a){t.exports=a.p+"assets/img/22-00-13.0260f8a3.jpg"},934:function(t,s,a){t.exports=a.p+"assets/img/image-20211104200657521.ea4cb301.png"},935:function(t,s,a){t.exports=a.p+"assets/img/22-00-54.2f594895.jpg"},936:function(t,s,a){t.exports=a.p+"assets/img/22-01-32.918cac02.jpg"},937:function(t,s,a){t.exports=a.p+"assets/img/image-20211103103955493.e164ff6a.png"},938:function(t,s,a){t.exports=a.p+"assets/img/image-20211103104135232.9f4d396e.png"},939:function(t,s,a){t.exports=a.p+"assets/img/11-22-13.86dd34c7.jpg"},940:function(t,s,a){t.exports=a.p+"assets/img/11-13-46.d8ccc9dd.jpg"}}]);