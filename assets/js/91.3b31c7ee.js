(window.webpackJsonp=window.webpackJsonp||[]).push([[91],{1985:function(t,s,a){"use strict";a.r(s);var n=a(14),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h2",{attrs:{id:"跨域"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#跨域"}},[t._v("#")]),t._v(" 跨域")]),t._v(" "),n("h3",{attrs:{id:"同源策略"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#同源策略"}},[t._v("#")]),t._v(" 同源策略")]),t._v(" "),n("p",[t._v('同源策略/SOP（Same origin policy）是一种约定;所谓同源是指 "'),n("strong",[t._v("协议 + 域名 + 端口")]),t._v('" 三者相同，'),n("strong",[t._v("即便两个不同的域名指向同一个 ip 地址，也非同源。")]),t._v(" 从一个源加载的文档或脚本如何与来自另一个源的资源进行交互。"),n("strong",[t._v("这是一个用于隔离潜在恶意文件的关键的安全机制")])]),t._v(" "),n("h3",{attrs:{id:"跨域的含义"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#跨域的含义"}},[t._v("#")]),t._v(" 跨域的含义")]),t._v(" "),n("p",[n("strong",[t._v("当协议、域名、端口号，有一个或多个不同时，有希望可以访问并获取数据的现象称为跨域访问")]),t._v("，同源策略限制下 "),n("code",[t._v("cookie")]),t._v("、"),n("code",[t._v("localStorage")]),t._v("、"),n("code",[t._v("dom")]),t._v("、"),n("code",[t._v("ajax")]),t._v("、"),n("code",[t._v("IndexDB")]),t._v(" 都是不支持跨域的。")]),t._v(" "),n("p",[n("strong",[t._v("不同源之间不能执行以下情况")]),t._v("，以下情况都是同源时执行：")]),t._v(" "),n("ol",[n("li",[t._v("Cookie、LocalStorage和indexDB无法读取;")]),t._v(" "),n("li",[t._v("AJAX请求不能发送; 限制了通过 XMLHttpRequest 等方式将站点的数据发送给不同源的站点;")]),t._v(" "),n("li",[t._v("DOM无法获得; 对当前 DOM 对象读和写的操作;")])]),t._v(" "),n("h3",{attrs:{id:"实现跨域的方式【要点】"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#实现跨域的方式【要点】"}},[t._v("#")]),t._v(" 实现跨域的方式【要点】")]),t._v(" "),n("h4",{attrs:{id:"方法总括"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#方法总括"}},[t._v("#")]),t._v(" 方法总括")]),t._v(" "),n("h5",{attrs:{id:"开发快捷调试"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#开发快捷调试"}},[t._v("#")]),t._v(" 开发快捷调试")]),t._v(" "),n("ul",[n("li",[t._v("webpack proxy代理设置；")]),t._v(" "),n("li",[t._v("使用charles等正向代理方式比较简单;  Map Remote 设置；")]),t._v(" "),n("li",[t._v("谷歌浏览器启动设置；\n"),n("ul",[n("li",[t._v("新建一个目录。用于存放保存关闭安全策略后的用户信息的，名称和位置随意。【可以不用创建文件夹】")]),t._v(" "),n("li",[n("strong",[t._v("win")]),t._v(": 在Chrome的"),n("strong",[t._v("快捷图标上")]),t._v("鼠标右键  --\x3e 属性 --\x3e 目标  --\x3e 在原chrome路径的基础上加上 "),n("code",[t._v("--disable-web-security --user-data-dir=D:\\MyChromeDevUserData")]),t._v(" --\x3e 应用。（注意：以上的字符串加在原路径引号外面，且要有空格间隔。）")]),t._v(" "),n("li",[n("strong",[t._v("mac")]),t._v(": 在终端中输入："),n("code",[t._v("open -n/-a xxx")]),t._v("完整： "),n("code",[t._v("open -n /Applications/Google\\ Chrome.app --args --disable-web-security --user-data-dir=/Users/samy/Documents/MyChromeDev")]),t._v(";")]),t._v(" "),n("li",[t._v("Ps：这个设置如果要考虑到cookie跨越会有问题，可以通过单独通过"),n("code",[t._v("http-proxy-middleware")]),t._v("代理处理；所以建议用token方式最好；")])])])]),t._v(" "),n("h5",{attrs:{id:"解决同源策略的方法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#解决同源策略的方法"}},[t._v("#")]),t._v(" "),n("strong",[t._v("解决同源策略的方法")])]),t._v(" "),n("ul",[n("li",[n("p",[t._v("使用 jsonp 跨域；")])]),t._v(" "),n("li",[n("p",[t._v("**使用 CORS 跨域; 可以直接用第三方库。cors库；**跨域资源在服务端设置允许跨域，就可以进行跨域访问控制，从而使跨域数据传输得以安全进行；")])]),t._v(" "),n("li",[n("p",[n("strong",[t._v("使用 nginx 实现跨域")])])]),t._v(" "),n("li",[n("p",[t._v("使用 WebSocket 实现跨域")])]),t._v(" "),n("li",[n("p",[n("strong",[t._v("使用 http-proxy-middleware 实现跨域")]),t._v(" （webpack）")]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" createProxyMiddleware "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http-proxy-middleware'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" jsonPlaceholderProxy "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createProxyMiddleware")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/api/v1'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  target"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://10.45.47.68:xxx'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  changeOrigin"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br")])])]),t._v(" "),n("li",[n("p",[t._v("使用 postMessage 实现跨域; 可以通过 window.postMessage 的 JavaScript 接口来和不同源的 DOM 进行通信。")])]),t._v(" "),n("li",[n("p",[t._v("使用 window.name 实现跨域")])]),t._v(" "),n("li",[n("p",[t._v("使用 location.hash 实现跨域")])]),t._v(" "),n("li",[n("p",[t._v("使用 document.domain 实现跨域")])])]),t._v(" "),n("h4",{attrs:{id:"jsonp实现跨域"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#jsonp实现跨域"}},[t._v("#")]),t._v(" jsonp实现跨域")]),t._v(" "),n("p",[t._v("使用场景：当自己的项目前端资源和后端部署在不同的服务器地址上，或者其他的公司需要访问自己对外公开的接口，需要实现跨域获取数据，如百度搜索。")]),t._v(" "),n("h5",{attrs:{id:"原理【要点】"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#原理【要点】"}},[t._v("#")]),t._v(" 原理【要点】")]),t._v(" "),n("p",[t._v("由于浏览器的同源策略限制，不允许跨域请求；"),n("strong",[t._v("但是页面中的 script、img、iframe标签是例外")]),t._v("，不受同源策略限制。"),n("strong",[t._v("Jsonp 就是利用"),n("code",[t._v("script")]),t._v("标签跨域特性进行请求。")])]),t._v(" "),n("p",[t._v("JSONP 的原理就是，先在全"),n("strong",[t._v("局注册一个回调函数，定义回调数据的处理")]),t._v("；与服务端约定好一个同名回调函数名，服务端接收到请求后，将返回一段 Javascript，在这段 Javascript 代码中调用了约定好的回调函数，并且将数据作为参数进行传递。当网页接收到这段 Javascript 代码后，就会执行这个回调函数。")]),t._v(" "),n("h5",{attrs:{id:"缺点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#缺点"}},[t._v("#")]),t._v(" 缺点")]),t._v(" "),n("p",[t._v("它只支持"),n("code",[t._v("GET")]),t._v("请求，而不支持"),n("code",[t._v("POST")]),t._v("请求等其他类型的HTTP请求。"),n("strong",[t._v("不处理好的会触发XSS攻击")]),t._v("；")]),t._v(" "),n("ul",[n("li",[n("strong",[t._v("只能发送 get 请求")]),t._v(" 不支持 post、put、delete；")]),t._v(" "),n("li",[t._v("不安全，容易引发 xss 攻击，别人在返回的结果中返回了下面代码。")])]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" script "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createElement")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'script'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nscript"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("src "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://192.168.0.57:8080/xss.js"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ndocument"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("appendChild")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("script"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br")])]),n("p",[n("strong",[t._v("会把别人的脚本引入到自己的页面中执行，如：弹窗、广告等，甚至更危险的脚本程序")]),t._v("。")]),t._v(" "),n("h5",{attrs:{id:"封装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#封装"}},[t._v("#")]),t._v(" 封装")]),t._v(" "),n("p",[t._v("步骤：")]),t._v(" "),n("ul",[n("li",[t._v("拼接发送请求的参数；")]),t._v(" "),n("li",[t._v("拼接发送请求的参数并赋值到 src 属性；")]),t._v(" "),n("li",[t._v("创建全局函数window.cb = function (data) {}；")]),t._v(" "),n("li",[t._v("在跨域拿到数据以后将 script 标签销毁；")])]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("jsonp")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" params"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" cb "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 封装 jsonp 跨域请求的方法")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Promise")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("resolve"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" reject")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" script "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createElement")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"script"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" arr "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    params "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("params"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" cb "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" key "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" params"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      arr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("push")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("key"),n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("params"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//拼接发送请求的参数")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    script"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("src "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("url"),n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("?")]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("arr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"&"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 拼接发送请求的参数并赋值到 src 属性")]),t._v("\n    document"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("appendChild")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("script"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    window"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("cb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("data")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 创建全局函数window.cb = function (data) {}")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      document"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("removeChild")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("script"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 在跨域拿到数据以后将 script 标签销毁")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("json")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 调用方法跨域请求百度搜索的接口")]),t._v("\n  url"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://sp0.baidu.com/5a1Fazu8AA54nxGko9WTAnF6hhy/su"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  params"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    wd"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jsonp"')]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  cb"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"show"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("data")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br"),n("span",{staticClass:"line-number"},[t._v("20")]),n("br"),n("span",{staticClass:"line-number"},[t._v("21")]),n("br"),n("span",{staticClass:"line-number"},[t._v("22")]),n("br"),n("span",{staticClass:"line-number"},[t._v("23")]),n("br"),n("span",{staticClass:"line-number"},[t._v("24")]),n("br"),n("span",{staticClass:"line-number"},[t._v("25")]),n("br"),n("span",{staticClass:"line-number"},[t._v("26")]),n("br")])]),n("h5",{attrs:{id:"示例"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#示例"}},[t._v("#")]),t._v(" 示例")]),t._v(" "),n("blockquote",[n("p",[t._v("写一个模拟jsonp原理的一个简单的例子")])]),t._v(" "),n("p",[t._v("本地客户端：")]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("script type"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"text/javascript"')]),t._v(" src"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://xxx.com/Index.aspx?callback=Hello"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("script"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br")])]),n("p",[t._v("本地回调函数")]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Hello")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("data")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n     "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("result"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br")])]),n("p",[t._v("跨域服务端：")]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("protected")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Page_Load")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("object sender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" EventArgs e")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n     string callback"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("Request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("QueryString"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"callback"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('//获取客户端回调函数名，值为"Hello"')]),t._v("\n     Response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Write")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("callback"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"({result:1})"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//调用客户端指定函数,并把数据传进去")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br")])]),n("h4",{attrs:{id:"cors实现跨域"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#cors实现跨域"}},[t._v("#")]),t._v(" CORS实现跨域")]),t._v(" "),n("h5",{attrs:{id:"配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置"}},[t._v("#")]),t._v(" 配置")]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" express "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"express"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" app "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("express")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" whiteList "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://localhost:3000"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 允许访问域的白名单")]),t._v("\napp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" next")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" origin "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("header"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("origin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("whiteList"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("includes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("origin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 设置那个源可以访问，参数为 * 时，允许任何人访问，但是不可以和 cookie 凭证的响应头共同使用")]),t._v("\n        res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setHeader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Access-Control-Allow-Origin"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" origin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 想要获取 ajax 的头信息，需设置响应头")]),t._v("\n        res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setHeader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Access-Control-Allow-Headers"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 处理复杂请求的头")]),t._v("\n        res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setHeader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Access-Control-Allow-Methods"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"PUT"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 允许发送 cookie 凭证的响应头")]),t._v("\n        res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setHeader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Access-Control-Allow-Credentials"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 允许前端获取哪个头信息")]),t._v("\n        res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setHeader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Access-Control-Expose-Headers"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 处理 OPTIONS 预检的存活时间，单位 s")]),t._v("\n        res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setHeader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Access-Control-Max-Age"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//发送PUT 请求会做一个试探性的请求OPTIONS，其实是请求了两次，当接收的请求为OPTIONS时不做任何处理")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("method "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"OPTIONS"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("end")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("next")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\napp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("put")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/getDate"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// res.setHeader('name', 'nihao'); // 设置自定义响应头信息")]),t._v("\n    res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("end")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"I love you"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\napp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/getDate"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("end")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"I love you"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\napp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("express"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("static")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\napp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("listen")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br"),n("span",{staticClass:"line-number"},[t._v("20")]),n("br"),n("span",{staticClass:"line-number"},[t._v("21")]),n("br"),n("span",{staticClass:"line-number"},[t._v("22")]),n("br"),n("span",{staticClass:"line-number"},[t._v("23")]),n("br"),n("span",{staticClass:"line-number"},[t._v("24")]),n("br"),n("span",{staticClass:"line-number"},[t._v("25")]),n("br"),n("span",{staticClass:"line-number"},[t._v("26")]),n("br"),n("span",{staticClass:"line-number"},[t._v("27")]),n("br"),n("span",{staticClass:"line-number"},[t._v("28")]),n("br"),n("span",{staticClass:"line-number"},[t._v("29")]),n("br"),n("span",{staticClass:"line-number"},[t._v("30")]),n("br"),n("span",{staticClass:"line-number"},[t._v("31")]),n("br"),n("span",{staticClass:"line-number"},[t._v("32")]),n("br"),n("span",{staticClass:"line-number"},[t._v("33")]),n("br"),n("span",{staticClass:"line-number"},[t._v("34")]),n("br")])]),n("h4",{attrs:{id:"nginx实现跨域"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx实现跨域"}},[t._v("#")]),t._v(" nginx实现跨域")]),t._v(" "),n("h5",{attrs:{id:"配置-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置-2"}},[t._v("#")]),t._v(" 配置")]),t._v(" "),n("p",[t._v("两种方式：")]),t._v(" "),n("ul",[n("li",[t._v("add_header")]),t._v(" "),n("li",[t._v("proxy_pass proxy_set_header")])]),t._v(" "),n("p",[n("code",[t._v("nginx.conf")])]),t._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#方式一: add_header")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("~")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\\"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("json "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("root")]),t._v(" json"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("add_header")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Access-Control-Allow-Origin"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request_method")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'GET'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#示例；")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("add_header")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Access-Control-Allow-Origin'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://docs.domain.com'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("add_header")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Access-Control-Allow-Credentials'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'true'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("add_header")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Access-Control-Allow-Methods'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'GET, POST, PUT, DELETE, PATCH, OPTIONS'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("add_header")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Access-Control-Allow-Headers'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization,token'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#方式二: proxy_pass proxy_set_header")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 访问的http://xx/ssm/api/相当于一个代理url，实际访问的是http://xx:8888/ssm/api/")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("ssm"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("interfaces"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_pass")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("http")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("localhost"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("8888")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("ssm"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("api"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        \n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_set_header")]),t._v(" Host "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$host")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_set_header")]),t._v(" X"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Real"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("IP "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$remote_addr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_set_header")]),t._v(" REMOTE"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("HOST "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$remote_addr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_set_header")]),t._v(" X"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Forwarded"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("For "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$proxy_add_x_forwarded_for")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br"),n("span",{staticClass:"line-number"},[t._v("20")]),n("br"),n("span",{staticClass:"line-number"},[t._v("21")]),n("br"),n("span",{staticClass:"line-number"},[t._v("22")]),n("br"),n("span",{staticClass:"line-number"},[t._v("23")]),n("br")])]),n("p",[n("strong",[t._v("含义：")])]),t._v(" "),n("ul",[n("li",[t._v("~.*.json：代表忽略大小写，后缀名为 json 的文件；")]),t._v(" "),n("li",[t._v("root json：代表 "),n("code",[t._v("json")]),t._v(" 文件夹；")]),t._v(" "),n("li",[t._v("add_header：代表加入跨域的响应头及允许访问的域，"),n("code",[t._v("*")]),t._v(" 为允许任何访问。")])]),t._v(" "),n("p",[t._v("在 "),n("code",[t._v("nginx")]),t._v(" 根目录启动 "),n("code",[t._v("cmd")]),t._v(" 命令行（windows 系统必须使用 "),n("code",[t._v("cmd")]),t._v(" 命令行）执行下面代码重启 "),n("code",[t._v("nginx")]),t._v("。")]),t._v(" "),n("p",[n("code",[t._v("nginx -t && nginx -s reload")])]),t._v(" "),n("p",[t._v("测试跨域请求")]),t._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" -I -X OPTIONS -H "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Origin: http://example.com"')]),t._v(" http://www.example2.com\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br")])]),n("p",[t._v("成功时，响应头是如下所示")]),t._v(" "),n("div",{staticClass:"language-http line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-http"}},[n("code",[n("span",{pre:!0,attrs:{class:"token response-status"}},[t._v("HTTP/1.1 "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v("200 OK")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Server:")]),t._v(" nginx\n"),n("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Access-Control-Allow-Origin:")]),t._v(" example.com\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br")])]),n("h4",{attrs:{id:"websocket实现跨域"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#websocket实现跨域"}},[t._v("#")]),t._v(" WebSocket实现跨域")]),t._v(" "),n("p",[t._v("WebSocket 没有跨域限制，高级 API（不兼容），想要兼容低版本浏览器，可以使用 "),n("code",[t._v("socket.io")]),t._v(" 的库，WebSocket 与 HTTP 内部都是基于 TCP 协议，"),n("strong",[t._v("区别在于 HTTP 是单向的（单双工），WebSocket 是双向的（全双工）")]),t._v("，协议是 "),n("code",[t._v("ws://")]),t._v(" 和 "),n("code",[t._v("wss://")]),t._v(" 对应 "),n("code",[t._v("http://")]),t._v(" 和 "),n("code",[t._v("https://")]),t._v("，因为"),n("strong",[t._v("没有跨域限制，所以使用 "),n("code",[t._v("file://")]),t._v(" 协议也可以进行通信。")])]),t._v(" "),n("p",[t._v("客户端/服务器的设置；")]),t._v(" "),n("div",{staticClass:"language-html line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-html"}},[n("code",[t._v("//客户端：index.html\n"),n("span",{pre:!0,attrs:{class:"token doctype"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<!")]),n("span",{pre:!0,attrs:{class:"token doctype-tag"}},[t._v("DOCTYPE")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token name"}},[t._v("html")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("html")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("lang")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("en"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("head")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("meta")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("charset")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("UTF-8"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("title")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("页面"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("title")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("head")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("body")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token script"}},[n("span",{pre:!0,attrs:{class:"token language-javascript"}},[t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" socket "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WebSocket")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ws://localhost:3000'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        socket"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onopen")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            socket"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'I love you'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        socket"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onmessage")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// I love you, too")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    ")])]),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("body")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("html")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br")])]),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//服务器设置；")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" express "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"express"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" app "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("express")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" WebSocket "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ws"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" wss "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WebSocket"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Server")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" port"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nwss"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"connection"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("ws")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    ws"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"message"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("data")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// I love you")]),t._v("\n        ws"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"I love you, too"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br")])]),n("h2",{attrs:{id:"web安全概念"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#web安全概念"}},[t._v("#")]),t._v(" Web安全概念")]),t._v(" "),n("p",[t._v("Web 应用中存在很多安全风险，这些风险会被黑客利用，轻则篡改网页内容，重则窃取网站内部数据，更为严重的则是在网页中植入恶意代码，使得用户受到侵害。")]),t._v(" "),n("h3",{attrs:{id:"分类"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#分类"}},[t._v("#")]),t._v(" 分类")]),t._v(" "),n("h4",{attrs:{id:"常见的安全漏洞"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#常见的安全漏洞"}},[t._v("#")]),t._v(" "),n("strong",[t._v("常见的安全漏洞")])]),t._v(" "),n("ul",[n("li",[n("strong",[t._v("XSS 攻击")]),t._v("：对 Web 页面注入脚本，使用 JavaScript 窃取用户信息，诱导用户操作。")]),t._v(" "),n("li",[n("strong",[t._v("CSRF 攻击")]),t._v("：伪造用户请求向网站发起恶意请求。")]),t._v(" "),n("li",[n("strong",[t._v("钓鱼攻击")]),t._v("：利用网站的跳转链接或者图片制造钓鱼陷阱。")]),t._v(" "),n("li",[n("strong",[t._v("HTTP参数污染")]),t._v("：利用对参数格式验证的不完善，对服务器进行参数注入攻击。")]),t._v(" "),n("li",[n("strong",[t._v("远程代码执行")]),t._v("：用户通过浏览器提交执行命令，由于服务器端没有针对执行函数做过滤，导致在没有指定绝对路径的情况下就执行命令。")]),t._v(" "),n("li",[n("strong",[t._v("XST攻击")]),t._v("；Https中间人攻击。")])]),t._v(" "),n("p",[t._v("ps:而egg框架本身针对 Web 端常见的安全风险内置了丰富的解决方案：")]),t._v(" "),n("ul",[n("li",[t._v("利用 "),n("a",{attrs:{href:"https://github.com/eggjs/egg/blob/master/docs/source/zh-cn/basics/extend.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("extend"),n("OutboundLink")],1),t._v(" 机制扩展了 Helper API, "),n("code",[t._v("提供了各种模板过滤函数，防止钓鱼或 XSS 攻击")]),t._v("。")]),t._v(" "),n("li",[t._v("常见 Web 安全头的支持。")]),t._v(" "),n("li",[t._v("CSRF 的防御方案。")]),t._v(" "),n("li",[t._v("灵活的安全配置，可以匹配不同的请求 url 。")]),t._v(" "),n("li",[t._v("可定制的白名单，用于安全跳转和 url 过滤。")]),t._v(" "),n("li",[t._v("各种模板相关的工具函数做预处理。")])]),t._v(" "),n("p",[t._v("在框架中内置了安全插件 "),n("a",{attrs:{href:"https://github.com/eggjs/egg-security",target:"_blank",rel:"noopener noreferrer"}},[t._v("egg-security"),n("OutboundLink")],1),t._v("， 提供了默认的安全实践。")]),t._v(" "),n("h4",{attrs:{id:"其他类型分类"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#其他类型分类"}},[t._v("#")]),t._v(" 其他类型分类")]),t._v(" "),n("ul",[n("li",[t._v("HTTP本身不具备必要的安全功能，需要开发者自行开发认证及会话管理功能；")]),t._v(" "),n("li",[t._v("在客户端可以篡改请求，导致Web 应用收到与预期不一致的内容，可能包含攻击代码；")]),t._v(" "),n("li",[t._v("针对Web应用的攻击模式；\n"),n("ul",[n("li",[n("strong",[t._v("主动攻击")]),t._v("：指攻击者通过直接访问 Web 应用， 把攻击代码传入，如：SQL 注入攻击和 OS 命令注 入攻击")]),t._v(" "),n("li",[n("strong",[t._v("被动攻击")]),t._v("：是指利用圈套策略执行攻击代码的攻击模式，如：跨站脚本攻击、跨站点请求伪造")]),t._v(" "),n("li",[t._v("利用用户的身份攻击企业内部的网络")])])])]),t._v(" "),n("h3",{attrs:{id:"xss-攻击防范"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#xss-攻击防范"}},[t._v("#")]),t._v(" "),n("strong",[t._v("XSS 攻击防范")])]),t._v(" "),n("h4",{attrs:{id:"安全威胁xss的防范"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安全威胁xss的防范"}},[t._v("#")]),t._v(" 安全威胁"),n("code",[t._v("XSS")]),t._v("的防范")]),t._v(" "),n("p",[n("a",{attrs:{href:"https://www.owasp.org/index.php/Cross-site_Scripting_(XSS)",target:"_blank",rel:"noopener noreferrer"}},[t._v("XSS"),n("OutboundLink")],1),t._v("（cross-site scripting跨域脚本攻击）攻击是最常见的 Web 攻击，其重点是**『跨域』和『客户端执行』**")]),t._v(" "),n("p",[n("strong",[t._v("XSS")]),t._v(" 攻击一般分为两类：")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("Reflected XSS（"),n("strong",[t._v("反射型的 XSS 攻击")]),t._v("）:主要是由于"),n("strong",[t._v("服务端接收到客户端的不安全输入")]),t._v("，在客户端触发执行从而发起 Web 攻击。")])]),t._v(" "),n("li",[n("p",[t._v("Stored XSS（"),n("strong",[t._v("存储型的 XSS 攻击")]),t._v("）:基于存储的 XSS 攻击，是通过提交带有恶意脚本的内容存储在服务器上，当其他人看到这些内容时发起 Web 攻击。一般提交的内容都是"),n("strong",[t._v("通过一些富文本编辑器编辑的，很容易插入危险代码")]),t._v("。")])]),t._v(" "),n("li",[n("p",[t._v("DOM XSS防范方式；"),n("strong",[t._v("DOM XSS 攻击不涉及网站服务器，通常是由于前端页面不严谨的代码产生的安全漏洞，导致注入了恶意代码")]),t._v("。")]),t._v(" "),n("p",[t._v("例如，在使用 "),n("code",[t._v(".innerHTML")]),t._v("、"),n("code",[t._v("document.write()")]),t._v("、"),n("code",[t._v("document.outerHTML")]),t._v(" 这些能够修改页面结构的 API 时要注意防范恶意代码，尽量使用 "),n("code",[t._v(".textContent")]),t._v("、"),n("code",[t._v(".setAttribute()")]),t._v(" 等。")])]),t._v(" "),n("li",[n("p",[t._v("JSONP XSS防范方式；")])])]),t._v(" "),n("h5",{attrs:{id:"reflected-xss防范方式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#reflected-xss防范方式"}},[t._v("#")]),t._v(" Reflected XSS防范方式")]),t._v(" "),n("p",[n("strong",[t._v("情况一")]),t._v(":  框架提供了 "),n("code",[t._v("helper.escape()")]),t._v(" 方法对"),n("strong",[t._v("字符串进行 XSS 过滤")]),t._v("。")]),t._v(" "),n("p",[n("strong",[t._v("另外一种情况")]),t._v("，网站输出的内容会提供给 JavaScript 来使用。这个时候需要使用 "),n("code",[t._v("helper.sjs()")]),t._v(" 来进行过滤。")]),t._v(" "),n("p",[n("strong",[t._v("还有一种情况")]),t._v("，有时候我们需要在 JavaScript 中输出 json ，若未做转义，易被利用为 XSS 漏洞。框架提供了 "),n("code",[t._v("helper.sjson()")]),t._v(" 宏做 json encode")]),t._v(" "),n("h5",{attrs:{id:"stored-xss防范方式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#stored-xss防范方式"}},[t._v("#")]),t._v(" Stored XSS防范方式")]),t._v(" "),n("p",[t._v("框架提供了 "),n("code",[t._v("helper.shtml()")]),t._v(" 方法对字符串进行 XSS 过滤。")]),t._v(" "),n("p",[t._v("所以，一定要注意 shtml 的适用场景，"),n("em",[t._v("一般是针对来自用户的富文本输入")]),t._v("，切忌滥用，功能既受到限制，又会影响服务端性能。 此类场景一般是论坛、评论系统等，即便是论坛等如果不支持 HTML 内容输入，也不要使用此 Helper，直接使用 "),n("code",[t._v("escape")]),t._v(" 即可。")]),t._v(" "),n("h5",{attrs:{id:"dom-xss防范方式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#dom-xss防范方式"}},[t._v("#")]),t._v(" DOM XSS防范方式")]),t._v(" "),n("p",[t._v("这种类型则是利用非法输入来闭合对应的html标签。")]),t._v(" "),n("p",[t._v("对用户的输入进行转义，即可解决XSS。但是现在都是用框架进行开发，例如Vue，React，angular，而XSS常是基于DOM的，而框架很少去操作Dom，并且框架底层也对XSS做了一些防范。")]),t._v(" "),n("p",[n("strong",[t._v("DOM XSS 攻击不涉及网站服务器，通常是由于前端页面不严谨的代码产生的安全漏洞，导致注入了恶意代码")]),t._v("。")]),t._v(" "),n("p",[t._v("例如，在使用 "),n("code",[t._v(".innerHTML")]),t._v("、"),n("code",[t._v("document.write()")]),t._v("、"),n("code",[t._v("document.outerHTML")]),t._v(" 这些能够修改页面结构的 API 时要注意防范恶意代码，尽量使用 "),n("code",[t._v(".textContent")]),t._v("、"),n("code",[t._v(".setAttribute()")]),t._v(" 等。")]),t._v(" "),n("p",[t._v("例如，黑客构造带有恶意代码的 URL 诱导用户打开 "),n("code",[t._v("http://www.xxx.com/index.html/?content=<script>alert('我是 DOM 型 XSS 攻击')<\/script>")]),t._v("，浏览器收到请求后解析之行，如果使用 "),n("code",[t._v("document.write()")]),t._v(" 未经转义输出，就可能遭到攻击。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(953),alt:"image-20211104095224715"}})]),t._v(" "),n("h4",{attrs:{id:"jsonp-xss防范方式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#jsonp-xss防范方式"}},[t._v("#")]),t._v(" JSONP XSS防范方式")]),t._v(" "),n("p",[t._v("JSONP 的 callback 参数非常危险，他有两种风险可能导致 XSS\n1、callback 参数意外截断js代码，特殊字符单引号双引号，换行符均存在风险。\n2、callback 参数恶意添加标签（如 `` ），造成 XSS 漏洞。")]),t._v(" "),n("p",[t._v("参考 "),n("a",{attrs:{href:"http://blog.knownsec.com/2015/03/jsonp_security_technic/",target:"_blank",rel:"noopener noreferrer"}},[t._v("JSONP 安全攻防"),n("OutboundLink")],1)]),t._v(" "),n("p",[n("strong",[t._v("框架内部使用 "),n("a",{attrs:{href:"https://github.com/node-modules/jsonp-body",target:"_blank",rel:"noopener noreferrer"}},[t._v("jsonp-body"),n("OutboundLink")],1),t._v(" 来对 JSONP 请求进行安全防范。")])]),t._v(" "),n("p",[t._v("防御内容：")]),t._v(" "),n("ul",[n("li",[t._v("callback 函数名词最长 50 个字符限制")]),t._v(" "),n("li",[t._v("callback 函数名只允许 "),n("code",[t._v("[")]),t._v(", "),n("code",[t._v("]")]),t._v(", "),n("code",[t._v("a-zA-Z0123456789_")]),t._v(", "),n("code",[t._v("$")]),t._v(", "),n("code",[t._v(".")]),t._v("，防止一般的 XSS，utf-7 XSS等攻击。")])]),t._v(" "),n("p",[t._v("可定义配置：")]),t._v(" "),n("ul",[n("li",[t._v("callback 默认 "),n("code",[t._v("_callback")]),t._v("，可以重命名。")]),t._v(" "),n("li",[t._v("limit - 函数名 length 限制，默认 50。")])]),t._v(" "),n("h4",{attrs:{id:"其他-xss-的防范方式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#其他-xss-的防范方式"}},[t._v("#")]),t._v(" 其他 XSS 的防范方式")]),t._v(" "),n("blockquote",[n("p",[t._v("浏览器自身具有一定针对各种攻击的防范能力，他们一般是通过开启 Web 安全头生效的。框架内置了一些常见的 Web 安全头的支持。")])]),t._v(" "),n("h5",{attrs:{id:"csp"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#csp"}},[t._v("#")]),t._v(" CSP")]),t._v(" "),n("p",[t._v("W3C 的 Content Security Policy，简称 CSP，"),n("strong",[t._v("主要是用来定义页面可以加载哪些资源，减少 XSS 的发生")]),t._v("。\n框架内支持 CSP 的配置，不过是默认关闭的，开启后可以有效的防止 XSS 攻击的发生。要配置 CSP , 需要对 CSP 的 policy 策略有了解，具体细节可以参考 "),n("a",{attrs:{href:"https://www.zhihu.com/question/21979782",target:"_blank",rel:"noopener noreferrer"}},[t._v("CSP 是什么"),n("OutboundLink")],1),t._v("。\n示例："),n("code",[t._v("Content-Security-Policey: default-src 'self'; img-src *;")])]),t._v(" "),n("p",[n("strong",[t._v("X-Download-Options:noopen")]),t._v("\n默认开启，禁用 IE 下下载框Open按钮，防止 IE 下下载文件默认被打开 XSS。")]),t._v(" "),n("p",[n("strong",[t._v("X-Content-Type-Options:nosniff")]),t._v("\n禁用 IE8 自动嗅探 mime 功能例如 "),n("code",[t._v("text/plain")]),t._v(" 却当成 "),n("code",[t._v("text/html")]),t._v(" 渲染，特别当本站点 serve 的内容未必可信的时候。")]),t._v(" "),n("p",[n("strong",[t._v("X-XSS-Protection")]),t._v("\nIE 提供的一些 XSS 检测与防范，默认开启。")]),t._v(" "),n("ul",[n("li",[t._v("close 默认值false，即设置为 "),n("code",[t._v("1; mode=block")])])]),t._v(" "),n("p",[t._v("设置：")]),t._v(" "),n("p",[t._v("1、meta")]),t._v(" "),n("div",{staticClass:"language-html line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-html"}},[n("code",[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("meta")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("http-equiv")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("Content-Security-Policy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("content")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("script-src "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("'")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br")])]),n("p",[t._v("2、Http 头部")]),t._v(" "),n("div",{staticClass:"language-http line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-http"}},[n("code",[t._v("Content-Security-Policy:\nscript-src 'unsafe-inline' 'unsafe-eval' 'self' *.54php.cn *.yunetidc.com *.baidu.com *.cnzz.com *.duoshuo.com *.jiathis.com;report-uri /error/csp\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br")])]),n("h3",{attrs:{id:"安全威胁-csrf-的防范"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安全威胁-csrf-的防范"}},[t._v("#")]),t._v(" 安全威胁 CSRF 的防范")]),t._v(" "),n("p",[n("a",{attrs:{href:"https://www.owasp.org/index.php/CSRF",target:"_blank",rel:"noopener noreferrer"}},[t._v("CSRF"),n("OutboundLink")],1),t._v("（Cross-site request forgery）"),n("strong",[t._v("跨站请求伪造")]),t._v("，也被称为 "),n("code",[t._v("One Click Attack")]),t._v(" 或者 "),n("code",[t._v("Session Riding")]),t._v("，通常缩写为 CSRF 或者 XSRF，是一种对网站的恶意利用。 CSRF 攻击会对网站发起恶意伪造的请求，严重影响网站的安全。因此框架内置了 CSRF 防范方案。")]),t._v(" "),n("h4",{attrs:{id:"防范方式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#防范方式"}},[t._v("#")]),t._v(" 防范方式")]),t._v(" "),n("p",[t._v("通常来说，对于 CSRF 攻击有一些通用的"),n("a",{attrs:{href:"https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF)_Prevention_Cheat_Sheet#CSRF_Specific_Defense",target:"_blank",rel:"noopener noreferrer"}},[t._v("防范方案"),n("OutboundLink")],1),t._v("，简单的介绍几种常用的防范方案：")]),t._v(" "),n("ul",[n("li",[n("strong",[t._v("Synchronizer Tokens")]),t._v("：通过响应页面时将 token 渲染到页面上，在 form 表单提交的时候通过隐藏域提交上来。")]),t._v(" "),n("li",[n("strong",[t._v("Double Cookie Defense")]),t._v("：将 token 设置在 Cookie 中，在提交 post 请求的时候提交 Cookie，并通过 header 或者 body 带上 Cookie 中的 token，服务端进行对比校验。")]),t._v(" "),n("li",[n("strong",[t._v("Custom Header")]),t._v("：信任带有特定的 header（例如 "),n("code",[t._v("X-Requested-With: XMLHttpRequest")]),t._v("）的请求。这个方案可以被绕过，所以 rails 和 django 等框架都"),n("a",{attrs:{href:"https://www.djangoproject.com/weblog/2011/feb/08/security/",target:"_blank",rel:"noopener noreferrer"}},[t._v("放弃了该防范方式"),n("OutboundLink")],1),t._v("。")])]),t._v(" "),n("p",[t._v("框架结合了上述几种防范方式，"),n("strong",[t._v("提供了一个可配置的 CSRF 防范策略")]),t._v("。")]),t._v(" "),n("p",[t._v("框架提供了一个配置项，可以将 token 存放到 Session 中。当 CSRF token 存储在 Cookie 中时，一旦在同一个浏览器上发生用户切换，新登陆的用户将会依旧使用旧的 token（之前用户使用的），这会带来一定的安全风险，因此在每次用户登陆的时候都"),n("strong",[t._v("必须刷新 CSRF token")]),t._v("。")]),t._v(" "),n("p",[t._v("另外"),n("code",[t._v("同源策略主要是浏览器来进行验证的")]),t._v(", 并且不同浏览器的实现又各自不同, 所以在某些浏览器上可以直接绕过, 而且也可以直接通过短信等方式直接绕过浏览器.")]),t._v(" "),n("p",[t._v("预防:")]),t._v(" "),n("ol",[n("li",[n("strong",[t._v("A 站 (预防站) 检查 http 请求的 header 确认其 origin")])]),t._v(" "),n("li",[n("strong",[t._v("检查 CSRF token")])])]),t._v(" "),n("h5",{attrs:{id:"同源检查"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#同源检查"}},[t._v("#")]),t._v(" 同源检查")]),t._v(" "),n("p",[t._v("通过检查来过滤简单的 CSRF 攻击, 主要检查一下两个 header:")]),t._v(" "),n("ul",[n("li",[t._v("Origin Header：请求来源限制")]),t._v(" "),n("li",[t._v("Referer Header")])]),t._v(" "),n("h5",{attrs:{id:"csrf-token"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#csrf-token"}},[t._v("#")]),t._v(" CSRF token")]),t._v(" "),n("p",[t._v("简单来说, 对需要预防的请求, 通过特别的算法生成 token 存在 session 中, 然后将 token 隐藏在正确的界面表单中, 正式请求时带上该 token 在服务端验证, 避免跨站请求;【常用】")]),t._v(" "),n("p",[t._v("基本思路如下：")]),t._v(" "),n("ol",[n("li",[t._v("服务器随机产生"),n("code",[t._v("token")]),t._v("（比如把"),n("code",[t._v("cookie")]),t._v(" hash化生成），存在"),n("code",[t._v("session")]),t._v("中，放在"),n("code",[t._v("cookie")]),t._v("中或者以"),n("code",[t._v("ajax")]),t._v("的形式交给前端。")]),t._v(" "),n("li",[t._v("前端发请求的时候，解析"),n("code",[t._v("cookie")]),t._v("中的"),n("code",[t._v("token")]),t._v("，放到请求"),n("code",[t._v("url")]),t._v("里或者请求头中。")]),t._v(" "),n("li",[t._v("服务器验证"),n("code",[t._v("token")]),t._v("，由于黑客无法得到或者伪造"),n("code",[t._v("token")]),t._v("，所以能防范"),n("code",[t._v("csrf")])])]),t._v(" "),n("p",[t._v("更进一步的加强手段（不需要session）：")]),t._v(" "),n("ol",[n("li",[t._v("服务器随机产生"),n("code",[t._v("token")]),t._v("，然后以"),n("code",[t._v("token")]),t._v("为密钥散列生成一段密文；")]),t._v(" "),n("li",[t._v("把"),n("code",[t._v("token")]),t._v("和密文都随"),n("code",[t._v("cookie")]),t._v("交给前端；")]),t._v(" "),n("li",[t._v("前端发起请求时把密文和"),n("code",[t._v("token")]),t._v("都交给后端；")]),t._v(" "),n("li",[t._v("后端对"),n("code",[t._v("token")]),t._v("和密文进行正向散列验证，看"),n("code",[t._v("token")]),t._v("能不能生成同样的密文；")]),t._v(" "),n("li",[t._v("这样即使黑客拿到了"),n("code",[t._v("token")]),t._v(" 也无法拿到密文；")])]),t._v(" "),n("h3",{attrs:{id:"安全威胁-钓鱼攻击-的防范"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安全威胁-钓鱼攻击-的防范"}},[t._v("#")]),t._v(" 安全威胁 "),n("code",[t._v("钓鱼攻击")]),t._v(" 的防范")]),t._v(" "),n("p",[t._v("钓鱼有多种方式，这里介绍 url 钓鱼、图片钓鱼和 iframe 钓鱼。")]),t._v(" "),n("h4",{attrs:{id:"url-钓鱼"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#url-钓鱼"}},[t._v("#")]),t._v(" url 钓鱼")]),t._v(" "),n("blockquote",[n("p",[t._v("服务端未对传入的跳转 url 变量进行检查和控制，可能导致可恶意构造任意一个恶意地址，诱导用户跳转到恶意网站。")])]),t._v(" "),n("h5",{attrs:{id:"防范方式-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#防范方式-2"}},[t._v("#")]),t._v(" 防范方式")]),t._v(" "),n("ul",[n("li",[t._v("若跳转的 url 事先是可以确定的，包括 url 和参数的值，则可以在后台先配置好，url 参数只需传对应 url 的索引即可，"),n("strong",[t._v("通过索引找到对应具体 url 再进行跳转")]),t._v("；")]),t._v(" "),n("li",[t._v("若跳转的 url 事先不确定，但其输入是由后台生成的（不是用户通过参数传人），则可以先生成好跳转链接然后"),n("strong",[t._v("进行签名")]),t._v("；")]),t._v(" "),n("li",[t._v("若 1 和 2 都不满足，url 事先无法确定，只能通过前端参数传入，则必须在跳转的时候对 url 进行按规则校验：判断 url 是否"),n("strong",[t._v("在应用授权的白名单内")]),t._v("。")])]),t._v(" "),n("p",[t._v("框架提供了安全跳转的方法，可以通过配置白名单避免这种风险。")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("ctx.redirect(url)")]),t._v(" 如果不在配置的白名单内，则禁止。")]),t._v(" "),n("li",[n("code",[t._v("ctx.unsafeRedirect(url)")]),t._v(" 一般不建议使用，明确了解可能带来的风险后使用。")])]),t._v(" "),n("p",[n("strong",[t._v("安全方案覆盖了默认的"),n("code",[t._v("ctx.redirect")]),t._v("方法，所有的跳转均会经过安全域名的判断")]),t._v("。")]),t._v(" "),n("h4",{attrs:{id:"图片钓鱼"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#图片钓鱼"}},[t._v("#")]),t._v(" 图片钓鱼")]),t._v(" "),n("blockquote",[n("p",[t._v("如果可以允许用户向网页里插入未经验证的外链图片，这有可能出现钓鱼风险。")])]),t._v(" "),n("p",[t._v("比如常见的 "),n("code",[t._v("401钓鱼")]),t._v(", 攻击者在访问页面时，页面弹出验证页面让用户输入帐号及密码，当用户输入之后，帐号及密码就存储到了黑客的服务器中。 通常这种情况会出现在"),n("code",[t._v("<img src=$url />")]),t._v("中，系统不对**$url**是否在域名白名单内进行校验。")]),t._v(" "),n("h5",{attrs:{id:"防范方式-3"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#防范方式-3"}},[t._v("#")]),t._v(" 防范方式")]),t._v(" "),n("blockquote",[n("p",[t._v("框架提供了 "),n("code",[t._v(".surl()")]),t._v(" 宏做 url 过滤")])]),t._v(" "),n("p",[t._v("用于在 html 标签中中要解析 url 的地方（比如 "),n("code",[t._v('<a href=""/><img src=""/>')]),t._v("），其他地方不允许使用。")]),t._v(" "),n("p",[t._v("对模板中要输出的变量，加 "),n("code",[t._v("helper.surl($value)")]),t._v("。")]),t._v(" "),n("p",[n("strong",[t._v("注意：在需要解析 url 的地方，surl 外面一定要加上双引号，否则就会导致XSS漏洞。")])]),t._v(" "),n("h4",{attrs:{id:"iframe-钓鱼"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#iframe-钓鱼"}},[t._v("#")]),t._v(" iframe 钓鱼")]),t._v(" "),n("blockquote",[n("p",[t._v("通过内嵌 iframe 到被攻击的网页中，攻击者可以引导用户去点击 iframe 指向的危险网站，甚至遮盖，影响网站的正常功能，劫持用户的点击操作。")])]),t._v(" "),n("p",[t._v("框架提供了 "),n("code",[t._v("X-Frame-Options")]),t._v(" 这个安全头来防止 iframe 钓鱼。默认值为 SAMEORIGIN，只允许同域把本页面当作 iframe 嵌入。当需要嵌入一些可信的第三方网页时，可以关闭这个配置。")]),t._v(" "),n("h3",{attrs:{id:"安全威胁-hpp-的防范"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安全威胁-hpp-的防范"}},[t._v("#")]),t._v(" 安全威胁 HPP 的防范")]),t._v(" "),n("p",[t._v("Http Parameter Pollution（HPP)，即 HTTP 参数污染攻击。在HTTP协议中是允许同样名称的参数出现多次，而由于应用的实现不规范，攻击者通过传播参数的时候传输 key 相同而 value 不同的参数，从而达到绕过某些防护的后果。")]),t._v(" "),n("p",[t._v("HPP 可能导致的安全威胁有：")]),t._v(" "),n("ul",[n("li",[t._v("绕过防护和参数校验。")]),t._v(" "),n("li",[t._v("产生逻辑漏洞和报错，影响应用代码执行。")])]),t._v(" "),n("h5",{attrs:{id:"防范方式-4"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#防范方式-4"}},[t._v("#")]),t._v(" 防范方式")]),t._v(" "),n("blockquote",[n("p",[t._v("框架本身会在客户端传输 key 相同而 value 不同的参数时，强制使用第一个参数，因此不会导致 hpp 攻击。")])]),t._v(" "),n("h3",{attrs:{id:"安全威胁-xst-的防范"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安全威胁-xst-的防范"}},[t._v("#")]),t._v(" 安全威胁 XST 的防范")]),t._v(" "),n("p",[n("strong",[n("a",{attrs:{href:"https://www.owasp.org/index.php/XST",target:"_blank",rel:"noopener noreferrer"}},[t._v("XST"),n("OutboundLink")],1)]),t._v(" 的全称是 "),n("code",[t._v("Cross-Site Tracing")]),t._v("，客户端发 TRACE 请求至服务器，如果服务器按照标准实现了 TRACE 响应，则在 response body 里会返回此次请求的完整头信息。通过这种方式，客户端可以获取某些敏感的头字段，例如 httpOnly 的 Cookie。Https中间人攻击;")]),t._v(" "),n("h5",{attrs:{id:"防范方式-5"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#防范方式-5"}},[t._v("#")]),t._v(" 防范方式")]),t._v(" "),n("blockquote",[n("p",[t._v("框架已经禁止了 trace，track，options 三种危险类型请求")])]),t._v(" "),n("h5",{attrs:{id:"中间人攻击与-http-https"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#中间人攻击与-http-https"}},[t._v("#")]),t._v(" "),n("a",{attrs:{href:"https://www.owasp.org/index.php/Man-in-the-middle_attack",target:"_blank",rel:"noopener noreferrer"}},[t._v("中间人攻击"),n("OutboundLink")],1),t._v("与 HTTP/HTTPS")]),t._v(" "),n("p",[n("code",[t._v("尽管 HTTPS 并非绝对安全")]),t._v("，掌握根证书的机构、掌握加密算法的组织同样可以进行中间人形式的攻击。"),n("strong",[t._v("不过HTTPS是现行架构下最安全的解决方案，并且它大幅增加了中间人攻击的成本。")])]),t._v(" "),n("p",[t._v("因此，请各位使用 Egg 框架开发网站的开发者，务必推动自己的网站升级到 HTTPS。")]),t._v(" "),n("p",[t._v("对于 HTTPS 来讲，还有一点要注意的是 HTTP 严格传输安全（HSTS），如果不使用 HSTS，当用户在浏览器中输入网址时没有加 HTTPS，浏览器会默认使用 HTTP 访问")]),t._v(" "),n("p",[t._v("框架提供了 "),n("code",[t._v("hsts Strict-Transport-Security")]),t._v(" 这个头的默认开启。"),n("strong",[t._v("让 HTTPS 站点不跳转到 HTTP，如果站点支持 HTTPS，请一定要开启。")])]),t._v(" "),n("p",[t._v("如果我们的Web 站点是 http 站点，需要关闭这个头。配置如下：")]),t._v(" "),n("ul",[n("li",[t._v("maxAge 默认一年 "),n("code",[t._v("365 * 24 * 3600")]),t._v("。")]),t._v(" "),n("li",[t._v("includeSubdomains 默认 false, 可以添加子域名，保证所有子域名都使用 HTTPS 访问。")])]),t._v(" "),n("p",[t._v("目前比较常见的是在公共场所放置精心准备的免费 wifi, 劫持/监控通过该 wifi 的流量. 或者攻击路由器, 连上你家 wifi 攻破你家 wifi 之后在上面劫持流量等.")]),t._v(" "),n("p",[t._v("对于通信过程中的 MITM, 常见的方案是通过 PKI / TLS 预防, 及时是通过存在第三方中间人的 wifi 你通过 HTTPS 访问的页面依旧是安全的.")]),t._v(" "),n("p",[t._v("而 HTTP 协议是明文传输, 则没有任何防护可言.不常见的还有强力的互相认证, 你确认他之后, 他也确认你一下; 延迟测试, 统计传输时间, 如果通讯延迟过高则认为可能存在第三方中间人; 等等.")]),t._v(" "),n("h3",{attrs:{id:"安全威胁-ssrf-的防范"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安全威胁-ssrf-的防范"}},[t._v("#")]),t._v(" 安全威胁 SSRF 的防范")]),t._v(" "),n("p",[t._v("通过 "),n("a",{attrs:{href:"https://www.owasp.org/index.php/Server_Side_Request_Forgery",target:"_blank",rel:"noopener noreferrer"}},[t._v("Server-Side Request Forgery(SSRF)"),n("OutboundLink")],1),t._v(" 攻击，攻击者可以发起网络请求访问或者操作内部网络的资源。")]),t._v(" "),n("p",[t._v("一般来说，"),n("strong",[t._v("SSRF 安全漏洞常见于开发者在服务端直接请求客户端传递进来的 URL 资源，一旦攻击者传入一些内部的 URL 即可发起 SSRF 攻击。")])]),t._v(" "),n("p",[n("strong",[t._v("如何防范")]),t._v("通常我们会"),n("code",[t._v("基于内网 IP 黑名单的形式来防范 SSRF 攻击，通过对解析域名后得到的 IP 做过滤，禁止访问内部 IP 地址来达到防范 SSRF 攻击的目的。")])]),t._v(" "),n("p",[t._v("框架在 "),n("code",[t._v("ctx")]),t._v(", "),n("code",[t._v("app")]),t._v(" 和 "),n("code",[t._v("agent")]),t._v(" 上都提供了 "),n("code",[t._v("safeCurl")]),t._v(" 方法，在发起网络请求的同时会对指定的内网 IP 地址过滤，除此之外，该方法和框架提供的 "),n("code",[t._v("curl")]),t._v(" 方法一致。")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("ctx.safeCurl(url, options)")])]),t._v(" "),n("li",[n("code",[t._v("app.safeCurl(url, options)")])]),t._v(" "),n("li",[n("code",[t._v("agent.safeCurl(url, options)")])])]),t._v(" "),n("h4",{attrs:{id:"配置-3"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置-3"}},[t._v("#")]),t._v(" 配置")]),t._v(" "),n("blockquote",[n("p",[t._v("直接调用 "),n("code",[t._v("safeCurl")]),t._v(" 方法其实并没有任何作用，还需要配合安全配置项")])]),t._v(" "),n("ul",[n("li",[n("code",[t._v("ipBlackList")]),t._v("(Array) - \b配置内网 IP 名单，在这些网段内的 IP 地址无法被访问。")]),t._v(" "),n("li",[n("code",[t._v("checkAddress")]),t._v("(Function) - 直接配置一个检查 IP 地址的函数，根据函数的返回值来判断是否允许在 "),n("code",[t._v("safeCurl")]),t._v(" 中被访问，当返回非 "),n("code",[t._v("true")]),t._v(" 时，该 IP 无法被访问。"),n("code",[t._v("checkAddress")]),t._v(" 优先级高于 "),n("code",[t._v("ipBlackList")]),t._v("。")])]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// config/config.default.js")]),t._v("\nexports"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("security "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  ssrf"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    ipBlackList"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'10.0.0.0/8'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 支持 IP 网段")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'0.0.0.0/32'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'127.0.0.1'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 支持指定 IP 地址")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 配置了 checkAddress 时，ipBlackList 不会生效")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("checkAddress")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("ip")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" ip "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'127.0.0.1'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br")])]),n("h3",{attrs:{id:"其他安全工具"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#其他安全工具"}},[t._v("#")]),t._v(" 其他安全工具")]),t._v(" "),n("p",[n("strong",[t._v("ctx.isSafeDomain(domain)")]),t._v(": 是否为安全域名。安全域名在配置中配置，见 "),n("code",[t._v("ctx.redirect")]),t._v(" 部分。")]),t._v(" "),n("p",[n("strong",[t._v("app.injectCsrf(str)")]),t._v(":这个函数提供了模板预处理－自动插入 CSRF key 的能力，可以自动在所有的 form 标签中插入 CSRF 隐藏域，用户就不需要手动写了。")]),t._v(" "),n("p",[n("strong",[t._v("app.injectNonce(str)")]),t._v(": 这个函数提供了模板预处理－自动插入 nonce 的能力，如果网站开启了 CSP 安全头，并且想使用 "),n("code",[t._v("CSP 2.0 nonce")]),t._v(" 特性，可以使用这个函数。参考 "),n("a",{attrs:{href:"https://www.zhihu.com/question/21979782",target:"_blank",rel:"noopener noreferrer"}},[t._v("CSP 是什么"),n("OutboundLink")],1),t._v("。这个函数会扫描模板中的 script 标签，并自动加上 nonce 头。")]),t._v(" "),n("p",[n("strong",[t._v("app.injectHijackingDefense(str)")]),t._v(": 对于没有开启 HTTPS 的网站，"),n("strong",[t._v("这个函数可以有限的防止运营商劫持")]),t._v("。")]),t._v(" "),n("h2",{attrs:{id:"接口防御"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#接口防御"}},[t._v("#")]),t._v(" 接口防御")]),t._v(" "),n("ul",[n("li",[t._v("网关控制流量洪峰，对在一个时间段内出现流量异常，可以拒绝请求;")]),t._v(" "),n("li",[t._v("源"),n("code",[t._v("ip")]),t._v("请求个数限制。对请求来源的"),n("code",[t._v("ip")]),t._v("请求个数做限制;  频率限制（1s内接口调用次数限制）IP限制；\n"),n("ul",[n("li",[t._v("防刷一般分两种：\n"),n("ul",[n("li",[t._v("总调用次数受限制。这个一般是在后端做限制，单位时间内最多可调用次数。")]),t._v(" "),n("li",[t._v("同一客户端次数限制。这个前端的一般使用是给接口调用加锁，在返回结果或者一定时间之后解锁。")])])]),t._v(" "),n("li",[n("strong",[t._v("刷接口")]),t._v("直接走脚本，前端限制有一定作用，但不大。\n"),n("ul",[n("li",[t._v("根据"),n("code",[t._v("IP")]),t._v("限制调用次数【请求在代理服务器被拦截"),n("code",[t._v("nginx")]),t._v("，减少后端服务被调用】；")]),t._v(" "),n("li",[t._v("拦截器特定信息校验，例如："),n("code",[t._v("token")]),t._v("【后端服务器拦截器，减少业务判断和处理】；\n"),n("ul",[n("li",[t._v("1、校验请求头referer;  2、校验请求token； 3、请求频率;")])])])])])])]),t._v(" "),n("li",[n("code",[t._v("http")]),t._v("请求头信息校验；（例如"),n("code",[t._v("host")]),t._v("，"),n("code",[t._v("User-Agent")]),t._v("，"),n("code",[t._v("Referer")]),t._v("）; referer校验; UA校验;")]),t._v(" "),n("li",[t._v("对用户唯一身份uid进行限制和校验。例如基本的长度，组合方式，甚至有效性进行判断。或者uid具有一定的时效性 ;")]),t._v(" "),n("li",[t._v("前后端协议采用二进制方式进行交互或者协议采用签名机制;")]),t._v(" "),n("li",[t._v("机验证，验证码，短信验证码，滑动图片形式，12306形式 ;")])]),t._v(" "),n("h2",{attrs:{id:"防御简述版【推荐】"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#防御简述版【推荐】"}},[t._v("#")]),t._v(" 防御简述版【推荐】")]),t._v(" "),n("h3",{attrs:{id:"xss攻击"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#xss攻击"}},[t._v("#")]),t._v(" XSS攻击")]),t._v(" "),n("p",[t._v("Cross-site "),n("strong",[t._v("script")]),t._v("，"),n("strong",[t._v("跨站脚本攻击")]),t._v("；为了与层叠样式表css区分，"),n("strong",[t._v("将跨站脚本简写为XSS")]),t._v("；当其它用户浏览该网站时候，该段 HTML 代码会自动执行，从而达到攻击的目的，如盗取用户的 Cookie，破坏页面结构，重定向到其它网站等。")]),t._v(" "),n("p",[n("strong",[t._v("XSS 类型")]),t._v("：一般可以分为： 非持久型 XSS 和持久性 XSS")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("Reflected XSS（"),n("strong",[t._v("反射型的 XSS 攻击")]),t._v("）"),n("strong",[t._v("非持久型")]),t._v(":")]),t._v(" "),n("ul",[n("li",[t._v("主要是由于"),n("strong",[t._v("服务端接收到客户端的不安全输入")]),t._v("，在客户端触发执行从而发起 Web 攻击。比如：对一个页面的 URL 中的某个参数做文章，把精心构造好的恶意脚本"),n("strong",[t._v("包装在 URL 参数重中")]),t._v("，再将这个 URL 发布到网上，骗取用户访问，从而进行攻;")]),t._v(" "),n("li",[t._v("用户将一段含有恶意代码的请求提交给 Web 服务器，Web 服务器接收到请求时，又将恶意代码反射给了浏览器端，这就是反射型 XSS 攻击。 在现实生活中，黑客经常会通过 QQ 群或者邮件等渠道诱导用户去点击这些恶意链接，所以对于一些链接我们一定要慎之又慎。")]),t._v(" "),n("li",[n("strong",[t._v("Web 服务器不会存储反射型 XSS 攻击的恶意脚本，这是和存储型 XSS 攻击不同的地方")]),t._v("。")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(954),alt:"image-20211104094829003"}})]),t._v(" "),n("p",[t._v("浏览器输入 "),n("code",[t._v("http://localhost:3000/?message=<script>var cookie = document.cookie; alert(")]),t._v("我是 XSS 攻击，你中招了 😄, cookie: ${cookie}"),n("code",[t._v(")<\/script>")]),t._v(" 回车后，页面上会弹出如下提示框。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(955),alt:"image-20211104100542590"}})])]),t._v(" "),n("li",[n("p",[t._v("Stored XSS（"),n("strong",[t._v("存储型的 XSS 攻击")]),t._v("）"),n("strong",[t._v("持久型")])]),t._v(" "),n("ul",[n("li",[t._v("基于存储的 XSS 攻击，是通过提交带有恶意脚本的"),n("strong",[t._v("内容存储在服务器上")]),t._v("，当其他人看到这些内容时发起 Web 攻击。一般提交的内容都是"),n("strong",[t._v("通过一些富文本编辑器编辑的，很容易插入危险代码")]),t._v("。(如上述的"),n("strong",[t._v("留言评论功能")]),t._v(");")]),t._v(" "),n("li",[t._v("利用漏洞提交恶意 JavaScript 代码，比如在input, textarea等所有可能输入文本信息的区域，输入"),n("code",[t._v('<script src="http://恶意网站"><\/script>')]),t._v("等，提交后信息会存在服务器中，当用户再次打开网站请求到相应的数据，打开页面，恶意脚本就会将用户的 Cookie 信息等数据上传到黑客服务器。")]),t._v(" "),n("li",[t._v("比如：攻击者在论坛中放一个看似安全的链接，骗取用户点击后，窃取"),n("code",[t._v("cookie")]),t._v("中的用户私密信息；或者攻击者在论坛中加一个恶意表单，当用户提交表单的时候，却把信息传送到攻击者的服务器中，而不是用户原本以为的信任站点。")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(956),alt:"image-20211104094427555"}})])])]),t._v(" "),n("p",[n("strong",[t._v("防范")])]),t._v(" "),n("p",[t._v("为了防止 XSS 攻击，我们需要验证用户的输入，做到有效检测。对输出的数据做编码，防止恶意脚本注入成功在浏览器端之行。")]),t._v(" "),n("ul",[n("li",[n("strong",[t._v("确定性类型字段加强校验")]),t._v("：当一些字段是确定性类型的，在输入内容时应按照相应规则加强校验，例如手机号、邮箱等信息。")]),t._v(" "),n("li",[n("strong",[t._v("HTML 模版转义")]),t._v("：对于前后端一体的应用，拼接 HTML 模版这些也是必不可少的，应对 HTML 模版做好充分转义。一些常用的模版引擎：pug、ejs 这些默认都带有转义功能，来防止 XSS 攻击。")]),t._v(" "),n("li",[n("strong",[t._v("设置 httpOnly")]),t._v("：禁止用户读取 cookie，就算注入恶意代码，也无法读取 cookie 信息冒充用户提交信息。")]),t._v(" "),n("li",[n("strong",[t._v("过滤和转码")]),t._v("：关键字符做过滤或转码，如果是过滤，直接过滤掉指定的关键词，页面就不会展示了。如果是转码，不会过滤掉但也不会让其执行，例如 "),n("code",[t._v("<script>")]),t._v(" 转义为 "),n("code",[t._v("<script>")]),t._v("。"),n("strong",[t._v("推荐一个库js-xss，用于对用户输入的内容进行过滤，以避免遭受 XSS 攻")]),t._v("。")]),t._v(" "),n("li",[n("strong",[t._v("CSP")]),t._v("：一种内容安全策略，需要在服务端设置；")])]),t._v(" "),n("h3",{attrs:{id:"csrf攻击"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#csrf攻击"}},[t._v("#")]),t._v(" CSRF攻击")]),t._v(" "),n("p",[t._v("CSRF(Cross-site "),n("strong",[t._v("request")]),t._v(" forgery), 中文名称："),n("strong",[t._v("跨站请求伪造")])]),t._v(" "),n("p",[t._v("CSRF 可以简单理解为：攻击者盗用了你的身份，以你的名义发送恶意请求，容易造成隐私泄露以及财产安全。")]),t._v(" "),n("p",[t._v("防范：")]),t._v(" "),n("ul",[n("li",[n("strong",[t._v("post请求")]),t._v("; 隐藏令牌")]),t._v(" "),n("li",[n("strong",[t._v("Token验证;")]),t._v(" 使用token")]),t._v(" "),n("li",[n("strong",[t._v("验证码")])])]),t._v(" "),n("p",[t._v("值得注意的是，过滤用户输入的内容不能阻挡 CSRF 攻击，我们需要做的事过滤请求的来源，因为有些请求是合法，有些是非法的，所以 "),n("strong",[t._v("CSRF 防御主要是过滤那些非法伪造的请求来源")]),t._v("。")]),t._v(" "),n("h4",{attrs:{id:"xss和csrf区别"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#xss和csrf区别"}},[t._v("#")]),t._v(" XSS和CSRF区别")]),t._v(" "),n("ul",[n("li",[n("strong",[t._v("原理不同")]),t._v("，XSS是向"),n("strong",[t._v("目标网站注入JS代码，然后执行JS里的代码。"),n("strong",[t._v("CSRF是")]),t._v("利用网站A本身的漏洞，去请求网站A的api")]),t._v("；")]),t._v(" "),n("li",[t._v("XSS不需要登录，而CSRF需要用户先登录目标网站获取cookie")]),t._v(" "),n("li",[n("strong",[t._v("XSS的目标是服务器，CSRF的目标是用户")])]),t._v(" "),n("li",[n("strong",[t._v("XSS是利用合法用户获取其信息")]),t._v("，而"),n("strong",[t._v("CSRF是伪造成合法用户发起")]),t._v("请求")])]),t._v(" "),n("h3",{attrs:{id:"ddos攻击"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ddos攻击"}},[t._v("#")]),t._v(" DDOS攻击")]),t._v(" "),n("p",[t._v("利用"),n("strong",[t._v("目标系统网络服务功能缺陷")]),t._v("或者"),n("strong",[t._v("直接消耗")]),t._v("其系统资源，使得该目标系统无法提供正常的服务。")]),t._v(" "),n("p",[t._v("DDoS 攻击通过大量合法的请求占用大量网络资源，以达到瘫痪网络的目的。 具体有几种形式：")]),t._v(" "),n("ul",[n("li",[t._v("通过使网络过载来干扰甚至阻断正常的网络通讯；")]),t._v(" "),n("li",[t._v("通过向服务器提交大量请求，使服务器超负荷；")]),t._v(" "),n("li",[t._v("阻断某一用户访问服务器；")]),t._v(" "),n("li",[t._v("阻断某服务与特定系统或个人的通讯。")])]),t._v(" "),n("h4",{attrs:{id:"接口-ddos-防御"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#接口-ddos-防御"}},[t._v("#")]),t._v(" 接口(DDOS)防御")]),t._v(" "),n("ol",[n("li",[t._v("网关控制流量洪峰，对在一个时间段内出现流量异常，可以拒绝请求;")]),t._v(" "),n("li",[t._v("源"),n("code",[t._v("ip")]),t._v("请求个数限制。对请求来源的"),n("code",[t._v("ip")]),t._v("请求个数做限制;")]),t._v(" "),n("li",[t._v("频率限制（1s内接口调用次数限制）IP限制； 防刷一般分两种：")])]),t._v(" "),n("ul",[n("li",[n("strong",[t._v("总调用次数受限制")]),t._v("。这个一般是在"),n("strong",[t._v("后端做限制")]),t._v("，单位时间内最多可调用次数。")]),t._v(" "),n("li",[n("strong",[t._v("同一客户端次数限制")]),t._v("。这个"),n("strong",[t._v("前端的一般使用")]),t._v("是给接口调用加锁，在返回结果或者一定时间之后解锁。")])]),t._v(" "),n("p",[n("strong",[t._v("刷接口")]),t._v("直接走脚本，前端限制有一定作用，但不大。")]),t._v(" "),n("ul",[n("li",[t._v("根据"),n("code",[t._v("IP")]),t._v("限制调用次数【请求在代理服务器被拦截"),n("code",[t._v("nginx")]),t._v("，减少后端服务被调用】；")]),t._v(" "),n("li",[t._v("拦截器特定信息校验，例如："),n("code",[t._v("token")]),t._v("【后端服务器拦截器，减少业务判断和处理】； 1、校验请求头referer 2、校验请求token； 3、请求频率")])]),t._v(" "),n("h3",{attrs:{id:"文件上传漏洞"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#文件上传漏洞"}},[t._v("#")]),t._v(" 文件上传漏洞")]),t._v(" "),n("p",[t._v("服务器未校验上传的文件，致使黑客可以上传恶意脚本等方式。")]),t._v(" "),n("p",[n("strong",[t._v("预防策略")])]),t._v(" "),n("ol",[n("li",[t._v("用文件头来检测文件类型，"),n("strong",[t._v("使用白名单过滤(有些文件可以从其中一部分执行，只检查文件头无效，例如 PHP 等脚本语言)；")])]),t._v(" "),n("li",[n("strong",[t._v("上传后将文件彻底重命名并移动到不可执行的目录下")]),t._v("；")]),t._v(" "),n("li",[t._v("升级服务器软件以避免路径解析漏洞；")]),t._v(" "),n("li",[t._v("升级用到的开源编辑器；")]),t._v(" "),n("li",[t._v("管理后台设置强密码。")])]),t._v(" "),n("h3",{attrs:{id:"sql注入"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#sql注入"}},[t._v("#")]),t._v(" SQL注入")]),t._v(" "),n("p",[t._v("拼接 SQL 时未仔细过滤，黑客可提交畸形数据改变语义。比如查某个文章，提交了这样的数据"),n("code",[t._v("id=-1 or 1=1")]),t._v("等。1=1 永远是true，导致where语句永远是ture.那么查询的结果相当于整张表的内容，攻击者就达到了目的。或者，通过屏幕上的报错提示推测 SQL 语句等。")]),t._v(" "),n("p",[n("strong",[t._v("预防策略")])]),t._v(" "),n("ol",[n("li",[t._v("禁止目标网站利用动态拼接字符串的方式访问数据库")]),t._v(" "),n("li",[t._v("减少不必要的数据库抛出的错误信息")]),t._v(" "),n("li",[t._v("对数据库的操作赋予严格的权限控制")]),t._v(" "),n("li",[t._v("净化和过滤掉不必要的SQL保留字，比如：where, or, exec 等")]),t._v(" "),n("li",[t._v('不要信任用户的输入，要对用户的输入进行校验，可以通过正则表达式，或限制长度，对单引号和双"-"进行转换等')]),t._v(" "),n("li",[t._v("不要使用动态拼装SQL，可以使用参数化的SQL或者直接使用存储过程进行数据查询存取")]),t._v(" "),n("li",[t._v("不要使用管理员权限的数据库连接，为每个应用使用单独的权限有限的数据库连接")]),t._v(" "),n("li",[t._v("不要把机密信息明文存放，请加密或者hash掉密码和敏感的信息")])]),t._v(" "),n("h2",{attrs:{id:"参考链接"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#参考链接"}},[t._v("#")]),t._v(" 参考链接")]),t._v(" "),n("p",[t._v("https://eggjs.org/zh-cn/core/security.html")]),t._v(" "),n("p",[t._v("https://juejin.cn/post/6929281260045434894")])])}),[],!1,null,null,null);s.default=e.exports},953:function(t,s,a){t.exports=a.p+"assets/img/image-20211104095224715.160d0778.png"},954:function(t,s,a){t.exports=a.p+"assets/img/image-20211104094829003.ade9cfee.png"},955:function(t,s,a){t.exports=a.p+"assets/img/image-20211104100542590.c1379d89.png"},956:function(t,s,a){t.exports=a.p+"assets/img/image-20211104094427555.3ba3dbac.png"}}]);