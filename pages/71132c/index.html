<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>vue-cli源码分析 | 写作认知体系</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/rat-summ/img/favicon.ico">
    <link rel="manifest" href="/rat-summ/manifest.json">
    <script charset="utf-8" src="/rat-summ/js/readmore.js"></script>
    <meta name="description" content="Evan You 8月10日 在 Medium发布了 Vue CLI 3.0 is here!，这标志着 vue-cli 进入了 3.0 时代。从这以后，vue 开发体验更加地优秀，开发逼格更加地高大。">
    <meta name="image" content="https://my.samyz.cn/./_image/03.vue-cli-base/foreword-img01.png">
    <meta name="twitter:title" content="vue-cli源码分析">
    <meta name="twitter:description" content="Evan You 8月10日 在 Medium发布了 Vue CLI 3.0 is here!，这标志着 vue-cli 进入了 3.0 时代。从这以后，vue 开发体验更加地优秀，开发逼格更加地高大。">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://my.samyz.cn/./_image/03.vue-cli-base/foreword-img01.png">
    <meta name="twitter:url" content="https://my.samyz.cn/%E3%80%8A%E6%8A%80%E8%83%BD%E8%AE%B0%E5%BD%95%E3%80%8B/05.vue/05.cli/03.vue-cli%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90.html">
    <meta property="og:type" content="article">
    <meta property="og:title" content="vue-cli源码分析">
    <meta property="og:description" content="Evan You 8月10日 在 Medium发布了 Vue CLI 3.0 is here!，这标志着 vue-cli 进入了 3.0 时代。从这以后，vue 开发体验更加地优秀，开发逼格更加地高大。">
    <meta property="og:image" content="https://my.samyz.cn/./_image/03.vue-cli-base/foreword-img01.png">
    <meta property="og:url" content="https://my.samyz.cn/%E3%80%8A%E6%8A%80%E8%83%BD%E8%AE%B0%E5%BD%95%E3%80%8B/05.vue/05.cli/03.vue-cli%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90.html">
    <meta property="og:site_name" content="samyzh">
    <meta property="article:published_time" content="2021-01-18T23:26:17.000Z">
    <meta itemprop="name" content="vue-cli源码分析">
    <meta itemprop="description" content="Evan You 8月10日 在 Medium发布了 Vue CLI 3.0 is here!，这标志着 vue-cli 进入了 3.0 时代。从这以后，vue 开发体验更加地优秀，开发逼格更加地高大。">
    <meta itemprop="image" content="https://my.samyz.cn/./_image/03.vue-cli-base/foreword-img01.png">
    <meta name="keywords" content="vuepress,theme,doc">
    <meta name="theme-color" content="#11a8cd">
    <link rel="preload" href="/rat-summ/assets/css/0.styles.b7fb6ee3.css" as="style"><link rel="preload" href="/rat-summ/assets/js/app.12c8e251.js" as="script"><link rel="preload" href="/rat-summ/assets/js/3.9ee9750d.js" as="script"><link rel="preload" href="/rat-summ/assets/js/19.edc5370a.js" as="script"><link rel="preload" href="/rat-summ/assets/js/126.5b6d9993.js" as="script"><link rel="prefetch" href="/rat-summ/assets/js/10.80323458.js"><link rel="prefetch" href="/rat-summ/assets/js/100.63ac2838.js"><link rel="prefetch" href="/rat-summ/assets/js/101.f09c9fa8.js"><link rel="prefetch" href="/rat-summ/assets/js/102.e02db0d7.js"><link rel="prefetch" href="/rat-summ/assets/js/103.51677b36.js"><link rel="prefetch" href="/rat-summ/assets/js/104.61a1cf5b.js"><link rel="prefetch" href="/rat-summ/assets/js/105.70098b35.js"><link rel="prefetch" href="/rat-summ/assets/js/106.6ae75c51.js"><link rel="prefetch" href="/rat-summ/assets/js/107.d489a3d5.js"><link rel="prefetch" href="/rat-summ/assets/js/108.8e8c89ba.js"><link rel="prefetch" href="/rat-summ/assets/js/109.882f5f95.js"><link rel="prefetch" href="/rat-summ/assets/js/11.d181b5e4.js"><link rel="prefetch" href="/rat-summ/assets/js/110.9d564d94.js"><link rel="prefetch" href="/rat-summ/assets/js/111.478420b6.js"><link rel="prefetch" href="/rat-summ/assets/js/112.6c4c063d.js"><link rel="prefetch" href="/rat-summ/assets/js/113.3315b958.js"><link rel="prefetch" href="/rat-summ/assets/js/114.12c71440.js"><link rel="prefetch" href="/rat-summ/assets/js/115.ae4f07da.js"><link rel="prefetch" href="/rat-summ/assets/js/116.43f95817.js"><link rel="prefetch" href="/rat-summ/assets/js/117.ed8bfc6d.js"><link rel="prefetch" href="/rat-summ/assets/js/118.64e4c02c.js"><link rel="prefetch" href="/rat-summ/assets/js/119.b875aab9.js"><link rel="prefetch" href="/rat-summ/assets/js/12.0e10da37.js"><link rel="prefetch" href="/rat-summ/assets/js/120.bd5786bb.js"><link rel="prefetch" href="/rat-summ/assets/js/121.86519d2a.js"><link rel="prefetch" href="/rat-summ/assets/js/122.ceba69a1.js"><link rel="prefetch" href="/rat-summ/assets/js/123.daacf7b1.js"><link rel="prefetch" href="/rat-summ/assets/js/124.343ee32a.js"><link rel="prefetch" href="/rat-summ/assets/js/125.9bcd4dbe.js"><link rel="prefetch" href="/rat-summ/assets/js/127.83f78f6b.js"><link rel="prefetch" href="/rat-summ/assets/js/128.d24cd969.js"><link rel="prefetch" href="/rat-summ/assets/js/129.1f27d5da.js"><link rel="prefetch" href="/rat-summ/assets/js/13.464088c6.js"><link rel="prefetch" href="/rat-summ/assets/js/130.d8eb4273.js"><link rel="prefetch" href="/rat-summ/assets/js/131.8781abf8.js"><link rel="prefetch" href="/rat-summ/assets/js/132.6498f3c3.js"><link rel="prefetch" href="/rat-summ/assets/js/133.57a6dd2f.js"><link rel="prefetch" href="/rat-summ/assets/js/134.fad0beeb.js"><link rel="prefetch" href="/rat-summ/assets/js/135.77d5837d.js"><link rel="prefetch" href="/rat-summ/assets/js/136.f276fa7c.js"><link rel="prefetch" href="/rat-summ/assets/js/137.26c2d25c.js"><link rel="prefetch" href="/rat-summ/assets/js/138.7e4b3e8b.js"><link rel="prefetch" href="/rat-summ/assets/js/139.5b8ba084.js"><link rel="prefetch" href="/rat-summ/assets/js/14.8dbffc81.js"><link rel="prefetch" href="/rat-summ/assets/js/140.cebddf00.js"><link rel="prefetch" href="/rat-summ/assets/js/141.93995db1.js"><link rel="prefetch" href="/rat-summ/assets/js/142.ae5cbf85.js"><link rel="prefetch" href="/rat-summ/assets/js/143.dac237e2.js"><link rel="prefetch" href="/rat-summ/assets/js/144.fed101d1.js"><link rel="prefetch" href="/rat-summ/assets/js/145.df2f2e49.js"><link rel="prefetch" href="/rat-summ/assets/js/146.5feac5c1.js"><link rel="prefetch" href="/rat-summ/assets/js/147.0389a873.js"><link rel="prefetch" href="/rat-summ/assets/js/148.d3e8a026.js"><link rel="prefetch" href="/rat-summ/assets/js/149.7efffb81.js"><link rel="prefetch" href="/rat-summ/assets/js/15.8ec7b29e.js"><link rel="prefetch" href="/rat-summ/assets/js/150.fd38d672.js"><link rel="prefetch" href="/rat-summ/assets/js/151.afe3a15d.js"><link rel="prefetch" href="/rat-summ/assets/js/152.9412368d.js"><link rel="prefetch" href="/rat-summ/assets/js/153.7d3adbef.js"><link rel="prefetch" href="/rat-summ/assets/js/154.e3448ffd.js"><link rel="prefetch" href="/rat-summ/assets/js/155.0f81c9f4.js"><link rel="prefetch" href="/rat-summ/assets/js/156.c7bd68bf.js"><link rel="prefetch" href="/rat-summ/assets/js/157.d4cf6362.js"><link rel="prefetch" href="/rat-summ/assets/js/158.9d23effb.js"><link rel="prefetch" href="/rat-summ/assets/js/159.03c2fc1f.js"><link rel="prefetch" href="/rat-summ/assets/js/16.d97cc4b2.js"><link rel="prefetch" href="/rat-summ/assets/js/160.a3697128.js"><link rel="prefetch" href="/rat-summ/assets/js/161.ceef51ed.js"><link rel="prefetch" href="/rat-summ/assets/js/162.5a415671.js"><link rel="prefetch" href="/rat-summ/assets/js/163.cb7f48e0.js"><link rel="prefetch" href="/rat-summ/assets/js/164.22d1a032.js"><link rel="prefetch" href="/rat-summ/assets/js/165.d36b06fe.js"><link rel="prefetch" href="/rat-summ/assets/js/166.5562cf71.js"><link rel="prefetch" href="/rat-summ/assets/js/167.f2f53141.js"><link rel="prefetch" href="/rat-summ/assets/js/168.d1764292.js"><link rel="prefetch" href="/rat-summ/assets/js/169.71c1b376.js"><link rel="prefetch" href="/rat-summ/assets/js/17.974c76b3.js"><link rel="prefetch" href="/rat-summ/assets/js/170.a1844c75.js"><link rel="prefetch" href="/rat-summ/assets/js/171.8bd11d6b.js"><link rel="prefetch" href="/rat-summ/assets/js/172.630472f7.js"><link rel="prefetch" href="/rat-summ/assets/js/173.9f780f02.js"><link rel="prefetch" href="/rat-summ/assets/js/174.3903a474.js"><link rel="prefetch" href="/rat-summ/assets/js/175.0b55890f.js"><link rel="prefetch" href="/rat-summ/assets/js/176.ebd9da76.js"><link rel="prefetch" href="/rat-summ/assets/js/177.f866bfcc.js"><link rel="prefetch" href="/rat-summ/assets/js/178.9dab120a.js"><link rel="prefetch" href="/rat-summ/assets/js/179.00f175ae.js"><link rel="prefetch" href="/rat-summ/assets/js/18.f1a4f7b2.js"><link rel="prefetch" href="/rat-summ/assets/js/180.fd45856c.js"><link rel="prefetch" href="/rat-summ/assets/js/181.1f9f05a8.js"><link rel="prefetch" href="/rat-summ/assets/js/182.dec7bce8.js"><link rel="prefetch" href="/rat-summ/assets/js/183.ee99d36c.js"><link rel="prefetch" href="/rat-summ/assets/js/184.873055ff.js"><link rel="prefetch" href="/rat-summ/assets/js/185.836db06c.js"><link rel="prefetch" href="/rat-summ/assets/js/186.ed2b2aa0.js"><link rel="prefetch" href="/rat-summ/assets/js/187.f55e617d.js"><link rel="prefetch" href="/rat-summ/assets/js/188.ffd267f6.js"><link rel="prefetch" href="/rat-summ/assets/js/189.0777dab4.js"><link rel="prefetch" href="/rat-summ/assets/js/190.37c6eb5c.js"><link rel="prefetch" href="/rat-summ/assets/js/191.e2148011.js"><link rel="prefetch" href="/rat-summ/assets/js/192.74b5350b.js"><link rel="prefetch" href="/rat-summ/assets/js/193.92639440.js"><link rel="prefetch" href="/rat-summ/assets/js/194.07a698d3.js"><link rel="prefetch" href="/rat-summ/assets/js/195.d9d05ac9.js"><link rel="prefetch" href="/rat-summ/assets/js/196.893ea875.js"><link rel="prefetch" href="/rat-summ/assets/js/197.faf002df.js"><link rel="prefetch" href="/rat-summ/assets/js/198.e9af0cc8.js"><link rel="prefetch" href="/rat-summ/assets/js/199.78a32edd.js"><link rel="prefetch" href="/rat-summ/assets/js/2.7c04700d.js"><link rel="prefetch" href="/rat-summ/assets/js/20.33603afe.js"><link rel="prefetch" href="/rat-summ/assets/js/200.d1cec810.js"><link rel="prefetch" href="/rat-summ/assets/js/201.de6d878d.js"><link rel="prefetch" href="/rat-summ/assets/js/202.cdb07eb9.js"><link rel="prefetch" href="/rat-summ/assets/js/203.f82a15e9.js"><link rel="prefetch" href="/rat-summ/assets/js/204.f9c43a60.js"><link rel="prefetch" href="/rat-summ/assets/js/205.ebfd1b03.js"><link rel="prefetch" href="/rat-summ/assets/js/206.9322b908.js"><link rel="prefetch" href="/rat-summ/assets/js/207.b611c8e4.js"><link rel="prefetch" href="/rat-summ/assets/js/208.b56c09a4.js"><link rel="prefetch" href="/rat-summ/assets/js/209.5fa250ae.js"><link rel="prefetch" href="/rat-summ/assets/js/21.e361060e.js"><link rel="prefetch" href="/rat-summ/assets/js/210.afb67c23.js"><link rel="prefetch" href="/rat-summ/assets/js/211.975d8a93.js"><link rel="prefetch" href="/rat-summ/assets/js/212.e6114672.js"><link rel="prefetch" href="/rat-summ/assets/js/213.dcc0418e.js"><link rel="prefetch" href="/rat-summ/assets/js/214.b34c4a78.js"><link rel="prefetch" href="/rat-summ/assets/js/215.46240575.js"><link rel="prefetch" href="/rat-summ/assets/js/216.4fcc46c0.js"><link rel="prefetch" href="/rat-summ/assets/js/217.a2791aae.js"><link rel="prefetch" href="/rat-summ/assets/js/218.4c256ceb.js"><link rel="prefetch" href="/rat-summ/assets/js/219.a943095e.js"><link rel="prefetch" href="/rat-summ/assets/js/22.483a320b.js"><link rel="prefetch" href="/rat-summ/assets/js/220.9fc9ad7e.js"><link rel="prefetch" href="/rat-summ/assets/js/221.cbc0e78d.js"><link rel="prefetch" href="/rat-summ/assets/js/222.191f7e78.js"><link rel="prefetch" href="/rat-summ/assets/js/223.2f2104da.js"><link rel="prefetch" href="/rat-summ/assets/js/224.a96291e3.js"><link rel="prefetch" href="/rat-summ/assets/js/225.5e7d4a2f.js"><link rel="prefetch" href="/rat-summ/assets/js/226.f2c52aeb.js"><link rel="prefetch" href="/rat-summ/assets/js/227.29ce8f1e.js"><link rel="prefetch" href="/rat-summ/assets/js/228.606fc221.js"><link rel="prefetch" href="/rat-summ/assets/js/229.35c0193b.js"><link rel="prefetch" href="/rat-summ/assets/js/23.ea56380f.js"><link rel="prefetch" href="/rat-summ/assets/js/230.c18c39ff.js"><link rel="prefetch" href="/rat-summ/assets/js/231.8ac9de68.js"><link rel="prefetch" href="/rat-summ/assets/js/232.a37a54cf.js"><link rel="prefetch" href="/rat-summ/assets/js/233.2d63ab61.js"><link rel="prefetch" href="/rat-summ/assets/js/234.bb2f44c1.js"><link rel="prefetch" href="/rat-summ/assets/js/235.6b07773d.js"><link rel="prefetch" href="/rat-summ/assets/js/236.d9377791.js"><link rel="prefetch" href="/rat-summ/assets/js/237.9cae90d9.js"><link rel="prefetch" href="/rat-summ/assets/js/238.fc5c2f17.js"><link rel="prefetch" href="/rat-summ/assets/js/239.b69acdbe.js"><link rel="prefetch" href="/rat-summ/assets/js/24.8165c81c.js"><link rel="prefetch" href="/rat-summ/assets/js/240.2998122f.js"><link rel="prefetch" href="/rat-summ/assets/js/241.dfd9d735.js"><link rel="prefetch" href="/rat-summ/assets/js/242.6d57d6b1.js"><link rel="prefetch" href="/rat-summ/assets/js/243.39bb5753.js"><link rel="prefetch" href="/rat-summ/assets/js/244.37f91d9e.js"><link rel="prefetch" href="/rat-summ/assets/js/245.710a3e10.js"><link rel="prefetch" href="/rat-summ/assets/js/246.680ed8ab.js"><link rel="prefetch" href="/rat-summ/assets/js/247.7ea05ed5.js"><link rel="prefetch" href="/rat-summ/assets/js/248.e76a424e.js"><link rel="prefetch" href="/rat-summ/assets/js/249.7c88f5bc.js"><link rel="prefetch" href="/rat-summ/assets/js/25.def02ca5.js"><link rel="prefetch" href="/rat-summ/assets/js/250.4569c567.js"><link rel="prefetch" href="/rat-summ/assets/js/251.878e4926.js"><link rel="prefetch" href="/rat-summ/assets/js/252.67d9ba84.js"><link rel="prefetch" href="/rat-summ/assets/js/253.82ca1732.js"><link rel="prefetch" href="/rat-summ/assets/js/254.27dbadc2.js"><link rel="prefetch" href="/rat-summ/assets/js/255.60f68a5f.js"><link rel="prefetch" href="/rat-summ/assets/js/256.b47e4d3f.js"><link rel="prefetch" href="/rat-summ/assets/js/257.0df59c99.js"><link rel="prefetch" href="/rat-summ/assets/js/258.130b0487.js"><link rel="prefetch" href="/rat-summ/assets/js/259.97887542.js"><link rel="prefetch" href="/rat-summ/assets/js/26.97b1d951.js"><link rel="prefetch" href="/rat-summ/assets/js/260.6dac92fb.js"><link rel="prefetch" href="/rat-summ/assets/js/261.af516821.js"><link rel="prefetch" href="/rat-summ/assets/js/262.ef9f9b6a.js"><link rel="prefetch" href="/rat-summ/assets/js/263.dcc5eb79.js"><link rel="prefetch" href="/rat-summ/assets/js/264.61ce928d.js"><link rel="prefetch" href="/rat-summ/assets/js/265.82cb28d2.js"><link rel="prefetch" href="/rat-summ/assets/js/266.9eb89497.js"><link rel="prefetch" href="/rat-summ/assets/js/267.99284b0c.js"><link rel="prefetch" href="/rat-summ/assets/js/268.82dfc492.js"><link rel="prefetch" href="/rat-summ/assets/js/269.6cac85a2.js"><link rel="prefetch" href="/rat-summ/assets/js/27.c1905c39.js"><link rel="prefetch" href="/rat-summ/assets/js/270.69da763d.js"><link rel="prefetch" href="/rat-summ/assets/js/271.bbbb2115.js"><link rel="prefetch" href="/rat-summ/assets/js/272.ff0f601d.js"><link rel="prefetch" href="/rat-summ/assets/js/273.0f3d1f43.js"><link rel="prefetch" href="/rat-summ/assets/js/274.de951754.js"><link rel="prefetch" href="/rat-summ/assets/js/275.36fcef7b.js"><link rel="prefetch" href="/rat-summ/assets/js/276.0f69e2d6.js"><link rel="prefetch" href="/rat-summ/assets/js/277.6116c28b.js"><link rel="prefetch" href="/rat-summ/assets/js/278.3ec4a543.js"><link rel="prefetch" href="/rat-summ/assets/js/279.79cacba3.js"><link rel="prefetch" href="/rat-summ/assets/js/28.29769ec1.js"><link rel="prefetch" href="/rat-summ/assets/js/280.67eae4c9.js"><link rel="prefetch" href="/rat-summ/assets/js/281.6454a6a5.js"><link rel="prefetch" href="/rat-summ/assets/js/282.de2ce91b.js"><link rel="prefetch" href="/rat-summ/assets/js/283.82e0f4ca.js"><link rel="prefetch" href="/rat-summ/assets/js/284.69abfc0e.js"><link rel="prefetch" href="/rat-summ/assets/js/285.558435fb.js"><link rel="prefetch" href="/rat-summ/assets/js/286.fa4f4e4a.js"><link rel="prefetch" href="/rat-summ/assets/js/287.8f22a85e.js"><link rel="prefetch" href="/rat-summ/assets/js/288.d36804d8.js"><link rel="prefetch" href="/rat-summ/assets/js/289.992bf452.js"><link rel="prefetch" href="/rat-summ/assets/js/29.bc17da71.js"><link rel="prefetch" href="/rat-summ/assets/js/290.d217e3d5.js"><link rel="prefetch" href="/rat-summ/assets/js/291.0108ca07.js"><link rel="prefetch" href="/rat-summ/assets/js/292.c1cf5376.js"><link rel="prefetch" href="/rat-summ/assets/js/293.55852ed3.js"><link rel="prefetch" href="/rat-summ/assets/js/294.709d66f6.js"><link rel="prefetch" href="/rat-summ/assets/js/295.e8eb94ac.js"><link rel="prefetch" href="/rat-summ/assets/js/296.ffbcc931.js"><link rel="prefetch" href="/rat-summ/assets/js/297.7048aea4.js"><link rel="prefetch" href="/rat-summ/assets/js/298.9cd565b1.js"><link rel="prefetch" href="/rat-summ/assets/js/299.8e2896d9.js"><link rel="prefetch" href="/rat-summ/assets/js/30.e0901edb.js"><link rel="prefetch" href="/rat-summ/assets/js/300.1ba977f6.js"><link rel="prefetch" href="/rat-summ/assets/js/301.4bd8028d.js"><link rel="prefetch" href="/rat-summ/assets/js/302.7e3656f6.js"><link rel="prefetch" href="/rat-summ/assets/js/303.5fa30d30.js"><link rel="prefetch" href="/rat-summ/assets/js/304.0bb8668c.js"><link rel="prefetch" href="/rat-summ/assets/js/305.61286ea3.js"><link rel="prefetch" href="/rat-summ/assets/js/306.6e1b897f.js"><link rel="prefetch" href="/rat-summ/assets/js/307.f11f9af6.js"><link rel="prefetch" href="/rat-summ/assets/js/308.83cfb59e.js"><link rel="prefetch" href="/rat-summ/assets/js/309.88606eb8.js"><link rel="prefetch" href="/rat-summ/assets/js/31.727deefc.js"><link rel="prefetch" href="/rat-summ/assets/js/310.ca3c4062.js"><link rel="prefetch" href="/rat-summ/assets/js/311.9c98aab5.js"><link rel="prefetch" href="/rat-summ/assets/js/312.f5d5917b.js"><link rel="prefetch" href="/rat-summ/assets/js/313.6a0d74b5.js"><link rel="prefetch" href="/rat-summ/assets/js/314.351731a0.js"><link rel="prefetch" href="/rat-summ/assets/js/315.1bceaee4.js"><link rel="prefetch" href="/rat-summ/assets/js/316.91d9bb5c.js"><link rel="prefetch" href="/rat-summ/assets/js/317.43a7c8e3.js"><link rel="prefetch" href="/rat-summ/assets/js/318.f91f4e5e.js"><link rel="prefetch" href="/rat-summ/assets/js/319.03048efe.js"><link rel="prefetch" href="/rat-summ/assets/js/32.be33afa2.js"><link rel="prefetch" href="/rat-summ/assets/js/320.6c4d6375.js"><link rel="prefetch" href="/rat-summ/assets/js/321.c0f4c466.js"><link rel="prefetch" href="/rat-summ/assets/js/322.40427a9f.js"><link rel="prefetch" href="/rat-summ/assets/js/323.8ed5a81e.js"><link rel="prefetch" href="/rat-summ/assets/js/324.8af7bf04.js"><link rel="prefetch" href="/rat-summ/assets/js/325.eb380a4f.js"><link rel="prefetch" href="/rat-summ/assets/js/326.6b704e5c.js"><link rel="prefetch" href="/rat-summ/assets/js/327.ee41c7c2.js"><link rel="prefetch" href="/rat-summ/assets/js/328.c50090e6.js"><link rel="prefetch" href="/rat-summ/assets/js/329.b7234454.js"><link rel="prefetch" href="/rat-summ/assets/js/33.a5387702.js"><link rel="prefetch" href="/rat-summ/assets/js/330.0b389f14.js"><link rel="prefetch" href="/rat-summ/assets/js/331.ebc829ce.js"><link rel="prefetch" href="/rat-summ/assets/js/332.3dbd0d43.js"><link rel="prefetch" href="/rat-summ/assets/js/333.2ad93411.js"><link rel="prefetch" href="/rat-summ/assets/js/334.19c4fca0.js"><link rel="prefetch" href="/rat-summ/assets/js/335.618d7f92.js"><link rel="prefetch" href="/rat-summ/assets/js/336.06b12de2.js"><link rel="prefetch" href="/rat-summ/assets/js/337.dfb91030.js"><link rel="prefetch" href="/rat-summ/assets/js/338.fbf6c528.js"><link rel="prefetch" href="/rat-summ/assets/js/339.081585fe.js"><link rel="prefetch" href="/rat-summ/assets/js/34.2aa94fce.js"><link rel="prefetch" href="/rat-summ/assets/js/340.392a0549.js"><link rel="prefetch" href="/rat-summ/assets/js/341.571be598.js"><link rel="prefetch" href="/rat-summ/assets/js/342.0c20e7dc.js"><link rel="prefetch" href="/rat-summ/assets/js/343.f087f4bc.js"><link rel="prefetch" href="/rat-summ/assets/js/344.432ae94b.js"><link rel="prefetch" href="/rat-summ/assets/js/345.5d1f52c2.js"><link rel="prefetch" href="/rat-summ/assets/js/346.29082c3e.js"><link rel="prefetch" href="/rat-summ/assets/js/347.5431d43a.js"><link rel="prefetch" href="/rat-summ/assets/js/348.70a115c6.js"><link rel="prefetch" href="/rat-summ/assets/js/349.110d3aea.js"><link rel="prefetch" href="/rat-summ/assets/js/35.3926e73e.js"><link rel="prefetch" href="/rat-summ/assets/js/350.4dd299b8.js"><link rel="prefetch" href="/rat-summ/assets/js/351.aa1cf3a7.js"><link rel="prefetch" href="/rat-summ/assets/js/352.f2c9aff8.js"><link rel="prefetch" href="/rat-summ/assets/js/353.bb0da04a.js"><link rel="prefetch" href="/rat-summ/assets/js/354.7b1fde0d.js"><link rel="prefetch" href="/rat-summ/assets/js/355.7c67d056.js"><link rel="prefetch" href="/rat-summ/assets/js/356.a2f3c163.js"><link rel="prefetch" href="/rat-summ/assets/js/357.4aa2a57f.js"><link rel="prefetch" href="/rat-summ/assets/js/358.7abdc16b.js"><link rel="prefetch" href="/rat-summ/assets/js/359.0acb9993.js"><link rel="prefetch" href="/rat-summ/assets/js/36.e9252af1.js"><link rel="prefetch" href="/rat-summ/assets/js/360.077f565b.js"><link rel="prefetch" href="/rat-summ/assets/js/361.7d044219.js"><link rel="prefetch" href="/rat-summ/assets/js/362.6d5271d3.js"><link rel="prefetch" href="/rat-summ/assets/js/363.52b56886.js"><link rel="prefetch" href="/rat-summ/assets/js/364.6f2d9945.js"><link rel="prefetch" href="/rat-summ/assets/js/365.25fd0aec.js"><link rel="prefetch" href="/rat-summ/assets/js/366.8697c537.js"><link rel="prefetch" href="/rat-summ/assets/js/367.ade10048.js"><link rel="prefetch" href="/rat-summ/assets/js/368.58690662.js"><link rel="prefetch" href="/rat-summ/assets/js/369.e37f17bc.js"><link rel="prefetch" href="/rat-summ/assets/js/37.40c6e32d.js"><link rel="prefetch" href="/rat-summ/assets/js/370.81c0f5c2.js"><link rel="prefetch" href="/rat-summ/assets/js/371.781d9032.js"><link rel="prefetch" href="/rat-summ/assets/js/372.2f75884d.js"><link rel="prefetch" href="/rat-summ/assets/js/373.83a4e2c0.js"><link rel="prefetch" href="/rat-summ/assets/js/374.c1c69154.js"><link rel="prefetch" href="/rat-summ/assets/js/375.4df7a40c.js"><link rel="prefetch" href="/rat-summ/assets/js/376.0feeb93c.js"><link rel="prefetch" href="/rat-summ/assets/js/377.561ca7da.js"><link rel="prefetch" href="/rat-summ/assets/js/378.3da43834.js"><link rel="prefetch" href="/rat-summ/assets/js/379.75c285a8.js"><link rel="prefetch" href="/rat-summ/assets/js/38.e48735ea.js"><link rel="prefetch" href="/rat-summ/assets/js/380.f94bd4a3.js"><link rel="prefetch" href="/rat-summ/assets/js/381.71953594.js"><link rel="prefetch" href="/rat-summ/assets/js/382.944a71d7.js"><link rel="prefetch" href="/rat-summ/assets/js/383.c6a18246.js"><link rel="prefetch" href="/rat-summ/assets/js/384.e089b47b.js"><link rel="prefetch" href="/rat-summ/assets/js/385.91742919.js"><link rel="prefetch" href="/rat-summ/assets/js/386.48e3b2e2.js"><link rel="prefetch" href="/rat-summ/assets/js/387.e29cd861.js"><link rel="prefetch" href="/rat-summ/assets/js/388.f70a74b4.js"><link rel="prefetch" href="/rat-summ/assets/js/389.104fdecf.js"><link rel="prefetch" href="/rat-summ/assets/js/39.825dffc2.js"><link rel="prefetch" href="/rat-summ/assets/js/390.6275cef1.js"><link rel="prefetch" href="/rat-summ/assets/js/391.8bb66679.js"><link rel="prefetch" href="/rat-summ/assets/js/392.3fe296d9.js"><link rel="prefetch" href="/rat-summ/assets/js/393.a4dc5585.js"><link rel="prefetch" href="/rat-summ/assets/js/394.d659930b.js"><link rel="prefetch" href="/rat-summ/assets/js/395.d2262aea.js"><link rel="prefetch" href="/rat-summ/assets/js/396.25b1e0de.js"><link rel="prefetch" href="/rat-summ/assets/js/397.41c6d90f.js"><link rel="prefetch" href="/rat-summ/assets/js/398.1023659d.js"><link rel="prefetch" href="/rat-summ/assets/js/399.6645efbd.js"><link rel="prefetch" href="/rat-summ/assets/js/4.5b220e8a.js"><link rel="prefetch" href="/rat-summ/assets/js/40.1f51dbcf.js"><link rel="prefetch" href="/rat-summ/assets/js/400.a979839c.js"><link rel="prefetch" href="/rat-summ/assets/js/401.3f1af38a.js"><link rel="prefetch" href="/rat-summ/assets/js/402.17ee8256.js"><link rel="prefetch" href="/rat-summ/assets/js/403.e5dd7606.js"><link rel="prefetch" href="/rat-summ/assets/js/404.b57e2cc6.js"><link rel="prefetch" href="/rat-summ/assets/js/405.2042fa73.js"><link rel="prefetch" href="/rat-summ/assets/js/406.e64bdb23.js"><link rel="prefetch" href="/rat-summ/assets/js/407.9a276c18.js"><link rel="prefetch" href="/rat-summ/assets/js/408.a528edd8.js"><link rel="prefetch" href="/rat-summ/assets/js/409.dba4cf75.js"><link rel="prefetch" href="/rat-summ/assets/js/41.58f3de48.js"><link rel="prefetch" href="/rat-summ/assets/js/410.d0b106c6.js"><link rel="prefetch" href="/rat-summ/assets/js/411.4b9dd0be.js"><link rel="prefetch" href="/rat-summ/assets/js/412.d2b4534c.js"><link rel="prefetch" href="/rat-summ/assets/js/413.13933934.js"><link rel="prefetch" href="/rat-summ/assets/js/414.f3aa79b3.js"><link rel="prefetch" href="/rat-summ/assets/js/415.7fb4f462.js"><link rel="prefetch" href="/rat-summ/assets/js/416.529de55d.js"><link rel="prefetch" href="/rat-summ/assets/js/417.4ca243c1.js"><link rel="prefetch" href="/rat-summ/assets/js/418.3c7e6391.js"><link rel="prefetch" href="/rat-summ/assets/js/419.821db849.js"><link rel="prefetch" href="/rat-summ/assets/js/42.1f57183a.js"><link rel="prefetch" href="/rat-summ/assets/js/420.4153e14c.js"><link rel="prefetch" href="/rat-summ/assets/js/421.94820f33.js"><link rel="prefetch" href="/rat-summ/assets/js/422.b85144cb.js"><link rel="prefetch" href="/rat-summ/assets/js/423.5702fec2.js"><link rel="prefetch" href="/rat-summ/assets/js/424.f3bb53f3.js"><link rel="prefetch" href="/rat-summ/assets/js/425.a09dac6c.js"><link rel="prefetch" href="/rat-summ/assets/js/426.5e7ea56d.js"><link rel="prefetch" href="/rat-summ/assets/js/427.dfe1e1f5.js"><link rel="prefetch" href="/rat-summ/assets/js/428.8829fe2e.js"><link rel="prefetch" href="/rat-summ/assets/js/429.206cbd26.js"><link rel="prefetch" href="/rat-summ/assets/js/43.f4ef7e7a.js"><link rel="prefetch" href="/rat-summ/assets/js/430.2e934b92.js"><link rel="prefetch" href="/rat-summ/assets/js/431.93b96b64.js"><link rel="prefetch" href="/rat-summ/assets/js/432.5742508e.js"><link rel="prefetch" href="/rat-summ/assets/js/433.602400bb.js"><link rel="prefetch" href="/rat-summ/assets/js/434.3c068b74.js"><link rel="prefetch" href="/rat-summ/assets/js/435.bd23ba01.js"><link rel="prefetch" href="/rat-summ/assets/js/436.f276df3f.js"><link rel="prefetch" href="/rat-summ/assets/js/437.e3136874.js"><link rel="prefetch" href="/rat-summ/assets/js/438.365bddbf.js"><link rel="prefetch" href="/rat-summ/assets/js/439.8610d147.js"><link rel="prefetch" href="/rat-summ/assets/js/44.95428610.js"><link rel="prefetch" href="/rat-summ/assets/js/440.d470a96c.js"><link rel="prefetch" href="/rat-summ/assets/js/441.51e68998.js"><link rel="prefetch" href="/rat-summ/assets/js/442.21942f8f.js"><link rel="prefetch" href="/rat-summ/assets/js/443.d78b7124.js"><link rel="prefetch" href="/rat-summ/assets/js/444.7ab2a2ce.js"><link rel="prefetch" href="/rat-summ/assets/js/445.734e537c.js"><link rel="prefetch" href="/rat-summ/assets/js/446.b6a46bba.js"><link rel="prefetch" href="/rat-summ/assets/js/447.0e610df1.js"><link rel="prefetch" href="/rat-summ/assets/js/448.c431addf.js"><link rel="prefetch" href="/rat-summ/assets/js/449.fd3f57c4.js"><link rel="prefetch" href="/rat-summ/assets/js/45.2f49bb0c.js"><link rel="prefetch" href="/rat-summ/assets/js/450.488cf3df.js"><link rel="prefetch" href="/rat-summ/assets/js/451.1812acf0.js"><link rel="prefetch" href="/rat-summ/assets/js/452.b9e98643.js"><link rel="prefetch" href="/rat-summ/assets/js/453.3a90612b.js"><link rel="prefetch" href="/rat-summ/assets/js/454.5aaa7797.js"><link rel="prefetch" href="/rat-summ/assets/js/455.0f8b8d13.js"><link rel="prefetch" href="/rat-summ/assets/js/456.6973979f.js"><link rel="prefetch" href="/rat-summ/assets/js/457.3cb9217b.js"><link rel="prefetch" href="/rat-summ/assets/js/458.79141a21.js"><link rel="prefetch" href="/rat-summ/assets/js/459.abcc974c.js"><link rel="prefetch" href="/rat-summ/assets/js/46.8c8bf5f1.js"><link rel="prefetch" href="/rat-summ/assets/js/460.b38c1ada.js"><link rel="prefetch" href="/rat-summ/assets/js/461.62beb08c.js"><link rel="prefetch" href="/rat-summ/assets/js/462.64f5f4e1.js"><link rel="prefetch" href="/rat-summ/assets/js/463.83081d34.js"><link rel="prefetch" href="/rat-summ/assets/js/464.d610e5ce.js"><link rel="prefetch" href="/rat-summ/assets/js/465.193b3b89.js"><link rel="prefetch" href="/rat-summ/assets/js/466.419fe212.js"><link rel="prefetch" href="/rat-summ/assets/js/467.910dc67d.js"><link rel="prefetch" href="/rat-summ/assets/js/468.b93c4e70.js"><link rel="prefetch" href="/rat-summ/assets/js/469.a4bc872a.js"><link rel="prefetch" href="/rat-summ/assets/js/47.11f3cc99.js"><link rel="prefetch" href="/rat-summ/assets/js/470.477c2897.js"><link rel="prefetch" href="/rat-summ/assets/js/471.abfff3cd.js"><link rel="prefetch" href="/rat-summ/assets/js/472.b8aea607.js"><link rel="prefetch" href="/rat-summ/assets/js/473.f6d4bd02.js"><link rel="prefetch" href="/rat-summ/assets/js/474.9449d59a.js"><link rel="prefetch" href="/rat-summ/assets/js/475.8a4bbfb6.js"><link rel="prefetch" href="/rat-summ/assets/js/476.0269ac30.js"><link rel="prefetch" href="/rat-summ/assets/js/477.3bcc01f0.js"><link rel="prefetch" href="/rat-summ/assets/js/478.c307cee9.js"><link rel="prefetch" href="/rat-summ/assets/js/479.c70c4a8e.js"><link rel="prefetch" href="/rat-summ/assets/js/48.05e97651.js"><link rel="prefetch" href="/rat-summ/assets/js/480.ac7405da.js"><link rel="prefetch" href="/rat-summ/assets/js/481.04261af4.js"><link rel="prefetch" href="/rat-summ/assets/js/482.7db8d1e2.js"><link rel="prefetch" href="/rat-summ/assets/js/483.ba568078.js"><link rel="prefetch" href="/rat-summ/assets/js/484.48a25747.js"><link rel="prefetch" href="/rat-summ/assets/js/485.d26a0a83.js"><link rel="prefetch" href="/rat-summ/assets/js/486.a50b2468.js"><link rel="prefetch" href="/rat-summ/assets/js/487.89c199d5.js"><link rel="prefetch" href="/rat-summ/assets/js/488.11ffda69.js"><link rel="prefetch" href="/rat-summ/assets/js/489.f410761e.js"><link rel="prefetch" href="/rat-summ/assets/js/49.4f8217ba.js"><link rel="prefetch" href="/rat-summ/assets/js/490.1d754006.js"><link rel="prefetch" href="/rat-summ/assets/js/491.80c5139a.js"><link rel="prefetch" href="/rat-summ/assets/js/492.d29884ed.js"><link rel="prefetch" href="/rat-summ/assets/js/493.605b5b69.js"><link rel="prefetch" href="/rat-summ/assets/js/494.cf11b24a.js"><link rel="prefetch" href="/rat-summ/assets/js/495.4fed3a56.js"><link rel="prefetch" href="/rat-summ/assets/js/496.2f9b5653.js"><link rel="prefetch" href="/rat-summ/assets/js/497.bdf700cb.js"><link rel="prefetch" href="/rat-summ/assets/js/498.c37bf4a0.js"><link rel="prefetch" href="/rat-summ/assets/js/499.273512ce.js"><link rel="prefetch" href="/rat-summ/assets/js/5.eb8a0105.js"><link rel="prefetch" href="/rat-summ/assets/js/50.8b43ef9b.js"><link rel="prefetch" href="/rat-summ/assets/js/500.41ab926a.js"><link rel="prefetch" href="/rat-summ/assets/js/501.b7e68b2b.js"><link rel="prefetch" href="/rat-summ/assets/js/502.c21b2ced.js"><link rel="prefetch" href="/rat-summ/assets/js/503.57cfc1cb.js"><link rel="prefetch" href="/rat-summ/assets/js/504.3737dd74.js"><link rel="prefetch" href="/rat-summ/assets/js/505.1a6e2c5c.js"><link rel="prefetch" href="/rat-summ/assets/js/506.bec8c785.js"><link rel="prefetch" href="/rat-summ/assets/js/507.9850a1ea.js"><link rel="prefetch" href="/rat-summ/assets/js/508.345fb54a.js"><link rel="prefetch" href="/rat-summ/assets/js/509.12b14128.js"><link rel="prefetch" href="/rat-summ/assets/js/51.6837cba4.js"><link rel="prefetch" href="/rat-summ/assets/js/510.0595d708.js"><link rel="prefetch" href="/rat-summ/assets/js/511.9ebeed80.js"><link rel="prefetch" href="/rat-summ/assets/js/512.a4b26565.js"><link rel="prefetch" href="/rat-summ/assets/js/513.dae12896.js"><link rel="prefetch" href="/rat-summ/assets/js/514.98452f74.js"><link rel="prefetch" href="/rat-summ/assets/js/515.79ac850c.js"><link rel="prefetch" href="/rat-summ/assets/js/516.2b46c6b5.js"><link rel="prefetch" href="/rat-summ/assets/js/517.21cae069.js"><link rel="prefetch" href="/rat-summ/assets/js/518.618ba011.js"><link rel="prefetch" href="/rat-summ/assets/js/519.d295be6f.js"><link rel="prefetch" href="/rat-summ/assets/js/52.6a3d1870.js"><link rel="prefetch" href="/rat-summ/assets/js/520.77322b7a.js"><link rel="prefetch" href="/rat-summ/assets/js/521.ab51a9d7.js"><link rel="prefetch" href="/rat-summ/assets/js/522.95569e5d.js"><link rel="prefetch" href="/rat-summ/assets/js/523.19e88a87.js"><link rel="prefetch" href="/rat-summ/assets/js/524.a9f13ff4.js"><link rel="prefetch" href="/rat-summ/assets/js/525.55775443.js"><link rel="prefetch" href="/rat-summ/assets/js/526.796f403d.js"><link rel="prefetch" href="/rat-summ/assets/js/527.8777ce49.js"><link rel="prefetch" href="/rat-summ/assets/js/528.fdc61407.js"><link rel="prefetch" href="/rat-summ/assets/js/529.410e276b.js"><link rel="prefetch" href="/rat-summ/assets/js/53.73686482.js"><link rel="prefetch" href="/rat-summ/assets/js/530.f4fc62f0.js"><link rel="prefetch" href="/rat-summ/assets/js/531.58338ca6.js"><link rel="prefetch" href="/rat-summ/assets/js/54.b4f9eb75.js"><link rel="prefetch" href="/rat-summ/assets/js/55.df849147.js"><link rel="prefetch" href="/rat-summ/assets/js/56.96d53eac.js"><link rel="prefetch" href="/rat-summ/assets/js/57.f19e0377.js"><link rel="prefetch" href="/rat-summ/assets/js/58.46887073.js"><link rel="prefetch" href="/rat-summ/assets/js/59.3f235b14.js"><link rel="prefetch" href="/rat-summ/assets/js/6.0306f3a7.js"><link rel="prefetch" href="/rat-summ/assets/js/60.f00dba60.js"><link rel="prefetch" href="/rat-summ/assets/js/61.110e9966.js"><link rel="prefetch" href="/rat-summ/assets/js/62.77adea85.js"><link rel="prefetch" href="/rat-summ/assets/js/63.84621a5a.js"><link rel="prefetch" href="/rat-summ/assets/js/64.c5e5007f.js"><link rel="prefetch" href="/rat-summ/assets/js/65.7932d639.js"><link rel="prefetch" href="/rat-summ/assets/js/66.f7b98c28.js"><link rel="prefetch" href="/rat-summ/assets/js/67.f73aa713.js"><link rel="prefetch" href="/rat-summ/assets/js/68.cd494063.js"><link rel="prefetch" href="/rat-summ/assets/js/69.b044b142.js"><link rel="prefetch" href="/rat-summ/assets/js/7.3eb2e5f4.js"><link rel="prefetch" href="/rat-summ/assets/js/70.fde8898d.js"><link rel="prefetch" href="/rat-summ/assets/js/71.9f0111ee.js"><link rel="prefetch" href="/rat-summ/assets/js/72.a980e88b.js"><link rel="prefetch" href="/rat-summ/assets/js/73.f83a1246.js"><link rel="prefetch" href="/rat-summ/assets/js/74.466aeb6d.js"><link rel="prefetch" href="/rat-summ/assets/js/75.8267a967.js"><link rel="prefetch" href="/rat-summ/assets/js/76.d627aaef.js"><link rel="prefetch" href="/rat-summ/assets/js/77.7f0d7168.js"><link rel="prefetch" href="/rat-summ/assets/js/78.1793ccbe.js"><link rel="prefetch" href="/rat-summ/assets/js/79.482c515e.js"><link rel="prefetch" href="/rat-summ/assets/js/8.79d1c3bb.js"><link rel="prefetch" href="/rat-summ/assets/js/80.3915b314.js"><link rel="prefetch" href="/rat-summ/assets/js/81.b8ec0fa5.js"><link rel="prefetch" href="/rat-summ/assets/js/82.dc9885a7.js"><link rel="prefetch" href="/rat-summ/assets/js/83.2d36b6a8.js"><link rel="prefetch" href="/rat-summ/assets/js/84.0ee5beb0.js"><link rel="prefetch" href="/rat-summ/assets/js/85.adac7d72.js"><link rel="prefetch" href="/rat-summ/assets/js/86.d7ed3e20.js"><link rel="prefetch" href="/rat-summ/assets/js/87.93bc5012.js"><link rel="prefetch" href="/rat-summ/assets/js/88.13a7244f.js"><link rel="prefetch" href="/rat-summ/assets/js/89.5512fba5.js"><link rel="prefetch" href="/rat-summ/assets/js/9.9db0e627.js"><link rel="prefetch" href="/rat-summ/assets/js/90.0d36bb3b.js"><link rel="prefetch" href="/rat-summ/assets/js/91.3b31c7ee.js"><link rel="prefetch" href="/rat-summ/assets/js/92.01af09c3.js"><link rel="prefetch" href="/rat-summ/assets/js/93.c98fe6f4.js"><link rel="prefetch" href="/rat-summ/assets/js/94.23a6678b.js"><link rel="prefetch" href="/rat-summ/assets/js/95.c50f9e7e.js"><link rel="prefetch" href="/rat-summ/assets/js/96.36897011.js"><link rel="prefetch" href="/rat-summ/assets/js/97.dead9357.js"><link rel="prefetch" href="/rat-summ/assets/js/98.e487ff01.js"><link rel="prefetch" href="/rat-summ/assets/js/99.2474b24c.js">
    <link rel="stylesheet" href="/rat-summ/assets/css/0.styles.b7fb6ee3.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/rat-summ/" class="home-link router-link-active"><img src="/rat-summ/img/logo.png" alt="写作认知体系" class="logo"> <span class="site-name can-hide">写作认知体系</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/rat-summ/" class="nav-link">首页</a></div><div class="nav-item"><a href="/rat-summ/writeRead/" class="nav-link">写作阅读</a></div><div class="nav-item"><a href="/rat-summ/promoteOper/" class="nav-link">推广运营</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="💖职场技能" class="dropdown-title"><a href="/rat-summ/workSkill/" class="link-title">💖职场技能</a> <span class="title" style="display:none;">💖职场技能</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/rat-summ/skill-note/" class="nav-link">技能记录</a></li><li class="dropdown-item"><!----> <a href="/rat-summ/skill-inter/" class="nav-link">面试技巧</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🌹快捷入口" class="dropdown-title"><!----> <span class="title" style="display:;">🌹快捷入口</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>快捷链接</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/rat-summ/pages/devLink/" class="nav-link">开发收藏</a></li></ul></li><li class="dropdown-item"><h4>💖体系入口</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://my.samyz.cn/rat-skill" target="_blank" rel="noopener noreferrer" class="nav-link external">
  工作实践体系
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://my.samyz.cn/rat-summ" target="_blank" rel="noopener noreferrer" class="nav-link external">
  写作认知体系
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://my.samyz.cn/rat-invest" target="_blank" rel="noopener noreferrer" class="nav-link external">
  投资理财体系
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div> <a href="https://github.com/samyzh/rat-summ" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/rat-summ/" class="nav-link">首页</a></div><div class="nav-item"><a href="/rat-summ/writeRead/" class="nav-link">写作阅读</a></div><div class="nav-item"><a href="/rat-summ/promoteOper/" class="nav-link">推广运营</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="💖职场技能" class="dropdown-title"><a href="/rat-summ/workSkill/" class="link-title">💖职场技能</a> <span class="title" style="display:none;">💖职场技能</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/rat-summ/skill-note/" class="nav-link">技能记录</a></li><li class="dropdown-item"><!----> <a href="/rat-summ/skill-inter/" class="nav-link">面试技巧</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🌹快捷入口" class="dropdown-title"><!----> <span class="title" style="display:;">🌹快捷入口</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>快捷链接</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/rat-summ/pages/devLink/" class="nav-link">开发收藏</a></li></ul></li><li class="dropdown-item"><h4>💖体系入口</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://my.samyz.cn/rat-skill" target="_blank" rel="noopener noreferrer" class="nav-link external">
  工作实践体系
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://my.samyz.cn/rat-summ" target="_blank" rel="noopener noreferrer" class="nav-link external">
  写作认知体系
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://my.samyz.cn/rat-invest" target="_blank" rel="noopener noreferrer" class="nav-link external">
  投资理财体系
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div> <a href="https://github.com/samyzh/rat-summ" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>知识体系</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/d299c4/" class="sidebar-link">知识体系</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>html&amp;css</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/59df57/" class="sidebar-link">html的使用</a></li><li><a href="/rat-summ/pages/bfeb1c/" class="sidebar-link">css的使用</a></li><li><a href="/rat-summ/pages/6f569a/" class="sidebar-link">html居中及常用布局</a></li><li><a href="/rat-summ/pages/75c080/" class="sidebar-link">html移动端适配</a></li><li><a href="/rat-summ/pages/1f3ef7/" class="sidebar-link">CSS和JS动画</a></li><li><a href="/rat-summ/pages/445bb3/" class="sidebar-link">html与js的组合使用</a></li><li><a href="/rat-summ/pages/b50ea5/" class="sidebar-link">前端跨页面通信</a></li><li><a href="/rat-summ/pages/91bfa6/" class="sidebar-link">html跨tab页通信(同源跨域)</a></li><li><a href="/rat-summ/pages/975a2e/" class="sidebar-link">cookie常用操作</a></li><li><a href="/rat-summ/pages/b09bd9/" class="sidebar-link">JS中对URL进行转码与解码</a></li><li><a href="/rat-summ/pages/7f7002/" class="sidebar-link">img标注热点分布</a></li><li><a href="/rat-summ/pages/d3dec5/" class="sidebar-link">html中input输入数字控制</a></li><li><a href="/rat-summ/pages/ac76fc/" class="sidebar-link">textarea的换行与空格问题</a></li><li><a href="/rat-summ/pages/59d1b8/" class="sidebar-link">html屏幕相关</a></li><li><a href="/rat-summ/pages/b0b165/" class="sidebar-link">console实用调试技巧</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>基础框架</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/1db8ae/" class="sidebar-link">jquery及zepto的使用</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>安全</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/2e79cd/" class="sidebar-link">html禁止复制文字</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>pwa</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/702634/" class="sidebar-link">pwa基础</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>WebComponent</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/4f2593/" class="sidebar-link">WebComponent基础</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>浏览器渲染</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/7027dc/" class="sidebar-link">浏览器渲染机制</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>实践</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/c7ba6e/" class="sidebar-link">左侧树折叠效果</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>优化</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/80f4c6/" class="sidebar-link">浏览器优化</a></li><li><a href="/rat-summ/pages/01686b/" class="sidebar-link">浏览器渲染原理与性能优化</a></li><li><a href="/rat-summ/pages/a6d3de/" class="sidebar-link">lighthouse实践及分析</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>样式</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/3b6bc5/" class="sidebar-link">第三方ui库样式重写</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>js</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/77c195/" class="sidebar-link">js分类、比较及数组</a></li><li><a href="/rat-summ/pages/8a1238/" class="sidebar-link">js函数</a></li><li><a href="/rat-summ/pages/803bc1/" class="sidebar-link">js对象、class、proxy及Symbol</a></li><li><a href="/rat-summ/pages/c85153/" class="sidebar-link">es6之变量,扩展,symbol,set,map,proxy,reflect及class</a></li><li><a href="/rat-summ/pages/db6ce7/" class="sidebar-link">es6之module,iterator,promise及es6+</a></li><li><a href="/rat-summ/pages/5c649d/" class="sidebar-link">es6中的proxy的使用</a></li><li><a href="/rat-summ/pages/b8e539/" class="sidebar-link">js异步</a></li><li><a href="/rat-summ/pages/2fa04b/" class="sidebar-link">js事件循环及优化</a></li><li><a href="/rat-summ/pages/45b059/" class="sidebar-link">js模块规范</a></li><li><a href="/rat-summ/pages/730656/" class="sidebar-link">数组常用方法</a></li><li><a href="/rat-summ/pages/b887a0/" class="sidebar-link">常用正则表达式提高效率</a></li><li><a href="/rat-summ/pages/c5c2b5/" class="sidebar-link">前端异常的捕获与处理</a></li><li><a href="/rat-summ/pages/c7a8f5/" class="sidebar-link">ES6优化实践</a></li><li><a href="/rat-summ/pages/48ae2c/" class="sidebar-link">ES6-ES12的开发技巧</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>进价</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/328e70/" class="sidebar-link">v8内存管理</a></li><li><a href="/rat-summ/pages/71fa00/" class="sidebar-link">js原生方法手写实现</a></li><li><a href="/rat-summ/pages/35e184/" class="sidebar-link">js中手写常用方法</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>网络库</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/a34b2c/" class="sidebar-link">ajax&amp;axios&amp;fetch对比</a></li><li><a href="/rat-summ/pages/e1382d/" class="sidebar-link">axios分析及实践</a></li><li><a href="/rat-summ/pages/67de0f/" class="sidebar-link">axios文档使用</a></li><li><a href="/rat-summ/pages/5a2414/" class="sidebar-link">fetch处理超时</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>常用库</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/7349f2/" class="sidebar-link">lodashjs中节流及防抖的实现</a></li><li><a href="/rat-summ/pages/d88e3e/" class="sidebar-link">puppeteer实践及分析</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>实践</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/7afb20/" class="sidebar-link">数字取整问题</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>ts</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/3caff3/" class="sidebar-link">typescript语法及实践</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>node</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/c7cd4e/" class="sidebar-link">node版本及源管理</a></li><li><a href="/rat-summ/pages/24c387/" class="sidebar-link">npm常用命令操作</a></li><li><a href="/rat-summ/pages/b9d467/" class="sidebar-link">npm发布及私服搭建</a></li><li><a href="/rat-summ/pages/b23049/" class="sidebar-link">yarn相关总结</a></li><li><a href="/rat-summ/pages/90e3bb/" class="sidebar-link">verdaccio详细设置</a></li><li><a href="/rat-summ/pages/53158b/" class="sidebar-link">nexus布署私有npm仓库</a></li><li><a href="/rat-summ/pages/cc3405/" class="sidebar-link">npm包管理机制</a></li><li><a href="/rat-summ/pages/16031f/" class="sidebar-link">pnpm实践及分析</a></li><li><a href="/rat-summ/pages/68c863/" class="sidebar-link">mac下彻底卸载node和npm</a></li><li><a href="/rat-summ/pages/d4e855/" class="sidebar-link">patch-package修改依赖包</a></li><li><a href="/rat-summ/pages/c886c0/" class="sidebar-link">pnm包管理</a></li><li><a href="/rat-summ/pages/bb9351/" class="sidebar-link">bower包管理</a></li><li><a href="/rat-summ/pages/8a2ca0/" class="sidebar-link">npm-git-bower设置代理</a></li><li><a href="/rat-summ/pages/f51081/" class="sidebar-link">docker下安装nodejs环境</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>node</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/f36b82/" class="sidebar-link">index</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>express</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/6c90e5/" class="sidebar-link">express基本配置</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>koa</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/796cbb/" class="sidebar-link">模板引擎ejs</a></li><li><a href="/rat-summ/pages/a340bc/" class="sidebar-link">深入浅出 Koa 的洋葱模型</a></li><li><a href="/rat-summ/pages/41cb0f/" class="sidebar-link">如何更好地理解中间件和洋葱模型</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>egg</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/514ebb/" class="sidebar-link">eggjs中curl请求、HTTP基础及RouteCtrl实战</a></li><li><a href="/rat-summ/pages/39412b/" class="sidebar-link">eggjs中HttpClient网络及Curl的使用</a></li><li><a href="/rat-summ/pages/4738e8/" class="sidebar-link">eggjs中Cookie与Session使用</a></li><li><a href="/rat-summ/pages/47858c/" class="sidebar-link">eggjs中实现RESTfulAPI及Router</a></li><li><a href="/rat-summ/pages/a69e2d/" class="sidebar-link">eggjs中cluster的实现原理</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>webpck</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/3793a8/" class="sidebar-link">webpack基础入门</a></li><li><a href="/rat-summ/pages/c741f3/" class="sidebar-link">webpack的自定义实现</a></li><li><a href="/rat-summ/pages/1e9637/" class="sidebar-link">webpack的源码分析</a></li><li><a href="/rat-summ/pages/c9f7c2/" class="sidebar-link">webpack热更新原理</a></li><li><a href="/rat-summ/pages/ac0ea5/" class="sidebar-link">webpack路由懒加载的原理</a></li><li><a href="/rat-summ/pages/d71cdf/" class="sidebar-link">组件按需加载babel-plugin-component分析</a></li><li><a href="/rat-summ/pages/eb92bd/" class="sidebar-link">webpack中require和import的区别</a></li><li><a href="/rat-summ/pages/sourcemap-detail/" class="sidebar-link">webpack中sourcemap详细配置</a></li><li><a href="/rat-summ/pages/1566f7/" class="sidebar-link">webpack的proxy用法</a></li><li><a href="/rat-summ/pages/1df7c0/" class="sidebar-link">http-proxy-middleware</a></li><li><a href="/rat-summ/pages/8c5df0/" class="sidebar-link">webpack-dll配置</a></li><li><a href="/rat-summ/pages/463f64/" class="sidebar-link">vue-config详解及实践</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>优化</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/47b067/" class="sidebar-link">webpack优化总括</a></li><li><a href="/rat-summ/pages/ff5832/" class="sidebar-link">webpack的使用及优化</a></li><li><a href="/rat-summ/pages/540308/" class="sidebar-link">webpack打包构建优化</a></li><li><a href="/rat-summ/pages/47832b/" class="sidebar-link">vue-config构建优化</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>实践</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/000507/" class="sidebar-link">webpack的插件实践</a></li><li><a href="/rat-summ/pages/webpack-externals/" class="sidebar-link">webpack中external实践</a></li><li><a href="/rat-summ/pages/624188/" class="sidebar-link">webpack中TreeShaking及压缩的实践</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>vue</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/a3a764/" class="sidebar-link">vue相关官方文档记录</a></li><li><a href="/rat-summ/pages/vue-use/" class="sidebar-link">vue的实践使用</a></li><li><a href="/rat-summ/pages/vue-my/" class="sidebar-link">vue自定义实现</a></li><li><a href="/rat-summ/pages/vue-src/" class="sidebar-link">vue源码分析</a></li><li><a href="/rat-summ/pages/80f59a/" class="sidebar-link">vue源码分析和对原理的理解</a></li><li><a href="/rat-summ/pages/41c21e/" class="sidebar-link">vue的源码分析</a></li><li><a href="/rat-summ/pages/6ce810/" class="sidebar-link">vue2、vue3及react的三种Diff算法</a></li><li><a href="/rat-summ/pages/00dd2e/" class="sidebar-link">vue与react的对比及个人思考</a></li><li><a href="/rat-summ/pages/vue_comp_tel/" class="sidebar-link">vue组件通信方式及原理分析</a></li><li><a href="/rat-summ/pages/9f3a90/" class="sidebar-link">vue将原生事件绑定到组件</a></li><li><a href="/rat-summ/pages/1431ab/" class="sidebar-link">vue生命周期及原理分析</a></li><li><a href="/rat-summ/pages/2ea231/" class="sidebar-link">vue常用修饰符详解</a></li><li><a href="/rat-summ/pages/892a81/" class="sidebar-link">vue常用的自定义指令</a></li><li><a href="/rat-summ/pages/bc2498/" class="sidebar-link">vue中extend实践及分析</a></li><li><a href="/rat-summ/pages/6bc868/" class="sidebar-link">vue中filter实践及分析</a></li><li><a href="/rat-summ/pages/191c2d/" class="sidebar-link">vue中nextTick实现原理</a></li><li><a href="/rat-summ/pages/vue-pro-pref/" class="sidebar-link">vue项目优化技巧【重点】</a></li><li><a href="/rat-summ/pages/211945/" class="sidebar-link">vue项目权限相关</a></li><li><a href="/rat-summ/pages/83f9be/" class="sidebar-link">vue项目实践</a></li><li><a href="/rat-summ/pages/22bc61/" class="sidebar-link">vue项目刷新当前页面</a></li><li><a href="/rat-summ/pages/398010/" class="sidebar-link">vue中使用jsx</a></li><li><a href="/rat-summ/pages/aeb50e/" class="sidebar-link">vue封装组件技巧</a></li><li><a href="/rat-summ/pages/c59b7d/" class="sidebar-link">vue3相关资料整理</a></li><li><a href="/rat-summ/pages/73a1c0/" class="sidebar-link">vue3新特点</a></li><li><a href="/rat-summ/pages/vue3-use/" class="sidebar-link">vue3实践使用</a></li><li><a href="/rat-summ/pages/vue3-my/" class="sidebar-link">vue3自定义实现</a></li><li><a href="/rat-summ/pages/vue3-src/" class="sidebar-link">vue3源码分析</a></li><li><a href="/rat-summ/pages/c51695/" class="sidebar-link">vue3与vue2组件通信方式及对比</a></li><li><a href="/rat-summ/pages/af09b9/" class="sidebar-link">vue3使用mitt</a></li><li><a href="/rat-summ/pages/78748a/" class="sidebar-link">vue3与react的hook比较</a></li><li><a href="/rat-summ/pages/d16cc3/" class="sidebar-link">vueuse实践及分析</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>vuex</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/vuex-use/" class="sidebar-link">vuex实践使用</a></li><li><a href="/rat-summ/pages/vuex-my/" class="sidebar-link">vuex自定义实现</a></li><li><a href="/rat-summ/pages/vuex-src/" class="sidebar-link">vuex源码分析</a></li><li><a href="/rat-summ/pages/93a55d/" class="sidebar-link">vuex4新特性</a></li><li><a href="/rat-summ/pages/93a599/" class="sidebar-link">vuex4源码分析</a></li><li><a href="/rat-summ/pages/a9aba2/" class="sidebar-link">pinia实践及分析</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>router</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/213b37/" class="sidebar-link">前端路由的原理及自定义</a></li><li><a href="/rat-summ/pages/vue-router-use/" class="sidebar-link">vue-rouer实践使用</a></li><li><a href="/rat-summ/pages/vue-router-my/" class="sidebar-link">vue-router自定义实现</a></li><li><a href="/rat-summ/pages/vue-router-src/" class="sidebar-link">vue-router源码分析</a></li><li><a href="/rat-summ/pages/3f15a5/" class="sidebar-link">vue-router4新特性</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>ssr</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/ff8fd0/" class="sidebar-link">ssr实践</a></li><li><a href="/rat-summ/pages/4bb23f/" class="sidebar-link">vue-ssr自定义实现</a></li><li><a href="/rat-summ/pages/e5d580/" class="sidebar-link">vue-ssr源码分析</a></li><li><a href="/rat-summ/pages/b7ed5f/" class="sidebar-link">nuxt实践使用</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>cli</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/41364d/" class="sidebar-link">vue-cli实践使用</a></li><li><a href="/rat-summ/pages/313db8/" class="sidebar-link">vue-cli自定义实现</a></li><li><a href="/rat-summ/pages/71132c/" aria-current="page" class="active sidebar-link">vue-cli源码分析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/rat-summ/pages/71132c/#前言" class="sidebar-link">前言</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/rat-summ/pages/71132c/#发布" class="sidebar-link">发布</a></li><li class="sidebar-sub-header"><a href="/rat-summ/pages/71132c/#版本" class="sidebar-link">版本</a></li><li class="sidebar-sub-header"><a href="/rat-summ/pages/71132c/#仓库" class="sidebar-link">仓库</a></li></ul></li><li class="sidebar-sub-header"><a href="/rat-summ/pages/71132c/#开始" class="sidebar-link">开始</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/rat-summ/pages/71132c/#环境介绍" class="sidebar-link">环境介绍</a></li><li class="sidebar-sub-header"><a href="/rat-summ/pages/71132c/#常见-npm-包" class="sidebar-link">常见 npm 包</a></li></ul></li><li class="sidebar-sub-header"><a href="/rat-summ/pages/71132c/#vue-create" class="sidebar-link">vue create</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/rat-summ/pages/71132c/#create-入口" class="sidebar-link">create 入口</a></li><li class="sidebar-sub-header"><a href="/rat-summ/pages/71132c/#整体分析" class="sidebar-link">整体分析</a></li><li class="sidebar-sub-header"><a href="/rat-summ/pages/71132c/#基础验证" class="sidebar-link">基础验证</a></li><li class="sidebar-sub-header"><a href="/rat-summ/pages/71132c/#获取预设选项-preset" class="sidebar-link">获取预设选项(preset)</a></li><li class="sidebar-sub-header"><a href="/rat-summ/pages/71132c/#依赖安装-installdeps" class="sidebar-link">依赖安装(installDeps)</a></li><li class="sidebar-sub-header"><a href="/rat-summ/pages/71132c/#generator" class="sidebar-link">Generator</a></li><li class="sidebar-sub-header"><a href="/rat-summ/pages/71132c/#结尾分析" class="sidebar-link">结尾分析</a></li><li class="sidebar-sub-header"><a href="/rat-summ/pages/71132c/#总结-2" class="sidebar-link">总结</a></li></ul></li><li class="sidebar-sub-header"><a href="/rat-summ/pages/71132c/#vue-add" class="sidebar-link">vue add</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/rat-summ/pages/71132c/#add-命令" class="sidebar-link">add 命令</a></li><li class="sidebar-sub-header"><a href="/rat-summ/pages/71132c/#安装插件" class="sidebar-link">安装插件</a></li><li class="sidebar-sub-header"><a href="/rat-summ/pages/71132c/#调用插件" class="sidebar-link">调用插件</a></li><li class="sidebar-sub-header"><a href="/rat-summ/pages/71132c/#总结-3" class="sidebar-link">总结</a></li></ul></li><li class="sidebar-sub-header"><a href="/rat-summ/pages/71132c/#vue-invoke" class="sidebar-link">vue invoke</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/rat-summ/pages/71132c/#invoke-命令" class="sidebar-link">invoke 命令</a></li></ul></li><li class="sidebar-sub-header"><a href="/rat-summ/pages/71132c/#vue-inspect" class="sidebar-link">vue inspect</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/rat-summ/pages/71132c/#inspect-命令" class="sidebar-link">inspect 命令</a></li></ul></li><li class="sidebar-sub-header"><a href="/rat-summ/pages/71132c/#vue-serve" class="sidebar-link">vue serve</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/rat-summ/pages/71132c/#serve-命令" class="sidebar-link">serve 命令</a></li></ul></li><li class="sidebar-sub-header"><a href="/rat-summ/pages/71132c/#vue-build" class="sidebar-link">vue build</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/rat-summ/pages/71132c/#build-命令" class="sidebar-link">build 命令</a></li></ul></li><li class="sidebar-sub-header"><a href="/rat-summ/pages/71132c/#vue-ui" class="sidebar-link">vue ui</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/rat-summ/pages/71132c/#ui-命令" class="sidebar-link">ui 命令</a></li><li class="sidebar-sub-header"><a href="/rat-summ/pages/71132c/#整体分析-2" class="sidebar-link">整体分析</a></li><li class="sidebar-sub-header"><a href="/rat-summ/pages/71132c/#server-分析" class="sidebar-link">server 分析</a></li><li class="sidebar-sub-header"><a href="/rat-summ/pages/71132c/#client-分析" class="sidebar-link">client 分析</a></li><li class="sidebar-sub-header"><a href="/rat-summ/pages/71132c/#总结-4" class="sidebar-link">总结</a></li></ul></li><li class="sidebar-sub-header"><a href="/rat-summ/pages/71132c/#vue-init" class="sidebar-link">vue init</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/rat-summ/pages/71132c/#init-命令" class="sidebar-link">init 命令</a></li><li class="sidebar-sub-header"><a href="/rat-summ/pages/71132c/#vue-cli-init-分析" class="sidebar-link">@vue/cli-init 分析</a></li><li class="sidebar-sub-header"><a href="/rat-summ/pages/71132c/#vue-cli-2-x-init-分析" class="sidebar-link">vue-cli 2.x init 分析</a></li><li class="sidebar-sub-header"><a href="/rat-summ/pages/71132c/#generate-函数分析" class="sidebar-link">generate 函数分析</a></li><li class="sidebar-sub-header"><a href="/rat-summ/pages/71132c/#总结-5" class="sidebar-link">总结</a></li></ul></li><li class="sidebar-sub-header"><a href="/rat-summ/pages/71132c/#vue-config" class="sidebar-link">vue config</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/rat-summ/pages/71132c/#config-命令" class="sidebar-link">config 命令</a></li></ul></li><li class="sidebar-sub-header"><a href="/rat-summ/pages/71132c/#vue-upgrade" class="sidebar-link">vue upgrade</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/rat-summ/pages/71132c/#upgrade-命令" class="sidebar-link">upgrade 命令</a></li></ul></li><li class="sidebar-sub-header"><a href="/rat-summ/pages/71132c/#vue-info" class="sidebar-link">vue info</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/rat-summ/pages/71132c/#info-命令" class="sidebar-link">info 命令</a></li></ul></li><li class="sidebar-sub-header"><a href="/rat-summ/pages/71132c/#相关链接" class="sidebar-link">相关链接</a></li></ul></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>vuepress</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/388ab8/" class="sidebar-link">vuepress主题模版及实践</a></li><li><a href="/rat-summ/pages/281e9a/" class="sidebar-link">vuepress搭建文档中心</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>优化</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/521b7b/" class="sidebar-link">长列表优化</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>实践</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/0a2802/" class="sidebar-link">vue中pdf下载及预览</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>vite</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/d6cc17/" class="sidebar-link">01.vite实践及分析</a></li><li><a href="/rat-summ/pages/8096e1/" class="sidebar-link">vite自定义实现</a></li><li><a href="/rat-summ/pages/1f61db/" class="sidebar-link">vite源码解析</a></li><li><a href="/rat-summ/pages/6b2a11/" class="sidebar-link">vite自定义实现2</a></li><li><a href="/rat-summ/pages/0413e2/" class="sidebar-link">vue-cli迁移vite2实践小结</a></li><li><a href="/rat-summ/pages/ff4767/" class="sidebar-link">Vite2&amp;React&amp;AntDesign4搭建开发环境</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>第三方库</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/eecca3/" class="sidebar-link">antd-vue table设置rowClass</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>组件库</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/rat-ui-vue2-my/" class="sidebar-link">基于vue2环境搭建</a></li><li><a href="/rat-summ/pages/rat-ui-vue3-my/" class="sidebar-link">基于vue3环境搭建</a></li><li><a href="/rat-summ/pages/rat-ui-vue3-me/" class="sidebar-link">vue3自定义组件库</a></li><li><a href="/rat-summ/pages/rat-ui-vue-icon-button/" class="sidebar-link">Icon和Button组件</a></li><li><a href="/rat-summ/pages/rat-ui-vue-message/" class="sidebar-link">Message组件</a></li><li><a href="/rat-summ/pages/rat-ui-vue-carousel/" class="sidebar-link">Carousel组件</a></li><li><a href="/rat-summ/pages/rat-ui-vue-tree/" class="sidebar-link">Tree组件</a></li><li><a href="/rat-summ/pages/824a5d/" class="sidebar-link">Tree组件2</a></li><li><a href="/rat-summ/pages/1a7009/" class="sidebar-link">Toast组件</a></li><li><a href="/rat-summ/pages/7b620d/" class="sidebar-link">vue组件化</a></li><li><a href="/rat-summ/pages/843a0b/" class="sidebar-link">相关参考</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>源码分析</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/1c6668/" class="sidebar-link">vue源码解密分析开源项目</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>react</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/f74c57/" class="sidebar-link">react生命周期</a></li><li><a href="/rat-summ/pages/febb52/" class="sidebar-link">react源码解析</a></li><li><a href="/rat-summ/pages/f7cd7b/" class="sidebar-link">react动态添加样式</a></li><li><a href="/rat-summ/pages/a20232/" class="sidebar-link">componentWillReceiveProps代替方案</a></li><li><a href="/rat-summ/pages/894913/" class="sidebar-link">react的通信方式</a></li><li><a href="/rat-summ/pages/725a47/" class="sidebar-link">react组件通信的方式</a></li><li><a href="/rat-summ/pages/29ef52/" class="sidebar-link">react优化性能技巧</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>dva</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/d887b1/" class="sidebar-link">dva使用实践</a></li><li><a href="/rat-summ/pages/203fe8/" class="sidebar-link">dva实现原理及自定义实现</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>router</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/5c9300/" class="sidebar-link">react-router&amp;dom实践使用</a></li><li><a href="/rat-summ/pages/8a9a13/" class="sidebar-link">react-router&amp;dom自定义实现</a></li><li><a href="/rat-summ/pages/ebc64f/" class="sidebar-link">react-router&amp;dom的源码分析</a></li><li><a href="/rat-summ/pages/ebc3a4/" class="sidebar-link">connected-react-router自定义实现</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>hooks</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/f3a825/" class="sidebar-link">hooks实践</a></li><li><a href="/rat-summ/pages/48c2d2/" class="sidebar-link">hooks自定义实现</a></li><li><a href="/rat-summ/pages/54db46/" class="sidebar-link">hooks源码实现</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>组件库</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/400fdf/" class="sidebar-link">通过storybook实现组件库</a></li><li><a href="/rat-summ/pages/f45bc7/" class="sidebar-link">组件发布相关</a></li><li><a href="/rat-summ/pages/9311d0/" class="sidebar-link">lerna&amp;dumi组件库及文档</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>优化</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/f8eee2/" class="sidebar-link">react性能优化</a></li><li><a href="/rat-summ/pages/1cc554/" class="sidebar-link">umi项目本地构建优化</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>antd</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/b936a9/" class="sidebar-link">antdv3中使用DatePicker控件</a></li><li><a href="/rat-summ/pages/636811/" class="sidebar-link">antd从v3升级到v4</a></li><li><a href="/rat-summ/pages/5a40df/" class="sidebar-link">umi插件</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>兼容性</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>IE</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/9e9433/" class="sidebar-link">解决TextEncoder和TextDecoder在IE下不兼容的问题</a></li><li><a href="/rat-summ/pages/56ba6a/" class="sidebar-link">解决iconfont在IE下不兼容问题</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>常用库</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>公共</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/5e3047/" class="sidebar-link">常用后台管理模块库</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>jspdf</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/77850d/" class="sidebar-link">pdf生成处理</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>dnd</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/224401/" class="sidebar-link">react-dnd用法详解</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>协议</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/23fc68/" class="sidebar-link">常用网络协议关系</a></li><li><a href="/rat-summ/pages/a62613/" class="sidebar-link">http协议相关</a></li><li><a href="/rat-summ/pages/65f844/" class="sidebar-link">websocket的使用</a></li><li><a href="/rat-summ/pages/8231a6/" class="sidebar-link">mqtt的使用</a></li><li><a href="/rat-summ/pages/b65f02/" class="sidebar-link">websocket-over-stomp</a></li><li><a href="/rat-summ/pages/http-defense/" class="sidebar-link">http防御</a></li><li><a href="/rat-summ/pages/1d91eb/" class="sidebar-link">从url输入到返回请求的过程</a></li><li><a href="/rat-summ/pages/f5f2bd/" class="sidebar-link">websocket重连优化</a></li><li><a href="/rat-summ/pages/471e57/" class="sidebar-link">iframe中cookie使用</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>api_权限</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/09a716/" class="sidebar-link">接口请求格式详解</a></li><li><a href="/rat-summ/pages/b2d2c4/" class="sidebar-link">apidoc使用实践</a></li><li><a href="/rat-summ/pages/0de4e4/" class="sidebar-link">前端鉴权知识</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>h5移动</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/560843/" class="sidebar-link">文章推荐</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>性能</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>优化</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/ee6f51/" class="sidebar-link">前端性能优化建议</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>监控</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/72e73a/" class="sidebar-link">常见监控问题汇总</a></li><li><a href="/rat-summ/pages/f0604f/" class="sidebar-link">sentry实践及性能监控</a></li><li><a href="/rat-summ/pages/90f275/" class="sidebar-link">sentry集成钉钉</a></li><li><a href="/rat-summ/pages/1c3756/" class="sidebar-link">sentry收集错误上报的原理</a></li><li><a href="/rat-summ/pages/24c0e6/" class="sidebar-link">sentry部署及实践</a></li><li><a href="/rat-summ/pages/351a6b/" class="sidebar-link">前端性能监控自己实现</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>辅助工具</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/a2f35a/" class="sidebar-link">chrome开发者工具的使用</a></li><li><a href="/rat-summ/pages/0ac96f/" class="sidebar-link">sonarqube实践及分析</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>组件化</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/d45aed/" class="sidebar-link">React组件库搭建</a></li><li><a href="/rat-summ/pages/834f6e/" class="sidebar-link">Vue组件库搭建</a></li><li><a href="/rat-summ/pages/071606/" class="sidebar-link">Vue移动端组件库</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>模块化</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>模板</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/adm-tpl-sys/" class="sidebar-link">管理端adm-tpl-sys模版</a></li><li><a href="/rat-summ/pages/adm-tpl-sub/" class="sidebar-link">管理端adm-tpl-sub模版</a></li><li><a href="/rat-summ/pages/adm-tpl-portal/" class="sidebar-link">管理端adm-tpl-portal模版</a></li><li><a href="/rat-summ/pages/adm-tpl-port/" class="sidebar-link">管理端adm-tpl-part模版</a></li><li><a href="/rat-summ/pages/adm-tpl-react/" class="sidebar-link">管理端adm-tpl-react模版</a></li><li><a href="/rat-summ/pages/adm-tpl-vue/" class="sidebar-link">管理端adm-tpl-vue模版</a></li><li><a href="/rat-summ/pages/h5-tpl-vue/" class="sidebar-link">移动端h5-tpl-vue模版</a></li><li><a href="/rat-summ/pages/doc-tpl-rat/" class="sidebar-link">管理端doc-tpl-rat模版</a></li><li><a href="/rat-summ/pages/doc-tpl-bdp/" class="sidebar-link">管理端doc-tpl-bdp模版</a></li><li><a href="/rat-summ/pages/adm-tpl-vue-multi/" class="sidebar-link">管理端adm-tpl-vue-multi模版</a></li><li><a href="/rat-summ/pages/adm-tpl-egg/" class="sidebar-link">管理端adm-tpl-egg模版</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>微前端</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/908314/" class="sidebar-link">微前端概况</a></li><li><a href="/rat-summ/pages/micro-fe-use/" class="sidebar-link">微前端实践使用</a></li><li><a href="/rat-summ/pages/micro-fe-my/" class="sidebar-link">微前端原理实现</a></li><li><a href="/rat-summ/pages/264bc0/" class="sidebar-link">qiankun实践</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>learn</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/monorepo-lerna-yarn-use/" class="sidebar-link">monorepo-lerna-yarn的实践</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>可视化</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>bizchart</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/c23b0f/" class="sidebar-link">bizchart基础</a></li><li><a href="/rat-summ/pages/e6701a/" class="sidebar-link">bizchart实践</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>x6</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/bf408c/" class="sidebar-link">x6实践</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>工程化</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>介绍</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/c9a984/" class="sidebar-link">介绍借鉴</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>babel</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/561173/" class="sidebar-link">babel实践及配置</a></li><li><a href="/rat-summ/pages/b5a629/" class="sidebar-link">babel原理及AST</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>gulp</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/fb8427/" class="sidebar-link">glup的使用</a></li><li><a href="/rat-summ/pages/013312/" class="sidebar-link">gulp搭建本地服务</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>webpack</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/b12f8c/" class="sidebar-link">webpack</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>代码规范</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/b68d92/" class="sidebar-link">常用的代码规范配置</a></li><li><a href="/rat-summ/pages/e58bf8/" class="sidebar-link">eslint+prettier规范与检测代码</a></li><li><a href="/rat-summ/pages/git-cz-commit/" class="sidebar-link">cz代码提交规范的工作流</a></li><li><a href="/rat-summ/pages/4de8c4/" class="sidebar-link">prettier配置</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>cli</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/da383f/" class="sidebar-link">脚手架cli开发</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>测试</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/24e8fd/" class="sidebar-link">自动化前端测试</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>构建</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/72751e/" class="sidebar-link">前端构建OOM</a></li><li><a href="/rat-summ/pages/a4bce3/" class="sidebar-link">前端内存分析</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>uml</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/77e0c4/" class="sidebar-link">UML工具之EA用法</a></li><li><a href="/rat-summ/pages/bb0cda/" class="sidebar-link">UML基于其的软件设计</a></li><li><a href="/rat-summ/pages/5a0304/" class="sidebar-link">UML基于其的需求分析</a></li><li><a href="/rat-summ/pages/3e0da4/" class="sidebar-link">UML基于其的需求分析之案例分析</a></li><li><a href="/rat-summ/pages/a233a0/" class="sidebar-link">UML用法之基础之基于StarUML</a></li><li><a href="/rat-summ/pages/46009e/" class="sidebar-link">UML用法之进阶之基于EA</a></li><li><a href="/rat-summ/pages/99ad7d/" class="sidebar-link">UML之类图分析</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>devops</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>gitd</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/0e4ee4/" class="sidebar-link">git常用命令及使用</a></li><li><a href="/rat-summ/pages/5f88ca/" class="sidebar-link">git提交规范</a></li><li><a href="/rat-summ/pages/3cf79d/" class="sidebar-link">git补丁patch和diff使用</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>jenkins</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/cf5bb3/" class="sidebar-link">jenkins配置及使用</a></li><li><a href="/rat-summ/pages/db0083/" class="sidebar-link">jenkins前端构建部署</a></li><li><a href="/rat-summ/pages/e9a204/" class="sidebar-link">Jenkins推送设置</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>github</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/github-action/" class="sidebar-link">Github Action自动打包部署</a></li><li><a href="/rat-summ/pages/04ea51/" class="sidebar-link">gitpage设置</a></li><li><a href="/rat-summ/pages/27f7b7/" class="sidebar-link">Github常用自动化及发布设置</a></li><li><a href="/rat-summ/pages/9cd829/" class="sidebar-link">gitlhub&amp;lab几个常用的API</a></li><li><a href="/rat-summ/pages/3a598f/" class="sidebar-link">github墙外</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>gitlab</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/92a5da/" class="sidebar-link">gitlab环境及配置</a></li><li><a href="/rat-summ/pages/2a7fb1/" class="sidebar-link">常用功能</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>bash</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/307097/" class="sidebar-link">前端脚本通过时间生成对应环境</a></li><li><a href="/rat-summ/pages/209a7a/" class="sidebar-link">shell脚本中变量判断</a></li><li><a href="/rat-summ/pages/85b237/" class="sidebar-link">bash判断文件或文件夹是否存在</a></li><li><a href="/rat-summ/pages/39d420/" class="sidebar-link">sed命令替换匹配行</a></li><li><a href="/rat-summ/pages/b8cc91/" class="sidebar-link">shell中find使用</a></li><li><a href="/rat-summ/pages/d16bc3/" class="sidebar-link">shell中mv&amp;rm&amp;cp使用</a></li><li><a href="/rat-summ/pages/3e2bbc/" class="sidebar-link">shell管道及并串行</a></li><li><a href="/rat-summ/pages/5aff55/" class="sidebar-link">shell参数传递与默认值</a></li><li><a href="/rat-summ/pages/da9733/" class="sidebar-link">shell读取配置文件参数</a></li><li><a href="/rat-summ/pages/ee26ee/" class="sidebar-link">shell交互式传参</a></li><li><a href="/rat-summ/pages/79fe8b/" class="sidebar-link">shell中json使用</a></li><li><a href="/rat-summ/pages/b9af92/" class="sidebar-link">shell中catch使用</a></li><li><a href="/rat-summ/pages/23ad45/" class="sidebar-link">shell中后台运行</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>k8s</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/012f5e/" class="sidebar-link">前端实践k8s</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>ansible</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/150b7c/" class="sidebar-link">ansible实践</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>docker</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/a07627/" class="sidebar-link">docker环境及配置</a></li><li><a href="/rat-summ/pages/docker-base/" class="sidebar-link">docker&amp;compose及swarm的使用</a></li><li><a href="/rat-summ/pages/975a75/" class="sidebar-link">docker常用脚本及工具</a></li><li><a href="/rat-summ/pages/3b2696/" class="sidebar-link">前端常用到的docker容器</a></li><li><a href="/rat-summ/pages/71907e/" class="sidebar-link">docker镜像源加速</a></li><li><a href="/rat-summ/pages/8b98ff/" class="sidebar-link">docker搭建私有仓库registry及harbor</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>nginx</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/nginx-base/" class="sidebar-link">nginx环境设置</a></li><li><a href="/rat-summ/pages/nginx-good/" class="sidebar-link">nginx常用设置及实践</a></li><li><a href="/rat-summ/pages/626088/" class="sidebar-link">nginx配置https-http2</a></li><li><a href="/rat-summ/pages/f7b17f/" class="sidebar-link">nginx部署相关</a></li><li><a href="/rat-summ/pages/1fd240/" class="sidebar-link">nginx运维部署相关</a></li><li><a href="/rat-summ/pages/2aabd0/" class="sidebar-link">nginx的重定向问题</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>ci&amp;cd</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/8ceda4/" class="sidebar-link">jenkins构建docker镜像上传至私有镜像库Nexus</a></li><li><a href="/rat-summ/pages/f645ee/" class="sidebar-link">ci&amp;cd通过k8s完整部署</a></li><li><a href="/rat-summ/pages/29c57b/" class="sidebar-link">gitLab搭建cicd</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>deploy</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/a991cc/" class="sidebar-link">pm2常用命令及管理</a></li><li><a href="/rat-summ/pages/7e9083/" class="sidebar-link">pm2一键部署</a></li><li><a href="/rat-summ/pages/e5878d/" class="sidebar-link">pm2的实现原理</a></li><li><a href="/rat-summ/pages/2942f3/" class="sidebar-link">ansible部署</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>db</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>nedb</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/275bf3/" class="sidebar-link">nedb的使用</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>mysql</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/a23297/" class="sidebar-link">mysql环境及配置</a></li><li><a href="/rat-summ/pages/bb5f4c/" class="sidebar-link">mysql语法相关</a></li><li><a href="/rat-summ/pages/c3d40c/" class="sidebar-link">mysql类型、储存引擎</a></li><li><a href="/rat-summ/pages/66840d/" class="sidebar-link">mysql事务</a></li><li><a href="/rat-summ/pages/e09335/" class="sidebar-link">mysql优化</a></li><li><a href="/rat-summ/pages/8b0470/" class="sidebar-link">sequelize事务</a></li><li><a href="/rat-summ/pages/408e49/" class="sidebar-link">mysql在win上bat脚本使用</a></li><li><a href="/rat-summ/pages/5ac000/" class="sidebar-link">sqlite的使用</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>redis</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/bcd737/" class="sidebar-link">redis环境及配置</a></li><li><a href="/rat-summ/pages/098cc4/" class="sidebar-link">redis简介、安装及配置</a></li><li><a href="/rat-summ/pages/7f774f/" class="sidebar-link">redis数据结构、订阅及案例</a></li><li><a href="/rat-summ/pages/7650e0/" class="sidebar-link">redis持久化、缓存及淘汰策略</a></li><li><a href="/rat-summ/pages/b7e7b7/" class="sidebar-link">redis集群、慢查询及内存优化</a></li><li><a href="/rat-summ/pages/0ecb33/" class="sidebar-link">redis事务、锁及分布式</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>业务其他</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>ambari</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/365af3/" class="sidebar-link">ambari-admin前端二次开发</a></li><li><a href="/rat-summ/pages/365af4/" class="sidebar-link">ambari-web前端二次开发</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>freemarker</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/851ff6/" class="sidebar-link">freemarker基本语法</a></li><li><a href="/rat-summ/pages/2a94be/" class="sidebar-link">freemarker与vue实践</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>ember</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/0597da/" class="sidebar-link">ember语法</a></li><li><a href="/rat-summ/pages/30db45/" class="sidebar-link">ember调试</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>go</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/850c2f/" class="sidebar-link">go环境相关配置</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>系统</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>mac</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/6a7c2d/" class="sidebar-link">mac中zsh配置</a></li><li><a href="/rat-summ/pages/00d9cb/" class="sidebar-link">mac常用软件</a></li><li><a href="/rat-summ/pages/f6ec35/" class="sidebar-link">mac上U盘及硬盘数据</a></li><li><a href="/rat-summ/pages/498a75/" class="sidebar-link">homebrew镜像设置</a></li><li><a href="/rat-summ/pages/6d2739/" class="sidebar-link">mac开发环境配置</a></li><li><a href="/rat-summ/pages/fa9bb9/" class="sidebar-link">mac升级固态重装系统</a></li><li><a href="/rat-summ/pages/b86746/" class="sidebar-link">mac打开scp功能</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>linux</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/f991c3/" class="sidebar-link">linux系统目录结构</a></li><li><a href="/rat-summ/pages/037572/" class="sidebar-link">shell脚本实现取当前时间</a></li><li><a href="/rat-summ/pages/6147ef/" class="sidebar-link">linux下通过端口查看进程</a></li><li><a href="/rat-summ/pages/5157d5/" class="sidebar-link">linux用户及权限配置管理</a></li><li><a href="/rat-summ/pages/bc509e/" class="sidebar-link">linux下使用Shell脚本使用ftp</a></li><li><a href="/rat-summ/pages/c74d05/" class="sidebar-link">linux下用户管理</a></li><li><a href="/rat-summ/pages/7c0099/" class="sidebar-link">linux解压缩命令</a></li><li><a href="/rat-summ/pages/02fc2e/" class="sidebar-link">服务常用命令</a></li><li><a href="/rat-summ/pages/99637c/" class="sidebar-link">linux安装配置sshd</a></li><li><a href="/rat-summ/pages/93d76c/" class="sidebar-link">centos7设置防火墙</a></li><li><a href="/rat-summ/pages/6f084f/" class="sidebar-link">linux写入的使用</a></li><li><a href="/rat-summ/pages/3ba63f/" class="sidebar-link">centos离线安装软件</a></li><li><a href="/rat-summ/pages/54a78b/" class="sidebar-link">linux下jdk环境安装</a></li><li><a href="/rat-summ/pages/d59afc/" class="sidebar-link">linux与win格式</a></li><li><a href="/rat-summ/pages/a85063/" class="sidebar-link">linux磁盘空间管理</a></li><li><a href="/rat-summ/pages/3654be/" class="sidebar-link">使用samba建立共享文件</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>win</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/ceea52/" class="sidebar-link">桌面上图标出现x及感叹号处理</a></li><li><a href="/rat-summ/pages/ac4a51/" class="sidebar-link">Chocolatey的使用</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>pi</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/8f3e17/" class="sidebar-link">安装MATE及配置</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>centos</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/52b482/" class="sidebar-link">centos安装配置注意事项</a></li><li><a href="/rat-summ/pages/3a9aef/" class="sidebar-link">centos常用命令</a></li><li><a href="/rat-summ/pages/d8dad9/" class="sidebar-link">centos修改国内yum源</a></li><li><a href="/rat-summ/pages/a52dbe/" class="sidebar-link">centos利用createrepo制作本地yum源</a></li><li><a href="/rat-summ/pages/e672e6/" class="sidebar-link">centos安装vim及配置</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>ubuntu</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/c21912/" class="sidebar-link">ubuntu上安装Chrome浏览器</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>tool</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>开发工具</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/fe80ea/" class="sidebar-link">vscode插件开发实践</a></li><li><a href="/rat-summ/pages/42487b/" class="sidebar-link">vscode常用插件及设置</a></li><li><a href="/rat-summ/pages/e7d3cc/" class="sidebar-link">vscode推荐插件分类</a></li><li><a href="/rat-summ/pages/191c13/" class="sidebar-link">谷歌插件推荐</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>命令终端</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/13e164/" class="sidebar-link">win终端Cmder配置及美化</a></li><li><a href="/rat-summ/pages/326653/" class="sidebar-link">terminus</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>写作工具</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/f931af/" class="sidebar-link">Markdown For Typora</a></li><li><a href="/rat-summ/pages/e28d3c/" class="sidebar-link">mdeditor完整示例</a></li><li><a href="/rat-summ/pages/8d4c7d/" class="sidebar-link">markdown语法指南</a></li><li><a href="/rat-summ/pages/790131/" class="sidebar-link">typora配合PicGo图床设置</a></li><li><a href="/rat-summ/pages/27f6e7/" class="sidebar-link">使用md语法编写在线文档</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>系统工具</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/ccbd1b/" class="sidebar-link">U盘启动盘制作工具</a></li><li><a href="/rat-summ/pages/ee04b1/" class="sidebar-link">mac上创建可启动USB</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>外部墙</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/10414e/" class="sidebar-link">内网穿透</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>design_pattern</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/5a8250/" class="sidebar-link">设计模式js版</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>algorithm</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/bd8a49/" class="sidebar-link">十大经典排序算法js版</a></li><li><a href="/rat-summ/pages/9456b9/" class="sidebar-link">数据结构及常用算法</a></li><li><a href="/rat-summ/pages/ed57ec/" class="sidebar-link">前端算法</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>android</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>junior</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/006aef/" class="sidebar-link">Android开发环境搭建和其相关配置</a></li><li><a href="/rat-summ/pages/b7d0d8/" class="sidebar-link">Android开发环境搭建和其相关配之Linux</a></li><li><a href="/rat-summ/pages/7d6f22/" class="sidebar-link">Android代码编程规范</a></li><li><a href="/rat-summ/pages/5e275b/" class="sidebar-link">Android网络基础</a></li><li><a href="/rat-summ/pages/b705d6/" class="sidebar-link">Android应用部署与发布</a></li><li><a href="/rat-summ/pages/1d4106/" class="sidebar-link">Android动画框架概括</a></li><li><a href="/rat-summ/pages/1ab136/" class="sidebar-link">Android动画框架基础</a></li><li><a href="/rat-summ/pages/b5f1e2/" class="sidebar-link">Android动画框架进阶</a></li><li><a href="/rat-summ/pages/38a1c0/" class="sidebar-link">Android应用学习进阶步骤之面试参照</a></li><li><a href="/rat-summ/pages/9bb8d0/" class="sidebar-link">Android应用学习进阶之初级</a></li><li><a href="/rat-summ/pages/5cb39b/" class="sidebar-link">Android应用市场发布流程之运营&amp;推广</a></li><li><a href="/rat-summ/pages/d94fea/" class="sidebar-link">Android开发新规范整理</a></li><li><a href="/rat-summ/pages/7b6ec9/" class="sidebar-link">gradle构建脚本优化</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>intermediate</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/eb6937/" class="sidebar-link">Android应用学习进阶之中级</a></li><li><a href="/rat-summ/pages/2c5f39/" class="sidebar-link">Android通信协议简述</a></li><li><a href="/rat-summ/pages/6ebce7/" class="sidebar-link">Android通讯协议之蓝牙基础</a></li><li><a href="/rat-summ/pages/e6d82e/" class="sidebar-link">Android自定义控件基础之事件分发和绘制</a></li><li><a href="/rat-summ/pages/37e06f/" class="sidebar-link">Android自定义控件基础分类及示例</a></li><li><a href="/rat-summ/pages/d3fdc6/" class="sidebar-link">Android编译脚本比较</a></li><li><a href="/rat-summ/pages/0365a3/" class="sidebar-link">NDK开发实践之基础</a></li><li><a href="/rat-summ/pages/9e9aed/" class="sidebar-link">NDK开发实践之基础之C语言</a></li><li><a href="/rat-summ/pages/383970/" class="sidebar-link">NDK开发实践之案例</a></li><li><a href="/rat-summ/pages/699fca/" class="sidebar-link">NDK开发实践之进阶</a></li><li><a href="/rat-summ/pages/fd869c/" class="sidebar-link">NDK开发环境搭建及初探</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>senior</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/fb359c/" class="sidebar-link">Andriod框架分析</a></li><li><a href="/rat-summ/pages/ced670/" class="sidebar-link">Andriod性能分析之概括</a></li><li><a href="/rat-summ/pages/69bd19/" class="sidebar-link">Andoid内存泄露案例分析</a></li><li><a href="/rat-summ/pages/b49e19/" class="sidebar-link">Andriod性能分析之布局优化</a></li><li><a href="/rat-summ/pages/bb4528/" class="sidebar-link">Andriod性能分析之代码优化</a></li><li><a href="/rat-summ/pages/024edd/" class="sidebar-link">Android插件化开发</a></li><li><a href="/rat-summ/pages/8794d6/" class="sidebar-link">Android内存分析及工具</a></li><li><a href="/rat-summ/pages/cc3b41/" class="sidebar-link">Android热插拔式开发</a></li><li><a href="/rat-summ/pages/e8c6d3/" class="sidebar-link">Dagger2&amp;Retrofit&amp;Mvp&amp;Rxjava使用</a></li><li><a href="/rat-summ/pages/b0b383/" class="sidebar-link">设计模式designpattern之Android</a></li><li><a href="/rat-summ/pages/32c934/" class="sidebar-link">Android应用学习进阶之高级</a></li><li><a href="/rat-summ/pages/d0714d/" class="sidebar-link">Android代码重构杂谈</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>frame_analysis</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/105499/" class="sidebar-link">photoview框架总体类关系类图</a></li><li><a href="/rat-summ/pages/3410a4/" class="sidebar-link">photoview_gestures类图</a></li><li><a href="/rat-summ/pages/d416e3/" class="sidebar-link">photoview_scrollerproxy类图</a></li><li><a href="/rat-summ/pages/caddb2/" class="sidebar-link">photoview时序图</a></li><li><a href="/rat-summ/pages/19455e/" class="sidebar-link">universalimageloader总体分析类图</a></li><li><a href="/rat-summ/pages/a6beae/" class="sidebar-link">universalimageloader图片显示时序图</a></li><li><a href="/rat-summ/pages/192be5/" class="sidebar-link">volley总体分析类图</a></li><li><a href="/rat-summ/pages/67eb09/" class="sidebar-link">volley网络调用时序图</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>source_analysis</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rat-summ/pages/782b10/" class="sidebar-link">Activity的Window创建的过程</a></li><li><a href="/rat-summ/pages/bd7c14/" class="sidebar-link">Android事件分发活动图</a></li><li><a href="/rat-summ/pages/98b15b/" class="sidebar-link">AppWidget相关类关系类图</a></li><li><a href="/rat-summ/pages/6de61b/" class="sidebar-link">AppWidget桌面小部件时序图</a></li><li><a href="/rat-summ/pages/9bcef6/" class="sidebar-link">drawable的层次关系类图</a></li><li><a href="/rat-summ/pages/39cfca/" class="sidebar-link">Toast的Window创建过程</a></li><li><a href="/rat-summ/pages/139a3b/" class="sidebar-link">Window的操作过程时序图</a></li><li><a href="/rat-summ/pages/9d63db/" class="sidebar-link">窗口视图相关类图</a></li><li><a href="/rat-summ/pages/92b566/" class="sidebar-link">视图相关类图</a></li><li><a href="/rat-summ/pages/5408af/" class="sidebar-link">总体视图组的继承结构类图</a></li><li><a href="/rat-summ/pages/cf8bd6/" class="sidebar-link">Notification通知栏时序图</a></li><li><a href="/rat-summ/pages/5da37d/" class="sidebar-link">Notification相关类关系类图</a></li><li><a href="/rat-summ/pages/dfd0ca/" class="sidebar-link">ViewGroup的绘制活动图</a></li><li><a href="/rat-summ/pages/9366f0/" class="sidebar-link">ViewGroup和View总体案例分析活动图</a></li><li><a href="/rat-summ/pages/285c96/" class="sidebar-link">ViewGroup事件分发活动图</a></li><li><a href="/rat-summ/pages/2d5ab3/" class="sidebar-link">View的绘制活动图</a></li><li><a href="/rat-summ/pages/5ed209/" class="sidebar-link">View事件分发活动图</a></li><li><a href="/rat-summ/pages/462233/" class="sidebar-link">View中draw子流程活动图</a></li><li><a href="/rat-summ/pages/33d189/" class="sidebar-link">消息处理机制时序图</a></li><li><a href="/rat-summ/pages/2963bb/" class="sidebar-link">消息处理机制相关类关系类图</a></li></ul></section></li></ul></section></li></ul> <div class="sidebar-slot sidebar-slot-bottom"><!-- 正方形 -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="3508773082"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div></aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-33863c7e><div class="articleInfo" data-v-33863c7e><ul class="breadcrumbs" data-v-33863c7e><li data-v-33863c7e><a href="/rat-summ/" title="首页" class="iconfont icon-home router-link-active" data-v-33863c7e></a></li> <li data-v-33863c7e><span data-v-33863c7e>《技能记录》</span></li> <li data-v-33863c7e><span data-v-33863c7e>vue</span></li> <li data-v-33863c7e><span data-v-33863c7e>cli</span></li></ul> <div class="info" data-v-33863c7e><div title="作者" class="author iconfont icon-touxiang" data-v-33863c7e><a href="https://github.com/samyzh" target="_blank" title="作者" class="beLink" data-v-33863c7e>samy</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-33863c7e><a href="javascript:;" data-v-33863c7e>2021-01-18</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">
          vue-cli源码分析
        </h1>  <div class="theme-vdoing-content content__default"><h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <h3 id="发布"><a href="#发布" class="header-anchor">#</a> 发布</h3> <p><a href="http://evanyou.me/" target="_blank" rel="noopener noreferrer">Evan You<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 8月10日 在 <a href="https://medium.com/" target="_blank" rel="noopener noreferrer">Medium<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>发布了 <a href="https://medium.com/the-vue-point/vue-cli-3-0-is-here-c42bebe28fbb" target="_blank" rel="noopener noreferrer">Vue CLI 3.0 is here!<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，这标志着 <code>vue-cli</code> 进入了 3.0 时代。从这以后，<code>vue</code> 开发体验更加地优秀，开发逼格更加地高大。</p> <p>其实，不是这样的，事实是：从这以后，你要明白，你又要继续学习了，尤大，你尽管更新，我们还学得动。</p> <p><img src="/rat-summ/assets/img/foreword-img01.713c8701.png" alt="img"></p> <h3 id="版本"><a href="#版本" class="header-anchor">#</a> 版本</h3> <p><code>vue-cli</code> 从 <code>3.0.0-alpha.1</code> 到 <code>3.0.0</code> 一共发布了 <strong>41</strong> 个版本，其中包括 <strong>13</strong> 个 <code>alpha</code> 版本，<strong>16</strong> 个 <code>beta</code> 版本以及 <strong>12</strong> 个 <code>rc</code> 版本,本次源码采用的版本是 <code>3.1.3</code>，也是在写这篇文章时的最新版本。截止 <code>3.1.3</code>，<code>npm</code> 上一共发布了 <strong>51</strong> 个版本。所以： <strong>一个好的项目不是一次写成的，只有不断地 <code>fix bugs</code> 才能更加完善</strong> 。</p> <p><a href="https://www.npmjs.com/package/@vue/cli" target="_blank" rel="noopener noreferrer">vue-cli npm versions<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><img src="/rat-summ/assets/img/foreword-img02.a7931302.gif" alt="img"></p> <h3 id="仓库"><a href="#仓库" class="header-anchor">#</a> 仓库</h3> <p><strong>Github 仓库</strong> : <a href="https://github.com/vuejs/vue-cli" target="_blank" rel="noopener noreferrer">vue-cli<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>仓库默认分支为 <code>dev</code>， 这个分支下放着<code>vue-cli3.0</code> 以及与之配套的一些插件代码，<code>master</code> 分支为 <code>vue-cli 2.X.X</code> 的代码。其中 <code>vue-cli</code> 的源码在 <code>/packages/@vue/cli</code> 中，看这目录的格式，应该是尤大将工具以及<code>vue-cli</code> 的一些插件都归在了 <code>npm</code> <code>@vue</code> 的组织下面，<a href="https://www.npmjs.com/org/vue" target="_blank" rel="noopener noreferrer">npm @vue<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p><img src="/rat-summ/assets/img/foreword-img03.37d07985.png" alt="img"></p> <h2 id="开始"><a href="#开始" class="header-anchor">#</a> 开始</h2> <h3 id="环境介绍"><a href="#环境介绍" class="header-anchor">#</a> 环境介绍</h3> <h4 id="版本-2"><a href="#版本-2" class="header-anchor">#</a> 版本</h4> <ul><li>@vue/cli： 3.1.3</li> <li>@vue/cli-service： 3.1.4</li> <li>node：8.11.4</li> <li>platform： macOS</li></ul> <h4 id="工具"><a href="#工具" class="header-anchor">#</a> 工具</h4> <ul><li>vscode： 代码编辑器</li> <li>Typora： Markdown 编辑器</li></ul> <p><strong>从一张图开始源码的分析</strong></p> <p><img src="/rat-summ/assets/img/install-env-img01.40fdafb8.png" alt="img"></p> <p><strong>安装 <code>vue-cli</code></strong></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> -g @vue/cli
<span class="token comment"># OR</span>
<span class="token function">yarn</span> global <span class="token function">add</span> @vue/cli
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>在安装 <code>vue-cli</code> 之后，执行 <code>vue</code> 命令，就可以得到上面图片中的内容，从这个图片中可以看出，<code>vue-cli</code> 一共有 <code>11</code> 种命令：</p> <ul><li>create</li> <li>add</li> <li>invoke</li> <li>inspect</li> <li>serve</li> <li>build</li> <li>ui</li> <li>init</li> <li>config</li> <li>upgrade</li> <li>info</li></ul> <p>我们就逐个开始分析。</p> <h3 id="常见-npm-包"><a href="#常见-npm-包" class="header-anchor">#</a> 常见 npm 包</h3> <p>在进去 <code>vue-cli</code> 源码学习之前，这里先介绍下在 <code>vue-cli</code> 项目中用到的一些必备的 <code>npm</code> 包，这样在后面分析源码的时候会比较快的理解（<code>handlebars</code>，<code>metalsmith</code>，<code>consolidate</code> 主要用于 <code>vue init</code> 命令）。</p> <ul><li><a href="https://github.com/tj/commander.js" target="_blank" rel="noopener noreferrer">commander<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>：node.js command-line interfaces made easy。</li> <li><a href="https://github.com/SBoudrias/Inquirer.js" target="_blank" rel="noopener noreferrer">Inquirer<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>：A collection of common interactive command line user interfaces。</li> <li><a href="https://github.com/sindresorhus/execa" target="_blank" rel="noopener noreferrer">execa<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>：A better <a href="https://nodejs.org/api/child_process.html" target="_blank" rel="noopener noreferrer">child_process<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</li> <li><a href="https://github.com/wycats/handlebars.js" target="_blank" rel="noopener noreferrer">handlebars<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>：一个 javascript 语以模版库。</li> <li><a href="https://github.com/segmentio/metalsmith" target="_blank" rel="noopener noreferrer">metalsmith<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>；An extremely simple, pluggable static site generator。</li> <li><a href="https://github.com/chalk/chalk" target="_blank" rel="noopener noreferrer">chalk<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>：Terminal string styling done right。</li> <li><a href="https://github.com/flipxfx/download-git-repo" target="_blank" rel="noopener noreferrer">download-git-repo<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>：Download and extract a git repository (GitHub, GitLab, Bitbucket) from node。</li> <li><a href="https://github.com/tj/consolidate.js" target="_blank" rel="noopener noreferrer">consolidate<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>：Template engine consolidation library for node.js 。</li></ul> <p>下面逐个介绍：</p> <h4 id="commander"><a href="#commander" class="header-anchor">#</a> commander</h4> <p><code>commander</code> 是一款重量轻，表现力和强大的命令行框架，提供了用户命令行输入和参数解析强大功能。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>#<span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env node
<span class="token keyword">const</span> program <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'commander'</span><span class="token punctuation">)</span>
program
  <span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token string">'0.0.1'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">'rmdir &lt;dir&gt; [otherDirs...]'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">action</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">dir<span class="token punctuation">,</span> otherDirs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'rmdir %s'</span><span class="token punctuation">,</span> dir<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>otherDirs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      otherDirs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">oDir</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'rmdir %s'</span><span class="token punctuation">,</span> oDir<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

program<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>这段代码为 <code>commander.js</code> 官方的一个示例，它展示了 <code>commander.js</code> 可变参数的特性，可以在 <code>action</code> 的回调中获取对应的参数，当然也可以通过 <code>process.argv</code> 获取，<a href="https://github.com/tj/commander.js/blob/master/Readme_zh-CN.md" target="_blank" rel="noopener noreferrer">commander.js 中文文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h4 id="inquirer"><a href="#inquirer" class="header-anchor">#</a> Inquirer</h4> <p><code>Inquirer</code> 为交互式命令行工具，比如执行 <code>vue create</code> 命令会有以下的命令行交互：</p> <p><img src="/rat-summ/assets/img/install-img01.62559909.png" alt="img"></p> <p><code>Inquirer</code> 的基本使用如下：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> inquirer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'inquirer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
inquirer
  <span class="token punctuation">.</span><span class="token function">prompt</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token comment">/* Pass your questions in here */</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">answers</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Use user feedback for... whatever!!</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><code>inquirer.prompt</code> 接受一个 <code>questions</code> 数组， 一个 <code>question</code> 对象包含 <code>type</code>，<code>name</code>， <code>message</code>， <code>default</code> 等等字段，然后通过回调获取命令行交互的值，<a href="https://github.com/SBoudrias/Inquirer.js" target="_blank" rel="noopener noreferrer">详细文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h4 id="execa"><a href="#execa" class="header-anchor">#</a> execa</h4> <p><code>execa</code> 是可以调用 shell 和本地外部程序的 javascript 封装。会启动子进程执行，支持多操作系统，包括 windows，如果父进程退出，则生成的全部子进程都被杀死。它是在 Node.js 内置的 <code>child_process.exec</code> 基础上进行了提升，比如更好地支持 windows 平台，以及提供 <code>Promise</code> 的接口等等。可以看一个很简单的例子：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> execa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'execa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> <span class="token punctuation">{</span>stdout<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">execa</span><span class="token punctuation">(</span><span class="token string">'echo'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'unicorns'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>stdout<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//=&gt; 'unicorns'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>上面例子就是执行 <code>echo unicorns</code> 命令输出 unicorns。关于 <code>execa</code> 更多的用法可查看 <a href="https://github.com/sindresorhus/execa#API" target="_blank" rel="noopener noreferrer">详细文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h4 id="handlebars"><a href="#handlebars" class="header-anchor">#</a> handlebars</h4> <p><code>handlebars</code> 是一个 <code>javascript</code> 语义模版库，而且与 <code>Mustache</code> 模板 是兼容的，通过一个 <code>demo</code> 来感受下：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> source <span class="token operator">=</span> <span class="token string">&quot;&lt;p&gt;Hello, my name is {{name}}. I am from {{hometown}}. I have &quot;</span> <span class="token operator">+</span>
             <span class="token string">&quot;{{kids.length}} kids:&lt;/p&gt;&quot;</span> <span class="token operator">+</span>
             <span class="token string">&quot;&lt;ul&gt;{{#kids}}&lt;li&gt;{{name}} is {{age}}&lt;/li&gt;{{/kids}}&lt;/ul&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> template <span class="token operator">=</span> Handlebars<span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Alan&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hometown&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Somewhere, TX&quot;</span><span class="token punctuation">,</span>
             <span class="token string">&quot;kids&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Jimmy&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token operator">:</span> <span class="token string">&quot;12&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Sally&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token operator">:</span> <span class="token string">&quot;4&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token function">template</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Would render:</span>
<span class="token comment">// &lt;p&gt;Hello, my name is Alan. I am from Somewhere, TX. I have 2 kids:&lt;/p&gt;</span>
<span class="token comment">// &lt;ul&gt;</span>
<span class="token comment">//   &lt;li&gt;Jimmy is 12&lt;/li&gt;</span>
<span class="token comment">//   &lt;li&gt;Sally is 4&lt;/li&gt;</span>
<span class="token comment">// &lt;/ul&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>这是官方的一个 <code>demo</code>, 就是通过 <code>Handlebars</code> 的 <code>compile</code> 方法将模板编译成 <code>html</code> 。在 <code>vue-cli</code> 的 <code>init</code> 命令中，利用 <code>Handlebars.registerHelper</code> 方法注册了一些 <code>helper</code>，这样就可以在模板中方便的使用这些 <code>helper</code>，<a href="https://handlebarsjs.com/" target="_blank" rel="noopener noreferrer">详细文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h4 id="metalsmith"><a href="#metalsmith" class="header-anchor">#</a> metalsmith</h4> <p><code>metalsmith</code> 一个静态网站生成器，可以用在批量处理模板的场景，和 <code>hexo</code> 类似。它最大的特点就是所有的逻辑都是由插件处理，你只需要将这些插件用 <code>metalsmith</code> 连接起来使用即可，比如官方的一个 <code>demo</code>：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token function">Metalsmith</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">markdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">layouts</span><span class="token punctuation">(</span><span class="token string">'handlebars'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Build finished!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>这段代码就是通过使用 <a href="https://github.com/segmentio/metalsmith-markdown" target="_blank" rel="noopener noreferrer">metalsmith-markdown<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 和 <a href="https://github.com/metalsmith/metalsmith-layouts" target="_blank" rel="noopener noreferrer">metalsmith-layouts<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 插件 将 <code>markdown</code> 文件以 <code>handlebars</code> 的模板形式来生成<code>html</code> 文件，在 <code>vue-cli</code> 的 <code>init</code> 命令中使用了三个插件：<code>askQuestions</code> <code>filterFiles</code> <code>renderTemplateFiles</code> 从这名字就知道这个插件的作用了。编写 metalsmith 其实不是很难，官方对插件的编写介绍地比较详细，示例代码：</p> <p><strong>metalsmith-myplugin</strong>:</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// we would like you to use debug</span>
<span class="token keyword">var</span> debug <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'debug'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'metalsmith-myplugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> multimatch <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'multimatch'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Expose `plugin`.</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> plugin<span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">plugin</span><span class="token punctuation">(</span><span class="token parameter">opts</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  opts<span class="token punctuation">.</span>pattern <span class="token operator">=</span> opts<span class="token punctuation">.</span>pattern <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">files<span class="token punctuation">,</span> metalsmith<span class="token punctuation">,</span> done</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token function">setImmediate</span><span class="token punctuation">(</span>done<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">multimatch</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> opts<span class="token punctuation">.</span>pattern<span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">'myplugin working on: %s'</span><span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//</span>
        <span class="token comment">// here would be your code</span>
        <span class="token comment">//</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>关于 <code>metalsmith</code> 的更多介绍以及语法可查看<a href="https://metalsmith.io/" target="_blank" rel="noopener noreferrer">详细文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h4 id="chalk"><a href="#chalk" class="header-anchor">#</a> chalk</h4> <p><code>chalk</code> 是用于修改控制台字符串的样式，包括字体样式（加粗），颜色以及背景颜色等。</p> <p><img src="/rat-summ/assets/img/install-img02.aa6c7de0.png" alt="img"></p> <p>使用比较简单：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> chalk <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'chalk'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chalk<span class="token punctuation">.</span><span class="token function">blue</span><span class="token punctuation">(</span><span class="token string">'Hello world!'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>更多的用法以及 <code>API</code> 可查看<a href="https://github.com/chalk/chalk" target="_blank" rel="noopener noreferrer">详细文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h4 id="download-git-repo"><a href="#download-git-repo" class="header-anchor">#</a> download-git-repo</h4> <p><code>download-git-repo</code> 是用于 从 <code>GitHub</code>, <code>GitLab</code>, <code>Bitbucket</code> 下载一个 <code>git</code> 仓库，<code>API</code> 如下：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token function">download</span><span class="token punctuation">(</span>repository<span class="token punctuation">,</span> destination<span class="token punctuation">,</span> options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>repository：仓库地址。</li> <li>destination：存放下载 git 仓库的路径。</li> <li>options：选项，clone。是以 http download 的形式还是 git clone 的形式下载。其中 git clone 的形式支持下载 private 仓库。</li> <li>callback：下载完成地回调。</li></ul> <p>更多例子可查看 <a href="https://github.com/flipxfx/download-git-repo" target="_blank" rel="noopener noreferrer">详细文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h4 id="consolidate"><a href="#consolidate" class="header-anchor">#</a> consolidate</h4> <p><code>consolidate</code> 是一个模版引擎整合库，它的作用是把一些著名的模板引擎适配成 <code>Express</code> 兼容的接口。在 <code>vue-cli</code> 的 <code>init</code> 命令中利用 <code>consolidate.handlebars.render</code> 是实现模版的渲染。在 <code>/example/metalsmith</code> 目录里有个 <code>demo</code>，就是通过 <code>metalsmith</code> 以及<code>consolidate.handlebars.render</code> 方法将一个 <code>package.json</code> 以 <code>handlebars</code> 的模板引擎来渲染，在项目里运行</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">npm</span> run metalsmith
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/rat-summ/assets/img/install-img03.bca762d6.gif" alt="img"></p> <p>希望可以通过这个小 <code>demo</code> 可以比较好地理解 <code>metalsmith</code>， <code>handlebars</code> ，<code>consolidate</code> 以及<code>inquirer</code>，关于 <code>consolidate</code> 的更多语法请查看<a href="https://github.com/tj/consolidate.js" target="_blank" rel="noopener noreferrer">详细文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h4 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h4> <p>这部分主要介绍了在利用 <code>node</code> 搭建脚手架工具时一些常见的 <code>npm</code> 包，对这些 <code>npm</code> 包进行一定的了解后，在后面看源码的时候会比较容易些，下面开始进行源码分析。</p> <h2 id="vue-create"><a href="#vue-create" class="header-anchor">#</a> <code>vue create</code></h2> <h3 id="create-入口"><a href="#create-入口" class="header-anchor">#</a> create 入口</h3> <p><strong>源码目录：</strong> packages/@vue/cli/lib/create.js 。</p> <p><strong>作用：</strong> create a new project powered by vue-cli-service 。</p> <p><code>vue create</code> 命令的入口在 <code>packages/@vue/cli/bin/vue.js</code> 中:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>program
  <span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">'create &lt;app-name&gt;'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">description</span><span class="token punctuation">(</span><span class="token string">'create a new project powered by vue-cli-service'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'-p, --preset &lt;presetName&gt;'</span><span class="token punctuation">,</span> <span class="token string">'Skip prompts and use saved or remote preset'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'-d, --default'</span><span class="token punctuation">,</span> <span class="token string">'Skip prompts and use default preset'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'-i, --inlinePreset &lt;json&gt;'</span><span class="token punctuation">,</span> <span class="token string">'Skip prompts and use inline JSON string as preset'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'-m, --packageManager &lt;command&gt;'</span><span class="token punctuation">,</span> <span class="token string">'Use specified npm client when installing dependencies'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'-r, --registry &lt;url&gt;'</span><span class="token punctuation">,</span> <span class="token string">'Use specified npm registry when installing dependencies (only for npm)'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'-g, --git [message]'</span><span class="token punctuation">,</span> <span class="token string">'Force git initialization with initial commit message'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'-n, --no-git'</span><span class="token punctuation">,</span> <span class="token string">'Skip git initialization'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'-f, --force'</span><span class="token punctuation">,</span> <span class="token string">'Overwrite target directory if it exists'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'-c, --clone'</span><span class="token punctuation">,</span> <span class="token string">'Use git clone when fetching remote preset'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'-x, --proxy'</span><span class="token punctuation">,</span> <span class="token string">'Use specified proxy when creating project'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'-b, --bare'</span><span class="token punctuation">,</span> <span class="token string">'Scaffold project without beginner instructions'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> cmd</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token function">cleanArgs</span><span class="token punctuation">(</span>cmd<span class="token punctuation">)</span>
    <span class="token comment">// --git makes commander to default git to true</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'-g'</span><span class="token punctuation">)</span> <span class="token operator">||</span> process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'--git'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      options<span class="token punctuation">.</span>forceGit <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
    <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../lib/create'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>一看这么多参数，不要方，一个一个地来解释这些参数：</p> <div class="language-text line-numbers-mode"><pre class="language-text"><code>-p, --preset &lt;presetName&gt;       忽略提示符并使用已保存的或远程的预设选项
-d, --default                   忽略提示符并使用默认预设选项
-i, --inlinePreset &lt;json&gt;       忽略提示符并使用内联的 JSON 字符串预设选项
-m, --packageManager &lt;command&gt;  在安装依赖时使用指定的 npm 客户端
-r, --registry &lt;url&gt;            在安装依赖时使用指定的 npm registry
-g, --git [message]             强制 / 跳过 git 初始化，并可选的指定初始化提交信息
-n, --no-git                    跳过 git 初始化
-f, --force                     覆写目标目录可能存在的配置
-c, --clone                     使用 git clone 获取远程预设选项
-x, --proxy                     使用指定的代理创建项目
-b, --bare                      创建项目时省略默认组件中的新手指导信息
-h, --help                      输出使用帮助信息
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>以上这些解释只是从 <code>vue-cli</code> 官网搬运过来了的，在下一节将整体介绍 <code>vue create</code> 命令主要由哪几部分构成的。</p> <h3 id="整体分析"><a href="#整体分析" class="header-anchor">#</a> 整体分析</h3> <p>先通过一张流程图大致聊了解下 <code>vue create</code> 的过程:</p> <p><img src="/rat-summ/assets/img/create-overall.e905f344.png" alt="img"></p> <p>从这个图可以直观地感受到 <code>vue create</code> 整个过程还是比较复杂的，为了比较清楚的讲解整个过程，大致分为了 5 个部分，如下：</p> <ul><li><strong><a href="">基础验证</a></strong></li> <li><strong><a href="">获取预设选项</a></strong></li> <li><strong><a href="">依赖安装</a></strong></li> <li><strong><a href="">Generator</a></strong></li> <li><strong><a href="">结尾分析</a></strong></li></ul> <p>下面将一节一节的来分析 <code>vue create</code> 的源码。</p> <h3 id="基础验证"><a href="#基础验证" class="header-anchor">#</a> 基础验证</h3> <p>当执行 <code>vue create</code> 命令的时候会加载 <code>cli/lib/create.js</code> 中的 <code>create</code> 函数。在 <code>create</code> 函数里会先定义以下几个变量：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> cwd <span class="token operator">=</span> options<span class="token punctuation">.</span>cwd <span class="token operator">||</span> process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 当前目录</span>
<span class="token keyword">const</span> inCurrent <span class="token operator">=</span> projectName <span class="token operator">===</span> <span class="token string">'.'</span> <span class="token comment">// 是否在当前目录</span>
<span class="token keyword">const</span> name <span class="token operator">=</span> inCurrent <span class="token operator">?</span> path<span class="token punctuation">.</span><span class="token function">relative</span><span class="token punctuation">(</span><span class="token string">'../'</span><span class="token punctuation">,</span> cwd<span class="token punctuation">)</span> <span class="token operator">:</span> projectName <span class="token comment">// 项目名称</span>
<span class="token keyword">const</span> targetDir <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>cwd<span class="token punctuation">,</span> projectName <span class="token operator">||</span> <span class="token string">'.'</span><span class="token punctuation">)</span> <span class="token comment">// 生成项目的目录</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>比较重要的就是 <code>name</code> 和 <code>targetDir</code> 这两个，在下面函数运行过程中会使用到。接下来执行函数 <code>validateProjectName</code> 利用 npm 包 <a href="https://github.com/npm/validate-npm-package-name" target="_blank" rel="noopener noreferrer">validate-npm-package-name<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 判断项目名称是否符合 npm 包名规范，并输出相应的 errors 或者 warnings。</p> <p>在验证包名之后，会判断项目目录是否与当前已有目录重复。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>targetDir<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>force<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> fs<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>targetDir<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token function">clearConsole</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>inCurrent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> ok <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> inquirer<span class="token punctuation">.</span><span class="token function">prompt</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          name<span class="token operator">:</span> <span class="token string">'ok'</span><span class="token punctuation">,</span>
          type<span class="token operator">:</span> <span class="token string">'confirm'</span><span class="token punctuation">,</span>
          message<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Generate project in current directory?</span><span class="token template-punctuation string">`</span></span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ok<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> action <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> inquirer<span class="token punctuation">.</span><span class="token function">prompt</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          name<span class="token operator">:</span> <span class="token string">'action'</span><span class="token punctuation">,</span>
          type<span class="token operator">:</span> <span class="token string">'list'</span><span class="token punctuation">,</span>
          message<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Target directory </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>chalk<span class="token punctuation">.</span><span class="token function">cyan</span><span class="token punctuation">(</span>targetDir<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> already exists. Pick an action:</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
          choices<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'Overwrite'</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token string">'overwrite'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'Merge'</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token string">'merge'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'Cancel'</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>action<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>action <span class="token operator">===</span> <span class="token string">'overwrite'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\nRemoving </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>chalk<span class="token punctuation">.</span><span class="token function">cyan</span><span class="token punctuation">(</span>targetDir<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">...</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
        <span class="token keyword">await</span> fs<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>targetDir<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><p>这段代码比较容易读懂，主要就是当存在相同项目目录的时候调用 <code>inquirer.prompt</code> 来询问是否要 Overwrite || Merge || Cancel。</p> <p>TIP</p> <p>当带有 <code>-f || --force</code> 的时候会跳过这些交互，即 <code>options.force = true</code>。</p> <p>基础验证这快大致就这些，下一个开始分析获取预设选项(preset)。</p> <h3 id="获取预设选项-preset"><a href="#获取预设选项-preset" class="header-anchor">#</a> 获取预设选项(preset)</h3> <p>在开始分析之前简单描述下什么是 <code>vue-cli-preset</code>， <strong>一个 Vue CLI preset 是一个包含创建新项目所需预定义选项和插件的 JSON 对象，让用户无需在命令提示中选择它们:</strong></p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;useConfigFiles&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">&quot;router&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">&quot;vuex&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">&quot;cssPreprocessor&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sass&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;plugins&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;@vue/cli-plugin-babel&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@vue/cli-plugin-eslint&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;config&quot;</span><span class="token operator">:</span> <span class="token string">&quot;airbnb&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;lintOn&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;save&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;commit&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>更多关于 <code>preset</code> 可以前往 <code>vue-cli</code> 官网 <a href="https://cli.vuejs.org/zh/guide/plugins-and-presets.html#%E6%8F%92%E4%BB%B6" target="_blank" rel="noopener noreferrer">插件和 Preset#<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p>在基础验证完成以后会创建一个 <code>Creator</code> 实例:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> creator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Creator</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> targetDir<span class="token punctuation">,</span> <span class="token function">getPromptModules</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="getpromptmodules"><a href="#getpromptmodules" class="header-anchor">#</a> getPromptModules</h4> <p>在分析 <code>Creator</code> 之前先看下 <code>getPromptModules()</code> 获取到的是什么。<code>getPromptModules()</code> 获取了 babel，typescript，pwa，router，vuex， cssPreprocessors，linter，unit，e2e 的 <code>Prompt</code> 的配置信息，以 unit 为例：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token parameter">cli</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  cli<span class="token punctuation">.</span><span class="token function">injectFeature</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'Unit Testing'</span><span class="token punctuation">,</span>
    value<span class="token operator">:</span> <span class="token string">'unit'</span><span class="token punctuation">,</span>
    short<span class="token operator">:</span> <span class="token string">'Unit'</span><span class="token punctuation">,</span>
    description<span class="token operator">:</span> <span class="token string">'Add a Unit Testing solution like Jest or Mocha'</span><span class="token punctuation">,</span>
    link<span class="token operator">:</span> <span class="token string">'https://cli.vuejs.org/config/#unit-testing'</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'unit-jest'</span><span class="token punctuation">,</span> <span class="token string">'unit-mocha'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  cli<span class="token punctuation">.</span><span class="token function">injectPrompt</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'unit'</span><span class="token punctuation">,</span>
    <span class="token function-variable function">when</span><span class="token operator">:</span> <span class="token parameter">answers</span> <span class="token operator">=&gt;</span> answers<span class="token punctuation">.</span>features<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'unit'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    type<span class="token operator">:</span> <span class="token string">'list'</span><span class="token punctuation">,</span>
    message<span class="token operator">:</span> <span class="token string">'Pick a unit testing solution:'</span><span class="token punctuation">,</span>
    choices<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        name<span class="token operator">:</span> <span class="token string">'Mocha + Chai'</span><span class="token punctuation">,</span>
        value<span class="token operator">:</span> <span class="token string">'mocha'</span><span class="token punctuation">,</span>
        short<span class="token operator">:</span> <span class="token string">'Mocha'</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        name<span class="token operator">:</span> <span class="token string">'Jest'</span><span class="token punctuation">,</span>
        value<span class="token operator">:</span> <span class="token string">'jest'</span><span class="token punctuation">,</span>
        short<span class="token operator">:</span> <span class="token string">'Jest'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  cli<span class="token punctuation">.</span><span class="token function">onPromptComplete</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">answers<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>answers<span class="token punctuation">.</span>unit <span class="token operator">===</span> <span class="token string">'mocha'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      options<span class="token punctuation">.</span>plugins<span class="token punctuation">[</span><span class="token string">'@vue/cli-plugin-unit-mocha'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>answers<span class="token punctuation">.</span>unit <span class="token operator">===</span> <span class="token string">'jest'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      options<span class="token punctuation">.</span>plugins<span class="token punctuation">[</span><span class="token string">'@vue/cli-plugin-unit-jest'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><p><strong>cli.injectFeature</strong></p> <p><code>cli.injectFeature</code> 是注入 <code>featurePrompt</code>，即初始化项目时选择 babel，typescript，pwa 等等，如下图：</p> <p><img src="/rat-summ/assets/img/create-img01.8d5f631f.png" alt="img"></p> <p><strong>cli.injectPrompt</strong></p> <p><code>cli.injectPrompt</code> 是根据选择的 <code>featurePrompt</code> 然后注入对应的 <code>prompt</code>，当选择了 unit，接下来会有以下的 <code>prompt</code>，选择 <code>Mocha + Chai</code> 还是 <code>Jest</code>：</p> <p><img src="/rat-summ/assets/img/create-img02.0401ed71.png" alt="img"></p> <p><strong>cli.onPromptComplete</strong></p> <p><code>cli.onPromptComplete</code> 就是一个回调，会根据选择来添加对应的插件， 当选择了 mocha ，那么就会添加 <code>@vue/cli-plugin-unit-mocha</code> 插件。</p> <h4 id="new-creator"><a href="#new-creator" class="header-anchor">#</a> new Creator()</h4> <p>搞清楚了 <code>getPromptModules</code> 之后，下面开始看一下初始化 <code>Creator</code> 实例发生了什么，直接看代码：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> context<span class="token punctuation">,</span> promptModules</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name
    <span class="token keyword">this</span><span class="token punctuation">.</span>context <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VUE_CLI_CONTEXT</span> <span class="token operator">=</span> context
    <span class="token keyword">const</span> <span class="token punctuation">{</span> presetPrompt<span class="token punctuation">,</span> featurePrompt <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resolveIntroPrompts</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 获取了 presetPrompt list，在初始化项目的时候提供选择</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>presetPrompt <span class="token operator">=</span> presetPrompt <span class="token comment">// presetPrompt list</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>featurePrompt <span class="token operator">=</span> featurePrompt <span class="token comment">// babal, pwa, e2e etc.</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>outroPrompts <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resolveOutroPrompts</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//  存放项目配置的文件（package.json || congfig.js） 以及是否将 presetPrompts 存放起来</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>injectedPrompts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// 对应 feature 的 Prompts</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>promptCompleteCbs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// injectedPrompts 的回调</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>createCompleteCbs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>run <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>

    <span class="token keyword">const</span> promptAPI <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PromptModuleAPI</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>

    <span class="token comment">/**
     * 1. 将 babel, e2e, pwa 等 push 到 featurePrompt.choices 中，在选择项目需要配置哪些时显示出来 （checkbox）；
     * 2. 将 babel, e2e, pwa 等 push 到 injectedPrompts 中，当设置了 feature 会对应通过 Prompts 来进一步选择哪种模式，比如当选择了 E2E Testing ，然后会再次让你
     *    选择哪种 E2E Testing，即， Cypress (Chrome only) ||  Nightwatch (Selenium-based)；
     * 3. 将每中 feature 的 onPromptComplete push 到 promptCompleteCbs，在后面会根据选择的配置来安装对应的 plugin。
     */</span>
    promptModules<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">m</span> <span class="token operator">=&gt;</span> <span class="token function">m</span><span class="token punctuation">(</span>promptAPI<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>这段代码主要看下 <code>PromptModuleAPI</code>，源码如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token class-name">PromptModuleAPI</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token parameter">creator</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>creator <span class="token operator">=</span> creator
  <span class="token punctuation">}</span>

  <span class="token function">injectFeature</span> <span class="token punctuation">(</span><span class="token parameter">feature</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>creator<span class="token punctuation">.</span>featurePrompt<span class="token punctuation">.</span>choices<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>feature<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">injectPrompt</span> <span class="token punctuation">(</span><span class="token parameter">prompt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>creator<span class="token punctuation">.</span>injectedPrompts<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>prompt<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">injectOptionForPrompt</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> option</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>creator<span class="token punctuation">.</span>injectedPrompts<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">f</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> f<span class="token punctuation">.</span>name <span class="token operator">===</span> name
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>choices<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>option<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">onPromptComplete</span> <span class="token punctuation">(</span><span class="token parameter">cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>creator<span class="token punctuation">.</span>promptCompleteCbs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p><code>PromptModuleAPI</code> 实例会调用它的实例方法，然后将 <code>injectFeature</code>， <code>injectPrompt</code>， <code>injectOptionForPrompt</code>， <code>onPromptComplete</code>保存到 <code>Creator</code>实例对应的变量中。</p> <p>最后遍历 <code>getPromptModules</code> 获取的 <code>promptModules</code>，传入实例 <code>promptAPI</code>，初始化 <code>Creator</code> 实例中 <code>featurePrompt</code>, <code>injectedPrompts</code>, <code>promptCompleteCbs</code> 变量。</p> <h4 id="getpreset"><a href="#getpreset" class="header-anchor">#</a> getPreset</h4> <p>在创建一个 Creator 实例后，然后调用了 create 方法</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">await</span> creator<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>create 开始是获取 preset ，源码如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> isTestOrDebug <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VUE_CLI_TEST</span> <span class="token operator">||</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VUE_CLI_DEBUG</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'before creating......'</span><span class="token punctuation">)</span>
<span class="token comment">// name: demo</span>
<span class="token comment">// context: targetDir</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> run<span class="token punctuation">,</span> name<span class="token punctuation">,</span> context<span class="token punctuation">,</span> createCompleteCbs <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>preset<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>cliOptions<span class="token punctuation">.</span>preset<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// vue create foo --preset bar</span>
    preset <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resolvePreset</span><span class="token punctuation">(</span>cliOptions<span class="token punctuation">.</span>preset<span class="token punctuation">,</span> cliOptions<span class="token punctuation">.</span>clone<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>cliOptions<span class="token punctuation">.</span>default<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// vue create foo --default</span>
    preset <span class="token operator">=</span> defaults<span class="token punctuation">.</span>presets<span class="token punctuation">.</span>default <span class="token comment">// 使用默认预设选项</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>cliOptions<span class="token punctuation">.</span>inlinePreset<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 使用内联的 JSON 字符串预设选项</span>
    <span class="token comment">// vue create foo --inlinePreset {...}</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      preset <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>cliOptions<span class="token punctuation">.</span>inlinePreset<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">CLI inline preset is not valid JSON: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>cliOptions<span class="token punctuation">.</span>inlinePreset<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
      <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// eg: vue create demo</span>
    preset <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">promptAndResolvePreset</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// clone before mutating</span>
preset <span class="token operator">=</span> <span class="token function">cloneDeep</span><span class="token punctuation">(</span>preset<span class="token punctuation">)</span>
<span class="token comment">// inject core service</span>
preset<span class="token punctuation">.</span>plugins<span class="token punctuation">[</span><span class="token string">'@vue/cli-service'</span><span class="token punctuation">]</span> <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token comment">// 注入核心 @vue/cli-service</span>
  projectName<span class="token operator">:</span> name
<span class="token punctuation">}</span><span class="token punctuation">,</span> preset<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  bare<span class="token operator">:</span> cliOptions<span class="token punctuation">.</span>bare
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p>先判断 <code>vue create</code> 命令是否带有 -p 选项，如果有的话会调用 <code>resolvePreset</code> 去解析 preset。<code>resolvePreset</code> 函数会先获取 ～/.vuerc 中保存的 preset， 然后进行遍历，如果里面包含了 -p 中的 <code>&lt;presetName&gt;</code>，则返回～/.vuerc 中的 preset。如果没有则判断是否是采用内联的 JSON 字符串预设选项，如果是就会解析 .json 文件，并返回 preset，还有一种情况就是从远程获取 preset（利用 <code>download-git-repo</code> 下载远程的 preset.json）并返回。</p> <p>上面的情况是当 <code>vue create</code> 命令带有 -p 选项的时候才会执行，如果没有就会调用 promptAndResolvePreset 函数利用 inquirer.prompt 以命令后交互的形式来获取 preset，下面看下 promptAndResolvePreset 函数的源码：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token function">promptAndResolvePreset</span> <span class="token punctuation">(</span><span class="token parameter">answers <span class="token operator">=</span> <span class="token keyword">null</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// prompt</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>answers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token function">clearConsole</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    answers <span class="token operator">=</span> <span class="token keyword">await</span> inquirer<span class="token punctuation">.</span><span class="token function">prompt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resolveFinalPrompts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">'vue-cli:answers'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>answers<span class="token punctuation">)</span>
  
  <span class="token keyword">if</span> <span class="token punctuation">(</span>answers<span class="token punctuation">.</span>packageManager<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">saveOptions</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      packageManager<span class="token operator">:</span> answers<span class="token punctuation">.</span>packageManager
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">let</span> preset
  <span class="token keyword">if</span> <span class="token punctuation">(</span>answers<span class="token punctuation">.</span>preset <span class="token operator">&amp;&amp;</span> answers<span class="token punctuation">.</span>preset <span class="token operator">!==</span> <span class="token string">'__manual__'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 如果是选择使用本地保存的 preset (~/.vuerc)</span>
    preset <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resolvePreset</span><span class="token punctuation">(</span>answers<span class="token punctuation">.</span>preset<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// manual</span>
    preset <span class="token operator">=</span> <span class="token punctuation">{</span>
      useConfigFiles<span class="token operator">:</span> answers<span class="token punctuation">.</span>useConfigFiles <span class="token operator">===</span> <span class="token string">'files'</span><span class="token punctuation">,</span>
      plugins<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    answers<span class="token punctuation">.</span>features <span class="token operator">=</span> answers<span class="token punctuation">.</span>features <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token comment">// run cb registered by prompt modules to finalize the preset</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>promptCompleteCbs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">cb</span> <span class="token operator">=&gt;</span> <span class="token function">cb</span><span class="token punctuation">(</span>answers<span class="token punctuation">,</span> preset<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// validate</span>
  <span class="token function">validatePreset</span><span class="token punctuation">(</span>preset<span class="token punctuation">)</span>
  
  <span class="token comment">// save preset</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>answers<span class="token punctuation">.</span>save <span class="token operator">&amp;&amp;</span> answers<span class="token punctuation">.</span>saveName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">savePreset</span><span class="token punctuation">(</span>answers<span class="token punctuation">.</span>saveName<span class="token punctuation">,</span> preset<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  
  <span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">'vue-cli:preset'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>preset<span class="token punctuation">)</span>
  <span class="token keyword">return</span> preset
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><p>在调用 <code>inquirer.prompt</code> 之前利用 <code>this.resolveFinalPrompts()</code> 获取了最后的 prompts，到这里有些同学可能就有点晕了，到底有多少个 prompt，别急，下面将 简单介绍下，查看 <code>this.resolveFinalPrompts()</code> 源码：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">resolveFinalPrompts</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// patch generator-injected prompts to only show in manual mode</span>
  <span class="token comment">// 将所有的 Prompt 合并，包含 preset，feature，injected，outro，只有当选择了手动模式的时候才会显示 injectedPrompts</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>injectedPrompts<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">prompt</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> originalWhen <span class="token operator">=</span> prompt<span class="token punctuation">.</span>when <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    prompt<span class="token punctuation">.</span><span class="token function-variable function">when</span> <span class="token operator">=</span> <span class="token parameter">answers</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">isManualMode</span><span class="token punctuation">(</span>answers<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">originalWhen</span><span class="token punctuation">(</span>answers<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> prompts <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>presetPrompt<span class="token punctuation">,</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>featurePrompt<span class="token punctuation">,</span>
    <span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>injectedPrompts<span class="token punctuation">,</span>
    <span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>outroPrompts
  <span class="token punctuation">]</span>
  <span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">'vue-cli:prompts'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>prompts<span class="token punctuation">)</span>
  <span class="token keyword">return</span> prompts
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>比较容易的就可以看出作用就是将 presetPrompt， featurePrompt， injectedPrompts， outroPrompts 合并成一个数组进行返回，这几个 Prompt 的含义如下：</p> <ul><li><p><strong>presetPrompt</strong>： 预设选项 prompt，当上次以 Manually 模式进行了预设选项，并且保存到了 ~/.vuerc 中，那么在初始化项目时就会列出已经保存的 preset，并提供选择。</p></li> <li><p><strong>featurePrompt</strong>：项目的一些 feature，就是选择 babel，typescript，pwa，router，vuex，cssPreprocessors，linter，unit，e2e。</p></li> <li><p><strong>injectedPrompts</strong>：当选择了 feature 后，就会为对应的 feature 注入 prompts，比如你选择了 unit，那么就会让你选择模式： <code>Mocha + Chai</code> 还是 <code>Jest</code></p></li> <li><p>outroPrompts</p> <p>： 其他的 prompt，包含：</p> <ul><li>将 Babel, PostCSS, ESLint 等等的配置文件存放在 package.json 中还是存放在 config 文件中；</li> <li>是否需要将这次设置的 preset 保存到本地，如果需要则会进一步让你输入名称进行保存；</li> <li>安装依赖是选择 npm 还是 yarn。</li></ul></li></ul> <p><code>inquirer.prompt</code> 执行完成后会返回 answers，如果选择了本地保存的 preset 或者 default，则调用 <code>resolvePreset</code> 进行解析 preset，否则遍历 <code>promptCompleteCbs</code> 执行 injectFeature 和 injectPrompt 的回调，将对应的插件赋值到 <code>options.plugins</code> 中，以 unit 为例：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>cli<span class="token punctuation">.</span><span class="token function">onPromptComplete</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">answers<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>answers<span class="token punctuation">.</span>unit <span class="token operator">===</span> <span class="token string">'mocha'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    options<span class="token punctuation">.</span>plugins<span class="token punctuation">[</span><span class="token string">'@vue/cli-plugin-unit-mocha'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>answers<span class="token punctuation">.</span>unit <span class="token operator">===</span> <span class="token string">'jest'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    options<span class="token punctuation">.</span>plugins<span class="token punctuation">[</span><span class="token string">'@vue/cli-plugin-unit-jest'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>如果 feature 选择了 unit，并且 unit 模式选择的是 Mocha + Chai，则添加 <code>@vue/cli-plugin-unit-mocha</code> 插件，如果选择的是 Jest 则添加 <code>@vue/cli-plugin-unit-jest</code> 插件。</p> <p>在获取到 preset 之后，还会向 preset 的插件里面注入核心插件 <code>@vue/cli-service</code>， 它是调用 <code>vue-cli-service &lt;command&gt; [...args]</code> 时创建的类。 负责管理内部的 webpack 配置、暴露服务和构建项目的命令等。</p> <p>到这里获取预设选项（preset）大致分析完了，在下节将会分析依赖的安装。</p> <h3 id="依赖安装-installdeps"><a href="#依赖安装-installdeps" class="header-anchor">#</a> 依赖安装(installDeps)</h3> <p>在上节中我们分析了获取 <code>preset</code> ，通过 <code>preset</code> 我们可以知道每个 <code>feature</code> 的配置以及整个项目所需的一些插件，接下来我们继续看源码。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> packageManager <span class="token operator">=</span> <span class="token punctuation">(</span>
  cliOptions<span class="token punctuation">.</span>packageManager <span class="token operator">||</span>
  <span class="token function">loadOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>packageManager <span class="token operator">||</span>
  <span class="token punctuation">(</span><span class="token function">hasYarn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">'yarn'</span> <span class="token operator">:</span> <span class="token string">'npm'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>

<span class="token keyword">await</span> <span class="token function">clearConsole</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 清空控制台</span>
<span class="token function">logWithSpinner</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">✨</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Creating project in </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>chalk<span class="token punctuation">.</span><span class="token function">yellow</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'creation'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> event<span class="token operator">:</span> <span class="token string">'creating'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// get latest CLI version</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> latest <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getVersions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// generate package.json with plugin dependencies</span>
<span class="token keyword">const</span> pkg <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">,</span>
  version<span class="token operator">:</span> <span class="token string">'0.1.0'</span><span class="token punctuation">,</span>
  <span class="token keyword">private</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  devDependencies<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> deps <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>preset<span class="token punctuation">.</span>plugins<span class="token punctuation">)</span>
deps<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">dep</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>preset<span class="token punctuation">.</span>plugins<span class="token punctuation">[</span>dep<span class="token punctuation">]</span><span class="token punctuation">.</span>_isPreset<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
  pkg<span class="token punctuation">.</span>devDependencies<span class="token punctuation">[</span>dep<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>
    preset<span class="token punctuation">.</span>plugins<span class="token punctuation">[</span>dep<span class="token punctuation">]</span><span class="token punctuation">.</span>version <span class="token operator">||</span>
    <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^@vue</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>dep<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> latest<span class="token punctuation">[</span>dep<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">^</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>latest<span class="token punctuation">[</span>dep<span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">latest</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// write package.json</span>
<span class="token keyword">await</span> <span class="token function">writeFileTree</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token string">'package.json'</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>pkg<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p>这段代码主要有两个作用：<strong>获取最新 CLI （包含插件）的版本</strong> 和 <strong>生成 package.json</strong>，接下来一个一个地看。</p> <h4 id="getversions"><a href="#getversions" class="header-anchor">#</a> getVersions</h4> <p>getVersions 的代码不多，看下比较核心的代码：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getVersions</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>sessionCached<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> sessionCached
  <span class="token punctuation">}</span>

  <span class="token keyword">let</span> latest
  <span class="token keyword">const</span> local <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'vue-cli-version-marker'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>devDependencies
  <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VUE_CLI_TEST</span> <span class="token operator">||</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VUE_CLI_DEBUG</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>sessionCached <span class="token operator">=</span> <span class="token punctuation">{</span>
      current<span class="token operator">:</span> local<span class="token punctuation">,</span>
      latest<span class="token operator">:</span> local
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>fsCachePath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// if the cache file doesn't exist, this is likely a fresh install</span>
    <span class="token comment">// then create a cache file with the bundled version map</span>
    <span class="token keyword">await</span> fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span>fsCachePath<span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>local<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> cached <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token keyword">await</span> fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>fsCachePath<span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> lastChecked <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">await</span> fs<span class="token punctuation">.</span><span class="token function">stat</span><span class="token punctuation">(</span>fsCachePath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mtimeMs
  <span class="token keyword">const</span> daysPassed <span class="token operator">=</span> <span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> lastChecked<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">1000</span> <span class="token operator">*</span> <span class="token number">24</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>daysPassed <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 距离上次检查更新超过一天</span>
    <span class="token comment">// if we haven't check for a new version in a day, wait for the check</span>
    <span class="token comment">// before proceeding</span>
    latest <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getAndCacheLatestVersions</span><span class="token punctuation">(</span>cached<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// Otherwise, do a check in the background. If the result was updated,</span>
    <span class="token comment">// it will be used for the next 24 hours.</span>
    <span class="token function">getAndCacheLatestVersions</span><span class="token punctuation">(</span>cached<span class="token punctuation">)</span> <span class="token comment">// 后台更新</span>
    latest <span class="token operator">=</span> cached
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>sessionCached <span class="token operator">=</span> <span class="token punctuation">{</span>
    current<span class="token operator">:</span> local<span class="token punctuation">,</span>
    latest
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><p>这段代码按顺序读下应该就知道其中的作用了，简单说下就注意两个变量：</p> <ul><li>local：本地 CLI 以及插件的版本</li> <li>latest：远程 CLI 以及插件的版本</li></ul> <p>local 和 latest 包含了 CLI 以及相关插件的版本，它们可以用于判断 @vue/cli 是否需要更新以及初始化项目中相关插件的版本。还有点需要注意的是，获取 CLI 的版本并不是直接获取， 而是通过 <a href="https://github.com/vuejs/vue-cli/blob/dev/packages/vue-cli-version-marker/package.json" target="_blank" rel="noopener noreferrer">vue-cli-version-marker<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> npm 包获取的 CLI 版本，为什么会这样做，主要原因有两点：</p> <ul><li><ol><li>vue-cli 从 3.0（@vue/cli） 开始就放在了 @vue 下面，即是一个 scoped package, 而 scoped package 又不支持通过 <code>npm registry</code> 来获取 latest 版本信息。比如 <a href="https://registry.npmjs.org/vue-cli-version-marker/latest" target="_blank" rel="noopener noreferrer">vue-cli-version-marker/latest<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>可以正常访问，而 <a href="https://registry.npmjs.org/@vue/cli/latest" target="_blank" rel="noopener noreferrer">@vue/cli/latest<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 则不可以。</li></ol></li> <li><ol><li>获取 scoped packages 的数据比获取 unscoped package 通常要慢 300ms。</li></ol></li></ul> <p>正是由于上述两个原因，因此通过 unscoped package <code>vue-cli-version-marker</code> 来获取 CLI 版本，<code>vue-cli-version-marker</code> 的内容比较简单，就是一个 package.json，通过获取里面 devDependencies 的版本信息，从而获取 @vue/cli 以及一些插件的版本号。获取了插件版本之后遍历 preset 中所有 plugin 为其初始化版本号，并调用 <code>writeFileTree</code> 生成 package.json 。</p> <h4 id="installdeps"><a href="#installdeps" class="header-anchor">#</a> installDeps</h4> <p>在生成 package.json 之后，我们再继续看下面的代码：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// intilaize git repository before installing deps</span>
<span class="token comment">// so that vue-cli-service can setup git hooks.</span>
<span class="token keyword">const</span> shouldInitGit <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">shouldInitGit</span><span class="token punctuation">(</span>cliOptions<span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>shouldInitGit<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">logWithSpinner</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">🗃</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Initializing git repository...</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'creation'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> event<span class="token operator">:</span> <span class="token string">'git-init'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">await</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token string">'git init'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// install plugins</span>
<span class="token function">stopSpinner</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">⚙  Installing CLI plugins. This might take a while...</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'creation'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> event<span class="token operator">:</span> <span class="token string">'plugins-install'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>isTestOrDebug<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// in development, avoid installation process</span>
  <span class="token keyword">await</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./util/setupDevProject'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token comment">// @vue/cli-service/bin/vue-cli-service</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> <span class="token function">installDeps</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> packageManager<span class="token punctuation">,</span> cliOptions<span class="token punctuation">.</span>registry<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>这段代码会先调用 shouldInitGit 来判断是否需要 git 初始化，判断的情形有以下几种：</p> <ul><li>没有安装 git (<code>!hasGit()</code>)：false；</li> <li>vue create 含有 --git 或者 -g 选项：true；</li> <li>vue create 含有 --no-git 或者 -n 选项：false；</li> <li>生成项目的目录是否已经含有 git （<code>!hasProjectGit(this.context)</code>）：如果有，则返回 false，否则返回 true。</li></ul> <p>在判断完是否需要 git 初始化项目后，接下来就会调用 installDeps 安装依赖，还是看下 installDeps 的源码：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>exports<span class="token punctuation">.</span><span class="token function-variable function">installDeps</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">installDeps</span> <span class="token punctuation">(</span><span class="token parameter">targetDir<span class="token punctuation">,</span> command<span class="token punctuation">,</span> cliRegistry</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> args <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>command <span class="token operator">===</span> <span class="token string">'npm'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    args<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'install'</span><span class="token punctuation">,</span> <span class="token string">'--loglevel'</span><span class="token punctuation">,</span> <span class="token string">'error'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>command <span class="token operator">===</span> <span class="token string">'yarn'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// do nothing</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Unknown package manager: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>command<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">await</span> <span class="token function">addRegistryToArgs</span><span class="token punctuation">(</span>command<span class="token punctuation">,</span> args<span class="token punctuation">,</span> cliRegistry<span class="token punctuation">)</span>

  <span class="token function">debug</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">command: </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> command<span class="token punctuation">)</span> <span class="token comment">// DEBUG=vue-cli:install vue create demo</span>
  <span class="token function">debug</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">args: </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> args<span class="token punctuation">)</span>

  <span class="token keyword">await</span> <span class="token function">executeCommand</span><span class="token punctuation">(</span>command<span class="token punctuation">,</span> args<span class="token punctuation">,</span> targetDir<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>源码很简洁，里面又先调用了 <code>addRegistryToArgs</code> 函数，它的作用就是安装依赖是指定安装源，如果 <code>vue create</code> 还有 -r 选项则采用设置的安装源，否则调用 <code>shouldUseTaobao</code> 函数来判断是否需要使用淘宝 NPM 镜像源。实现原理就是发送两个 Promise 使用默认安装源和淘宝镜像源去请求同一个 npm 包，然后利用 <code>Promise.race</code> 看在哪种源下返回结果更快就将此 设置为安装源，另外如果 ~/.vuerc 中设置了<code>useTaobaoRegistry</code>，则使用设置的安装源。设置了安装源之后则调用 <code>executeCommand</code> 函数利用 execa 执行 npm 或者 yarn 安装命令。</p> <p>到这里安装依赖就大致介绍完了，在下面一节将介绍 <code>vue create</code> 核心部分 <code>Generator</code>。</p> <h3 id="generator"><a href="#generator" class="header-anchor">#</a> Generator</h3> <p>在安装完依赖以后，就会调用 <code>resolvePlugins</code>，作用就是加载每个插件的 <code>generator</code> ，并且如果插件需要进行命令行交互的话会执行 <code>inquirer.prompt</code> 获取 option。 在此之后会实例化一个 <code>Generator</code> ，看代码：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> generator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Generator</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  pkg<span class="token punctuation">,</span>
  plugins<span class="token punctuation">,</span>
  completeCbs<span class="token operator">:</span> createCompleteCbs
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>在实例化一个 <code>Generator</code> 的时候会初始化一些成员变量，最重要的就是调用插件的 <code>generators</code>，不同于 1.x/2.x 基于模板的脚手架，Vue-cli3.0 采用了一套 基于插件的架构，到这里就会交给各个插件去执行了，看一下 <code>Generator</code> 实例化的代码：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token class-name">Generator</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    pkg <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    plugins <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    completeCbs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    files <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    invoking <span class="token operator">=</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>context <span class="token operator">=</span> context
    <span class="token keyword">this</span><span class="token punctuation">.</span>plugins <span class="token operator">=</span> plugins
    <span class="token keyword">this</span><span class="token punctuation">.</span>originalPkg <span class="token operator">=</span> pkg
    <span class="token keyword">this</span><span class="token punctuation">.</span>pkg <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> pkg<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>imports <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>rootOptions <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>completeCbs <span class="token operator">=</span> completeCbs
    <span class="token keyword">this</span><span class="token punctuation">.</span>configTransforms <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 插件通过 GeneratorAPI 暴露的 addConfigTransform 方法添加如何提取配置文件</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>defaultConfigTransforms <span class="token operator">=</span> defaultConfigTransforms <span class="token comment">// 默认的配置文件</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>reservedConfigTransforms <span class="token operator">=</span> reservedConfigTransforms <span class="token comment">// 保留的配置文件 vue.config.js</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>invoking <span class="token operator">=</span> invoking
    <span class="token comment">// for conflict resolution</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>depSources <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token comment">// virtual file tree</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>files <span class="token operator">=</span> files
    <span class="token keyword">this</span><span class="token punctuation">.</span>fileMiddlewares <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// receives the virtual files tree object, and an ejs render function</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>postProcessFilesCbs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token comment">// exit messages</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>exitLogs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

    <span class="token keyword">const</span> cliService <span class="token operator">=</span> plugins<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">p</span> <span class="token operator">=&gt;</span> p<span class="token punctuation">.</span>id <span class="token operator">===</span> <span class="token string">'@vue/cli-service'</span><span class="token punctuation">)</span>

    <span class="token keyword">const</span> rootOptions <span class="token operator">=</span> cliService
      <span class="token operator">?</span> cliService<span class="token punctuation">.</span>options
      <span class="token operator">:</span> <span class="token function">inferRootOptions</span><span class="token punctuation">(</span>pkg<span class="token punctuation">)</span>
    <span class="token comment">// apply generators from plugins</span>
    <span class="token comment">// 调用插件的 generators</span>
    plugins<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> id<span class="token punctuation">,</span> apply<span class="token punctuation">,</span> options <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 每个插件对应生成一个 GeneratorAPI 实例，并将实例 api 传入插件暴露出来的 generator 函数</span>
      <span class="token keyword">const</span> api <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GeneratorAPI</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> options<span class="token punctuation">,</span> rootOptions<span class="token punctuation">)</span>
      <span class="token function">apply</span><span class="token punctuation">(</span>api<span class="token punctuation">,</span> options<span class="token punctuation">,</span> rootOptions<span class="token punctuation">,</span> invoking<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><p>接下来看一下 GeneratorAPI。</p> <h4 id="generatorapi"><a href="#generatorapi" class="header-anchor">#</a> GeneratorAPI</h4> <p><code>GeneratorAPI</code> 是一个比较重要的部分了，前面说过 vue-cli 3.0 是基于一套插件架构的，那么如果插件需要自定义项目模板、修改模板中的一些文件或者添加一些依赖 的话怎么处理呢。方法是 @vue/cli 插件所提供的 generator 向外暴露一个函数，接收的第一个参数 api，然后通过该 api 提供的方法去完成应用的拓展工作，这里所说 的 api 就是 <code>GeneratorAPI</code>，下面看一下 <code>GeneratorAPI</code> 提供了哪些方法。</p> <ul><li><strong>hasPlugin</strong>：判断项目中是否有某个插件</li> <li><strong>extendPackage</strong>：拓展 package.json 配置</li> <li><strong>render</strong>：利用 ejs 渲染模板文件</li> <li><strong>onCreateComplete</strong>：内存中保存的文件字符串全部被写入文件后的回调函数</li> <li><strong>exitLog</strong>：当 generator 退出的时候输出的信息</li> <li><strong>genJSConfig</strong>：将 json 文件生成为 js 配置文件</li> <li><strong>injectImports</strong>：向文件当中注入import语法的方法</li> <li><strong>injectRootOptions</strong>：向 Vue 根实例中添加选项</li> <li>...</li></ul> <p>下面就以 <code>@vue/cli-service</code> 为例，来简单熟悉下 <code>GeneratorAPI</code>。首先看一下 <code>@vue/cli-service/generator/index.js</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">api<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">/* 渲染 ejs 模板 */</span>
  api<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'./template'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    doesCompile<span class="token operator">:</span> api<span class="token punctuation">.</span><span class="token function">hasPlugin</span><span class="token punctuation">(</span><span class="token string">'babel'</span><span class="token punctuation">)</span> <span class="token operator">||</span> api<span class="token punctuation">.</span><span class="token function">hasPlugin</span><span class="token punctuation">(</span><span class="token string">'typescript'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  
  <span class="token comment">// 扩展 package.json</span>
  api<span class="token punctuation">.</span><span class="token function">extendPackage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    scripts<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">'serve'</span><span class="token operator">:</span> <span class="token string">'vue-cli-service serve'</span><span class="token punctuation">,</span>
      <span class="token string">'build'</span><span class="token operator">:</span> <span class="token string">'vue-cli-service build'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    dependencies<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">'vue'</span><span class="token operator">:</span> <span class="token string">'^2.5.17'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    devDependencies<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">'vue-template-compiler'</span><span class="token operator">:</span> <span class="token string">'^2.5.17'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">'postcss'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">'plugins'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">'autoprefixer'</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    browserslist<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">'&gt; 1%'</span><span class="token punctuation">,</span>
      <span class="token string">'last 2 versions'</span><span class="token punctuation">,</span>
      <span class="token string">'not ie &lt;= 8'</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">// 如果 preset 中包含 vue-router</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>router<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./router'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>api<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// 如果 preset 中包含 vuex</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>vuex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./vuex'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>api<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// 如果 preset 中包含 cssPreprocessor，即选择了 css 预处理器</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>cssPreprocessor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> deps <span class="token operator">=</span> <span class="token punctuation">{</span>
      sass<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">'node-sass'</span><span class="token operator">:</span> <span class="token string">'^4.9.0'</span><span class="token punctuation">,</span>
        <span class="token string">'sass-loader'</span><span class="token operator">:</span> <span class="token string">'^7.0.1'</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      less<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">'less'</span><span class="token operator">:</span> <span class="token string">'^3.0.4'</span><span class="token punctuation">,</span>
        <span class="token string">'less-loader'</span><span class="token operator">:</span> <span class="token string">'^4.1.0'</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      stylus<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">'stylus'</span><span class="token operator">:</span> <span class="token string">'^0.54.5'</span><span class="token punctuation">,</span>
        <span class="token string">'stylus-loader'</span><span class="token operator">:</span> <span class="token string">'^3.0.2'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    api<span class="token punctuation">.</span><span class="token function">extendPackage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      devDependencies<span class="token operator">:</span> deps<span class="token punctuation">[</span>options<span class="token punctuation">.</span>cssPreprocessor<span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// additional tooling configurations</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>configs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    api<span class="token punctuation">.</span><span class="token function">extendPackage</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>configs<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br></div></div><p>看一下 <code>@vue/cli-service</code> generator 代码，然后结合 <code>GeneratorAPI</code> 所暴露的方法，自己再感悟下，大概就可以明白插件利用 GeneratorAPI 暴露的方法 做了一些什么事情，也可以初步感受到 vue-cli 3.0 的插件机制，将所有功能都交给插件去完成。对于 vue-cli 3.0 内置的插件，比如：<code>@vue/cli-plugin-eslint</code> 、<code>@vue/cli-plugin-pwa</code> 等等，以及其他第三方插件，他们的 <code>generator</code> 作用都是一样都可以向项目的 <code>package.json</code> 中注入额外的依赖或字段，并向项目中添加文件。</p> <p>在实例化 Generator 之后，就会调用实例的 generate 放在，此时就差不多进入到了生成项目文件的阶段了。大致可以分为三部分，extractConfigFiles（提取配置文件）， resolveFiles（模板渲染）和 writeFileTree（在磁盘上生成文件）。</p> <h4 id="extractconfigfiles"><a href="#extractconfigfiles" class="header-anchor">#</a> extractConfigFiles</h4> <p>提取配置文件指的是将一些插件（比如 eslint，babel）的配置从 <code>package.json</code> 的字段中提取到专属的配置文件中。下面以 eslint 为例进行分析： 在初始化项目的时候，如果选择了 eslint 插件，在调用 <code>@vue/cli-plugin-eslint</code> 的 generator 的时候，就会向 <code>package.json</code> 注入 eslintConfig 字段：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">api<span class="token punctuation">,</span> <span class="token punctuation">{</span> config<span class="token punctuation">,</span> lintOn <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> _<span class="token punctuation">,</span> invoking</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> lintOn <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    lintOn <span class="token operator">=</span> lintOn<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> eslintConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../eslintOptions'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span>api<span class="token punctuation">)</span>

  <span class="token keyword">const</span> pkg <span class="token operator">=</span> <span class="token punctuation">{</span>
    scripts<span class="token operator">:</span> <span class="token punctuation">{</span>
      lint<span class="token operator">:</span> <span class="token string">'vue-cli-service lint'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    eslintConfig<span class="token punctuation">,</span>
    <span class="token comment">// TODO:</span>
    <span class="token comment">// Move these dependencies to package.json in v4.</span>
    <span class="token comment">// Now in v3 we have to add redundant eslint related dependencies</span>
    <span class="token comment">// in order to keep compatibility with v3.0.x users who defaults to ESlint v4.</span>
    devDependencies<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">'babel-eslint'</span><span class="token operator">:</span> <span class="token string">'^10.0.1'</span><span class="token punctuation">,</span>
      <span class="token string">'eslint'</span><span class="token operator">:</span> <span class="token string">'^5.8.0'</span><span class="token punctuation">,</span>
      <span class="token string">'esliint-plugin-vue'</span><span class="token operator">:</span> <span class="token string">'^5.0.0-0'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> <span class="token function-variable function">injectEditorConfig</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> filePath <span class="token operator">=</span> api<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'.editorconfig'</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Append to existing .editorconfig</span>
      api<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">files</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> configPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./template/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>config<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/_editorconfig</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
        <span class="token keyword">const</span> editorconfig <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>configPath<span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span>

        files<span class="token punctuation">[</span><span class="token string">'.editorconfig'</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\n</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>editorconfig<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      api<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./template/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>config<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>config <span class="token operator">===</span> <span class="token string">'airbnb'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    eslintConfig<span class="token punctuation">.</span>extends<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'@vue/airbnb'</span><span class="token punctuation">)</span>
    Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>pkg<span class="token punctuation">.</span>devDependencies<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token string">'@vue/eslint-config-airbnb'</span><span class="token operator">:</span> <span class="token string">'^4.0.0'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token function">injectEditorConfig</span><span class="token punctuation">(</span><span class="token string">'airbnb'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>config <span class="token operator">===</span> <span class="token string">'standard'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    eslintConfig<span class="token punctuation">.</span>extends<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'@vue/standard'</span><span class="token punctuation">)</span>
    Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>pkg<span class="token punctuation">.</span>devDependencies<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token string">'@vue/eslint-config-standard'</span><span class="token operator">:</span> <span class="token string">'^4.0.0'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token function">injectEditorConfig</span><span class="token punctuation">(</span><span class="token string">'standard'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>config <span class="token operator">===</span> <span class="token string">'prettier'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    eslintConfig<span class="token punctuation">.</span>extends<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'@vue/prettier'</span><span class="token punctuation">)</span>
    Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>pkg<span class="token punctuation">.</span>devDependencies<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token string">'@vue/eslint-config-prettier'</span><span class="token operator">:</span> <span class="token string">'^4.0.0'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// prettier &amp; default config do not have any style rules</span>
    <span class="token comment">// so no need to generate an editorconfig file</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// default</span>
    eslintConfig<span class="token punctuation">.</span>extends<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'eslint:recommended'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  api<span class="token punctuation">.</span><span class="token function">extendPackage</span><span class="token punctuation">(</span>pkg<span class="token punctuation">)</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br></div></div><p>这是 <code>@vue/cli-plugin-eslint/generator/index.js</code> 中的一部分代码，从代码中可以看出，利用 <code>GeneratorAPI</code> 的 <code>extendPackage</code> 方法向 <code>package.josn</code> 里面注入了 scripts，eslintConfig 以及 devDependencies 字段，另外也会根据选择的 eslint 模式添加对应的依赖和修改对应的配置文件，例如选择了 airbnb 模式，就会向 <code>eslintConfig.extends</code> 添加 <code>@vue/airbnb</code> 配置，并且添加 <code>@vue/eslint-config-airbnb</code> 依赖和修改 <code>.editorconfig</code> 配置文件。此时 项目 <code>package.json</code> 中 <code>eslintConfig</code> 字段内容如下：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
<span class="token property">&quot;eslintConfig&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;root&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">&quot;env&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;node&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;extends&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;plugin:vue/essential&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;@vue/airbnb&quot;</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;rules&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;parserOptions&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;parser&quot;</span><span class="token operator">:</span> <span class="token string">&quot;babel-eslint&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>如果 preset 的 <code>useConfigFiles</code> 为 true ，或者以 Manually 模式初始化 preset 的时候选择 In dedicated config files 存放配置文件:</p> <p><img src="/rat-summ/assets/img/create-img03.3221c4cc.png" alt="img"></p> <p>那么 <code>extractConfigFiles</code> 方法就会将 <code>package.json</code> 中 eslintConfig 字段内容提取到 <code>.eslintrc.js</code> 文件中，内存中 <code>.eslintrc.js</code> 内容如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  root<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  env<span class="token operator">:</span> <span class="token punctuation">{</span>
    node<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token keyword">extends</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">'plugin:vue/essential'</span><span class="token punctuation">,</span>
    <span class="token string">'@vue/airbnb'</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  rules<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'no-console'</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'production'</span> <span class="token operator">?</span> <span class="token string">'error'</span> <span class="token operator">:</span> <span class="token string">'off'</span><span class="token punctuation">,</span>
    <span class="token string">'no-debugger'</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'production'</span> <span class="token operator">?</span> <span class="token string">'error'</span> <span class="token operator">:</span> <span class="token string">'off'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  parserOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
    parser<span class="token operator">:</span> <span class="token string">'babel-eslint'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p><code>extractConfigFiles</code> 方法的具体实现主要是调用 <code>ConfigTransform</code> 实例的 <code>transform</code> 方法，代码实现的比较清晰，各位同学可以自己看下。这里就不做详细 分析了，在配置文件提取完了以后接下来就是执行 <code>resolveFiles</code> 函数了。</p> <h4 id="resolvefiles"><a href="#resolvefiles" class="header-anchor">#</a> resolveFiles</h4> <p>resolveFiles 主要分为以下三个部分执行：</p> <ul><li><strong>fileMiddlewares</strong></li> <li><strong>injectImportsAndOptions</strong></li> <li><strong>postProcessFilesCbs</strong></li></ul> <p><code>fileMiddlewares</code> 里面包含了 <code>ejs render</code> 函数，所有插件调用 <code>api.render</code> 时候只是把对应的渲染函数 push 到了 <code>fileMiddlewares</code> 中，等所有的 插件执行完以后才会遍历执行 <code>fileMiddlewares</code> 里面的所有函数，即在内存中生成模板文件字符串。</p> <p><code>injectImportsAndOptions</code> 就是将 generator 注入的 import 和 rootOption 解析到对应的文件中，比如选择了 vuex, 会在 <code>src/main.js</code> 中添加 <code>import store from './store'</code>，以及在 vue 根实例中添加 router 选项。</p> <p><code>postProcessFilesCbs</code> 是在所有普通文件在内存中渲染成字符串完成之后要执行的遍历回调。例如将 <code>@vue/cli-service/generator/index.js</code> 中的 render 是放在了 <code>fileMiddlewares</code> 里面，而将 <code>@vue/cli-service/generator/router/index.js</code> 中将替换 <code>src/App.vue</code> 文件的方法放在了 <code>postProcessFiles</code> 里面，原因是对 <code>src/App.vue</code> 文件的一些替换一定是发生在 render 函数之后，如果在之前，修改后的 src/App.vue 在之后 render 函数执行时又会被覆盖，这样显然不合理。</p> <h4 id="writefiletree"><a href="#writefiletree" class="header-anchor">#</a> writeFileTree</h4> <p>在提取了配置文件和模板渲染之后调用了 <code>sortPkg</code> 对 <code>package.json</code> 的字段进行了排序并将 <code>package.json</code> 转化为 json 字符串添加到项目的 files 中。 此时整个项目的文件已经在内存中生成好了（在源码中就是对应的 this.files），接下来就调用 <code>writeFileTree</code> 方法将内存中的字符串模板文件生成在磁盘中。到这里 <code>vue create</code> 核心部分 generator 基本上就分析完了，在下一节就分析 <code>vue create</code> 命令剩下的部分。</p> <h3 id="结尾分析"><a href="#结尾分析" class="header-anchor">#</a> 结尾分析</h3> <p>在分析了 Generator 之后可能会有点晕晕的，毕竟 Generator 是 <code>vue create</code> 最核心的部分，而 <code>vue create</code> 又是 <code>@vue/cli</code> 中最核心的部分之一。 没关系，结尾分析这部分比较容易理解，看一下代码就知道结尾做了写什么事了，那就直接看下代码清醒下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// install additional deps (injected by generators)</span>
<span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">📦  Installing additional dependencies...</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'creation'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> event<span class="token operator">:</span> <span class="token string">'deps-install'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isTestOrDebug<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> <span class="token function">installDeps</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> packageManager<span class="token punctuation">,</span> cliOptions<span class="token punctuation">.</span>registry<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// run complete cbs if any (injected by generators)</span>
<span class="token function">logWithSpinner</span><span class="token punctuation">(</span><span class="token string">'⚓'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Running completion hooks...</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'creation'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> event<span class="token operator">:</span> <span class="token string">'completion-hooks'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> cb <span class="token keyword">of</span> createCompleteCbs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// generate README.md</span>
<span class="token function">stopSpinner</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">logWithSpinner</span><span class="token punctuation">(</span><span class="token string">'📄'</span><span class="token punctuation">,</span> <span class="token string">'Generating README.md...'</span><span class="token punctuation">)</span>
<span class="token keyword">await</span> <span class="token function">writeFileTree</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token string">'README.md'</span><span class="token operator">:</span> <span class="token function">generateReadme</span><span class="token punctuation">(</span>generator<span class="token punctuation">.</span>pkg<span class="token punctuation">,</span> packageManager<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// commit initial state</span>
<span class="token keyword">let</span> gitCommitFailed <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>shouldInitGit<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token string">'git add -A'</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>isTestOrDebug<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token string">'git'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'config'</span><span class="token punctuation">,</span> <span class="token string">'user.name'</span><span class="token punctuation">,</span> <span class="token string">'test'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token string">'git'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'config'</span><span class="token punctuation">,</span> <span class="token string">'user.email'</span><span class="token punctuation">,</span> <span class="token string">'test@test.com'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> msg <span class="token operator">=</span> <span class="token keyword">typeof</span> cliOptions<span class="token punctuation">.</span>git <span class="token operator">===</span> <span class="token string">'string'</span> <span class="token operator">?</span> cliOptions<span class="token punctuation">.</span>git <span class="token operator">:</span> <span class="token string">'init'</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token string">'git'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'commit'</span><span class="token punctuation">,</span> <span class="token string">'-m'</span><span class="token punctuation">,</span> msg<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    gitCommitFailed <span class="token operator">=</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// log instructions</span>
<span class="token function">stopSpinner</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">🎉  Successfully created project </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>chalk<span class="token punctuation">.</span><span class="token function">yellow</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token function">log</span><span class="token punctuation">(</span>
  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">👉  Get started with the following commands:\n\n</span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
  <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>context <span class="token operator">===</span> process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> chalk<span class="token punctuation">.</span><span class="token function">cyan</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>chalk<span class="token punctuation">.</span><span class="token function">gray</span><span class="token punctuation">(</span><span class="token string">'$'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> cd </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span>
  chalk<span class="token punctuation">.</span><span class="token function">cyan</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>chalk<span class="token punctuation">.</span><span class="token function">gray</span><span class="token punctuation">(</span><span class="token string">'$'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>packageManager <span class="token operator">===</span> <span class="token string">'yarn'</span> <span class="token operator">?</span> <span class="token string">'yarn serve'</span> <span class="token operator">:</span> <span class="token string">'npm run serve'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
<span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'creation'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> event<span class="token operator">:</span> <span class="token string">'done'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>gitCommitFailed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">warn</span><span class="token punctuation">(</span>
    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Skipped git commit due to missing username and email in git config.\n</span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">You will need to perform the initial commit yourself.\n</span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

generator<span class="token punctuation">.</span><span class="token function">printExitLogs</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br></div></div><p>可以分为以下4个部分来进行介绍：</p> <ul><li><strong>安装额外依赖</strong></li> <li><strong>执行 createCompleteCbs</strong></li> <li><strong>生成 README.md</strong></li> <li><strong>git 初始化提交</strong></li> <li><strong>日志输出</strong></li></ul> <h4 id="安装额外依赖"><a href="#安装额外依赖" class="header-anchor">#</a> 安装额外依赖</h4> <p>这里的依赖来源于 preset 的 option，比如选择了 <code>scss</code> css 预处理器，那么就需要额外安装 <code>node-sass</code> 和 <code>sass-loader</code> 两个依赖。</p> <h4 id="createcompletecbs"><a href="#createcompletecbs" class="header-anchor">#</a> createCompleteCbs</h4> <p>所有文件都写在磁盘后执行地遍历回调。<code>@vue/cli-plugin-eslint</code> 的 generator 就注入了 <code>createCompleteCbs</code>，源码如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// lint &amp; fix after create to ensure files adhere to chosen config</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>config <span class="token operator">&amp;&amp;</span> config <span class="token operator">!==</span> <span class="token string">'base'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  api<span class="token punctuation">.</span><span class="token function">onCreateComplete</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../lint'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span> silent<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> api<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>他的作用就是对生成后的文件进行 <code>lint &amp; fix</code>，保证符合 elsit 所选的配置。</p> <h4 id="生成-readme-md"><a href="#生成-readme-md" class="header-anchor">#</a> 生成 README.md</h4> <p>生成 README.md，这里需要注意的一点就是，调用的 <code>generateReadme</code> 函数会根据 <code>package.json</code> 的 script 的字段生成生成对应的 `README.md。</p> <h4 id="git-初始化提交"><a href="#git-初始化提交" class="header-anchor">#</a> git 初始化提交</h4> <p>git 初始化提交主要就是调用 <code>shouldInitGit</code> 来判断是否需要 git 初始化提交，如果需要初始化提交就会执行 <code>git add</code> 和 <code>git commmit</code> 命令， 只有在以下这种情况会 git 初始化提交：</p> <ul><li>--git: vue create 含有 -g 或者 --git 选项</li></ul> <h4 id="日志输出"><a href="#日志输出" class="header-anchor">#</a> 日志输出</h4> <p>插件的 generator 可以利用 <code>GeneratorAPI</code> 暴露的 <code>exitLog</code> 方法在项目输出其他所有的 message 之后输出一些日志。</p> <h3 id="总结-2"><a href="#总结-2" class="header-anchor">#</a> 总结</h3> <p>分析了整个 <code>vue create</code> 命令，感受比较明显的两点就是</p> <ul><li><code>@vue/cli 3.0</code> 比 <code>vue-cli 2.0</code> 真的复杂的太多了</li> <li><code>@vue/cli 3.0</code> 基于插件的架构做的真心不错</li></ul> <p>虽然 <code>vue create</code> 真个过程比较复杂，但是从源码一部分一部分地进行分析，会发现真的很复杂，哈哈，开个玩笑😊😊会发现其实整个逻辑十分地清楚， 函数模块化的思想体现的十分明显。看完了源码 <code>vue create</code> 命令总的来说就实例化了2个类，然后各自调了一个方法。当执行 <code>create</code> 命令时会创建一个 <code>Creator</code> 实例， 然后调用其 <code>create</code> 方法。在 <code>create</code> 方法中又会创建一个 <code>Generator</code> 实例，然后再调用其 <code>generator</code> 方法，只是可能方法有点复杂😆😆。 在 <code>@vue/cli 3.0</code> 中使用了大量的 <code>async</code> 函数，这也避免了回调地狱，让代码拥有很高地可读性。</p> <p>初始化整个项目会交给各个插件去完成。比如核心插件 <code>@vue/cli-service</code> 会渲染整个项目的文件，<code>@vue/cli-plugin-eslint</code> 会进行 eslint 的一些配置， <code>@vue/cli-plugin-unit-jest</code> 插件也会进行一些 jest 的配置，各个功能都会交给对应的插件去完成，而 <code>GeneratorAPI</code> 又允许一个插件的 <code>generator</code> 向 <code>package.json</code> 注入额外的依赖或字段，并向项目中添加文件，这也让插件对整个项目拥有更高地可配置性。</p> <p>对于 <code>@vue/cli 3.0</code> 基于插件构建的思想可能看了一遍源码不是很熟悉，可以尝试再看一遍，这样你就会慢慢地感受到这种思想，另外就是如果你看了 <code>vue create</code> 的代码后你还是不是很清楚的话，你可以选择用 <code>vue create</code> 创建几个项目，将这个流程和代码的执行顺序结合起来，可能会得到不一样的收获。</p> <h2 id="vue-add"><a href="#vue-add" class="header-anchor">#</a> <code>vue add</code></h2> <h3 id="add-命令"><a href="#add-命令" class="header-anchor">#</a> add 命令</h3> <p><strong>源码目录：</strong> packages/@vue/cli/lib/add.js 。</p> <p><strong>作用：</strong> 在 vue-cli 项目中安装插件并调用其 generator 。</p> <p><code>vue add</code> 命令的入口在 <code>packages/@vue/cli/bin/vue.js</code> 中:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>program
  <span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">'add &lt;plugin&gt; [pluginOptions]'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">description</span><span class="token punctuation">(</span><span class="token string">'install a plugin and invoke its generator in an already created project'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'--registry &lt;url&gt;'</span><span class="token punctuation">,</span> <span class="token string">'Use specified npm registry when installing dependencies (only for npm)'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">allowUnknownOption</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">plugin</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../lib/add'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>plugin<span class="token punctuation">,</span> <span class="token function">minimist</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>从代码中可以看出，<code>vue add</code> 命令接受两个参数:</p> <ul><li>plugin： 插件名称，必填。</li> <li>registry： 安装插件指定的安装源，只针对于 npm 包管理器，选填。</li></ul> <p>当执行了 <code>vue add</code> 命令后会加载 <code>@vue/cli/lib/add.js</code>，下面就逐步开始分析。</p> <h3 id="安装插件"><a href="#安装插件" class="header-anchor">#</a> 安装插件</h3> <p><code>vue add</code> 和 <code>vue invoke</code> 两个命令其实有很多相同的地方，即 <code>vue add</code> 包含了 <code>vue invoke</code> 的功能，另外还多了一个插件安装的功能，下面就直接看下代码。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VUE_CLI_TEST</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>加载 <code>add.js</code> 脚本就会调用 <code>add</code> 函数，接着看 <code>add</code> 函数的代码：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">add</span> <span class="token punctuation">(</span><span class="token parameter">pluginName<span class="token punctuation">,</span> options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> context <span class="token operator">=</span> process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// special internal &quot;plugins&quot;</span>
  <span class="token comment">// 内部 plugin</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^(@vue\/)?router$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>pluginName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 匹配 @vue/router，router。 ? 表示匹配前面的子表达式零次或一次</span>
    <span class="token keyword">return</span> <span class="token function">addRouter</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^(@vue\/)?vuex$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>pluginName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 匹配 @vue/vuex，vuex</span>
    <span class="token keyword">return</span> <span class="token function">addVuex</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 解析插件名称</span>
  <span class="token comment">// full id, scoped short, or default short</span>
  <span class="token comment">// @bar/foo =&gt; @bar/vue-cli-plugin-foo</span>
  <span class="token comment">// @vue/foo =&gt; @vue/cli-plugin-foo</span>
  <span class="token comment">// foo =&gt; vue-cli-plugin-foo</span>
  <span class="token keyword">const</span> packageName <span class="token operator">=</span> <span class="token function">resolvePluginId</span><span class="token punctuation">(</span>pluginName<span class="token punctuation">)</span>

  <span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">📦  Installing </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>chalk<span class="token punctuation">.</span><span class="token function">cyan</span><span class="token punctuation">(</span>packageName<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">...</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> packageManager <span class="token operator">=</span> <span class="token function">loadOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>packageManager <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token function">hasProjectYarn</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">'yarn'</span> <span class="token operator">:</span> <span class="token string">'npm'</span><span class="token punctuation">)</span>
  <span class="token keyword">await</span> <span class="token function">installPackage</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> packageManager<span class="token punctuation">,</span> options<span class="token punctuation">.</span>registry<span class="token punctuation">,</span> packageName<span class="token punctuation">)</span>

  <span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>chalk<span class="token punctuation">.</span><span class="token function">green</span><span class="token punctuation">(</span><span class="token string">'✔'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">  Successfully installed plugin: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>chalk<span class="token punctuation">.</span><span class="token function">cyan</span><span class="token punctuation">(</span>packageName<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> generatorPath <span class="token operator">=</span> <span class="token function">resolveModule</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>packageName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/generator</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> context<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>generatorPath<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">invoke</span><span class="token punctuation">(</span>pluginName<span class="token punctuation">,</span> options<span class="token punctuation">,</span> context<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Plugin </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>packageName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> does not have a generator to invoke</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p><code>add</code> 函数并不复杂，主要就是安装插件包，对于 <code>vue-cli</code> 内部一些特殊的&quot;插件&quot;，比如 <code>router，vuex</code>，就不会通过包管理器安装，而是直接加载 <code>@vue/cli-service/generator/router</code> 和 <code>@vue/cli-service/generator/vuex</code>，这两个文件也是两个 <code>generator</code>，可以向 <code>package.json</code> 注入额外的依赖或字段，并向项目中添加文件，对于普通的第三方插件，就需要通过包管理器安装了。</p> <p>安装第三方插件这部分比较重要的就是解析插件的名称，即 <code>resolvePluginId</code>，还是看下 <code>resolvePluginId</code> 的实现：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>exports<span class="token punctuation">.</span><span class="token function-variable function">resolvePluginId</span> <span class="token operator">=</span> <span class="token parameter">id</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// already full id</span>
  <span class="token comment">// e.g. vue-cli-plugin-foo, @vue/cli-plugin-foo, @bar/vue-cli-plugin-foo</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>pluginRE<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// const pluginRE = /^(@vue\/|vue-|@[\w-]+\/vue-)cli-plugin-/</span>
    <span class="token keyword">return</span> id
  <span class="token punctuation">}</span>
  <span class="token comment">// scoped short</span>
  <span class="token comment">// e.g. @vue/foo, @bar/foo</span>
  <span class="token comment">// @vue/foo =&gt; @vue/cli-plugin-foo</span>
  <span class="token comment">// @bar/foo =&gt; @bar/vue-cli-plugin-foo</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>id<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'@'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> scopeMatch <span class="token operator">=</span> id<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>scopeRE<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>scopeMatch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> scope <span class="token operator">=</span> scopeMatch<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
      <span class="token keyword">const</span> shortId <span class="token operator">=</span> id<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>scopeRE<span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>scope<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>scope <span class="token operator">===</span> <span class="token string">'@vue/'</span> <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">vue-</span><span class="token template-punctuation string">`</span></span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">cli-plugin-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>shortId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// default short</span>
  <span class="token comment">// e.g. foo</span>
  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">vue-cli-plugin-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>看一下代码应该就比较清楚它的作用了，就是将 <code>full id ，scoped short 以及 default short</code> 解析成完整的插件名称。在 <code>vue-cli</code> 官方文档中对插件 的命名有着明确的要求，即命名方式为：<code>vue-cli-plugin-&lt;name&gt;</code>，插件遵循命名约定之后就可以：</p> <ul><li>被 <code>@vue/cli-service</code> 发现；</li> <li>被其它开发者搜索到；</li> <li>通过 <code>vue add &lt;name&gt;</code> 或 <code>vue invoke &lt;name&gt;</code> 安装下来。</li></ul> <p>在获取第三方插件名称后，就会调用 <code>installPackage</code> 安装插件包，接下来就是调用插件的 <code>generator</code> 了，调用插件将在下一节分析。调用插件</p> <p>对于第三方插件安装完成之后，先调用 <code>invoke</code> 方法，该方法实现如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">invoke</span> <span class="token punctuation">(</span><span class="token parameter">pluginName<span class="token punctuation">,</span> options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> context <span class="token operator">=</span> process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">delete</span> options<span class="token punctuation">.</span>_
  <span class="token keyword">const</span> pkg <span class="token operator">=</span> <span class="token function">getPkg</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token comment">// 解析 package.json</span>

  <span class="token comment">// attempt to locate the plugin in package.json</span>
  <span class="token keyword">const</span> <span class="token function-variable function">findPlugin</span> <span class="token operator">=</span> <span class="token parameter">deps</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>deps<span class="token punctuation">)</span> <span class="token keyword">return</span>
    <span class="token keyword">let</span> name
    <span class="token comment">// official</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>deps<span class="token punctuation">[</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">@vue/cli-plugin-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>pluginName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> name
    <span class="token punctuation">}</span>
    <span class="token comment">// full id, scoped short, or default short</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>deps<span class="token punctuation">[</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token function">resolvePluginId</span><span class="token punctuation">(</span>pluginName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> name
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">findPlugin</span><span class="token punctuation">(</span>pkg<span class="token punctuation">.</span>devDependencies<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">findPlugin</span><span class="token punctuation">(</span>pkg<span class="token punctuation">.</span>dependencies<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>
      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Cannot resolve plugin </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>chalk<span class="token punctuation">.</span><span class="token function">yellow</span><span class="token punctuation">(</span>pluginName<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> from package.json. </span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Did you forget to install it?</span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> pluginGenerator <span class="token operator">=</span> <span class="token function">loadModule</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/generator</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> context<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pluginGenerator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Plugin </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> does not have a generator.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// resolve options if no command line options (other than --registry) are passed,</span>
  <span class="token comment">// and the plugin contains a prompt module.</span>
  <span class="token comment">// eslint-disable-next-line prefer-const</span>
  <span class="token keyword">let</span> <span class="token punctuation">{</span> registry<span class="token punctuation">,</span> <span class="token operator">...</span>pluginOptions <span class="token punctuation">}</span> <span class="token operator">=</span> options
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>pluginOptions<span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> pluginPrompts <span class="token operator">=</span> <span class="token function">loadModule</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/prompts</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> context<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>pluginPrompts<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> pluginPrompts <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        pluginPrompts <span class="token operator">=</span> <span class="token function">pluginPrompts</span><span class="token punctuation">(</span>pkg<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> pluginPrompts<span class="token punctuation">.</span>getPrompts <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        pluginPrompts <span class="token operator">=</span> pluginPrompts<span class="token punctuation">.</span><span class="token function">getPrompts</span><span class="token punctuation">(</span>pkg<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      pluginOptions <span class="token operator">=</span> <span class="token keyword">await</span> inquirer<span class="token punctuation">.</span><span class="token function">prompt</span><span class="token punctuation">(</span>pluginPrompts<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> plugin <span class="token operator">=</span> <span class="token punctuation">{</span>
    id<span class="token punctuation">,</span>
    apply<span class="token operator">:</span> pluginGenerator<span class="token punctuation">,</span>
    options<span class="token operator">:</span> <span class="token punctuation">{</span>
      registry<span class="token punctuation">,</span>
      <span class="token operator">...</span>pluginOptions
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">await</span> <span class="token function">runGenerator</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> plugin<span class="token punctuation">,</span> pkg<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br></div></div><p>该方法先调用 <code>findPlugin</code> 判断插件是否安装，接着判断是否有 <code>generator（pluginGenerator）</code>，然后就是判断插件是否含有 <code>prompt</code>。如果有则调用 <code>inquirer.prompt</code> 获取插件的 <code>option</code>，并传给其 <code>generator</code>，在完成这些以后，就是 <code>runGenerator</code>。</p> <p>而对于 <code>vue-cli</code> 内部一些特殊的&quot;插件&quot;，比如 <code>router，vuex</code>就直接调用 <code>runGenerator</code>。</p> <p>如果你看了 <code>vue create</code> 分析部分的 <code>Generator</code> 的话，接下来就比较轻松了。<code>runGenerator</code> 的实质就是构造一个 <code>Generator</code> 实例，并调用其 <code>generate</code> 方法。 如果对 <code>generate</code> 方法还不熟悉的话，可查看下 <code>vue create</code> 部分。 在实例的 <code>generator</code> 方法调用完成之后执行以下命令：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">git</span> ls-files --exclude-standard --modified --others
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>因为插件的 <code>generator</code> 可以通过 <code>GeneratorAPI</code> 暴露的 <code>render</code> 和 <code>extendPackage</code> 方法修改项目的文件，因此通过执行该命令将变化的文件显示在 终端上，这对开发者十分地友好。</p> <h3 id="调用插件"><a href="#调用插件" class="header-anchor">#</a> 调用插件</h3> <p>对于第三方插件安装完成之后，先调用 <code>invoke</code> 方法，该方法实现如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">invoke</span> <span class="token punctuation">(</span><span class="token parameter">pluginName<span class="token punctuation">,</span> options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> context <span class="token operator">=</span> process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">delete</span> options<span class="token punctuation">.</span>_
  <span class="token keyword">const</span> pkg <span class="token operator">=</span> <span class="token function">getPkg</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token comment">// 解析 package.json</span>

  <span class="token comment">// attempt to locate the plugin in package.json</span>
  <span class="token keyword">const</span> <span class="token function-variable function">findPlugin</span> <span class="token operator">=</span> <span class="token parameter">deps</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>deps<span class="token punctuation">)</span> <span class="token keyword">return</span>
    <span class="token keyword">let</span> name
    <span class="token comment">// official</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>deps<span class="token punctuation">[</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">@vue/cli-plugin-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>pluginName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> name
    <span class="token punctuation">}</span>
    <span class="token comment">// full id, scoped short, or default short</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>deps<span class="token punctuation">[</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token function">resolvePluginId</span><span class="token punctuation">(</span>pluginName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> name
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">findPlugin</span><span class="token punctuation">(</span>pkg<span class="token punctuation">.</span>devDependencies<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">findPlugin</span><span class="token punctuation">(</span>pkg<span class="token punctuation">.</span>dependencies<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>
      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Cannot resolve plugin </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>chalk<span class="token punctuation">.</span><span class="token function">yellow</span><span class="token punctuation">(</span>pluginName<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> from package.json. </span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Did you forget to install it?</span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> pluginGenerator <span class="token operator">=</span> <span class="token function">loadModule</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/generator</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> context<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pluginGenerator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Plugin </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> does not have a generator.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// resolve options if no command line options (other than --registry) are passed,</span>
  <span class="token comment">// and the plugin contains a prompt module.</span>
  <span class="token comment">// eslint-disable-next-line prefer-const</span>
  <span class="token keyword">let</span> <span class="token punctuation">{</span> registry<span class="token punctuation">,</span> <span class="token operator">...</span>pluginOptions <span class="token punctuation">}</span> <span class="token operator">=</span> options
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>pluginOptions<span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> pluginPrompts <span class="token operator">=</span> <span class="token function">loadModule</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/prompts</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> context<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>pluginPrompts<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> pluginPrompts <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        pluginPrompts <span class="token operator">=</span> <span class="token function">pluginPrompts</span><span class="token punctuation">(</span>pkg<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> pluginPrompts<span class="token punctuation">.</span>getPrompts <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        pluginPrompts <span class="token operator">=</span> pluginPrompts<span class="token punctuation">.</span><span class="token function">getPrompts</span><span class="token punctuation">(</span>pkg<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      pluginOptions <span class="token operator">=</span> <span class="token keyword">await</span> inquirer<span class="token punctuation">.</span><span class="token function">prompt</span><span class="token punctuation">(</span>pluginPrompts<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> plugin <span class="token operator">=</span> <span class="token punctuation">{</span>
    id<span class="token punctuation">,</span>
    apply<span class="token operator">:</span> pluginGenerator<span class="token punctuation">,</span>
    options<span class="token operator">:</span> <span class="token punctuation">{</span>
      registry<span class="token punctuation">,</span>
      <span class="token operator">...</span>pluginOptions
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">await</span> <span class="token function">runGenerator</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> plugin<span class="token punctuation">,</span> pkg<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br></div></div><p>该方法先调用 <code>findPlugin</code> 判断插件是否安装，接着判断是否有 <code>generator（pluginGenerator）</code>，然后就是判断插件是否含有 <code>prompt</code>。如果有则调用 <code>inquirer.prompt</code> 获取插件的 <code>option</code>，并传给其 <code>generator</code>，在完成这些以后，就是 <code>runGenerator</code>。</p> <p>而对于 <code>vue-cli</code> 内部一些特殊的&quot;插件&quot;，比如 <code>router，vuex</code>就直接调用 <code>runGenerator</code>。</p> <p>如果你看了 <code>vue create</code> 分析部分的 <code>Generator</code> 的话，接下来就比较轻松了。<code>runGenerator</code> 的实质就是构造一个 <code>Generator</code> 实例，并调用其 <code>generate</code> 方法。 如果对 <code>generate</code> 方法还不熟悉的话，可查看下 <code>vue create</code> 部分。 在实例的 <code>generator</code> 方法调用完成之后执行以下命令：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">git</span> ls-files --exclude-standard --modified --others
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>因为插件的 <code>generator</code> 可以通过 <code>GeneratorAPI</code> 暴露的 <code>render</code> 和 <code>extendPackage</code> 方法修改项目的文件，因此通过执行该命令将变化的文件显示在 终端上，这对开发者十分地友好。</p> <h3 id="总结-3"><a href="#总结-3" class="header-anchor">#</a> 总结</h3> <p>如果了解了 <code>vue create</code> 整个过程，那么相信你对 <code>vue add</code> 命令的代码看起来应该比较轻松，因为 <code>vue add</code> 相当于只是 <code>vue create</code> 中的一部分，<code>vue create</code> 包含了插件的安装以及调用，<code>vue add</code> 命令只是将此功能分离了出来。</p> <p>有个消息就是，接下来分析的 <code>vue invoke</code> 命令其实是 <code>vue add</code> 命名去掉了插件包安装的那一部分，所以同学们都懂噻😁😁。</p> <p>扶我起来，我还能学习，接下来就开始 <code>vue invoke</code> 命令的分析。</p> <h2 id="vue-invoke"><a href="#vue-invoke" class="header-anchor">#</a> <code>vue invoke</code></h2> <h3 id="invoke-命令"><a href="#invoke-命令" class="header-anchor">#</a> invoke 命令</h3> <p><strong>源码目录：</strong> packages/@vue/cli/lib/invoke.js 。</p> <p><strong>作用：</strong> 在 vue-cli 项目中调用插件的 generator 。</p> <p><code>vue invoke</code> 命令的入口在 <code>packages/@vue/cli/bin/vue.js</code> 中:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>program
  <span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">'invoke &lt;plugin&gt; [pluginOptions]'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">description</span><span class="token punctuation">(</span><span class="token string">'invoke the generator of a plugin in an already created project'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'--registry &lt;url&gt;'</span><span class="token punctuation">,</span> <span class="token string">'Use specified npm registry when installing dependencies (only for npm)'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">allowUnknownOption</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">plugin</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../lib/invoke'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>plugin<span class="token punctuation">,</span> <span class="token function">minimist</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>从代码中可以看出，<code>vue invoke</code> 命令接受两个参数:</p> <ul><li>plugin： 插件名称，必填。</li> <li>registry： 安装插件指定的安装源，只针对于 npm 包管理器，选填。</li></ul> <p>当执行了 <code>vue add</code> 命令时会加载 <code>@vue/cli/lib/invoke.js</code>，对于插件的调用在 <code>vue add</code> 命令中已经分析了，这里就不做介绍。<code>vue add</code> 本身就包含了 <code>vue invoke</code> 的功能，而<code>vue invoke</code> 只是将插件调用的功能分离出了。在某些场景下该功能十分方便，比如当你执行 <code>vue add</code> 安装并调用了 一个插件的 <code>generator</code> 之后，你想要更改这个插件配置，那么此时只需要执行 <code>vue invoke</code> 调用插件的 <code>generator</code> 修改配置即可。</p> <h2 id="vue-inspect"><a href="#vue-inspect" class="header-anchor">#</a> <code>vue inspect</code></h2> <h3 id="inspect-命令"><a href="#inspect-命令" class="header-anchor">#</a> inspect 命令</h3> <p><strong>源码目录：</strong> packages/@vue/cli/lib/inspect.js 。</p> <p><strong>作用：</strong> 审查一个 Vue CLI 项目的 webpack config 。</p> <p><code>vue inspect</code> 命令的入口在 <code>packages/@vue/cli/bin/vue.js</code> 中:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>program
  <span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">'inspect [paths...]'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">description</span><span class="token punctuation">(</span><span class="token string">'inspect the webpack config in a project with vue-cli-service'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'--mode &lt;mode&gt;'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'--rule &lt;ruleName&gt;'</span><span class="token punctuation">,</span> <span class="token string">'inspect a specific module rule'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'--plugin &lt;pluginName&gt;'</span><span class="token punctuation">,</span> <span class="token string">'inspect a specific plugin'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'--rules'</span><span class="token punctuation">,</span> <span class="token string">'list all module rule names'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'--plugins'</span><span class="token punctuation">,</span> <span class="token string">'list all plugin names'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'-v --verbose'</span><span class="token punctuation">,</span> <span class="token string">'Show full function definitions in output'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">paths<span class="token punctuation">,</span> cmd</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../lib/inspect'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>paths<span class="token punctuation">,</span> <span class="token function">cleanArgs</span><span class="token punctuation">(</span>cmd<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>当执行了 <code>vue inspect</code> 命令时会加载 <code>@vue/cli/lib/inspect.js</code>，那么接下来分析 <code>inspect.js</code> 代码。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">inspect</span> <span class="token punctuation">(</span><span class="token parameter">paths<span class="token punctuation">,</span> args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> cwd <span class="token operator">=</span> process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> servicePath
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    servicePath <span class="token operator">=</span> resolve<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token string">'@vue/cli-service'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> basedir<span class="token operator">:</span> cwd <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token comment">// cwd/node_modules/@vue/cli-service/lib/Service.js</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> error <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@vue/cli-shared-utils'</span><span class="token punctuation">)</span>
    <span class="token function">error</span><span class="token punctuation">(</span>
      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Failed to locate @vue/cli-service.\n</span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Note that \`vue inspect\` is an alias of \`vue-cli-service inspect\`\n</span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">and can only be used in a project where @vue/cli-service is locally installed.</span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">)</span>
    process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> binPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>servicePath<span class="token punctuation">,</span> <span class="token string">'../../bin/vue-cli-service.js'</span><span class="token punctuation">)</span> <span class="token comment">// cwd/node_modules/@vue/cli-service/bin/vue-cli-service.js</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>binPath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">execa</span><span class="token punctuation">(</span><span class="token string">'node'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
      binPath<span class="token punctuation">,</span>
      <span class="token string">'inspect'</span><span class="token punctuation">,</span>
      <span class="token operator">...</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span>mode <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token string">'--mode'</span><span class="token punctuation">,</span> args<span class="token punctuation">.</span>mode<span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token operator">...</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span>rule <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token string">'--rule'</span><span class="token punctuation">,</span> args<span class="token punctuation">.</span>rule<span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token operator">...</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span>plugin <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token string">'--plugin'</span><span class="token punctuation">,</span> args<span class="token punctuation">.</span>plugin<span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token operator">...</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span>rules <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token string">'--rules'</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token operator">...</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span>plugins <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token string">'--plugins'</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token operator">...</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span>verbose <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token string">'--verbose'</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token operator">...</span>paths
    <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> cwd<span class="token punctuation">,</span> stdio<span class="token operator">:</span> <span class="token string">'inherit'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>这段代码比较好理解，作用就是获取 <code>@vue/cli-service</code> 的执行文件路径，然后执行其 <code>inspect</code> 命令。也就是说 <code>vue inspect</code> 命令实际执行的是 <code>vue-cli-service inspect</code> 命令，相关分析可查看 <a href="https://kuangpf.com/vue-cli-analysis/cli-service/inspect.html" target="_blank" rel="noopener noreferrer">cli-service 内置插件 inspect<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h2 id="vue-serve"><a href="#vue-serve" class="header-anchor">#</a> <code>vue serve</code></h2> <h3 id="serve-命令"><a href="#serve-命令" class="header-anchor">#</a> serve 命令</h3> <p><strong>源码目录：</strong> packages/@vue/cli-service-global 。</p> <p><strong>作用：</strong> 在开发环境模式下零配置为 .js 或 .vue 文件启动一个服务器 。</p> <p><code>vue serve</code> 命令的入口在 <code>packages/@vue/cli/bin/vue.js</code> 中:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>program
  <span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">'serve [entry]'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">description</span><span class="token punctuation">(</span><span class="token string">'serve a .js or .vue file in development mode with zero config'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'-o, --open'</span><span class="token punctuation">,</span> <span class="token string">'Open browser'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'-c, --copy'</span><span class="token punctuation">,</span> <span class="token string">'Copy local url to clipboard'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">entry<span class="token punctuation">,</span> cmd</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">loadCommand</span><span class="token punctuation">(</span><span class="token string">'serve'</span><span class="token punctuation">,</span> <span class="token string">'@vue/cli-service-global'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">serve</span><span class="token punctuation">(</span>entry<span class="token punctuation">,</span> <span class="token function">cleanArgs</span><span class="token punctuation">(</span>cmd<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>代码写的很清楚了，当执行 <code>vue serve</code> 命令时会执行 <code>@vue/cli-service-global</code> 的 <code>serve</code> 方法，那就直接看 <code>serve</code> 方法源码：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>exports<span class="token punctuation">.</span><span class="token function-variable function">serve</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">_entry<span class="token punctuation">,</span> args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> context<span class="token punctuation">,</span> entry <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">resolveEntry</span><span class="token punctuation">(</span>_entry<span class="token punctuation">)</span>
  <span class="token function">createService</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> entry<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token string">'serve'</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>首先调用 <code>resolveEntry</code> 获取入口文件 <code>entry</code>，和当前工作目录 <code>context</code>，看 <code>resolveEntry</code> 函数代码：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">resolveEntry</span> <span class="token punctuation">(</span><span class="token parameter">entry</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> context <span class="token operator">=</span> process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  entry <span class="token operator">=</span> entry <span class="token operator">||</span> <span class="token function">findExisting</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token string">'main.js'</span><span class="token punctuation">,</span>
    <span class="token string">'index.js'</span><span class="token punctuation">,</span>
    <span class="token string">'App.vue'</span><span class="token punctuation">,</span>
    <span class="token string">'app.vue'</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>entry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chalk<span class="token punctuation">.</span><span class="token function">red</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Failed to locate entry file in </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>chalk<span class="token punctuation">.</span><span class="token function">yellow</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chalk<span class="token punctuation">.</span><span class="token function">red</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Valid entry file should be one of: main.js, index.js, App.vue or app.vue.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> entry<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chalk<span class="token punctuation">.</span><span class="token function">red</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Entry file </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>chalk<span class="token punctuation">.</span><span class="token function">yellow</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> does not exist.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    context<span class="token punctuation">,</span>
    entry
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>如果 <code>vue serve</code> 命令中含有 <code>--entry</code> 参数，那么入口文件就取参数中的文件，否则会依次判断在当前工作目录是否存在 main.js，index.js，App.vue，app.vue， 文件，只要存在就会返回，针对于参数中含有 <code>entry</code> 的情形还会判断 <code>entry</code> 文件是否存在，如果存在则将当前工作目录和入口文件一起返回。</p> <p>接下来就创建了一个 <code>Service</code> 实例，并执行其 <code>run</code> 方法，如果之前看了 <a href="https://kuangpf.com/vue-cli-analysis/cli-service/entrance.html" target="_blank" rel="noopener noreferrer">cli-service<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 部分的话，我相信到这里就应该就非常熟悉了，相当于就执行了 <code>vue-cli-service</code> serve 命令。还是看下在 <code>createService</code> 中发生了什么：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">createService</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> entry<span class="token punctuation">,</span> asLib</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Service</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    projectOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
      compiler<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      lintOnSave<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
      babelPlugin<span class="token punctuation">,</span>
      eslintPlugin<span class="token punctuation">,</span>
      <span class="token function">globalConfigPlugin</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> entry<span class="token punctuation">,</span> asLib<span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><code>createService</code> 主要工作就是实例化一个 <code>Service</code>，并且初始化了 <code>projectOptions</code> 和 <code>plugins</code>，看一下 <code>globalConfigPlugin</code> 的代码：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">createConfigPlugin</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> entry<span class="token punctuation">,</span> asLib</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token string">'@vue/cli-service-global-config'</span><span class="token punctuation">,</span>
    <span class="token function-variable function">apply</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">api<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      api<span class="token punctuation">.</span><span class="token function">chainWebpack</span><span class="token punctuation">(</span><span class="token parameter">config</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// some code ...</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>这就是一个 service 插件，主要进行了 webpack 的一些配置。在此之后就调用了实例的 <code>run</code> 方法，执行了 <code>vue-cli-service serve</code> 命令，相关分析可查看 <a href="https://kuangpf.com/vue-cli-analysis/cli-service/serve.html" target="_blank" rel="noopener noreferrer">cli-service 内置插件 serve<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h2 id="vue-build"><a href="#vue-build" class="header-anchor">#</a> <code>vue build</code></h2> <h3 id="build-命令"><a href="#build-命令" class="header-anchor">#</a> build 命令</h3> <p><strong>源码目录：</strong> packages/@vue/cli-service-globa 。</p> <p><strong>作用：</strong> 在生产环境模式下零配置构建一个 .js 或 .vue 文件 。</p> <p><code>vue build</code> 命令的入口在 <code>packages/@vue/cli/bin/vue.js</code> 中:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>program
  <span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">'build [entry]'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">description</span><span class="token punctuation">(</span><span class="token string">'build a .js or .vue file in production mode with zero config'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'-t, --target &lt;target&gt;'</span><span class="token punctuation">,</span> <span class="token string">'Build target (app | lib | wc | wc-async, default: app)'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'-n, --name &lt;name&gt;'</span><span class="token punctuation">,</span> <span class="token string">'name for lib or web-component mode (default: entry filename)'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'-d, --dest &lt;dir&gt;'</span><span class="token punctuation">,</span> <span class="token string">'output directory (default: dist)'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">entry<span class="token punctuation">,</span> cmd</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">loadCommand</span><span class="token punctuation">(</span><span class="token string">'build'</span><span class="token punctuation">,</span> <span class="token string">'@vue/cli-service-global'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>entry<span class="token punctuation">,</span> <span class="token function">cleanArgs</span><span class="token punctuation">(</span>cmd<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>与 <code>vue serve</code> 命令类似，当执行 <code>vue build</code> 命令时会执行 <code>@vue/cli-service-global</code> 的 <code>build</code> 方法，那就直接看 <code>build</code> 方法源码：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>exports<span class="token punctuation">.</span><span class="token function-variable function">build</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">_entry<span class="token punctuation">,</span> args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> context<span class="token punctuation">,</span> entry <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">resolveEntry</span><span class="token punctuation">(</span>_entry<span class="token punctuation">)</span>
  <span class="token keyword">const</span> asLib <span class="token operator">=</span> args<span class="token punctuation">.</span>target <span class="token operator">&amp;&amp;</span> args<span class="token punctuation">.</span>target <span class="token operator">!==</span> <span class="token string">'app'</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>asLib<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    args<span class="token punctuation">.</span>entry <span class="token operator">=</span> entry
  <span class="token punctuation">}</span>
  <span class="token function">createService</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> entry<span class="token punctuation">,</span> asLib<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token string">'build'</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>基本上和 <code>vue serve</code> 命令一样，只是针对于构建目标为 lib ，wc 以及 wc-async 时为 <code>build</code> 命令添加了 <code>entry</code> 参数，防止找不到构建入口。因为当不指定 构建目标入口时，默认为 <code>src/App.vue</code>，那么如果 <code>vue build</code> 命令不指定 <code>entry</code> 参数，就很容易出现找不到构建入口的情形。</p> <h2 id="vue-ui"><a href="#vue-ui" class="header-anchor">#</a> <code>vue ui</code></h2> <h3 id="ui-命令"><a href="#ui-命令" class="header-anchor">#</a> ui 命令</h3> <p><strong>源码目录：</strong> packages/@vue/cli/lib/ui.js 。</p> <p><strong>作用：</strong> 以图形化界面创建和管理项目。</p> <p><code>vue ui</code> 命令的入口在 <code>packages/@vue/cli/bin/ui.js</code> 中:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>program
  <span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">'ui'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">description</span><span class="token punctuation">(</span><span class="token string">'start and open the vue-cli ui'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'-H, --host &lt;host&gt;'</span><span class="token punctuation">,</span> <span class="token string">'Host used for the UI server (default: localhost)'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'-p, --port &lt;port&gt;'</span><span class="token punctuation">,</span> <span class="token string">'Port used for the UI server (by default search for available port)'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'-D, --dev'</span><span class="token punctuation">,</span> <span class="token string">'Run in dev mode'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'--quiet'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Don't output starting messages</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'--headless'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Don't open browser on start and output port</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">cmd</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">checkNodeVersion</span><span class="token punctuation">(</span><span class="token string">'&gt;=8.6'</span><span class="token punctuation">,</span> <span class="token string">'vue ui'</span><span class="token punctuation">)</span>
    <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../lib/ui'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">cleanArgs</span><span class="token punctuation">(</span>cmd<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>和其它 <code>vue</code> 命令一样，从这里可以简单查看 <code>ui</code> 命令的一些参数，其中包括 host 配置，端口配置以及在什么模式下运行等等，<code>ui</code> 命令的回调 action 会加载 <code>ui.js</code>，但在分析 <code>ui.js</code> 之前先整体上分析 <code>vue ui</code> 命令，以及其中涉及到的一些知识。</p> <h3 id="整体分析-2"><a href="#整体分析-2" class="header-anchor">#</a> 整体分析</h3> <p>ui 命令旨在通过 GUI 的形式对 vue 项目进行管理，可以说是 vue-cli3.0 中的除了插件系统后的又一大新特性，那么整个 ui 系统是怎么运行起来的呢，可以大致的分为两部分进行分析，server 端和 client 端。server 端主要使用了 <a href="https://github.com/apollographql/apollo-server" target="_blank" rel="noopener noreferrer">apollo-server<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 与 <a href="https://github.com/expressjs/express" target="_blank" rel="noopener noreferrer">express<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，以 <a href="https://graphql.org/" target="_blank" rel="noopener noreferrer">GraphQL<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> API 查询语言来实现数据的查询，变更以及订阅。而 client 端在 <code>ui</code> 方面使用了自家的 <a href="https://www.npmjs.com/package/@vue/ui" target="_blank" rel="noopener noreferrer">@vue/ui<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，另外在项目中还集成了<a href="https://github.com/Akryum/vue-apollo" target="_blank" rel="noopener noreferrer">vue-apollo<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p>先从 cli 官网搬一张图来整体感受下 vue ui：</p> <p><img src="/rat-summ/assets/img/ui-img01.08266803.png" alt="img"></p> <p>这张图是 <code>vue ui</code> 的整体架构，如果现在不是很清楚里面里面涉及的知识的话，不要慌，可以在了解完 ui 命令后再来回看一下。</p> <p>除此之外，还需要了解以下这些知识：</p> <ul><li><a href="https://graphql.org/" target="_blank" rel="noopener noreferrer">GraphQL<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>：API 查询语言</li> <li><a href="https://github.com/apollographql/apollo-server" target="_blank" rel="noopener noreferrer">apollo-server<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>： nodejs上构建grqphql服务端的web中间件,支持express，koa ，hapi等框架。</li> <li><a href="https://vue-apollo.netlify.com/zh-cn/" target="_blank" rel="noopener noreferrer">vue-apollo<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>：在 vue 项目中集成 GraphQL</li> <li><a href="https://github.com/expressjs/express" target="_blank" rel="noopener noreferrer">express<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>：Node.js Web 应用程序框架</li></ul> <p>接下来就从 server 端和 client 端进行分析。</p> <h3 id="server-分析"><a href="#server-分析" class="header-anchor">#</a> server 分析</h3> <p>先看下 <code>ui</code> 命令加载的 <code>lib/ui.js</code> 内容：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">ui</span> <span class="token punctuation">(</span><span class="token parameter">options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> context <span class="token operator">=</span> process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> host <span class="token operator">=</span> options<span class="token punctuation">.</span>host <span class="token operator">||</span> <span class="token string">'localhost'</span>

  <span class="token comment">// some code ...</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>options<span class="token punctuation">.</span>quiet<span class="token punctuation">)</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">🚀  Starting GUI...</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> opts <span class="token operator">=</span> <span class="token punctuation">{</span>
    host<span class="token punctuation">,</span> <span class="token comment">// 域名</span>
    port<span class="token punctuation">,</span> <span class="token comment">// 端口</span>
    graphqlPath<span class="token operator">:</span> <span class="token string">'/graphql'</span><span class="token punctuation">,</span> 
    subscriptionsPath<span class="token operator">:</span> <span class="token string">'/graphql'</span><span class="token punctuation">,</span> <span class="token comment">// 订阅</span>
    enableMocks<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 是否模拟数据</span>
    enableEngine<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// Apollo Engine</span>
    cors<span class="token operator">:</span> <span class="token string">'*'</span><span class="token punctuation">,</span>
    timeout<span class="token operator">:</span> <span class="token number">1000000</span><span class="token punctuation">,</span>
    quiet<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    paths<span class="token operator">:</span> <span class="token punctuation">{</span>
      typeDefs<span class="token operator">:</span> require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'@vue/cli-ui/apollo-server/type-defs.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// schema</span>
      resolvers<span class="token operator">:</span> require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'@vue/cli-ui/apollo-server/resolvers.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// resolvers</span>
      context<span class="token operator">:</span> require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'@vue/cli-ui/apollo-server/context.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 可以向 resolvers 注入上下文对象</span>
      pubsub<span class="token operator">:</span> require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'@vue/cli-ui/apollo-server/pubsub.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 订阅</span>
      server<span class="token operator">:</span> require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'@vue/cli-ui/apollo-server/server.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// express 服务 e.g. express.static</span>
      directives<span class="token operator">:</span> require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'@vue/cli-ui/apollo-server/directives.js'</span><span class="token punctuation">)</span> <span class="token comment">// schema 指令</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>


  <span class="token function">server</span><span class="token punctuation">(</span>opts<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// server cb()</span>
    <span class="token comment">// some code ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">ui</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VUE_CLI_TEST</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><p>上面是 <code>lib/ui.js</code> 的部分代码，主要就是获取 <code>opts</code>，然后执行 <code>@vue/cli-ui</code> 的 <code>server</code> 方法。在 <code>opts</code> 中需要注意的就是 <code>opts.path</code> , 它定义一些变量的路径，具体作用如下：</p> <ul><li><strong>typeDefs</strong>: GraphQL Schema，用来定义 GraphQL 数据模型</li> <li><strong>resolvers</strong>： 用于解析 GraphQL Query 获取的数据</li> <li><strong>context</strong>：可以向 resolvers 注入上下文对象</li> <li><strong>pubsub</strong>：GraphQL 订阅</li> <li><strong>server</strong>：express 服务，利用 app.use 注册中间件</li> <li><strong>directives</strong>： GraphQL 指令， @include，@skip</li></ul> <p>接下来看服务端启动的代码，代码目录在 <code>vue-cli-plugin-apollo/graphql-server/index.js</code> 中，简单看下部分代码：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 创建基于 express 的 GraphQL server</span>
<span class="token comment">// apollo-server-express 是由 Apollo 提供在 express 环境下实现 GraphQL 的库</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">options<span class="token punctuation">,</span> cb <span class="token operator">=</span> <span class="token keyword">null</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// some code ...</span>
  <span class="token comment">// Express app</span>
  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>typescript<span class="token punctuation">)</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'ts-node/register/transpile-only'</span><span class="token punctuation">)</span>

  <span class="token comment">// Customize those files</span>
  <span class="token keyword">let</span> typeDefs <span class="token operator">=</span> <span class="token function">load</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>paths<span class="token punctuation">.</span>typeDefs<span class="token punctuation">)</span> <span class="token comment">// GraphQL schema</span>
  <span class="token keyword">const</span> resolvers <span class="token operator">=</span> <span class="token function">load</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>paths<span class="token punctuation">.</span>resolvers<span class="token punctuation">)</span> <span class="token comment">// GraphQL resolvers</span>
  
  <span class="token comment">// ...</span>

  <span class="token keyword">let</span> apolloServerOptions <span class="token operator">=</span> <span class="token punctuation">{</span>
    typeDefs<span class="token punctuation">,</span>
    resolvers<span class="token punctuation">,</span>
    schemaDirectives<span class="token punctuation">,</span>
    dataSources<span class="token punctuation">,</span>
    tracing<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    cacheControl<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    engine<span class="token operator">:</span> <span class="token operator">!</span>options<span class="token punctuation">.</span>integratedEngine<span class="token punctuation">,</span>
    <span class="token comment">// Resolvers context from POST</span>
    <span class="token function-variable function">context</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> req<span class="token punctuation">,</span> connection <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> contextData
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>connection<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          contextData <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">autoCall</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token punctuation">{</span> connection <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          contextData <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">autoCall</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token punctuation">{</span> req <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
        <span class="token keyword">throw</span> e
      <span class="token punctuation">}</span>
      contextData <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> contextData<span class="token punctuation">,</span> <span class="token punctuation">{</span> pubsub <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> contextData
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// Resolvers context from WebSocket</span>
    subscriptions<span class="token operator">:</span> <span class="token punctuation">{</span>
      path<span class="token operator">:</span> options<span class="token punctuation">.</span>subscriptionsPath<span class="token punctuation">,</span>
      <span class="token function-variable function">onConnect</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">connection<span class="token punctuation">,</span> websocket</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> contextData <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
          contextData <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">autoCall</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token punctuation">{</span>
            connection<span class="token punctuation">,</span>
            websocket<span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
          contextData <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> contextData<span class="token punctuation">,</span> <span class="token punctuation">{</span> pubsub <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
          <span class="token keyword">throw</span> e
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> contextData
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>

  <span class="token comment">// Apollo Server</span>
  <span class="token keyword">const</span> server <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ApolloServer</span><span class="token punctuation">(</span>apolloServerOptions<span class="token punctuation">)</span>

  <span class="token comment">// Express middleware</span>
  <span class="token comment">// 通过 applyMiddleware() 作为 app 来传递它，来添加 Apollo Server 的中间件</span>
  server<span class="token punctuation">.</span><span class="token function">applyMiddleware</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    app<span class="token punctuation">,</span>
    path<span class="token operator">:</span> options<span class="token punctuation">.</span>graphqlPath<span class="token punctuation">,</span>
    cors<span class="token operator">:</span> options<span class="token punctuation">.</span>cors<span class="token punctuation">,</span>
    <span class="token comment">// gui: {</span>
    <span class="token comment">//   endpoint: graphqlPath,</span>
    <span class="token comment">//   subscriptionEndpoint: graphqlSubscriptionsPath,</span>
    <span class="token comment">// },</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// Start server</span>
  <span class="token keyword">const</span> httpServer <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span>
  httpServer<span class="token punctuation">.</span><span class="token function">setTimeout</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>timeout<span class="token punctuation">)</span>
  server<span class="token punctuation">.</span><span class="token function">installSubscriptionHandlers</span><span class="token punctuation">(</span>httpServer<span class="token punctuation">)</span>

  httpServer<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    host<span class="token operator">:</span> options<span class="token punctuation">.</span>host <span class="token operator">||</span> <span class="token string">'localhost'</span><span class="token punctuation">,</span>
    port<span class="token operator">:</span> options<span class="token punctuation">.</span>port<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>options<span class="token punctuation">.</span>quiet<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">✔️  GraphQL Server is running on </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>chalk<span class="token punctuation">.</span><span class="token function">cyan</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">http://localhost:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>options<span class="token punctuation">.</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>options<span class="token punctuation">.</span>graphqlPath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VUE_CLI_API_MODE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">✔️  Type </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>chalk<span class="token punctuation">.</span><span class="token function">cyan</span><span class="token punctuation">(</span><span class="token string">'rs'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> to restart the server</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    cb <span class="token operator">&amp;&amp;</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br></div></div><p>以上是 <code>server</code> 的部分代码，主要作用是利用 <code>apollo-server</code> 在 nodejs 上构建 <code>grqphql</code> 服务端的 web 中间件，由于 <code>server</code> 端是 <code>express</code> 环境， 因此使用了 npm 包 <code>apollo-server-express</code>，到这里，服务端就启动起来了。</p> <p>vue-cli-plugin-apollo</p> <p>启动 server 使用了 <a href="https://github.com/Akryum/vue-cli-plugin-apollo" target="_blank" rel="noopener noreferrer">vue-cli-plugin-apollo<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>插件， 它是 <a href="https://vue-apollo.netlify.com/zh-cn/" target="_blank" rel="noopener noreferrer">vue-apollo<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的 cli 插件，但与 vue-apollo 相比，它又有更多的新特性，比如集成了 apollo-server 以及包含一些 vue apollo 例子等等。</p> <h3 id="client-分析"><a href="#client-分析" class="header-anchor">#</a> client 分析</h3> <p>client 端可以看作是一个 vue 项目，它是通过 vue 组件构成，在 <code>ui</code> 方面使用了自家的 <a href="https://www.npmjs.com/package/@vue/ui" target="_blank" rel="noopener noreferrer">@vue/ui<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，由于 server 端采用了 graphql，因此 client 端使用了 <a href="https://github.com/Akryum/vue-apollo" target="_blank" rel="noopener noreferrer">vue-apollo<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，这样可以利用其提供的 API 和组件高效方便地使用 graphql 进行查询，变更以及订阅。</p> <p>client 端的内容非常多，从项目创建到项目配置、运行以及打包发布，涉及到的代码很多，但大部分的流程基本上一致，这就不会一一做分析了，会选择导入项目这部分来分析，因为 ui 命令也是基于插件机制的，而导入项目的时候会涉及到插件加载以及利用 PluginAPI 增强项目的配置和任务，下面就开始分析项目导入的整个过程。</p> <p>源码目录</p> <p><code>vue ui</code> 运行的客户端是要打包压缩过的代码，目录为 <code>@vue/cli-ui/dist</code>，通过以下代码设置了静态资源（文件）目录，访问 <code>localhost:8000</code> 则指向 <code>@vue/cli-ui/dist/index.html</code>,从而启动了 client 端，对应的源码目录为 <code>@vue/cli-ui/src</code>。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span>distPath<span class="token punctuation">,</span> <span class="token punctuation">{</span> maxAge<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="importproject"><a href="#importproject" class="header-anchor">#</a> importProject</h4> <p>导入项目的组件为 <code>@vue/cli-ui/src/components/project-manager/ProjectSelect.vue</code>，部分代码如下</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>actions-bar center<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>VueButton</span>
    <span class="token attr-name">icon-left</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>unarchive<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">:label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>$route.query.action || $t(<span class="token punctuation">'</span>org.vue.views.project-select.buttons.import<span class="token punctuation">'</span>)<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>big primary import-project<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">:disabled</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>folderCurrent &amp;&amp; !folderCurrent.isPackage<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">:loading</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>busy<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>importProject()<span class="token punctuation">&quot;</span></span>
  <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>这是不是看着就熟悉了，接着看 <code>importProject</code> 方法：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token function">importProject</span> <span class="token punctuation">(</span><span class="token parameter">force <span class="token operator">=</span> <span class="token boolean">false</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>showNoModulesModal <span class="token operator">=</span> <span class="token boolean">false</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>busy <span class="token operator">=</span> <span class="token boolean">true</span>
  <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$apollo<span class="token punctuation">.</span><span class="token function">mutate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      mutation<span class="token operator">:</span> <span class="token constant">PROJECT_IMPORT</span><span class="token punctuation">,</span>
      variables<span class="token operator">:</span> <span class="token punctuation">{</span>
        input<span class="token operator">:</span> <span class="token punctuation">{</span>
          path<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>folderCurrent<span class="token punctuation">.</span>path<span class="token punctuation">,</span>
          force
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'project-home'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>graphQLErrors <span class="token operator">&amp;&amp;</span> e<span class="token punctuation">.</span>graphQLErrors<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span>message <span class="token operator">===</span> <span class="token string">'NO_MODULES'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>showNoModulesModal <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>busy <span class="token operator">=</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>代码写的比较明了，当执行 <code>importProject</code> 时候会利用 vue-apollo 提供的 <code>this.$apollo.mutate()</code> 来发送一个 GraphQL 变更，从而改变服务端的数据，接下来就看服务端的 Mutation： <code>projectImport</code>。</p> <h4 id="mutation"><a href="#mutation" class="header-anchor">#</a> Mutation</h4> <p>处理 <code>projectImport</code> 变更的代码目录在 <code>@vue/cli-ui/apollo-server/schema/project.js</code> 中，代码如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>exports<span class="token punctuation">.</span>resolvers <span class="token operator">=</span> <span class="token punctuation">{</span>
  Project<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// ... </span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  Query<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// ... </span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  Mutation<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token function-variable function">projectImport</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">root<span class="token punctuation">,</span> <span class="token punctuation">{</span> input <span class="token punctuation">}</span><span class="token punctuation">,</span> context</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> projects<span class="token punctuation">.</span><span class="token function">import</span><span class="token punctuation">(</span>input<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>接着看 <code>projects.import</code>,代码目录在 <code>@vue/cli-ui/apollo-server/connectors/projects.js</code> 中，代码如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">importProject</span> <span class="token punctuation">(</span><span class="token parameter">input<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 导入项目，执行 projectImport mutate</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>input<span class="token punctuation">.</span>force <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>input<span class="token punctuation">.</span>path<span class="token punctuation">,</span> <span class="token string">'node_modules'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 强制导入没有 node_modules 的情形</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'NO_MODULES'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> project <span class="token operator">=</span> <span class="token punctuation">{</span>
    id<span class="token operator">:</span> shortId<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// shortId</span>
    path<span class="token operator">:</span> input<span class="token punctuation">.</span>path<span class="token punctuation">,</span> <span class="token comment">// 导入项目的路径</span>
    favorite<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    type<span class="token operator">:</span> folders<span class="token punctuation">.</span><span class="token function">isVueProject</span><span class="token punctuation">(</span>input<span class="token punctuation">.</span>path<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">'vue'</span> <span class="token operator">:</span> <span class="token string">'unknown'</span> <span class="token comment">// 是否为 vue 项目</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> packageData <span class="token operator">=</span> folders<span class="token punctuation">.</span><span class="token function">readPackage</span><span class="token punctuation">(</span>project<span class="token punctuation">.</span>path<span class="token punctuation">,</span> context<span class="token punctuation">)</span>
  project<span class="token punctuation">.</span>name <span class="token operator">=</span> packageData<span class="token punctuation">.</span>name
  context<span class="token punctuation">.</span>db<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'projects'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>project<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 将 project 信息存在本地的 db 中 （ lowdb 实现 ）</span>
  <span class="token keyword">return</span> <span class="token function">open</span><span class="token punctuation">(</span>project<span class="token punctuation">.</span>id<span class="token punctuation">,</span> context<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><code>importProject</code> 方法的作用就是获取导入项目的信息，并利用 <a href="https://github.com/typicode/lowdb" target="_blank" rel="noopener noreferrer">lowdb<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 将数据存储在本地（~/.vue-cli-ui/db.json），接着执行 open 方法加载插件。</p> <h4 id="插件加载"><a href="#插件加载" class="header-anchor">#</a> 插件加载</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">open</span> <span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> project <span class="token operator">=</span> <span class="token function">findOne</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> context<span class="token punctuation">)</span>
  <span class="token comment">// ...</span>
  cwd<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>project<span class="token punctuation">.</span>path<span class="token punctuation">,</span> context<span class="token punctuation">)</span> <span class="token comment">// process.env.VUE_CLI_CONTEXT</span>
  <span class="token comment">// Reset locales</span>
  locales<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span>
  <span class="token comment">// Load plugins</span>
  <span class="token comment">// 加载插件</span>
  <span class="token keyword">await</span> plugins<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span>project<span class="token punctuation">.</span>path<span class="token punctuation">,</span> context<span class="token punctuation">)</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">return</span> project
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>以上为 open 方法的部分代码，比较核心的就是 <code>await plugins.list(project.path, context)</code>,接着看</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">list</span> <span class="token punctuation">(</span><span class="token parameter">file<span class="token punctuation">,</span> context<span class="token punctuation">,</span> <span class="token punctuation">{</span> resetApi <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> lightApi <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> autoLoadApi <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> pkg <span class="token operator">=</span> folders<span class="token punctuation">.</span><span class="token function">readPackage</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> context<span class="token punctuation">)</span>
  <span class="token keyword">let</span> pkgContext <span class="token operator">=</span> cwd<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// Custom package.json location</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>pkg<span class="token punctuation">.</span>vuePlugins <span class="token operator">&amp;&amp;</span> pkg<span class="token punctuation">.</span>vuePlugins<span class="token punctuation">.</span>resolveFrom<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 加载其他文件夹里的 package.json</span>
    pkgContext <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>cwd<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pkg<span class="token punctuation">.</span>vuePlugins<span class="token punctuation">.</span>resolveFrom<span class="token punctuation">)</span>
    pkg <span class="token operator">=</span> folders<span class="token punctuation">.</span><span class="token function">readPackage</span><span class="token punctuation">(</span>pkgContext<span class="token punctuation">,</span> context<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  pkgStore<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token punctuation">{</span> pkgContext<span class="token punctuation">,</span> pkg <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">let</span> plugins <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token comment">// package.json 中 devDependencies，dependencies 插件</span>
  plugins <span class="token operator">=</span> plugins<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token function">findPlugins</span><span class="token punctuation">(</span>pkg<span class="token punctuation">.</span>devDependencies <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">)</span>
  plugins <span class="token operator">=</span> plugins<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token function">findPlugins</span><span class="token punctuation">(</span>pkg<span class="token punctuation">.</span>dependencies <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token comment">// Put cli service at the top</span>
  <span class="token keyword">const</span> index <span class="token operator">=</span> plugins<span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span><span class="token parameter">p</span> <span class="token operator">=&gt;</span> p<span class="token punctuation">.</span>id <span class="token operator">===</span> <span class="token constant">CLI_SERVICE</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> service <span class="token operator">=</span> plugins<span class="token punctuation">[</span>index<span class="token punctuation">]</span>
    plugins<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    plugins<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span>service<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  pluginsStore<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> plugins<span class="token punctuation">)</span>

  <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Plugins found:'</span><span class="token punctuation">,</span> plugins<span class="token punctuation">.</span>length<span class="token punctuation">,</span> chalk<span class="token punctuation">.</span><span class="token function">grey</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>resetApi <span class="token operator">||</span> <span class="token punctuation">(</span>autoLoadApi <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>pluginApiInstances<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token function">resetPluginApi</span><span class="token punctuation">(</span><span class="token punctuation">{</span> file<span class="token punctuation">,</span> lightApi <span class="token punctuation">}</span><span class="token punctuation">,</span> context<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> plugins
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p><code>list</code> 方法首先会获取 package.json 里 <code>devDependencies</code> 和 <code>dependencies</code> 字段中的 UI 插件，接着执行 <code>resetPluginApi</code> 函数调用 UI 插件的 API，<code>resetPluginApi</code> 方法部分代码如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">resetPluginApi</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> file<span class="token punctuation">,</span> lightApi <span class="token punctuation">}</span><span class="token punctuation">,</span> context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token comment">// Cyclic dependency with projects connector</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// ...</span>
      pluginApi <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PluginApi</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        plugins<span class="token punctuation">,</span>
        file<span class="token punctuation">,</span>
        project<span class="token punctuation">,</span>
        lightMode<span class="token operator">:</span> lightApi
      <span class="token punctuation">}</span><span class="token punctuation">,</span> context<span class="token punctuation">)</span>
      pluginApiInstances<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> pluginApi<span class="token punctuation">)</span>

      <span class="token comment">// Run Plugin API</span>
      <span class="token comment">// 默认的插件 suggest,task,config,widgets</span>
      <span class="token function">runPluginApi</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../../'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pluginApi<span class="token punctuation">,</span> context<span class="token punctuation">,</span> <span class="token string">'ui-defaults'</span><span class="token punctuation">)</span>

      <span class="token comment">// devDependencies dependencies 插件</span>
      plugins<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">plugin</span> <span class="token operator">=&gt;</span> <span class="token function">runPluginApi</span><span class="token punctuation">(</span>plugin<span class="token punctuation">.</span>id<span class="token punctuation">,</span> pluginApi<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token comment">// Local plugins</span>
      <span class="token comment">// package.json 中 vuePlugins.ui 插件</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> pkg<span class="token punctuation">,</span> pkgContext <span class="token punctuation">}</span> <span class="token operator">=</span> pkgStore<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>pkg<span class="token punctuation">.</span>vuePlugins <span class="token operator">&amp;&amp;</span> pkg<span class="token punctuation">.</span>vuePlugins<span class="token punctuation">.</span>ui<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> files <span class="token operator">=</span> pkg<span class="token punctuation">.</span>vuePlugins<span class="token punctuation">.</span>ui
        <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> file <span class="token keyword">of</span> files<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">runPluginApi</span><span class="token punctuation">(</span>pkgContext<span class="token punctuation">,</span> pluginApi<span class="token punctuation">,</span> context<span class="token punctuation">,</span> file<span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// Add client addons</span>
      pluginApi<span class="token punctuation">.</span>clientAddons<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">options</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        clientAddons<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> context<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token comment">// Add views</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> view <span class="token keyword">of</span> pluginApi<span class="token punctuation">.</span>views<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">await</span> views<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">{</span> view<span class="token punctuation">,</span> project <span class="token punctuation">}</span><span class="token punctuation">,</span> context<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// Register widgets</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> definition <span class="token keyword">of</span> pluginApi<span class="token punctuation">.</span>widgetDefs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">await</span> widgets<span class="token punctuation">.</span><span class="token function">registerDefinition</span><span class="token punctuation">(</span><span class="token punctuation">{</span> definition<span class="token punctuation">,</span> project <span class="token punctuation">}</span><span class="token punctuation">,</span> context<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// callHook ...</span>
      <span class="token comment">// Load widgets for current project</span>
      widgets<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br></div></div><p><code>resetPluginApi</code> 方法主要利用函数 <code>runPluginApi</code> 执行所有 UI 插件的 PluginAPI，这里的 UI 插件来源主要有三部分组成：</p> <ul><li><strong>内置 UI 插件</strong>：包括了配置插件，建议插件（vue-router，vuex），任务插件以及看板部分的 widget 插件</li> <li><strong>package.json UI 插件</strong>：项目中依赖的 UI 插件，可以通过 vuePlugins.resolveFrom 指定 package.json 位置</li> <li><strong>vuePlugins.ui</strong>： package.json 中 vuePlugins 字段中的 UI 插件，这样可以直接访问插件 API</li></ul> <p>还是按照流程继续看下 <code>runPluginApi</code> 的核心代码：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">runPluginApi</span> <span class="token punctuation">(</span>id<span class="token punctuation">,</span> pluginApi<span class="token punctuation">,</span> context<span class="token punctuation">,</span> filename <span class="token operator">=</span> <span class="token string">'ui'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    module <span class="token operator">=</span> <span class="token function">loadModule</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>filename<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> pluginApi<span class="token punctuation">.</span>cwd<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>module<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> module <span class="token operator">!==</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      pluginApi<span class="token punctuation">.</span>pluginId <span class="token operator">=</span> id
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token function">module</span><span class="token punctuation">(</span>pluginApi<span class="token punctuation">)</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Plugin API loaded for'</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> chalk<span class="token punctuation">.</span><span class="token function">grey</span><span class="token punctuation">(</span>pluginApi<span class="token punctuation">.</span>cwd<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
      pluginApi<span class="token punctuation">.</span>pluginId <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>首先尝试加载 UI 插件的 ui.js (也可以ui/index.js)，对于内置的 UI 插件，则加载 id/ui-defaults/index.js，加载完成以后则执行其 PluginAPI，<a href="https://cli.vuejs.org/zh/dev-guide/ui-api.html#ui-%E6%96%87%E4%BB%B6" target="_blank" rel="noopener noreferrer">PluginAPI<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 提供了很多的方法来增强项目的配置和任务以及分享数据和在进程间进行通信，具体查看官方文档，PluginAPI 在整个插件机制中是十分重要的一部分。在加载完所有 UI 插件后，则加载 PluginAPI 实例中 <code>addons</code>， <code>views</code> 和 <code>widgetDefs</code> 注册的 vue 组件。以 <code>client addons</code> 为例简单看下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">add</span> <span class="token punctuation">(</span><span class="token parameter">options<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">findOne</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">remove</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>id<span class="token punctuation">,</span> context<span class="token punctuation">)</span>

  addons<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
  context<span class="token punctuation">.</span>pubsub<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span>channels<span class="token punctuation">.</span><span class="token constant">CLIENT_ADDON_ADDED</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    clientAddonAdded<span class="token operator">:</span> options
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>当执行 <code>clientAddons.add(options, context)</code> 会发布一个订阅，而 client 端在 <code>cli-ui/src/components/client-addon/ClientAddonLoader.vue</code> 中启用了 <code>client_addon_added</code> 订阅：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>apollo<span class="token operator">:</span> <span class="token punctuation">{</span>
  clientAddons<span class="token operator">:</span> <span class="token punctuation">{</span>
    query<span class="token operator">:</span> <span class="token constant">CLIENT_ADDONS</span><span class="token punctuation">,</span>
    fetchPolicy<span class="token operator">:</span> <span class="token string">'no-cache'</span><span class="token punctuation">,</span>
    manual<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token function">result</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> data<span class="token operator">:</span> <span class="token punctuation">{</span> clientAddons <span class="token punctuation">}</span><span class="token punctuation">,</span> stale <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>stale<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        clientAddons<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>loadAddon<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$_lastRead <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  $subscribe<span class="token operator">:</span> <span class="token punctuation">{</span>
    clientAddonAdded<span class="token operator">:</span> <span class="token punctuation">{</span>
      query<span class="token operator">:</span> <span class="token constant">CLIENT_ADDON_ADDED</span><span class="token punctuation">,</span>
      <span class="token function">result</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> data <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$_lastRead <span class="token operator">&amp;&amp;</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$_lastRead <span class="token operator">&gt;</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">loadAddon</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>clientAddonAdded<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>当在 server 端发布了一个订阅后，client 端会就是执行 <code>loadAddon</code> 从而加载客户端 addon 包，<code>loadAddon</code> 代码如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">loadAddon</span> <span class="token punctuation">(</span><span class="token parameter">addon</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// eslint-disable-next-line no-console</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[UI] Loading client addon </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>addon<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> (</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>addon<span class="token punctuation">.</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)...</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span>
  script<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">,</span> addon<span class="token punctuation">.</span>url<span class="token punctuation">)</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><code>loadAddon</code> 方法通过 <code>&lt;script&gt;</code> 标签的方式将客户端 addon 包引入，view，widgets 这就暂不分析了，可自行查看下。 在 UI 插件加载完毕后，会执行对应的钩子回调 callHook。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>projectId <span class="token operator">!==</span> project<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">callHook</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token string">'projectOpen'</span><span class="token punctuation">,</span>
    args<span class="token operator">:</span> <span class="token punctuation">[</span>project<span class="token punctuation">,</span> projects<span class="token punctuation">.</span><span class="token function">getLast</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    file
  <span class="token punctuation">}</span><span class="token punctuation">,</span> context<span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token function">callHook</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token string">'pluginReload'</span><span class="token punctuation">,</span>
    args<span class="token operator">:</span> <span class="token punctuation">[</span>project<span class="token punctuation">]</span><span class="token punctuation">,</span>
    file
  <span class="token punctuation">}</span><span class="token punctuation">,</span> context<span class="token punctuation">)</span>

  <span class="token comment">// View open hook</span>
  <span class="token keyword">const</span> currentView <span class="token operator">=</span> views<span class="token punctuation">.</span><span class="token function">getCurrent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>currentView<span class="token punctuation">)</span> views<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>currentView<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>最后再加载当前项目的 widgets，到这里加载插件，即下面这段代码执行完毕：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">await</span> plugins<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span>project<span class="token punctuation">.</span>path<span class="token punctuation">,</span> context<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>接着看 <code>open</code> 函数剩下的部分:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// Date</span>
context<span class="token punctuation">.</span>db<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'projects'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  openDate<span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// Save for next time</span>
context<span class="token punctuation">.</span>db<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'config.lastOpenProject'</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Project open'</span><span class="token punctuation">,</span> id<span class="token punctuation">,</span> project<span class="token punctuation">.</span>path<span class="token punctuation">)</span>
<span class="token keyword">return</span> project
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>这段代码的作用就是将当前项目的信息存储在本地 db 中作为下次默认打开，执行到这里打开项目 <code>importProject</code> 的整个过程就分析完了。</p> <h3 id="总结-4"><a href="#总结-4" class="header-anchor">#</a> 总结</h3> <p>vue-cli 3.0 中 UI 系统应该是一个亮点，通过完整的 GUI 形式来管理整个 vue 项目，ui 命令涉及的知识应该算是比较多的，在刚开始分析的时候由于对 graphql 了解的比较少，对代码的整个运行不是很清楚，在了解 graphql 以及 vue-apollo 之后，对于 ui 命令的代码就有了思路。ui 系统其实也是基于插件机制的，比较核心的就是 PluginAPI，通过分析打开项目 <code>importProject</code> 可以比较清楚的了解 UI 插件是如何利用 PluginAPI 来增强项目的配置和任务，如果对 PluginAPI 不是很清楚的话可以看下 <code>packages/@vue/cli-ui-addon-webpack</code> 代码，<code>cli-ui-addon-webpack</code> 创建了项目任务模块中 webpack 客户端 addon（serve，build）。</p> <p>vue-cli 3.0 中核心部分是 <a href="https://github.com/vuejs/vue-cli/blob/dev/packages/%40vue/cli/lib/Creator.js" target="_blank" rel="noopener noreferrer">Creator<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 和 <a href="https://github.com/vuejs/vue-cli/blob/dev/packages/%40vue/cli-service/lib/Service.js" target="_blank" rel="noopener noreferrer">Service<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, 可在 create 部分可 vue-cli-service 部分查看具体分析 ，ui 命令是一个 GUI 的形式，在后台运行的还是 nodejs 代码，比如点击创建项目的时候还是会引入<code>@vue/cli/lib/Creator</code> 并执行，点击任务看板中的 “运行” 实质执行的是 <code>vue-cli-service serve</code> 命令。</p> <h2 id="vue-init"><a href="#vue-init" class="header-anchor">#</a> <code>vue init</code></h2> <h3 id="init-命令"><a href="#init-命令" class="header-anchor">#</a> init 命令</h3> <p><strong>源码目录：</strong> packages/@vue/cli-init/index.js 。</p> <p><strong>作用：</strong> 下载远程模板并生成项目 。</p> <p><strong>相关说明：</strong> <code>vue init</code> 命令主要是 2.x 版本使用，但在 3.0中还是将其保留，3.0 推荐使用 <code>vue create</code> 。</p> <p><code>vue init</code> 命令的入口在 packages/@vue/cli/bin/vue.js 中:</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>program
  <span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">'init &lt;template&gt; &lt;app-name&gt;'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">description</span><span class="token punctuation">(</span><span class="token string">'generate a project from a remote template (legacy API, requires @vue/cli-init)'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'-c, --clone'</span><span class="token punctuation">,</span> <span class="token string">'Use git clone when fetching remote template'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'--offline'</span><span class="token punctuation">,</span> <span class="token string">'Use cached template'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">loadCommand</span><span class="token punctuation">(</span><span class="token string">'init'</span><span class="token punctuation">,</span> <span class="token string">'@vue/cli-init'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>vue init 命令需要输入模版的名称（template）以及 项目名称（app-name），而且都为必填。模版名称可以是官方的模板，<a href="https://github.com/vuejs-templates" target="_blank" rel="noopener noreferrer">官方模版<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 包含了 <a href="https://github.com/vuejs-templates/webpack" target="_blank" rel="noopener noreferrer">webpack<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，<a href="https://github.com/vuejs-templates/pwa" target="_blank" rel="noopener noreferrer">pwa<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，<a href="https://github.com/vuejs-templates/webpack-simple" target="_blank" rel="noopener noreferrer">webpack-simple<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，<a href="https://github.com/vuejs-templates/simple" target="_blank" rel="noopener noreferrer">simple<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，<a href="https://github.com/vuejs-templates/browserify" target="_blank" rel="noopener noreferrer">browserify<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，<a href="https://github.com/vuejs-templates/browserify-simple" target="_blank" rel="noopener noreferrer">browserify-simple<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 这 6 种模板。当然支持自定义 Github 模板，比如初始化 <code>mpvue-quickstart</code>的命令如下：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>vue init mpvue/mpvue-quickstart my-project
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><a href="https://github.com/mpvue/mpvue-quickstart" target="_blank" rel="noopener noreferrer">mpvue/mpvue-quickstart<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 中的 <code>template</code> 就为mpvue-quickstart 的内容。</p> <p>另外 option 包含了 -c 和 -offline，这两个参数的作用为：</p> <ul><li>-c：当利用 <code>download-git-repo</code> 获取模版的时候采用<code>git clone</code>下载而不是<code>http 下载</code>，默认采用 http 下载。</li> <li>--offline：使用缓存的 template 模板，位于<code>~/.vue-templates</code>目录下面。</li></ul> <p>当执行 <code>vue-init</code> 命令的时候 <code>loadCommand</code> 函数会加载 <code>@vue/cli-init</code> 模块，这也是为什么当你安装了 <code>@vue/cli</code>，但没有安装 <code>@vue/cli-init</code> 的时候执行 <code>vue init &lt;template&gt; &lt;app-name&gt;</code> 会有以下的提示：</p> <p><img src="https://kuangpf.com/vue-cli-analysis/assets/init-img01.png" alt="img"></p> <p>接下来我们就开始分析<code>@vue/cli-init</code> 模块做了什么事情。</p> <h3 id="vue-cli-init-分析"><a href="#vue-cli-init-分析" class="header-anchor">#</a> @vue/cli-init 分析</h3> <p><code>@vue/cli-init</code> 的源码很简单，如下：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> execa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'execa'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> binPath <span class="token operator">=</span> require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'vue-cli/bin/vue-init'</span><span class="token punctuation">)</span>

<span class="token function">execa</span><span class="token punctuation">(</span>
  binPath<span class="token punctuation">,</span>
  process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'init'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> stdio<span class="token operator">:</span> <span class="token string">'inherit'</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>对，你没有看错，这就是 <code>@vue/cli-init 的源码</code>。这段代码引入了 <a href="https://github.com/sindresorhus/execa" target="_blank" rel="noopener noreferrer">execa<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，execa 是可以调用 shell 和本地外部程序的 javascript 封装，会启动子进程执行。支持多操作系统，包括 windows。如果父进程退出，则生成的全部子进程都被杀死。对应在这里就会启动一个子线程去执行 <code>vue-cli/bin/vue-init</code> 脚本，那么 <code>vue-cli/bin/vue-init</code> 又是什么脚本？其实就是 <code>vue-cli 2.x</code> 中对应 <code>vue init</code> 的脚本（<code>vue cli 3.0</code> 中 <code>vue init</code> 命令的源码就是加载 <code>vue-cli 2.x</code> 中的 <code>vue init</code> 命令）。</p> <p>那么接下来就开始分析 <code>vue-cli 2.x</code> 中 <code>init</code> 命令的源码。</p> <h3 id="vue-cli-2-x-init-分析"><a href="#vue-cli-2-x-init-分析" class="header-anchor">#</a> vue-cli 2.x init 分析</h3> <p>当开始执行 <code>vue-cli-init/bin/vue-init</code> 的代码时，会进入这个判断：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>inPlace <span class="token operator">||</span> <span class="token function">exists</span><span class="token punctuation">(</span>to<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  inquirer<span class="token punctuation">.</span><span class="token function">prompt</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{</span>
    type<span class="token operator">:</span> <span class="token string">'confirm'</span><span class="token punctuation">,</span>
    message<span class="token operator">:</span> inPlace
      <span class="token operator">?</span> <span class="token string">'Generate project in current directory?'</span>
      <span class="token operator">:</span> <span class="token string">'Target directory exists. Continue?'</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">'ok'</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">answers</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>answers<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>logger<span class="token punctuation">.</span>fatal<span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>这段代码的作用是：</p> <ul><li>如果没有填写 app-name ,则默认在当前目录生成模版。 在 vue-cli 3.0 中 app-name 为必填，不过在 vue-cli 2.x 中为非必填。</li> <li>如果当前目录有与 app-name 重名的，是否要继续。</li></ul> <p>然后根据用户的回答来判断是否执行 <code>run</code> 函数，对应的代码如下：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">run</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// check if template is local</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isLocalPath</span><span class="token punctuation">(</span>template<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> templatePath <span class="token operator">=</span> <span class="token function">getTemplatePath</span><span class="token punctuation">(</span>template<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">exists</span><span class="token punctuation">(</span>templatePath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">generate</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> templatePath<span class="token punctuation">,</span> to<span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> logger<span class="token punctuation">.</span><span class="token function">fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        logger<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">'Generated &quot;%s&quot;.'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      logger<span class="token punctuation">.</span><span class="token function">fatal</span><span class="token punctuation">(</span><span class="token string">'Local template &quot;%s&quot; not found.'</span><span class="token punctuation">,</span> template<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">checkVersion</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>hasSlash<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// use official templates</span>
        <span class="token keyword">const</span> officialTemplate <span class="token operator">=</span> <span class="token string">'vuejs-templates/'</span> <span class="token operator">+</span> template
        <span class="token keyword">if</span> <span class="token punctuation">(</span>template<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'#'</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">downloadAndGenerate</span><span class="token punctuation">(</span>officialTemplate<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>template<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'-2.0'</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            warnings<span class="token punctuation">.</span><span class="token function">v2SuffixTemplatesDeprecated</span><span class="token punctuation">(</span>template<span class="token punctuation">,</span> inPlace <span class="token operator">?</span> <span class="token string">''</span> <span class="token operator">:</span> name<span class="token punctuation">)</span>
            <span class="token keyword">return</span>
          <span class="token punctuation">}</span>

          <span class="token comment">// warnings.v2BranchIsNowDefault(template, inPlace ? '' : name)</span>
          <span class="token function">downloadAndGenerate</span><span class="token punctuation">(</span>officialTemplate<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">downloadAndGenerate</span><span class="token punctuation">(</span>template<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p><code>run</code> 函数作用如下：</p> <ul><li>是否需要从缓存中读取模版并生成</li> <li>下载官方模板还是自定义模板</li></ul> <p>如果按照正常流程来的话（方便下一步描述，不然 <code>return</code> 了就没得什么分析的了）会执行 <code>downloadAndGenerate</code> 函数，总算到了核心部分了，来看一下 <code>downloadAndGenerate</code> 函数的代码：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">downloadAndGenerate</span> <span class="token punctuation">(</span><span class="token parameter">template</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> spinner <span class="token operator">=</span> <span class="token function">ora</span><span class="token punctuation">(</span><span class="token string">'downloading template'</span><span class="token punctuation">)</span>
  spinner<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// Remove if local template exists</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">exists</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">rm</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span>
  <span class="token function">download</span><span class="token punctuation">(</span>template<span class="token punctuation">,</span> tmp<span class="token punctuation">,</span> <span class="token punctuation">{</span> clone <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    spinner<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> logger<span class="token punctuation">.</span><span class="token function">fatal</span><span class="token punctuation">(</span><span class="token string">'Failed to download repo '</span> <span class="token operator">+</span> template <span class="token operator">+</span> <span class="token string">': '</span> <span class="token operator">+</span> err<span class="token punctuation">.</span>message<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token function">generate</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> tmp<span class="token punctuation">,</span> to<span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> logger<span class="token punctuation">.</span><span class="token function">fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      logger<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">'Generated &quot;%s&quot;.'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><code>downloadAndGenerate</code> 函数其实很简洁，就是利用 <a href="https://github.com/flipxfx/download-git-repo" target="_blank" rel="noopener noreferrer">download-git-repo<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 从 Github 拉取模板，然后生成在 <code>~/.vue-templates</code>目录下面，之后会又会调用 <code>generate</code> 函数将<code>~/.vue-templates</code> 目录下面的模板来生成文件。</p> <p>到这里也许有些朋友会问：直接把模板下载下来放在 /app-name 目录下面不就可以了？如果是静态的模板的的确可以这么做，但是在 vue-cli 初始化一个项目的过程中会询问你 <code>Project name</code>， <code>Project description</code> 以及是否需要安装 <code>vue-router</code>等等，最后会根据你的回答来生成对应的文件，所以直接将静态的模板放在 /app-name 目录显然不行，因此调用<code>generate</code> 函数动态地生成模板。</p> <p>其实分析到这里就会发现 vue-cli 会将一个功能拆分为多个模块来写，这中模块化的思想是非常值得学习的，好了，下一节开始分析 <code>generate</code> 函数的实现，这也是 init 命令中最核心的部分。</p> <h3 id="generate-函数分析"><a href="#generate-函数分析" class="header-anchor">#</a> generate 函数分析</h3> <p>首先直接看代码：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">generate</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> src<span class="token punctuation">,</span> dest<span class="token punctuation">,</span> done</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> opts <span class="token operator">=</span> <span class="token function">getOptions</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> src<span class="token punctuation">)</span> <span class="token comment">// 获取配置信息</span>
  <span class="token keyword">const</span> metalsmith <span class="token operator">=</span> <span class="token function">Metalsmith</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> <span class="token string">'template'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// 定义 Metalsmith 工作目录  ~/.vue-templates`</span>
  <span class="token keyword">const</span> data <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>metalsmith<span class="token punctuation">.</span><span class="token function">metadata</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token comment">// 定义一些全局变量，这样可以在 layout-files 中使用</span>
    destDirName<span class="token operator">:</span> name<span class="token punctuation">,</span>
    inPlace<span class="token operator">:</span> dest <span class="token operator">===</span> process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    noEscape<span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  opts<span class="token punctuation">.</span>helpers <span class="token operator">&amp;&amp;</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>opts<span class="token punctuation">.</span>helpers<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    Handlebars<span class="token punctuation">.</span><span class="token function">registerHelper</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> opts<span class="token punctuation">.</span>helpers<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> helpers <span class="token operator">=</span> <span class="token punctuation">{</span> chalk<span class="token punctuation">,</span> logger <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>opts<span class="token punctuation">.</span>metalsmith <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> opts<span class="token punctuation">.</span>metalsmith<span class="token punctuation">.</span>before <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    opts<span class="token punctuation">.</span>metalsmith<span class="token punctuation">.</span><span class="token function">before</span><span class="token punctuation">(</span>metalsmith<span class="token punctuation">,</span> opts<span class="token punctuation">,</span> helpers<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  metalsmith<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">askQuestions</span><span class="token punctuation">(</span>opts<span class="token punctuation">.</span>prompts<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">filterFiles</span><span class="token punctuation">(</span>opts<span class="token punctuation">.</span>filters<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">renderTemplateFiles</span><span class="token punctuation">(</span>opts<span class="token punctuation">.</span>skipInterpolation<span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> opts<span class="token punctuation">.</span>metalsmith <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    opts<span class="token punctuation">.</span><span class="token function">metalsmith</span><span class="token punctuation">(</span>metalsmith<span class="token punctuation">,</span> opts<span class="token punctuation">,</span> helpers<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>opts<span class="token punctuation">.</span>metalsmith <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> opts<span class="token punctuation">.</span>metalsmith<span class="token punctuation">.</span>after <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    opts<span class="token punctuation">.</span>metalsmith<span class="token punctuation">.</span><span class="token function">after</span><span class="token punctuation">(</span>metalsmith<span class="token punctuation">,</span> opts<span class="token punctuation">,</span> helpers<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  metalsmith<span class="token punctuation">.</span><span class="token function">clean</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span> <span class="token comment">// start from template root instead of `./src` which is Metalsmith's default for `source`</span>
    <span class="token punctuation">.</span><span class="token function">destination</span><span class="token punctuation">(</span>dest<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> files</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">done</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> opts<span class="token punctuation">.</span>complete <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> helpers <span class="token operator">=</span> <span class="token punctuation">{</span> chalk<span class="token punctuation">,</span> logger<span class="token punctuation">,</span> files <span class="token punctuation">}</span>
        opts<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> helpers<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">logMessage</span><span class="token punctuation">(</span>opts<span class="token punctuation">.</span>completeMessage<span class="token punctuation">,</span> data<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> data
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><p>我们将这段代码分为以下部分来讲：</p> <h4 id="getoptions"><a href="#getoptions" class="header-anchor">#</a> getOptions</h4> <p>根据这语以化的函数名就知道这是获取配置的，然后详细看下 <code>getOptions</code> 函数的代码：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">options</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> dir</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> opts <span class="token operator">=</span> <span class="token function">getMetadata</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span> <span class="token comment">// 获取 meta.js 里面的信息，比如：prompts，helpers，filters 等等</span>

  <span class="token function">setDefault</span><span class="token punctuation">(</span>opts<span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span> <span class="token comment">// 将 meta.js 里面 prompts 字段添加到 inquirer 中，完成命令行的交互</span>
  <span class="token function">setValidateName</span><span class="token punctuation">(</span>opts<span class="token punctuation">)</span> <span class="token comment">// 检查包的名称是否符合规范</span>

  <span class="token comment">// 获取 name 和 email，用于生成 package.json 里面的 author 字段</span>
  <span class="token keyword">const</span> author <span class="token operator">=</span> <span class="token function">getGitUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// git config --get user.name , git config --get user.email</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>author<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setDefault</span><span class="token punctuation">(</span>opts<span class="token punctuation">,</span> <span class="token string">'author'</span><span class="token punctuation">,</span> author<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> opts
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><code>setValidateName</code> 的作用就是利用 <a href="https://github.com/atlassian/validate-npm-package" target="_blank" rel="noopener noreferrer">validate-npm-package-name<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 检查你输入的 app-name 是否符合 npm 包名命名规范，当然你也可以在 <code>meta.js</code> 中的 <code>prompts</code> 字段中的 <code>name</code> 下面增加 <code>validate</code> 字段来进行校验，但和 <code>validate-npm-package-name</code> 的规则是 &amp;&amp; 的关系。比如，当你输入的 app-name 包含了大写字母，就会有以下的提示：</p> <p><img src="/rat-summ/assets/img/init-img02.0845d164.png" alt="img"></p> <h4 id="handlebars-registerhelper"><a href="#handlebars-registerhelper" class="header-anchor">#</a> Handlebars.registerHelper</h4> <p><code>Handlebars.registerHelper</code> 用于注册一些 <code>helper</code>（或者说成是一些逻辑方法），在模版中来处理一些数据，比如像源码中注册的 <code>if_eq</code> <code>helper</code>，他的作用就是判断两个字符串是否相等。然后在 <code>webpack</code> 的模板中就有以下的用法：</p> <p><img src="/rat-summ/assets/img/init-img03.88fa087b.png" alt="img"></p> <p>就是根据你在构建项目时选择的 <code>test runner （Jest，Karma and Mocha，none configure it yourself）</code> 来生成对应的 <code>npm script</code>。你也可以在 <code>meta.js</code> 中添加自定义的 <code>helper</code>，<code>vue-cli</code> 会帮你注册到 <code>Handlebars</code> 中。</p> <h4 id="opts-metalsmith"><a href="#opts-metalsmith" class="header-anchor">#</a> opts.metalsmith</h4> <p>先看一段源码：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>opts<span class="token punctuation">.</span>metalsmith <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> opts<span class="token punctuation">.</span>metalsmith<span class="token punctuation">.</span>before <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    opts<span class="token punctuation">.</span>metalsmith<span class="token punctuation">.</span><span class="token function">before</span><span class="token punctuation">(</span>metalsmith<span class="token punctuation">,</span> opts<span class="token punctuation">,</span> helpers<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  metalsmith<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">askQuestions</span><span class="token punctuation">(</span>opts<span class="token punctuation">.</span>prompts<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">filterFiles</span><span class="token punctuation">(</span>opts<span class="token punctuation">.</span>filters<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">renderTemplateFiles</span><span class="token punctuation">(</span>opts<span class="token punctuation">.</span>skipInterpolation<span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> opts<span class="token punctuation">.</span>metalsmith <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    opts<span class="token punctuation">.</span><span class="token function">metalsmith</span><span class="token punctuation">(</span>metalsmith<span class="token punctuation">,</span> opts<span class="token punctuation">,</span> helpers<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>opts<span class="token punctuation">.</span>metalsmith <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> opts<span class="token punctuation">.</span>metalsmith<span class="token punctuation">.</span>after <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    opts<span class="token punctuation">.</span>metalsmith<span class="token punctuation">.</span><span class="token function">after</span><span class="token punctuation">(</span>metalsmith<span class="token punctuation">,</span> opts<span class="token punctuation">,</span> helpers<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><code>opts.metalsmith</code> 的作用就是合并一些全局变量，怎么理解呢，我们从 <code>webpack</code> 模板入手。在 <code>webpack</code> 模板的 <code>meta.js</code> 中含有<code>metalsmith.after</code>:</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  metalsmith<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// When running tests for the template, this adds answers for the selected scenario</span>
    before<span class="token operator">:</span> addTestAnswers
  <span class="token punctuation">}</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>然后一步一步找到 <code>addTestAnswers</code>：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> scenarios <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token string">'full'</span><span class="token punctuation">,</span> 
  <span class="token string">'full-karma-airbnb'</span><span class="token punctuation">,</span> 
  <span class="token string">'minimal'</span>
<span class="token punctuation">]</span>

<span class="token keyword">const</span> index <span class="token operator">=</span> scenarios<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VUE_TEMPL_TEST</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> isTest <span class="token operator">=</span> exports<span class="token punctuation">.</span>isTest <span class="token operator">=</span> index <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span>

<span class="token keyword">const</span> scenario <span class="token operator">=</span> isTest <span class="token operator">&amp;&amp;</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>scenarios<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.json</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>

exports<span class="token punctuation">.</span><span class="token function-variable function">addTestAnswers</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">metalsmith<span class="token punctuation">,</span> options<span class="token punctuation">,</span> helpers</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>
    metalsmith<span class="token punctuation">.</span><span class="token function">metadata</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> isNotTest<span class="token operator">:</span> <span class="token operator">!</span>isTest <span class="token punctuation">}</span><span class="token punctuation">,</span>
    isTest <span class="token operator">?</span> scenario <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p><code>metalsmith.before</code> 结果就是将 <code>metalsmith metadata</code> 数据和 <code>isNotTest</code> 合并，如果 <code>isTest</code> 为 <code>ture</code>，还会自动设置 <code>name</code>，<code>description</code>等字段。那么它的作用是什么呢，作用就是为模版添加自动测试脚本，它会将 <code>isNotTest</code> 设置为 <code>false</code>，而通过 <code>inquirer</code> 来提问又会是在 <code>isNotTest</code> 为 <code>true</code> 的情况下才会发生，因此设置了<code>VUE_TEMPL_TEST</code>的值会省略 <code>inquirer</code> 提问过程，并且会根据你设置的值来生成对应的模板，有以下三种值可以设置：</p> <ul><li><strong>minimal</strong>：这种不会设置 router，eslint 和 tests</li> <li><strong>full</strong>： 会带有 router，eslint (standard) 和 tests (jest &amp; e2e)</li> <li><strong>full-airbnb-karma</strong>：带有 router eslint（airbnb） 和 tests（karma）</li></ul> <p>那么如何使用某一种呢，命令如下：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token assign-left variable">VUE_TEMPL_TEST</span><span class="token operator">=</span>full vue init webpack demo
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在这种情况下，会自动跳过 <code>inquirer</code> 的问题，并生成你设置的 <code>VUE_TEMPL_TEST</code>。</p> <p><img src="/rat-summ/assets/img/init-img04.253833b3.png" alt="img"></p> <h4 id="metalsmith-use"><a href="#metalsmith-use" class="header-anchor">#</a> metalsmith.use</h4> <p><code>metalsmith.use</code> 是 <code>metalsmith</code> 使用插件的写法，前面说过 <code>metalsmith</code> 最大的特点就是所有的逻辑都是由插件处理，在 <code>generate</code> 函数中一共有使用了三个 <code>metalsmith</code> 插件，分别为：<code>askQuestions</code> <code>filterFiles</code> <code>renderTemplateFiles</code> 。</p> <ul><li>askQuestions</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">askQuestions</span> <span class="token punctuation">(</span><span class="token parameter">prompts</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">files<span class="token punctuation">,</span> metalsmith<span class="token punctuation">,</span> done</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">ask</span><span class="token punctuation">(</span>prompts<span class="token punctuation">,</span> metalsmith<span class="token punctuation">.</span><span class="token function">metadata</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> done<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>ask 函数又是独立出来的一个模块，源码（主要代码）为：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//  ...</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">ask</span> <span class="token punctuation">(</span><span class="token parameter">prompts<span class="token punctuation">,</span> data<span class="token punctuation">,</span> done</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  async<span class="token punctuation">.</span><span class="token function">eachSeries</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>prompts<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">prompt</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> prompts<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> next<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> done<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">prompt</span> <span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> prompt<span class="token punctuation">,</span> done</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// skip prompts whose when condition is not met</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>prompt<span class="token punctuation">.</span>when <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">evaluate</span><span class="token punctuation">(</span>prompt<span class="token punctuation">.</span>when<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">let</span> promptDefault <span class="token operator">=</span> prompt<span class="token punctuation">.</span>default
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> prompt<span class="token punctuation">.</span>default <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">promptDefault</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> prompt<span class="token punctuation">.</span><span class="token function">default</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  inquirer<span class="token punctuation">.</span><span class="token function">prompt</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{</span>
    type<span class="token operator">:</span> promptMapping<span class="token punctuation">[</span>prompt<span class="token punctuation">.</span>type<span class="token punctuation">]</span> <span class="token operator">||</span> prompt<span class="token punctuation">.</span>type<span class="token punctuation">,</span>
    name<span class="token operator">:</span> key<span class="token punctuation">,</span>
    message<span class="token operator">:</span> prompt<span class="token punctuation">.</span>message <span class="token operator">||</span> prompt<span class="token punctuation">.</span>label <span class="token operator">||</span> key<span class="token punctuation">,</span>
    <span class="token keyword">default</span><span class="token operator">:</span> promptDefault<span class="token punctuation">,</span>
    choices<span class="token operator">:</span> prompt<span class="token punctuation">.</span>choices <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    validate<span class="token operator">:</span> prompt<span class="token punctuation">.</span>validate <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">answers</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>answers<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      data<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
      answers<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">multiChoiceAnswer</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        data<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">[</span>multiChoiceAnswer<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> answers<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      data<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> answers<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&quot;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">'\\&quot;'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      data<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> answers<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
    <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>done<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><p>根据这个语以话的命令以及看一些 <code>ask</code> 函数的实现，就明白这个 <code>askQuestions</code> 就是通过 <code>inquirer.prompt</code> 来实现命令行交互，并将交互的值通过 <code>metalsmith.metadata()</code> 存到全局，然后在渲染模板的时候直接获取这些值。</p> <ul><li>filterFiles</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">filterFiles</span> <span class="token punctuation">(</span><span class="token parameter">filters</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">files<span class="token punctuation">,</span> metalsmith<span class="token punctuation">,</span> done</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">filter</span><span class="token punctuation">(</span>files<span class="token punctuation">,</span> filters<span class="token punctuation">,</span> metalsmith<span class="token punctuation">.</span><span class="token function">metadata</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> done<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>filter 函数也是独立出来的一个模块，源码（主要代码）如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">files<span class="token punctuation">,</span> filters<span class="token punctuation">,</span> data<span class="token punctuation">,</span> done</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>filters<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> fileNames <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span>
  Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>filters<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">glob</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    fileNames<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">file</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">match</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> glob<span class="token punctuation">,</span> <span class="token punctuation">{</span> dot<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// ~/.vue-templates 下面如果有文件名和 filters下的某一个字段匹配上</span>
        <span class="token keyword">const</span> condition <span class="token operator">=</span> filters<span class="token punctuation">[</span>glob<span class="token punctuation">]</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">evaluate</span><span class="token punctuation">(</span>condition<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 如果 metalsmith.metadata()下 condition 表达式不成立，删除该文件</span>
          <span class="token keyword">delete</span> files<span class="token punctuation">[</span>file<span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>大致描述以下这个过程： <code>meta.js</code> 中 <code>filter</code> 字段如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>filters<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'.eslintrc.js'</span><span class="token operator">:</span> <span class="token string">'lint'</span><span class="token punctuation">,</span>
    <span class="token string">'.eslintignore'</span><span class="token operator">:</span> <span class="token string">'lint'</span><span class="token punctuation">,</span>
    <span class="token string">'config/test.env.js'</span><span class="token operator">:</span> <span class="token string">'unit || e2e'</span><span class="token punctuation">,</span>
    <span class="token string">'build/webpack.test.conf.js'</span><span class="token operator">:</span> <span class="token string">&quot;unit &amp;&amp; runner === 'karma'&quot;</span><span class="token punctuation">,</span>
    <span class="token string">'test/unit/**/*'</span><span class="token operator">:</span> <span class="token string">'unit'</span><span class="token punctuation">,</span>
    <span class="token string">'test/unit/index.js'</span><span class="token operator">:</span> <span class="token string">&quot;unit &amp;&amp; runner === 'karma'&quot;</span><span class="token punctuation">,</span>
    <span class="token string">'test/unit/jest.conf.js'</span><span class="token operator">:</span> <span class="token string">&quot;unit &amp;&amp; runner === 'jest'&quot;</span><span class="token punctuation">,</span>
    <span class="token string">'test/unit/karma.conf.js'</span><span class="token operator">:</span> <span class="token string">&quot;unit &amp;&amp; runner === 'karma'&quot;</span><span class="token punctuation">,</span>
    <span class="token string">'test/unit/specs/index.js'</span><span class="token operator">:</span> <span class="token string">&quot;unit &amp;&amp; runner === 'karma'&quot;</span><span class="token punctuation">,</span>
    <span class="token string">'test/unit/setup.js'</span><span class="token operator">:</span> <span class="token string">&quot;unit &amp;&amp; runner === 'jest'&quot;</span><span class="token punctuation">,</span>
    <span class="token string">'test/e2e/**/*'</span><span class="token operator">:</span> <span class="token string">'e2e'</span><span class="token punctuation">,</span>
    <span class="token string">'src/router/**/*'</span><span class="token operator">:</span> <span class="token string">'router'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>一看应该就大致知道是什么意思。以 <code>.eslintrc.js</code> 为例，在模板中默认是有 <code>.eslintrc.js</code> 文件的。利用 <code>vue-cli</code> 初始化一个项目的时候，会询问你 <code>Use ESLint to lint your code?</code> ，然后 <code>inquirer.prompt</code> 通过回调将你回答的值存在 <code>metalsmith.metadata()</code> 的 <code>lint</code> 字段中，在调用 <code>filter</code> 方法的时候就会通过 <code>evaluate</code> 函数来判断在 <code>metalsmith.metadata()</code> 下 <code>lint</code> 的值是否为 <code>true</code>，如果为 <code>false</code> 的就会删除 <code>.eslintrc.js</code>。</p> <ul><li>renderTemplateFiles</li></ul> <p><code>renderTemplateFiles</code> 源码如下</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">renderTemplateFiles</span> <span class="token punctuation">(</span><span class="token parameter">skipInterpolation</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 在 meta.js 的 skipInterpolation 下面添加跳过插值的文件，这样在渲染的时候就不会使用 consolidate.handlebars.render 去渲染页面</span>
  skipInterpolation <span class="token operator">=</span> <span class="token keyword">typeof</span> skipInterpolation <span class="token operator">===</span> <span class="token string">'string'</span>
    <span class="token operator">?</span> <span class="token punctuation">[</span>skipInterpolation<span class="token punctuation">]</span>
    <span class="token operator">:</span> skipInterpolation
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">files<span class="token punctuation">,</span> metalsmith<span class="token punctuation">,</span> done</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> keys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span>
    <span class="token keyword">const</span> metalsmithMetadata <span class="token operator">=</span> metalsmith<span class="token punctuation">.</span><span class="token function">metadata</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    async<span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span>keys<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">file<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// skipping files with skipInterpolation option</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>skipInterpolation <span class="token operator">&amp;&amp;</span> <span class="token function">multimatch</span><span class="token punctuation">(</span><span class="token punctuation">[</span>file<span class="token punctuation">]</span><span class="token punctuation">,</span> skipInterpolation<span class="token punctuation">,</span> <span class="token punctuation">{</span> dot<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">const</span> str <span class="token operator">=</span> files<span class="token punctuation">[</span>file<span class="token punctuation">]</span><span class="token punctuation">.</span>contents<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token comment">// do not attempt to render files that do not have mustaches</span>
      <span class="token comment">// 如果在该文件中没有遇到 {{}} (小胡子)就跳过该文件</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">{{([^{}]+)}}</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token function">render</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> metalsmithMetadata<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          err<span class="token punctuation">.</span>message <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>file<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">] </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>err<span class="token punctuation">.</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
          <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        files<span class="token punctuation">[</span>file<span class="token punctuation">]</span><span class="token punctuation">.</span>contents <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> done<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p><code>renderTemplateFiles</code> 的主要功能就是利用 <code>consolidate.handlebars.render</code> 将 <code>~/.vue-templates</code>下面的 <code>handlebars</code> 模板文件渲染成正式的文件。</p> <h4 id="metalsmith-build"><a href="#metalsmith-build" class="header-anchor">#</a> metalsmith.build</h4> <p><code>metalsmith.build</code> 就是使用刚才分析的 <code>askQuestions</code> 、<code>filterFiles</code> 和 <code>renderTemplateFiles</code> 三个插件将项目的初始化文件生成出来并输出到目标目录，完成后输出相关的信息。</p> <p><code>generate</code> 函数分析就到此为止，在下一节会通过一张流程图来总结整个 <code>vue init</code> 命令的过程。</p> <h3 id="总结-5"><a href="#总结-5" class="header-anchor">#</a> 总结</h3> <p>通过一张图来回顾 <code>vue init</code> 命令:</p> <p><img src="/rat-summ/assets/img/vue-cli-init-summary.bddce5e6.svg" alt="img"></p> <p>从这个图可以比较清晰地看出 <code>vue init</code> 命令的整个流程，分析源码也是一样，跟着代码的执行顺序一步一步地分析，从而可以将整个流程搞清。虽然在 <code>vue-cli 3.0</code> 当中 <code>vue init</code> 是一个遗留的 <code>API</code>，不推荐使用，但是通过 <code>vue init</code> 来了解 <code>node</code> 命令行脚手架工具搭建还是一个不错的选择。</p> <h2 id="vue-config"><a href="#vue-config" class="header-anchor">#</a> <code>vue config</code></h2> <h3 id="config-命令"><a href="#config-命令" class="header-anchor">#</a> config 命令</h3> <p><strong>源码目录：</strong> packages/@vue/cli/lib/config.js 。</p> <p><strong>作用：</strong> 审查或修改全局的 CLI 配置 。</p> <p><code>vue config</code> 命令的入口在 <code>packages/@vue/cli/bin/vue.js</code> 中:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>program
  <span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">'config [value]'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">description</span><span class="token punctuation">(</span><span class="token string">'inspect and modify the config'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'-g, --get &lt;path&gt;'</span><span class="token punctuation">,</span> <span class="token string">'get value from option'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'-s, --set &lt;path&gt; &lt;value&gt;'</span><span class="token punctuation">,</span> <span class="token string">'set option value'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'-d, --delete &lt;path&gt;'</span><span class="token punctuation">,</span> <span class="token string">'delete option from config'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'-e, --edit'</span><span class="token punctuation">,</span> <span class="token string">'open config with default editor'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'--json'</span><span class="token punctuation">,</span> <span class="token string">'outputs JSON result only'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> cmd</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../lib/config'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token function">cleanArgs</span><span class="token punctuation">(</span>cmd<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><code>vue config</code> 参数比较好理解，注意一下的就是 <code>&lt;path&gt;</code> 这个值，它用于指定特定配置的路径，比如想要查看 <code>.vuerc</code> 中 presets 的值，可使用以下命令：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>vue config -g presets
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>如果想要查看某一个 preset 的详细信息，例如查看名称为 <code>demo</code> 的 preset，config 命令如下：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>vue config -g presets.demo
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>path</code> 就是一个路径，一级一级地查找，以 <code>.</code> 分割，接下来分析下 <code>config.js</code> 的内容。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">config</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VUE_CLI_TEST</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>当执行 vue config 命令时，执行了 config 函数，接着看 config 函数内容：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">config</span> <span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> file <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>homedir<span class="token punctuation">,</span> <span class="token string">'.vuerc'</span><span class="token punctuation">)</span> <span class="token comment">// 获取 .vuerc 路径</span>
  <span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token keyword">await</span> fs<span class="token punctuation">.</span><span class="token function">readJson</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span> <span class="token comment">// 获取 .vuerc 中的内容</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>options<span class="token punctuation">.</span>delete <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>options<span class="token punctuation">.</span>get <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>options<span class="token punctuation">.</span>edit <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>options<span class="token punctuation">.</span>set<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 输出 .vuerc 内容</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>json<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// --json</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        resolvedPath<span class="token operator">:</span> file<span class="token punctuation">,</span>
        content<span class="token operator">:</span> config
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Resolved path: '</span> <span class="token operator">+</span> file <span class="token operator">+</span> <span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>config<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>get<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 获取 .vuerc 中某个指定的配置，vue config -g presets 可以获取预设的值</span>
    <span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token function">get</span><span class="token punctuation">(</span>config<span class="token punctuation">,</span> options<span class="token punctuation">.</span>get<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>json<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        value
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>delete<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 删除 .vuerc 中某个指定的配置</span>
    <span class="token function">unset</span><span class="token punctuation">(</span>config<span class="token punctuation">,</span> options<span class="token punctuation">.</span>delete<span class="token punctuation">)</span>
    <span class="token keyword">await</span> fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>config<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>json<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        deleted<span class="token operator">:</span> options<span class="token punctuation">.</span>delete
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">You have removed the option: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>options<span class="token punctuation">.</span>delete<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>edit<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 启用编辑器编辑 .vuerc</span>
    <span class="token function">launch</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>set <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Make sure you define a value for the option </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>options<span class="token punctuation">.</span>set<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>set <span class="token operator">&amp;&amp;</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 设置 config，做一些类型处理</span>
    <span class="token function">set</span><span class="token punctuation">(</span>config<span class="token punctuation">,</span> options<span class="token punctuation">.</span>set<span class="token punctuation">,</span> value<span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token string">'[0-9]'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">set</span><span class="token punctuation">(</span>config<span class="token punctuation">,</span> options<span class="token punctuation">.</span>set<span class="token punctuation">,</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">===</span> <span class="token string">'true'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">set</span><span class="token punctuation">(</span>config<span class="token punctuation">,</span> options<span class="token punctuation">.</span>set<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">===</span> <span class="token string">'false'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">set</span><span class="token punctuation">(</span>config<span class="token punctuation">,</span> options<span class="token punctuation">.</span>set<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">await</span> fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>config<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>json<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        updated<span class="token operator">:</span> options<span class="token punctuation">.</span>set
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">You have updated the option: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>options<span class="token punctuation">.</span>set<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> to </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br></div></div><p>首先读取了 <code>.vuerc</code> 内容，然后根据参数处理对应的情形，下面以 <code>--get &lt;path&gt;</code> 为例来分析，处理 get 情形的代码如下:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>get<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 获取 .vuerc 中某个指定的配置，vue config -g presets 可以获取预设的值</span>
  <span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token function">get</span><span class="token punctuation">(</span>config<span class="token punctuation">,</span> options<span class="token punctuation">.</span>get<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>json<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      value
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>获取 value 的任务交给了 <code>@vue/cli-shared-utils</code> 中的 <code>get</code> 函数，那么继续看：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>exports<span class="token punctuation">.</span><span class="token function-variable function">get</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> fields <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> obj <span class="token operator">=</span> target
  <span class="token keyword">const</span> l <span class="token operator">=</span> fields<span class="token punctuation">.</span>length
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> key <span class="token operator">=</span> fields<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">undefined</span>
    <span class="token punctuation">}</span>
    obj <span class="token operator">=</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> obj<span class="token punctuation">[</span>fields<span class="token punctuation">[</span>l <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>先将 get 参数值以 . 分割，然后循环一级一级地遍历 obj 对象的值，最后返回。其他 set， delete 与 get 类似，就不做分析了，注意一下的就是 set 命令会对 输入的内容进行一定的处理，因为终端输入的内容都是 <code>String</code> 类型，因此检测到含有数字，则将其转为 Number 类型，如果检测到 <code>'true' || 'false'</code>，会将其转为 <code>Boolean</code> 类型。</p> <h2 id="vue-upgrade"><a href="#vue-upgrade" class="header-anchor">#</a> <code>vue upgrade</code></h2> <h3 id="upgrade-命令"><a href="#upgrade-命令" class="header-anchor">#</a> upgrade 命令</h3> <p><strong>源码目录：</strong> packages/@vue/cli-upgrade 。</p> <p><strong>作用：</strong> 升级 @vue/cli-service 和 vue-cli 插件。</p> <p><code>vue upgrade</code> 命令的入口在 <code>packages/@vue/cli/bin/vue.js</code> 中:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>program
  <span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">'upgrade [semverLevel]'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">description</span><span class="token punctuation">(</span><span class="token string">'upgrade vue cli service / plugins (default semverLevel: minor)'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">semverLevel<span class="token punctuation">,</span> cmd</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">loadCommand</span><span class="token punctuation">(</span><span class="token string">'upgrade'</span><span class="token punctuation">,</span> <span class="token string">'@vue/cli-upgrade'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>semverLevel<span class="token punctuation">,</span> <span class="token function">cleanArgs</span><span class="token punctuation">(</span>cmd<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>代码比较少，需要注意的就是 <code>semverLevel</code>，它用于指定安装 <code>@vue/cli-service || @vue/cli-plugin-*</code> 的版本号形式,可选择值有三个，默认值为 minor：</p> <ul><li><strong>patch</strong>： 升级到最新补丁版号</li> <li><strong>minor</strong>： 升级到最新次版本号</li> <li><strong>major</strong>： 升级到最新主版本号</li></ul> <p>先看下 <code>@vue/cli-upgrade/index.js</code> 代码，即 <code>upgrade</code> 命令执行的函数：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">vueCliUpgrade</span> <span class="token punctuation">(</span>semverLevel <span class="token operator">=</span> <span class="token string">'minor'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// get current deps</span>
  <span class="token comment">// filter @vue/cli-service &amp; @vue/cli-plugin-*</span>
  <span class="token keyword">const</span> pkg <span class="token operator">=</span> <span class="token function">getPackageJson</span><span class="token punctuation">(</span>projectPath<span class="token punctuation">)</span>
  <span class="token keyword">const</span> upgradableDepMaps <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token string">'dependencies'</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token string">'devDependencies'</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token string">'optionalDependencies'</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token function">logWithSpinner</span><span class="token punctuation">(</span><span class="token string">'Gathering update information...'</span><span class="token punctuation">)</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> depType <span class="token keyword">of</span> upgradableDepMaps<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token punctuation">[</span>packageName<span class="token punctuation">,</span> currRange<span class="token punctuation">]</span> <span class="token keyword">of</span> Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>pkg<span class="token punctuation">[</span>depType<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isCorePackage</span><span class="token punctuation">(</span>packageName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">continue</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">const</span> upgradable <span class="token operator">=</span> <span class="token function">getUpgradableVersion</span><span class="token punctuation">(</span>
        packageName<span class="token punctuation">,</span>
        currRange<span class="token punctuation">,</span>
        semverLevel
      <span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>upgradable <span class="token operator">!==</span> currRange<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        upgradableDepMaps<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>depType<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>packageName<span class="token punctuation">,</span> upgradable<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// some code ...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>首先获取了项目的 <code>package.json</code>，然后获取其中的 dependencies，devDependencies，optionalDependencies。获取了这些依赖后利用 <code>isCorePackage</code> 过滤掉不是 <code>@vue/cli-service</code> 和 <code>@vue/cli-plugin-*</code> 的依赖，再分别获取过滤后的依赖需要更新到的版本号，获取版本号使用了 <code>getUpgradableVersion</code> 方法:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">getUpgradableVersion</span> <span class="token punctuation">(</span>
  <span class="token parameter">packageName<span class="token punctuation">,</span>
  currRange<span class="token punctuation">,</span>
  semverLevel</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> newRange
  <span class="token keyword">if</span> <span class="token punctuation">(</span>semverLevel <span class="token operator">===</span> <span class="token string">'patch'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 安装最近的小版本依赖包， 补丁号</span>
    <span class="token keyword">const</span> currMaxVersion <span class="token operator">=</span> <span class="token function">getMaxSatisfying</span><span class="token punctuation">(</span>packageName<span class="token punctuation">,</span> currRange<span class="token punctuation">)</span>
    newRange <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">~</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>currMaxVersion<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
    <span class="token keyword">const</span> newMaxVersion <span class="token operator">=</span> <span class="token function">getMaxSatisfying</span><span class="token punctuation">(</span>packageName<span class="token punctuation">,</span> newRange<span class="token punctuation">)</span>
    newRange <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">~</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>newMaxVersion<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>semverLevel <span class="token operator">===</span> <span class="token string">'minor'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 安装最近大版本依赖包，次版本号</span>
    <span class="token keyword">const</span> currMaxVersion <span class="token operator">=</span> <span class="token function">getMaxSatisfying</span><span class="token punctuation">(</span>packageName<span class="token punctuation">,</span> currRange<span class="token punctuation">)</span>
    newRange <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">^</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>currMaxVersion<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> 
    <span class="token keyword">const</span> newMaxVersion <span class="token operator">=</span> <span class="token function">getMaxSatisfying</span><span class="token punctuation">(</span>packageName<span class="token punctuation">,</span> newRange<span class="token punctuation">)</span>
    newRange <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">^</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>newMaxVersion<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>semverLevel <span class="token operator">===</span> <span class="token string">'major'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 主版本号</span>
    newRange <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">^</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">getMaxSatisfying</span><span class="token punctuation">(</span>packageName<span class="token punctuation">,</span> <span class="token string">'latest'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Release type must be one of patch | minor | major!'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> newRange
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>通过 <code>getMaxSatisfying</code> 方法执行 <code>npm view</code> 命令获取依赖的版本号，然后根据 semverLevel 确定版本号的形式并返回。如果返回的版本号与当前 <code>package.json</code> 里面依赖的不一致，则将需要升级的信息存在 table 中，以便后续利用 <a href="https://github.com/Automattic/cli-table" target="_blank" rel="noopener noreferrer">cli-table<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 输出到控制台上，除此之外还将该依赖名称和需要升级的版本号存在 Map 结构中。</p> <p>在此之后会遍历 <code>upgradableDepMaps</code>，判断依赖是否有更新信息，如果有则输出信息并询问是否需要安装依赖，否则直接退出。</p> <h2 id="vue-info"><a href="#vue-info" class="header-anchor">#</a> <code>vue info</code></h2> <h3 id="info-命令"><a href="#info-命令" class="header-anchor">#</a> info 命令</h3> <p><strong>源码目录：</strong> 主要依赖了 npm 包 <a href="https://github.com/tabrindle/envinfo" target="_blank" rel="noopener noreferrer">envinfo<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p><strong>作用：</strong> 输出环境的调试信息。</p> <p><code>vue info</code> 命令的入口在 <code>packages/@vue/cli/bin/vue.js</code> 中:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>program
  <span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">'info'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">description</span><span class="token punctuation">(</span><span class="token string">'print debugging information about your environment'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">cmd</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chalk<span class="token punctuation">.</span><span class="token function">bold</span><span class="token punctuation">(</span><span class="token string">'\nEnvironment Info:'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'envinfo'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>
      <span class="token punctuation">{</span>
        System<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'OS'</span><span class="token punctuation">,</span> <span class="token string">'CPU'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        Binaries<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'Node'</span><span class="token punctuation">,</span> <span class="token string">'Yarn'</span><span class="token punctuation">,</span> <span class="token string">'npm'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        Browsers<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'Chrome'</span><span class="token punctuation">,</span> <span class="token string">'Edge'</span><span class="token punctuation">,</span> <span class="token string">'Firefox'</span><span class="token punctuation">,</span> <span class="token string">'Safari'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        npmPackages<span class="token operator">:</span> <span class="token string">'/**/{*vue*,@vue/*/}'</span><span class="token punctuation">,</span>
        npmGlobalPackages<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'@vue/cli'</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        showNotFound<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        duplicates<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        fullTree<span class="token operator">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p><code>npm info</code> 命令主要利用 npm <code>envinfo</code> 包输出一些环境的调试信息，比如系统信息，二进制执行文件信息，浏览器信息，项目中与 vue 相关的 npm 包的版本号以及全局 <code>@vue/cli</code> 信息，更多关于 <code>envinfo</code> 的使用可查看详细文档<a href="https://github.com/tabrindle/envinfo" target="_blank" rel="noopener noreferrer">envinfo<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h2 id="相关链接"><a href="#相关链接" class="header-anchor">#</a> 相关链接</h2> <p>https://kuangpf.com/vue-cli-analysis</p></div></div> <div class="page-slot page-slot-bottom"><!-- 横向自适应 -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6620245489"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022/04/15, 05:41:28</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/rat-summ/pages/313db8/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">vue-cli自定义实现</div></a> <a href="/rat-summ/pages/388ab8/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">vuepress主题模版及实践</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/rat-summ/pages/313db8/" class="prev">vue-cli自定义实现</a></span> <span class="next"><a href="/rat-summ/pages/388ab8/">vuepress主题模版及实践</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="mailto:yessz@foxmail.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/samyzh" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
    Copyright © 2015-2022
    <span><a href='https://my.samyz.cn' target='_blank'>友一升 | yessz</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">跟随系统</li><li class="iconfont icon-rijianmoshi">浅色模式</li><li class="iconfont icon-yejianmoshi">深色模式</li><li class="iconfont icon-yuedu">阅读模式</li></ul></div></div> <!----> <!----> <div class="custom-html-window custom-html-window-rb" style="display:;"><div class="custom-wrapper"><i class="close-but">×</i> <div><!-- 固定160*160px -->
      <ins class="adsbygoogle"
          style="display:inline-block;width:160px;height:160px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="8377369658"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
      </div></div></div></div><div class="global-ui"><!----></div></div>
    <script src="/rat-summ/assets/js/app.12c8e251.js" defer></script><script src="/rat-summ/assets/js/3.9ee9750d.js" defer></script><script src="/rat-summ/assets/js/19.edc5370a.js" defer></script><script src="/rat-summ/assets/js/126.5b6d9993.js" defer></script>
  </body>
</html>